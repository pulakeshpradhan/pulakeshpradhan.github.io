<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Earth Engine AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles adapted from rgee.html */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* Tab Styles from rgee.html */
        .tab-button {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #4b5563;
            font-size: 0.875rem;
        }
        .tab-button:hover {
            background-color: #e5e7eb;
            border-bottom-color: #9ca3af;
        }
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #1f2937;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Styles for collapsible sections from geeai.html, adapted for rgee look */
        .collapsible-container {
             background-color: #ffffff;
             border: 1px solid #d1d5db;
             border-radius: 0.5rem;
        }
        .collapsible-button {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            text-align: left;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 1rem;
        }
        .collapsible-content.open {
            padding-top: 1rem;
            padding-bottom: 1.25rem;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Copy button style from rgee.html */
        .copy-btn {
            background-color: #374151;
            color: #e5e7eb;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
        }
        .copy-btn:hover {
            background-color: #4b5563;
        }
        .copy-btn.copied {
            background-color: #10b981;
            color: white;
        }
        
        /* Prompt item styling */
        .prompt-item {
             background-color: #f9fafb; 
             border: 1px solid #e5e7eb;
        }

        /* Responsive adjustments for larger screens */
        @media (min-width: 768px) {
            .tab-button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
             .collapsible-button {
                padding: 1.25rem;
             }
             .collapsible-content {
                padding: 0 1.25rem;
             }
        }

        /* Styles for Social Tab */
        ::placeholder {
            color: #9ca3af;
            opacity: 1;
        }
 
        .file-input-label {
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
 
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        
        #prompt-thread .prompt-item:last-child .thread-line {
            display: none;
        }
 
        .footer-logo {
            width: 14px;
            height: 14px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }

        /* Modern UI for generated image */
        #image-container {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            font-family: 'Inter', sans-serif;
        }
        #project-heading-preview {
            font-weight: 600;
            color: #111827;
            letter-spacing: -0.025em;
        }
        #image-footer {
            opacity: 0.7;
        }
        #image-footer p {
             color: #4b5563;
        }
        .prompt-text {
            color: #374151;
            line-height: 1.6;
        }
        .delete-prompt-btn {
            color: #9ca3af;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .prompt-item:hover .delete-prompt-btn {
           opacity: 1;
        }
        .delete-prompt-btn:hover {
            color: #ef4444;
        }
        .prompt-body {
            background-color: #f3f4f6;
        }

    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-2 sm:px-4 py-6 md:py-12">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800">Google Earth Engine AI Assistant</h1>
            <p class="mt-2 md:mt-3 text-base md:text-lg text-gray-600">Easily analyze and visualize GEE datasets by just typing messages — <strong>no coding required</strong>.</p>
        </header>

        <main class="max-w-5xl mx-auto">
            <div class="mb-6 bg-white rounded-t-lg shadow-sm">
                 <div class="border-b border-gray-200">
                    <nav class="flex flex-wrap -mb-px text-sm font-medium text-center" id="promptTabs" aria-label="Tabs">
                        <!-- <button class="tab-button" data-tab-id="social">Social</button> -->
                        <!-- <button class="tab-button" data-tab-id="curated">Prompts</button> -->
                        <button class="tab-button" data-tab-id="how-it-works">AI Assistant</button>
                        <button class="tab-button" data-tab-id="about-me">About Me</button>
                    </nav>
                </div>
            </div>

            <div id="tabContentContainer">
                <div id="social" class="tab-content">
                    <div class="bg-gray-50 dark:bg-gray-900 text-black dark:text-gray-200">
                        <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                            <div class="text-center mb-10">
                                <p class="text-black dark:text-gray-400 mt-2 text-xl">Create and share social media posts</p>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                                    <h2 class="text-2xl font-bold mb-6 text-black dark:text-white">Controls</h2>
                                    <div class="mb-4">
                                        <label for="project-heading-input" class="block text-sm font-medium text-black dark:text-gray-300 mb-1">Project Heading</label>
                                        <input type="text" id="project-heading-input" placeholder="e.g., Marketing Campaign Feedback" class="w-full bg-gray-100 dark:bg-gray-700 text-black dark:text-white border-gray-300 dark:border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                                    </div>
                                    <div class="mb-4 pt-6 border-t border-gray-200 dark:border-gray-700">
                                        <label for="prompt-input" class="block text-sm font-medium text-black dark:text-gray-300 mb-1">Add a Prompt</p>
                                        <textarea id="prompt-input" rows="3" placeholder="Type a new prompt..." class="w-full bg-gray-100 dark:bg-gray-700 text-black dark:text-white border-gray-300 dark:border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                                    </div>
                                    <button id="add-prompt-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition transform hover:scale-105">Add Prompt</button>
                                    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                        <label class="block text-sm font-medium text-black dark:text-gray-300 mb-1">Upload Images</label>
                                        <label for="image-upload" class="file-input-label w-full flex items-center justify-center bg-gray-50 dark:bg-gray-700 text-black dark:text-gray-300 p-3 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 hover:border-indigo-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                            <span id="image-upload-text">Select one or more images...</span>
                                        </label>
                                        <input type="file" id="image-upload" class="hidden" accept="image/*" multiple>
                                    </div>
                                    <div class="mt-8">
                                        <button id="download-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800 transition transform hover:scale-105 flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                            Download as JPG
                                            <div id="loading-spinner" class="spinner ml-3 hidden"></div>
                                        </button>
                                    </div>
                                    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                        <h3 class="text-lg font-medium text-black dark:text-gray-300 mb-2 text-center">Share Image</h3>
                                        <p id="share-helper-text" class="text-xs text-gray-500 text-center mb-4">Click to share the generated image using your device's share dialog.</p>
                                        <button id="share-image-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition transform hover:scale-105 flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path></svg>
                                            Share Image
                                            <div id="share-loading-spinner" class="spinner ml-3 hidden"></div>
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-transparent p-6 rounded-2xl flex flex-col items-center justify-center">
                                    <h2 class="text-xl font-bold mb-4 text-black dark:text-white self-start">Image Preview</h2>
                                    <div id="image-container" class="w-full max-w-2xl text-black p-8 rounded-lg">
                                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                                            <h1 id="project-heading-preview" class="text-2xl">Project Heading</h1>
                                            <img id="logo-preview" src="https://lh3.googleusercontent.com/mSw2vqTxfj3oM2XWyFkKraH8-wvEjmrVQkg3egeyLKk4XXquqgNldu9ckhraK062Oe8tWCNRGwqgC5JPe3_olba811A=s120" alt="Company Logo" class="max-h-8" onerror="this.style.display='none';">
                                        </div>
                                        <div id="prompt-thread" class="space-y-4">
                                        </div>
                                        <div id="image-preview-container" class="mt-6 pt-6 border-t border-gray-200 space-y-4">
                                        </div>
                                        <div id="image-footer" class="mt-8 pt-4 border-t border-gray-200">
                                            <div class="flex items-center justify-center gap-2">
                                                <img src="https://lh3.googleusercontent.com/mSw2vqTxfj3oM2XWyFkKraH8-wvEjmrVQkg3egeyLKk4XXquqgNldu9ckhraK062Oe8tWCNRGwqgC5JPe3_olba811A=s120" alt="Chrome Web Store Logo" class="footer-logo">
                                                <p class="text-xs">
                                                    Made with the <strong>'Google Earth Engine AI Assistant'</strong> Chrome Extension
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="curated" class="tab-content">
                    <div class="space-y-4">
                        <div class="collapsible-container"><button class="collapsible-button"><div><span class="font-semibold text-lg text-gray-800">🗺️ Map Generation</span><p class="text-xs font-normal text-gray-500 mt-1">Keywords: show, display, map, generate, view, overlay</p></div><svg class="w-6 h-6 transform transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="collapsible-content"><div class="space-y-3" data-category="map-gen-content"></div></div></div>
                        <div class="collapsible-container"><button class="collapsible-button"><div><span class="font-semibold text-lg text-gray-800">🎨 Fixing Visualization</span><p class="text-xs font-normal text-gray-500 mt-1">Keywords: fix, adjust, change, apply, modify, set, stretch</p></div><svg class="w-6 h-6 transform transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="collapsible-content"><div class="space-y-3" data-category="viz-fix-content"></div></div></div>
                        <div class="collapsible-container"><button class="collapsible-button"><div><span class="font-semibold text-lg text-gray-800">📊 Calculating Statistics</span><p class="text-xs font-normal text-gray-500 mt-1">Keywords: calculate, compute, get, count, extract, reduceRegion, summarize</p></div><svg class="w-6 h-6 transform transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="collapsible-content"><div class="space-y-3" data-category="stats-content"></div></div></div>
                        <div class="collapsible-container"><button class="collapsible-button"><div><span class="font-semibold text-lg text-gray-800">📈 Creating Chart</span><p class="text-xs font-normal text-gray-500 mt-1">Keywords: chart, plot, create, generate, make, histogram, time-series</p></div><svg class="w-6 h-6 transform transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="collapsible-content"><div class="space-y-3" data-category="chart-content"></div></div></div>
                        <div class="collapsible-container"><button class="collapsible-button"><div><span class="font-semibold text-lg text-gray-800">💾 Exporting & Downloading</span><p class="text-xs font-normal text-gray-500 mt-1">Keywords: export, download, save, get URL, create task, to Drive, to Asset</p></div><svg class="w-6 h-6 transform transition-transform duration-300 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="collapsible-content"><div class="space-y-3" data-category="export-content"></div></div></div>
                        
                        <div class="bg-white border border-gray-200 p-4 md:p-5 rounded-lg">
                            <div class="flex flex-col sm:flex-row items-start">
                                <div class="flex-shrink-0 pt-1 mb-3 sm:mb-0">
                                    <svg class="w-6 h-6 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 01-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 013.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 013.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 01-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.684-2.684L11.25 18l1.938-.648a3.375 3.375 0 002.684-2.684L16.25 13l.648 1.938a3.375 3.375 0 002.684 2.684L21.75 18l-1.938.648a3.375 3.375 0 00-2.684 2.684z" /></svg>
                                </div>
                                <div class="sm:ml-4 flex-1">
                                    <h3 class="font-bold text-gray-800 text-lg">Tackling Common Issues</h3>
                                    <p class="mt-1 text-sm text-gray-600">If the AI can't find a dataset by name, you can provide the exact Dataset ID in your prompt.</p>
                                    <div class="mt-4 p-4 bg-gray-50 rounded-md border border-gray-200">
                                        <p class="text-xs font-semibold text-gray-500 uppercase">Example: Dataset Not Found</p>
                                        <p class="mt-2 text-sm text-gray-700"><strong>Problem Prompt:</strong> "Generate a map of global population density from the WorldPop dataset."</p>
                                        <p class="mt-2 text-sm text-green-700"><strong>Solution Prompt:</strong> "Generate a map of global population density from the WorldPop dataset. <code class='text-sm bg-gray-200 p-1 rounded'>ee.ImageCollection(\"CIESIN/GPWv411/GPW_UNWPP-Adjusted_Population_Count\")</code>"</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="how-it-works" class="tab-content">
                    <div class="space-y-6 bg-white p-4 md:p-6 rounded-lg border border-gray-200">
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Initial Setup: API Key</h3>
                            <p class="mt-1 text-sm text-gray-600">To use the GEE AI Assistant, you need a Gemini API key. This allows the tool to make requests to Google's generative models.</p>
                            <div class="mt-4"><ol class="list-decimal list-inside text-sm text-gray-600 space-y-2"><li>Go to <a href="https://aistudio.google.com/" target="_blank" class="font-medium text-indigo-600 hover:underline">Google AI Studio</a>.</li><li>Click on <strong>"Get API key"</strong> and then <strong>"Create API key in new project"</strong>.</li><li>Copy the generated API key to your clipboard.</li><li>Paste the key into the "Gemini API Key" field at the top of the GEE AI Assistant panel in the Code Editor.</li></ol></div>
                        </div>
                        <div>
                           <h3 class="font-bold text-gray-800 text-lg">Actions</h3>
                           <p class="mt-1 text-sm text-gray-600">These buttons provide core functionalities for interacting with your script.</p>
                           <div class="mt-4 space-y-3"><div><h4 class="font-semibold text-gray-700">Run Script</h4><p class="mt-1 text-sm text-gray-600">Executes the code currently in the script editor and displays the output on the map or in the console.</p></div><div><h4 class="font-semibold text-gray-700">Fix with Console Errors</h4><p class="mt-1 text-sm text-gray-600">If your script fails, just hit the 'Fix with Console Errors' button then 'Run Script' again do the process. If that doesn't work, try regenerating the code using the 'Generate' button.</p></div></div>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Generate Script</h3>
                            <p class="mt-1 text-sm text-gray-600">This is for creating new Google Earth Engine code from scratch. Type a description of what you want to achieve and click 'Generate'.</p>
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><div><h4 class="font-semibold text-green-600">What to Do</h4><ul class="mt-2 list-disc list-inside text-sm text-gray-600 space-y-1"><li>Be specific about locations, dates, and datasets. Provide dataset IDs.</li><li>Clearly state your goal (e.g., "calculate NDVI", "create a cloud-free mosaic").</li><li>Use prompts from the "Curated" tab as inspiration.</li></ul></div><div><h4 class="font-semibold text-red-600">What to Avoid</h4><ul class="mt-2 list-disc list-inside text-sm text-gray-600 space-y-1"><li>Asking for multiple, complex tasks in one prompt.</li><li>Using ambiguous dataset or place names.</li></ul></div></div>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Modify Existing Code</h3>
                            <p class="mt-1 text-sm text-gray-600">This allows you to make changes or additions to the code already in the editor. Enter your desired change and click 'Modify'.</p>
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><div><h4 class="font-semibold text-green-600">What to Do</h4><ul class="mt-2 list-disc list-inside text-sm text-gray-600 space-y-1"><li>Clearly state the change, e.g., "Change the color palette ".</li><li>Refer to specific variables or layers if you know them.</li><li>Focus on one modification at a time for best results.</li></ul></div><div><h4 class="font-semibold text-red-600">What to Avoid</h4><ul class="mt-2 list-disc list-inside text-sm text-gray-600 space-y-1"><li></li><li></li></ul></div></div>
                        </div>
                    </div>
                </div>

                <div id="user" class="tab-content"><div id="user-contrib-content-data" class="space-y-4"></div></div>

                <div id="contribute" class="tab-content"><div class="bg-white rounded-lg shadow-sm border border-gray-200 p-1"><iframe src="https://docs.google.com/forms/d/e/1FAIpQLSck1zEJptr4W-VfOR0zv2GHOAJkLST-3ABWBtFX9sH05ExhSw/viewform?embedded=true" class="w-full rounded-md" height="1100" frameborder="0" marginheight="0" marginwidth="0">Loading…</iframe></div></div>
                <div id="youtube" class="tab-content">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 md:p-6">
                        <h3 class="font-bold text-gray-800 text-xl mb-4 text-center">Video Tutorial</h3>
                        <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;" class="rounded-lg shadow-lg mx-auto max-w-4xl">
                        <iframe
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                            src="https://www.youtube.com/embed/6NLihVkHwsI?si=SEx1QWmj7RXqjqto"
                            title="YouTube video player"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            referrerpolicy="strict-origin-when-cross-origin"
                            allowfullscreen
                        ></iframe>
                        </div>
                        <div class="mt-4 text-center max-w-4xl mx-auto">
                        <p class="text-lg font-semibold text-gray-800">Introducing the Google Earth Engine AI Assistant</p>
                        <p class="mt-1 text-sm text-gray-600">A quick tutorial on how to get started and use the GEE AI Assistant for your geospatial analysis workflows.</p>
                        </div>
                    </div>
                </div>

                <div id="about-me" class="tab-content">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><h3 class="font-bold text-gray-800 text-xl">Pulakesh Pradhan</h3><p class="mt-2 text-gray-600">Creator of this prompt guide and the GEE AI Assistant.</p><a href="https://pulakeshpradhan.github.io/" target="_blank" rel="noopener noreferrer" class="mt-6 inline-block bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-sm transition-colors">Visit my Portfolio</a></div>
                </div>
            </div>
        </main>
         <footer class="text-center mt-12 py-6 border-t border-gray-300">
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Watch the Tutorial</h3>
                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;" class="rounded-lg shadow-lg mx-auto max-w-xl">
                    <iframe
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        src="https://www.youtube.com/embed/zCLoDylGM-c?si=Hwbeo1auMD9wthqA"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerpolicy="strict-origin-when-cross-origin"
                        allowfullscreen
                    ></iframe>
                </div>
            </div>
            <p class="text-gray-600 text-sm">Pulakesh Pradhan © 2025 - All rights reserved.</p>
        </footer>
    </div>

    <script>
        const promptData = {
            "map-gen-content": ["Show a Sentinel-2 true-color image of New Delhi for March 2024.", "Map vegetation cover in the Western Ghats over using NDVI.", "Visualize air pollution over Delhi.","Monitor glacier retreat in the Himalayas ", "Map forest fire in central India during the last dry season", "Assess drought conditions in Rajasthan with NDWI and precipitation data.", "Estimate rice planting areas using SAR data from Sentinel-1"],
            "viz-fix-content": ["The current map is too dark. Adjust the visualization parameters for my Landsat image to increase brightness.", "Apply a different color palette to my NDVI layer. Use a green-to-yellow ramp.", "Change the stretch of my elevation data to a min of 0 and a max of 3000 meters.", "Make the forest layer 50% transparent so I can see the basemap underneath.", "Modify the visualization of my water mask to be solid blue.", "The reds in my false-color image are too saturated. Tone them down.", "Can you apply a percentile stretch to the current image?", "Set the gamma value to 1.5 to lighten the mid-tones.", "Visualize the land cover layer using the official colors provided in the dataset's documentation.", "Invert the color palette for the temperature map."],
            "stats-content": ["Calculate the total area of deforestation in square kilometers within my drawn polygon.", "Compute the average NDVI for each county in California for 2023.", "Generate a report with the minimum, maximum, and mean temperature for the Sahara desert last month.", "Get the sum of the population for all census tracts in Chicago.", "What is the area of pixels classified as 'urban' in my land cover map for China?", "Count the number of pixels in this image that have an NDVI value greater than 0.5.", "Extract the pixel values from this image for a list of coordinates I provide.", "Calculate the histogram of slope values for this region.", "Run a `reduceRegion` to get the standard deviation of elevation within the current map view."],
            "chart-content": ["Create a time-series chart of monthly average precipitation for this point over the last decade.", "Generate a histogram of elevation values for the state of Colorado.", "Make a bar chart showing the area of each land cover class in this region.", "Chart the annual mean NDVI for this geometry from 2000 to 2023.", "I need a scatter plot of temperature vs. precipitation for this area.", "Plot the spectral profile for this pixel from a Landsat image.", "Create a time-series chart with a linear trendline.", "Chart the monthly burned area from the MODIS dataset for California for the last 5 years.", "Make a pie chart of the land cover class distribution."],
            "export-content": ["Export the current map view as a GeoTIFF to my Google Drive. Name it 'my_map'.", "Create a task to export this image collection as a series of TIFFs to my Drive folder 'GEE_Exports'.", "Generate a download URL for an RGB image of the current map as a high-resolution PNG.", "Export the results of my statistics calculation as a CSV file to my Drive.", "I need to export this feature collection as a Shapefile.", "Start an export task to save this ImageCollection to a TFRecord file in Google Cloud Storage.", "Get a URL for a thumbnail of this image, with dimensions 500x500 pixels.", "Write a script to export this image, clipping it to my geometry, at a scale of 30 meters.", "Export my land cover classification result to an Asset in my Earth Engine account. Asset ID should be 'my_landcover_map'.", "Prepare a download link for a video of this image collection time-series."]
        };

        function createPromptItem(text) {
            return `<div class="prompt-item flex justify-between items-center p-3 rounded-lg hover:bg-gray-100 transition-colors"><p class="prompt-text text-sm text-gray-700 flex-grow mr-4">${text}</p><button class="copy-btn flex-shrink-0">Copy</button></div>`;
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            for (const key in promptData) {
                const container = document.querySelector(`[data-category="${key}"]`);
                if(container) {
                    container.innerHTML = promptData[key].map(createPromptItem).join('');
                }
            }
            setupTabs();
            setupCollapsibles();
            loadUserContributions();
            initializeSocialTab();
        });

        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function setActiveTab(tabButton) {
                const tabId = tabButton.dataset.tabId;
                
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                tabButton.classList.add('active');

                tabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }

            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => setActiveTab(e.currentTarget));
            });
            if (tabButtons.length > 0) {
                 setActiveTab(tabButtons[0]);
            }
        }

        function setupCollapsibles() {
            const buttons = document.querySelectorAll('.collapsible-button');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const svg = button.querySelector('svg');
                    const isAlreadyOpen = content.classList.contains('open');

                    document.querySelectorAll('.collapsible-content.open').forEach(openContent => {
                        if (openContent !== content) {
                            openContent.style.maxHeight = null;
                            openContent.classList.remove('open');
                            openContent.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                        }
                    });

                    if (isAlreadyOpen) {
                        content.style.maxHeight = null;
                        content.classList.remove('open');
                        svg.classList.remove('rotate-180');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        content.classList.add('open');
                        svg.classList.add('rotate-180');
                    }
                });
            });
        }
        
        function generateStars(rating) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += `<svg class="w-5 h-5 ${i <= rating ? 'text-amber-400' : 'text-gray-300'}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
            }
            return `<div class="flex" title="Rated ${rating} out of 5">${starsHtml}</div>`;
        }

        async function loadUserContributions() {
            const container = document.getElementById('user-contrib-content-data');
            if (!container) return;

            container.innerHTML = '<p class="text-gray-500 text-center p-4">Loading contributions...</p>';
            const sheetId = '1x55zbgGhcsn3ZWLrVUQpE2eczra6cWR9paBJt4I0_t4';
            const sheetName = 'Form_Responses1';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                
                const csvText = await response.text();
                container.innerHTML = ''; 
                
                const rows = csvText.trim().split('\n').slice(1);
                if (rows.length === 0 || (rows.length === 1 && rows[0].trim() === '')) {
                     container.innerHTML = '<p class="text-gray-500 text-center p-4">No contributions yet. Be the first!</p>';
                     return;
                }

                rows.forEach(row => {
                    const columns = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(col => col.replace(/^"|"$/g, '').trim());
                    
                    const prompt = columns[3];
                    if (!prompt) return;

                    const contributor = columns[4] || 'N/A';
                    const affiliation = columns[5] || 'N/A';
                    const ratingStr = columns[6];
                    const appreciation = columns[7] || 'N/A';

                    let ratingDisplay;
                    const rating = parseInt(ratingStr, 10);
                    if (isNaN(rating)) {
                        ratingDisplay = `<span class="text-xs text-gray-500">Rating: N/A</span>`;
                    } else {
                        ratingDisplay = `<div class="flex items-center"><span class="text-xs text-gray-500 mr-2">Rating:</span>${generateStars(rating)}</div>`;
                    }


                    const cardHtml = `
                        <div class="prompt-container p-4 md:p-5 bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="flex justify-between items-start mb-3">
                                <p class="prompt-text text-base font-medium text-gray-800 mr-4">${prompt}</p>
                                <button class="copy-btn flex-shrink-0">Copy</button>
                            </div>
                            <div class="text-xs text-gray-500 space-y-1">
                                <p>Contributed by: <strong class="text-gray-600">${contributor}</strong></p>
                                <p>Affiliation: <span class="text-gray-600">${affiliation}</span></p>
                            </div>
                            <div class="mt-4">
                                ${appreciation !== 'N/A' ? 
                                    `<blockquote class="text-sm text-gray-600 italic border-l-2 pl-3 border-gray-200">“${appreciation}”</blockquote>` :
                                    `<p class="text-sm text-gray-500 italic">Quote: N/A</p>`
                                }
                            </div>
                            <div class="mt-4">
                                ${ratingDisplay}
                            </div>
                        </div>`;
                    container.insertAdjacentHTML('beforeend', cardHtml);
                });
            } catch (error) {
                console.error('Error fetching or parsing sheet data:', error);
                container.innerHTML = '<p class="text-red-500 text-center p-4">Could not load contributions. Please try again later.</p>';
            }
        }
        
        document.querySelector('main').addEventListener('click', (event) => {
            const button = event.target.closest('.copy-btn');
            if (!button) return;

            event.stopPropagation();
            const container = button.closest('.prompt-item, .prompt-container');
            const promptText = container?.querySelector('.prompt-text')?.textContent;
            if (!promptText) return;

            function updateButtonState(btn, copied) {
                if (copied) {
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                } else {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }
            }
            
            try {
                 navigator.clipboard.writeText(promptText).then(() => {
                    updateButtonState(button, true);
                    setTimeout(() => updateButtonState(button, false), 2000);
                }).catch(err => {
                    throw err; 
                });
            } catch (err) {
                 console.error('Async clipboard write failed, trying fallback: ', err);
                 const textArea = document.createElement("textarea");
                 textArea.value = promptText;
                 textArea.style.position = "fixed";
                 textArea.style.top = "0";
                 textArea.style.left = "0";
                 textArea.style.width = "2em";
                 textArea.style.height = "2em";
                 textArea.style.padding = "0";
                 textArea.style.border = "none";
                 textArea.style.outline = "none";
                 textArea.style.boxShadow = "none";
                 textArea.style.background = "transparent";
                 document.body.appendChild(textArea);
                 textArea.focus();
                 textArea.select();
                 try {
                     document.execCommand('copy');
                     updateButtonState(button, true);
                     setTimeout(() => updateButtonState(button, false), 2000);
                 } catch (execErr) {
                     console.error('Fallback copy command failed: ', execErr);
                     alert('Copying to clipboard failed.');
                 }
                 document.body.removeChild(textArea);
            }
        });

        // --- Social Tab JavaScript ---
        function initializeSocialTab() {
            const projectHeadingInput = document.getElementById('project-heading-input');
            const projectHeadingPreview = document.getElementById('project-heading-preview');
            const promptInput = document.getElementById('prompt-input');
            const addPromptBtn = document.getElementById('add-prompt-btn');
            const promptThread = document.getElementById('prompt-thread');
            const downloadBtn = document.getElementById('download-btn');
            const imageContainer = document.getElementById('image-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const imageUpload = document.getElementById('image-upload');
            const imageUploadText = document.getElementById('image-upload-text');
            const imagePreviewContainer = document.getElementById('image-preview-container');

            let isFirstUserPrompt = true;

            function createPromptElement(text) {
                const promptItem = document.createElement('div');
                promptItem.className = 'prompt-item flex items-start space-x-4 animate-fade-in';
                
                const avatar = document.createElement('div');
                avatar.className = 'w-8 h-8 mt-1 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center ring-2 ring-white';
                avatar.innerHTML = `<svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>`;

                const promptBody = document.createElement('div');
                promptBody.className = 'prompt-body flex-grow p-4 rounded-xl';
                
                const promptContent = document.createElement('div');
                promptContent.className = 'flex justify-between items-start';
                
                const promptParagraph = document.createElement('p');
                promptParagraph.className = 'prompt-text mr-4';
                promptParagraph.textContent = text;
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-prompt-btn flex-shrink-0';
                deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>`;

                promptContent.appendChild(promptParagraph);
                promptContent.appendChild(deleteButton);
                promptBody.appendChild(promptContent);
                promptItem.appendChild(avatar);
                promptItem.appendChild(promptBody);
                promptThread.appendChild(promptItem);
            }

            function initializeSamplePrompts() {
                if (promptThread) {
                    createPromptElement("This is a sample prompt to show how the new thread will look.");
                    createPromptElement("You can also upload images below the prompts!");
                }
            }

            initializeSamplePrompts();

            function handleAddPrompt() {
                const promptText = promptInput.value.trim();
                if (promptText) {
                    if (isFirstUserPrompt) {
                        promptThread.innerHTML = '';
                        isFirstUserPrompt = false;
                    }
                    createPromptElement(promptText);
                    promptInput.value = '';
                    promptInput.focus();
                }
            }

            projectHeadingInput.addEventListener('input', () => {
                projectHeadingPreview.textContent = projectHeadingInput.value || 'Project Heading';
            });

            addPromptBtn.addEventListener('click', handleAddPrompt);
            
            promptInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    handleAddPrompt();
                }
            });

            promptThread.addEventListener('click', (event) => {
                const deleteButton = event.target.closest('.delete-prompt-btn');
                if (deleteButton) {
                    if (isFirstUserPrompt) {
                        promptThread.innerHTML = '';
                        isFirstUserPrompt = false;
                        return; 
                    }
                    const promptItem = deleteButton.closest('.prompt-item');
                    if (promptItem) {
                        promptItem.remove();
                        if (promptThread.children.length === 0) {
                            isFirstUserPrompt = true;
                            initializeSamplePrompts();
                        }
                    }
                }
            });
            
            imageUpload.addEventListener('change', (event) => {
                imagePreviewContainer.innerHTML = ''; 
                const files = event.target.files;

                if (files.length > 0) {
                    imageUploadText.textContent = `${files.length} image(s) selected`;
                    for (const file of files) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full rounded-lg shadow-sm';
                            imagePreviewContainer.appendChild(img);
                        }
                        reader.readAsDataURL(file);
                    }
                } else {
                     imageUploadText.textContent = 'Select one or more images...';
                }
            });

            downloadBtn.addEventListener('click', () => {
                loadingSpinner.classList.remove('hidden');
                downloadBtn.disabled = true;

                const deleteButtons = document.querySelectorAll('.delete-prompt-btn');
                deleteButtons.forEach(btn => btn.style.display = 'none');

                html2canvas(imageContainer, { 
                    scale: 3, // Increased scale for higher resolution
                    useCORS: true,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    const link = document.createElement('a');
                    const filename = (projectHeadingInput.value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'prompt_thread') + '.jpg';
                    link.download = filename;
                    link.href = canvas.toDataURL('image/jpeg', 0.95);
                    link.click();
                    link.remove();
                    
                }).catch(err => {
                    console.error("Oops, something went wrong!", err);
                    alert("Error generating image. Please check the console for details.");
                }).finally(() => {
                    deleteButtons.forEach(btn => btn.style.display = '');
                    loadingSpinner.classList.add('hidden');
                    downloadBtn.disabled = false;
                });
            });

            // --- New Web Share API Logic ---
            const shareImageBtn = document.getElementById('share-image-btn');
            const shareLoadingSpinner = document.getElementById('share-loading-spinner');
            const shareHelperText = document.getElementById('share-helper-text');

            if (!navigator.share) {
                shareImageBtn.disabled = true;
                shareHelperText.textContent = 'Image sharing is not supported by your browser.';
                shareImageBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }

            shareImageBtn.addEventListener('click', async () => {
                shareLoadingSpinner.classList.remove('hidden');
                shareImageBtn.disabled = true;

                const deleteButtons = document.querySelectorAll('.delete-prompt-btn');
                deleteButtons.forEach(btn => btn.style.display = 'none');

                try {
                    const canvas = await html2canvas(imageContainer, {
                        scale: 3, // Increased scale for higher resolution
                        useCORS: true,
                        backgroundColor: '#ffffff'
                    });

                    const filename = (projectHeadingInput.value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'prompt_thread') + '.jpg';

                    canvas.toBlob(async (blob) => {
                        if (!blob) {
                            throw new Error("Canvas to Blob conversion failed.");
                        }
                        const file = new File([blob], filename, { type: 'image/jpeg' });
                        const shareData = {
                            files: [file],
                            title: projectHeadingInput.value.trim() || 'Social Media Post',
                            text: 'Check out this post I created with the GEE AI Assistant!',
                        };

                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            await navigator.share(shareData);
                        } else {
                            shareHelperText.textContent = "Sorry, this image can't be shared directly. Please download it instead.";
                            const link = document.createElement('a');
                            link.download = filename;
                            link.href = URL.createObjectURL(blob);
                            link.click();
                            URL.revokeObjectURL(link.href);
                            link.remove();
                        }
                    }, 'image/jpeg', 0.95);

                } catch (err) {
                    console.error("Sharing failed:", err);
                    shareHelperText.textContent = "Sharing failed. Please try downloading the image.";
                } finally {
                    deleteButtons.forEach(btn => btn.style.display = '');
                    shareLoadingSpinner.classList.add('hidden');
                    shareImageBtn.disabled = false;
                }
            });
        }
    </script>
</body>
</html>
