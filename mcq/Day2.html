<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive Google Earth Engine Quiz with advanced features">
    <meta name="keywords" content="GEE, Google Earth Engine, Quiz, Geospatial, Remote Sensing">
    <title>Advanced GEE Datatypes Quiz</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* Light Theme Colors */
            --primary: #4285F4; /* Google Blue */
            --secondary: #34A853; /* Google Green */
            --accent: #FBBC05; /* Google Yellow */
            --error: #EA4335; /* Google Red */
            --text-dark: #202124;
            --text-light: #5F6368;
            --bg-light: #F8F9FA;
            --card-bg: #FFFFFF;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --border-color: #DADCE0;
            
            /* Shared Variables */
            --radius: 16px;
            --transition: all 0.3s ease;
            --font-primary: 'Inter', sans-serif;
            --font-heading: 'Montserrat', sans-serif;
        }

        [data-theme="dark"] {
            /* Dark Theme Colors */
            --primary: #8AB4F8; /* Light Blue */
            --secondary: #81C995; /* Light Green */
            --accent: #FDD663; /* Light Yellow */
            --error: #F28B82; /* Light Red */
            --text-dark: #E8EAED;
            --text-light: #9AA0A6;
            --bg-light: #202124;
            --card-bg: #303134;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --border-color: #5F6368;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        header {
            background: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            font-size: 1.75rem;
            color: var(--primary);
            animation: pulse 2s infinite;
        }

        .logo-text {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-dark);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary);
        }

        [data-theme="dark"] .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .settings-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary);
        }

        [data-theme="dark"] .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 1rem;
        }

        .quiz-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 900px;
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease;
            border: 1px solid var(--border-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .quiz-title {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        .globe-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            animation: spin 12s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .difficulty-selector {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-light);
            padding: 0.5rem;
            border-radius: 30px;
        }

        .difficulty-btn {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
        }

        .difficulty-btn.active {
            background: var(--primary);
            color: white;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-light);
            padding: 0.75rem 1.25rem;
            border-radius: 30px;
            font-weight: 600;
        }

        .timer-icon {
            color: var(--primary);
        }

        .timer-display {
            font-family: monospace;
            font-size: 1.1rem;
        }

        .timer-controls {
            display: flex;
            gap: 0.25rem;
        }

        .timer-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.25rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .timer-btn:hover {
            color: var(--primary);
        }

        .progress-container {
            background: var(--bg-light);
            height: 8px;
            border-radius: 4px;
            margin: 2rem 0;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0.1)
            );
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        .question-container {
            margin-bottom: 2rem;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-number {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .question-number .badge {
            background: var(--primary);
            color: white;
            padding: 0.35rem 0.9rem;
            border-radius: 20px;
            font-size: 1rem;
        }

        .question {
            font-family: var(--font-heading);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.4;
            margin-bottom: 1.5rem;
        }

        .hint-container {
            margin-bottom: 1.5rem;
            background: rgba(66, 133, 244, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .hint-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .hint-text {
            color: var(--text-dark);
            font-size: 1rem;
            line-height: 1.5;
        }

        .hint-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem 0;
        }

        .hint-btn:hover {
            text-decoration: underline;
        }

        .options {
            display: grid;
            gap: 1rem;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            background: var(--bg-light);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .option-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .option-label.selected {
            transform: scale(1.02);
            border-color: var(--primary);
            background: rgba(66, 133, 244, 0.1);
        }

        .option-input {
            display: none;
        }

        .option-radio {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--text-light);
            position: relative;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .option-input:checked + .option-radio {
            border-color: var(--primary);
            background: var(--primary);
        }

        .option-input:checked + .option-radio::after {
            content: '';
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .option-label.correct {
            border-color: var(--secondary);
            background: rgba(52, 168, 83, 0.1);
        }

        .option-label.correct .option-radio {
            border-color: var(--secondary);
            background: var(--secondary);
        }

        .option-label.incorrect {
            border-color: var(--error);
            background: rgba(234, 67, 53, 0.1);
        }

        .option-label.incorrect .option-radio {
            border-color: var(--error);
            background: var(--error);
        }

        .option-text {
            font-size: 1.2rem;
            color: var(--text-dark);
            font-weight: 500;
            line-height: 1.4;
        }

        .feedback {
            margin: 1.5rem 0;
            padding: 1.25rem;
            border-radius: 12px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .feedback.correct {
            background: rgba(52, 168, 83, 0.1);
            border-left: 4px solid var(--secondary);
            display: block;
        }

        .feedback.incorrect {
            background: rgba(234, 67, 53, 0.1);
            border-left: 4px solid var(--error);
            display: block;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .feedback-icon {
            font-size: 1.5rem;
        }

        .feedback-icon.correct {
            color: var(--secondary);
        }

        .feedback-icon.incorrect {
            color: var(--error);
        }

        .feedback-title {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .feedback-title.correct {
            color: var(--secondary);
        }

        .feedback-title.incorrect {
            color: var(--error);
        }

        .feedback-text {
            color: var(--text-dark);
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
            width: 100%;
        }

        .btn:hover {
            background: #3367d6; /* Darker blue */
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #c5c5c5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .results-container.visible {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .results-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
        }

        .score-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 60%);
            animation: pulse 3s infinite;
        }

        .score-value {
            font-size: 5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .score-text {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .detail-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .detail-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .detail-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .results-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
        }

        .action-btn.secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .certificate-container {
            display: none;
            margin-top: 2rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem;
            background: var(--bg-light);
            position: relative;
        }

        .certificate-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .certificate {
            background: white;
            border: 5px solid var(--primary);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .certificate::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 1px solid var(--accent);
            margin: 0.5rem;
            pointer-events: none;
        }

        .certificate-title {
            font-family: var(--font-heading);
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .certificate-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .certificate-name {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent);
            display: inline-block;
            padding-bottom: 0.5rem;
        }

        .certificate-text {
            font-size: 1.1rem;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .certificate-date {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .certificate-signature {
            font-family: 'Pacifico', cursive;
            font-size: 1.5rem;
            color: var(--primary);
            margin-top: 1rem;
        }

        .certificate-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 100px;
            height: 100px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .settings-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .settings-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .settings-modal.visible .settings-content {
            transform: translateY(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--error);
        }

        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .settings-option-label {
            font-size: 1rem;
            color: var(--text-dark);
        }

        .settings-option-description {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .visualization-container {
            margin: 2rem 0;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            display: none;
        }

        .visualization-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .visualization-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .visualization-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .visualization-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .visualization-content {
            background: var(--bg-light);
            padding: 1.5rem;
            min-height: 200px;
        }

        .visualization-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .visualization-description {
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .quiz-container {
                padding: 1.5rem;
            }

            .quiz-title {
                font-size: 2rem;
            }

            .quiz-subtitle {
                font-size: 1rem;
            }

            .question {
                font-size: 1.5rem;
            }

            .option-text {
                font-size: 1rem;
            }

            .score-value {
                font-size: 4rem;
            }

            .certificate-title {
                font-size: 1.5rem;
            }

            .certificate-name {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                padding: 1rem;
            }

            .quiz-title {
                font-size: 1.75rem;
            }

            .globe-icon {
                font-size: 2.5rem;
            }

            .question {
                font-size: 1.25rem;
            }

            .option-label {
                padding: 1rem;
            }

            .option-radio {
                width: 20px;
                height: 20px;
            }

            .option-input:checked + .option-radio::after {
                width: 10px;
                height: 10px;
            }

            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }

            .score-value {
                font-size: 3rem;
            }

            .detail-value {
                font-size: 1.5rem;
            }

            .certificate-badge {
                width: 70px;
                height: 70px;
                font-size: 1.2rem;
            }
        }

        /* AI Controls Styles */
        .ai-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(66, 133, 244, 0.05);
            border-radius: var(--radius);
            border: 1px dashed var(--primary);
        }
        
        .ai-btn {
            background: linear-gradient(135deg, var(--primary), #8134af);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
        }
        
        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, 0.3);
        }
        
        .ai-btn:active {
            transform: translateY(0);
        }
        
        .ai-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .ai-btn.loading::after {
            content: '';
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
        
        .ai-topic-container {
            flex: 1;
            min-width: 200px;
        }
        
        .ai-topic-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            font-size: 1rem;
            background: var(--bg-light);
            color: var(--text-dark);
            transition: var(--transition);
        }
        
        .ai-topic-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        .ai-status {
            width: 100%;
            padding: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            text-align: center;
            display: none;
        }
        
        .ai-status.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Accessibility Styles */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        *:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* Animation for correct answer */
        @keyframes correctAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-label.correct {
            animation: correctAnimation 0.5s ease;
        }

        /* Animation for incorrect answer */
        @keyframes incorrectAnimation {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .option-label.incorrect {
            animation: incorrectAnimation 0.5s ease;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
            margin: 2rem auto;
        }

        .loading div {
            position: absolute;
            top: 33px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: var(--primary);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loading div:nth-child(1) {
            left: 8px;
            animation: loading1 0.6s infinite;
        }

        .loading div:nth-child(2) {
            left: 8px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(3) {
            left: 32px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(4) {
            left: 56px;
            animation: loading3 0.6s infinite;
        }

        @keyframes loading1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes loading2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        @keyframes loading3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        /* Confetti animation for celebration */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0.7;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh)) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-globe-americas"></i></div>
            <div class="logo-text">GEE Quiz Pro</div>
        </div>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
            <button id="settings-btn" class="settings-btn" aria-label="Open settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <main>
        <div class="quiz-container" id="quiz-container">
            <div id="quiz-content">
                <div class="quiz-header">
                    <div class="globe-icon"><i class="fas fa-globe-americas"></i></div>
                    <h1 class="quiz-title">GEE Datatypes Quiz</h1>
                    <p class="quiz-subtitle">Test your Google Earth Engine expertise with this interactive quiz</p>
                </div>

                <div class="quiz-controls">
                    <div class="difficulty-selector">
                        <button class="difficulty-btn active" data-difficulty="all">All</button>
                        <button class="difficulty-btn" data-difficulty="easy">Easy</button>
                        <button class="difficulty-btn" data-difficulty="medium">Medium</button>
                        <button class="difficulty-btn" data-difficulty="hard">Hard</button>
                    </div>
                    <div class="timer-container">
                        <span class="timer-icon"><i class="fas fa-stopwatch"></i></span>
                        <span id="time-display" class="timer-display">00:00</span>
                        <div class="timer-controls">
                            <button id="pause-timer" class="timer-btn" aria-label="Pause timer">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button id="reset-timer" class="timer-btn" aria-label="Reset timer">
                                <i class="fas fa-redo-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="ai-controls">
                    <button id="generate-ai-question" class="ai-btn">
                        <i class="fas fa-robot"></i> Generate AI Question
                    </button>
                    <div class="ai-topic-container">
                        <input type="text" id="ai-topic-input" placeholder="Enter a GEE topic (e.g., NDVI, Classification)" class="ai-topic-input">
                    </div>
                    <div id="ai-status" class="ai-status">Generating question...</div>
                    <div class="ai-info">
                        <i class="fas fa-info-circle"></i> 
                        <span>AI-generated questions are created dynamically based on your topic. Try topics like "NDVI", "Landsat", "Classification", "Scale", "Reducer", or "Projection".</span>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>

                <div id="question-container" class="question-container"></div>
                
                <div id="hint-container" class="hint-container">
                    <p id="hint-text" class="hint-text"></p>
                </div>
                
                <div id="visualization-container" class="visualization-container">
                    <div class="visualization-header">
                        <div class="visualization-title">Visual Explanation</div>
                        <button id="close-visualization" class="visualization-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="visualization-content" id="visualization-content">
                        <!-- Visualization content will be inserted here -->
                    </div>
                </div>
                
                <div id="feedback" class="feedback"></div>
                
                <button id="hint-btn" class="hint-btn">
                    <i class="fas fa-lightbulb"></i> Need a hint?
                </button>
                
                <button id="next-btn" class="btn" disabled>
                    <span id="btn-text">Check Answer</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                
                <div id="results-container" class="results-container">
                    <div class="results-header">
                        <h2 class="results-title">Quiz Completed!</h2>
                        <p class="results-subtitle">Here's how you performed</p>
                    </div>
                    
                    <div class="score-card">
                        <div class="score-value" id="score-percentage">0%</div>
                        <div class="score-text">Your Score</div>
                    </div>
                    
                    <div class="score-details">
                        <div class="detail-card">
                            <div class="detail-value" id="correct-answers">0</div>
                            <div class="detail-label">Correct</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-value" id="incorrect-answers">0</div>
                            <div class="detail-label">Incorrect</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-value" id="completion-time">00:00</div>
                            <div class="detail-label">Time</div>
                        </div>
                    </div>
                    
                    <div class="results-actions">
                        <button id="restart-btn" class="action-btn primary">
                            <i class="fas fa-redo-alt"></i> Restart Quiz
                        </button>
                        <button id="review-btn" class="action-btn secondary">
                            <i class="fas fa-search"></i> Review Answers
                        </button>
                        <button id="certificate-btn" class="action-btn secondary">
                            <i class="fas fa-award"></i> Get Certificate
                        </button>
                        <button id="share-btn" class="action-btn secondary">
                            <i class="fas fa-share-alt"></i> Share Results
                        </button>
                    </div>
                    
                    <div id="certificate-container" class="certificate-container">
                        <div class="certificate">
                            <div class="certificate-badge" id="certificate-score">90%</div>
                            <h3 class="certificate-title">Certificate of Achievement</h3>
                            <p class="certificate-subtitle">Google Earth Engine Datatypes Quiz</p>
                            <div class="certificate-name" id="certificate-name">Your Name</div>
                            <p class="certificate-text">
                                has successfully completed the Google Earth Engine Datatypes Quiz
                                with an outstanding performance, demonstrating proficiency in GEE concepts and applications.
                            </p>
                            <p class="certificate-date" id="certificate-date">March 21, 2025</p>
                            <div class="certificate-signature">GEE Quiz Pro</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="settings-modal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h3 class="settings-title">Settings</h3>
                <button id="close-settings" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Appearance</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Dark Mode</div>
                        <div class="settings-option-description">Switch between light and dark theme</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Quiz Settings</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Show Hints</div>
                        <div class="settings-option-description">Enable hint button for difficult questions</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="hints-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Show Visualizations</div>
                        <div class="settings-option-description">Display visual explanations for concepts</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="visualizations-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Shuffle Questions</div>
                        <div class="settings-option-description">Randomize question order</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="shuffle-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Save Progress</div>
                        <div class="settings-option-description">Save your progress for later</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="save-progress-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Accessibility</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">High Contrast</div>
                        <div class="settings-option-description">Increase contrast for better readability</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="contrast-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Larger Text</div>
                        <div class="settings-option-description">Increase text size throughout the quiz</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="large-text-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        // LLM API Configuration
        const LLM_API_URL = "https://api.openai.com/v1/chat/completions";
        // Note: In a production environment, API keys should be handled securely on the server side
        // This is a placeholder for demonstration purposes
        let API_KEY = ""; // Would be set by user in settings
        
        // Enhanced Quiz Questions with Difficulty Levels and Visualizations
        const originalQuestions = [
            { 
                q: "What is the primary purpose of the Google Earth Engine Data Catalog?", 
                options: [
                    "To store personal datasets", 
                    "To provide public geospatial datasets for analysis", 
                    "To visualize 3D maps", 
                    "To edit user data"
                ], 
                answer: "To provide public geospatial datasets for analysis", 
                explanation: "The GEE Data Catalog is designed to offer a wide range of public datasets for geospatial analysis and research.",
                difficulty: "easy",
                hint: "Think about the main resource that GEE provides to users for their analysis work.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/DataCatalog.png",
                    description: "The GEE Data Catalog contains petabytes of geospatial data from various sources, including satellite imagery, climate data, and more."
                }
            },
            { 
                q: "Which types of data can be found in the GEE Data Catalog?", 
                options: [
                    "Only satellite imagery", 
                    "Only vector data", 
                    "Both raster and vector data", 
                    "Only climate data"
                ], 
                answer: "Both raster and vector data", 
                explanation: "The catalog includes diverse data types, including satellite imagery, vector boundaries, digital elevation models, climate data, and more.",
                difficulty: "easy",
                hint: "Consider the different formats needed to represent both imagery and boundaries/shapes.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Datasets.png",
                    description: "GEE supports both raster data (like satellite imagery) and vector data (like country boundaries)."
                }
            },
            { 
                q: "How are datasets in the GEE Data Catalog typically organized?", 
                options: [
                    "By file size", 
                    "By acquisition date only", 
                    "By thematic categories and providers", 
                    "Alphabetically"
                ], 
                answer: "By thematic categories and providers", 
                explanation: "The GEE Data Catalog organizes datasets by thematic categories (like imagery, climate) and by data providers (like NASA, USGS).",
                difficulty: "medium",
                hint: "Think about how you would logically group similar types of Earth observation data.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/CatalogStructure.png",
                    description: "The catalog is organized hierarchically by themes and providers to make finding relevant datasets easier."
                }
            },
            { 
                q: "What is the function of the 'Inspector' tab in the GEE Code Editor?", 
                options: [
                    "To write and run code", 
                    "To inspect pixel values and properties", 
                    "To apply visualizations", 
                    "To view error messages"
                ], 
                answer: "To inspect pixel values and properties", 
                explanation: "The Inspector tool allows users to click on the map and view pixel values, properties, and feature details.",
                difficulty: "easy",
                hint: "This tool helps you examine what's at a specific location on your map.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Inspector.png",
                    description: "The Inspector tab shows detailed information about the data at locations you click on the map."
                }
            },
            { 
                q: "Which function is used to load an image collection from the Data Catalog in Google Earth Engine?", 
                options: [
                    "ee.Image()", 
                    "ee.ImageCollection()", 
                    "ee.FeatureCollection()", 
                    "ee.Catalog()"
                ], 
                answer: "ee.ImageCollection()", 
                explanation: "The ee.ImageCollection() function is used to load a collection of images from the catalog, such as a time series of satellite imagery.",
                difficulty: "medium",
                hint: "When you need to work with multiple images as a set, you use this function.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/ImageCollection.png",
                    description: "An ImageCollection represents a stack of images, often representing the same area at different times."
                }
            },
            { 
                q: "What does 'ee.Image' represent in Google Earth Engine?", 
                options: [
                    "A single satellite image or raster layer", 
                    "A vector feature", 
                    "A table of data", 
                    "A JavaScript object"
                ], 
                answer: "A single satellite image or raster layer", 
                explanation: "An ee.Image represents a raster dataset, often derived from satellite sensors or the result of computations.",
                difficulty: "easy",
                hint: "This is the basic raster data type in GEE.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Image.png",
                    description: "An ee.Image is a multi-band raster with values at each pixel position."
                }
            },
            { 
                q: "Which of the following is NOT a valid data type in GEE?", 
                options: [
                    "ee.Geometry", 
                    "ee.Number", 
                    "ee.Vector", 
                    "ee.String"
                ], 
                answer: "ee.Vector", 
                explanation: "GEE does not have an ee.Vector type; vector data is represented using ee.Geometry, ee.Feature, or ee.FeatureCollection.",
                difficulty: "medium",
                hint: "Look for the option that doesn't exist in the GEE API documentation.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/DataTypes.png",
                    description: "GEE has various data types including ee.Geometry, ee.Feature, ee.FeatureCollection for vector data, but no specific ee.Vector type."
                }
            },
            { 
                q: "How can you filter an ImageCollection in GEE by date?", 
                options: [
                    "Using Map.addLayer()", 
                    "Using ee.Filter.date()", 
                    "Using ee.Date()", 
                    "Using ee.filterByDate()"
                ], 
                answer: "Using ee.Filter.date()", 
                explanation: "The ee.Filter.date() function is used to filter an ImageCollection by a date range.",
                difficulty: "medium",
                hint: "This filter helps you select images from a specific time period.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/FilterDate.png",
                    description: "Filtering by date allows you to select images from a specific time period in your collection."
                }
            },
            { 
                q: "What is the purpose of the 'Map' object in GEE?", 
                options: [
                    "To store feature data", 
                    "To run reducers", 
                    "To display images and vectors on the map", 
                    "To filter datasets"
                ], 
                answer: "To display images and vectors on the map", 
                explanation: "The Map object is used for visualizing geospatial data as layers on the interactive map.",
                difficulty: "easy",
                hint: "This object controls what you see in the main visualization area.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Map.png",
                    description: "The Map object allows you to visualize your data and control the interactive map display."
                }
            },
            { 
                q: "Which file format is commonly used to export raster data from GEE?", 
                options: [
                    "CSV", 
                    "GeoJSON", 
                    "GeoTIFF", 
                    "Shapefile"
                ], 
                answer: "GeoTIFF", 
                explanation: "GeoTIFF is a popular format for exporting raster data as it preserves geospatial information and is widely supported.",
                difficulty: "medium",
                hint: "This format is specifically designed for georeferenced raster imagery.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Export.png",
                    description: "GeoTIFF is the standard format for exporting raster data with its geographic information intact."
                }
            },
            { 
                q: "What is a 'reducer' in Google Earth Engine?", 
                options: [
                    "A function that compresses file sizes", 
                    "A function that aggregates values across dimensions", 
                    "A tool that simplifies geometries", 
                    "A method to reduce the number of bands"
                ], 
                answer: "A function that aggregates values across dimensions", 
                explanation: "Reducers in GEE are functions that aggregate values across dimensions, such as calculating statistics over regions or time series.",
                difficulty: "hard",
                hint: "These functions help you summarize data across space, time, or bands.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Reducer.png",
                    description: "Reducers aggregate values across dimensions, like calculating the mean NDVI value for each country."
                }
            },
            { 
                q: "What is the significance of scale in Google Earth Engine?", 
                options: [
                    "It only affects visualization", 
                    "It determines the pixel resolution for computations", 
                    "It's only relevant for vector data", 
                    "It has no impact on analysis results"
                ], 
                answer: "It determines the pixel resolution for computations", 
                explanation: "Scale in GEE determines the pixel resolution at which computations are performed, affecting the accuracy and performance of analyses.",
                difficulty: "hard",
                hint: "This parameter affects how detailed your analysis will be.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Scale.png",
                    description: "Scale determines the pixel size for computations, which affects both accuracy and processing time."
                }
            },
            { 
                q: "Which method would you use to calculate the NDVI vegetation index in GEE?", 
                options: [
                    "image.normalizedDifference(['NIR', 'RED'])", 
                    "image.spectralIndex('NDVI')", 
                    "image.calculateIndex('NDVI')", 
                    "image.vegetation('NDVI')"
                ], 
                answer: "image.normalizedDifference(['NIR', 'RED'])", 
                explanation: "The normalizedDifference() method is used to calculate indices like NDVI by computing (NIR-RED)/(NIR+RED).",
                difficulty: "hard",
                hint: "This method computes (band1-band2)/(band1+band2) which is the formula for normalized difference indices.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/NDVI.png",
                    description: "NDVI is calculated using the normalized difference between near-infrared and red bands."
                }
            },
            { 
                q: "What is the purpose of the 'projection' parameter in GEE?", 
                options: [
                    "To determine how data is displayed on the map", 
                    "To specify the coordinate reference system for analysis", 
                    "To project data into the future", 
                    "To create 3D visualizations"
                ], 
                answer: "To specify the coordinate reference system for analysis", 
                explanation: "The projection parameter defines the coordinate reference system used for spatial operations and exports.",
                difficulty: "hard",
                hint: "This parameter defines how coordinates are mapped to positions on Earth's surface.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Projection.png",
                    description: "Different projections represent Earth's curved surface on a flat plane in different ways."
                }
            },
            { 
                q: "What is the maximum size limit for exporting an image from GEE?", 
                options: [
                    "100 MB", 
                    "1 GB", 
                    "10 GB", 
                    "There is no fixed limit, but practical limits exist"
                ], 
                answer: "There is no fixed limit, but practical limits exist", 
                explanation: "While GEE doesn't impose a strict size limit, practical limitations exist based on memory, computation time, and download bandwidth.",
                difficulty: "hard",
                hint: "Think about the practical constraints rather than a specific number.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/ExportLimits.png",
                    description: "Export size is limited by practical constraints like computation resources and download bandwidth."
                }
            }
        ];

        // DOM Elements
        const quizContainer = document.getElementById('quiz-container');
        const questionContainer = document.getElementById('question-container');
        const progressBar = document.getElementById('progress-bar');
        const nextBtn = document.getElementById('next-btn');
        const btnText = document.getElementById('btn-text');
        const feedback = document.getElementById('feedback');
        const resultsContainer = document.getElementById('results-container');
        const scorePercentage = document.getElementById('score-percentage');
        const correctAnswers = document.getElementById('correct-answers');
        const incorrectAnswers = document.getElementById('incorrect-answers');
        const completionTime = document.getElementById('completion-time');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const certificateBtn = document.getElementById('certificate-btn');
        const shareBtn = document.getElementById('share-btn');
        const certificateContainer = document.getElementById('certificate-container');
        const certificateScore = document.getElementById('certificate-score');
        const certificateName = document.getElementById('certificate-name');
        const certificateDate = document.getElementById('certificate-date');
        const timeDisplay = document.getElementById('time-display');
        const pauseTimerBtn = document.getElementById('pause-timer');
        const resetTimerBtn = document.getElementById('reset-timer');
        const themeToggle = document.getElementById('theme-toggle');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const hintsToggle = document.getElementById('hints-toggle');
        const visualizationsToggle = document.getElementById('visualizations-toggle');
        const shuffleToggle = document.getElementById('shuffle-toggle');
        const saveProgressToggle = document.getElementById('save-progress-toggle');
        const contrastToggle = document.getElementById('contrast-toggle');
        const largeTextToggle = document.getElementById('large-text-toggle');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const hintBtn = document.getElementById('hint-btn');
        const hintContainer = document.getElementById('hint-container');
        const hintText = document.getElementById('hint-text');
        const visualizationContainer = document.getElementById('visualization-container');
        const visualizationContent = document.getElementById('visualization-content');
        const closeVisualization = document.getElementById('close-visualization');

        // Quiz State
        let questions = [...originalQuestions];
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOption = null;
        let quizCompleted = false;
        let reviewMode = false;
        let seconds = 0;
        let minutes = 0;
        let timerInterval;
        let timerPaused = false;
        let currentDifficulty = 'all';
        let userAnswers = [];
        let userName = 'Quiz Taker';

        // Initialize the quiz
        function initQuiz() {
            // Load saved settings
            loadSettings();
            
            // Load saved progress if enabled
            if (saveProgressToggle.checked && localStorage.getItem('geeQuizProgress')) {
                loadProgress();
            } else {
                // Apply difficulty filter
                filterQuestionsByDifficulty();
                
                // Shuffle questions if enabled
                if (shuffleToggle.checked) {
                    shuffleQuestions();
                }
                
                // Reset quiz state
                currentQuestionIndex = 0;
                score = 0;
                userAnswers = Array(questions.length).fill(null);
                quizCompleted = false;
                reviewMode = false;
                
                // Reset timer
                resetTimer();
                startTimer();
            }
            
            // Show first question
            showQuestion();
            updateProgressBar();
            
            // Hide results
            resultsContainer.classList.remove('visible');
            certificateContainer.classList.remove('visible');
        }

        // Filter questions by difficulty
        function filterQuestionsByDifficulty() {
            if (currentDifficulty === 'all') {
                questions = [...originalQuestions];
            } else {
                questions = originalQuestions.filter(q => q.difficulty === currentDifficulty);
            }
        }

        // Shuffle questions
        function shuffleQuestions() {
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
        }

        // Show current question
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Reset state
            selectedOption = null;
            nextBtn.disabled = true;
            btnText.textContent = 'Check Answer';
            feedback.className = 'feedback';
            feedback.innerHTML = '';
            hintContainer.classList.remove('visible');
            visualizationContainer.classList.remove('visible');
            
            // Create question HTML
            const questionNumber = currentQuestionIndex + 1;
            const totalQuestions = questions.length;
            
            let questionHTML = `
                <div class="question-number">
                    <span class="badge">${questionNumber}/${totalQuestions}</span>
                    <span>Question ${questionNumber}</span>
                    ${question.difficulty ? `<span class="difficulty-tag ${question.difficulty}">(${question.difficulty})</span>` : ''}
                </div>
                <h2 class="question">${question.q}</h2>
                <div class="options">
            `;
            
            // Add options
            question.options.forEach((option, index) => {
                const isSelected = reviewMode && userAnswers[currentQuestionIndex] === index;
                const isCorrect = reviewMode && option === question.answer;
                
                let optionClass = 'option-label';
                if (reviewMode) {
                    if (isSelected && isCorrect) {
                        optionClass += ' correct';
                    } else if (isSelected && !isCorrect) {
                        optionClass += ' incorrect';
                    } else if (isCorrect) {
                        optionClass += ' correct';
                    }
                } else if (isSelected) {
                    optionClass += ' selected';
                }
                
                questionHTML += `
                    <label class="${optionClass}" data-index="${index}">
                        <input type="radio" name="quiz-option" class="option-input" ${isSelected ? 'checked' : ''} ${reviewMode ? 'disabled' : ''}>
                        <div class="option-radio"></div>
                        <span class="option-text">${option}</span>
                    </label>
                `;
            });
            
            questionHTML += `</div>`;
            
            // Update DOM
            questionContainer.innerHTML = questionHTML;
            
            // Add event listeners to options
            if (!reviewMode) {
                const optionLabels = document.querySelectorAll('.option-label');
                optionLabels.forEach(label => {
                    label.addEventListener('click', selectOption);
                });
            }
            
            // Show feedback in review mode
            if (reviewMode) {
                showFeedback(true);
                nextBtn.disabled = false;
                btnText.textContent = currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Review';
            }
            
            // Update hint button visibility
            hintBtn.style.display = hintsToggle.checked && !reviewMode ? 'flex' : 'none';
        }

        // Select an option
        function selectOption(e) {
            // Remove selected class from all options
            const optionLabels = document.querySelectorAll('.option-label');
            optionLabels.forEach(label => {
                label.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            const selectedLabel = e.currentTarget;
            selectedLabel.classList.add('selected');
            
            // Update selected option
            selectedOption = parseInt(selectedLabel.dataset.index);
            
            // Enable next button
            nextBtn.disabled = false;
        }

        // Check answer
        function checkAnswer() {
            const question = questions[currentQuestionIndex];
            const selectedOptionText = question.options[selectedOption];
            const isCorrect = selectedOptionText === question.answer;
            
            // Update score
            if (isCorrect) {
                score++;
            }
            
            // Save user answer
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // Update UI
            const optionLabels = document.querySelectorAll('.option-label');
            optionLabels.forEach(label => {
                const index = parseInt(label.dataset.index);
                const optionText = question.options[index];
                
                if (optionText === question.answer) {
                    label.classList.add('correct');
                } else if (index === selectedOption && !isCorrect) {
                    label.classList.add('incorrect');
                }
                
                // Disable all options
                const input = label.querySelector('.option-input');
                input.disabled = true;
            });
            
            // Show feedback
            showFeedback(isCorrect);
            
            // Update button
            btnText.textContent = currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'See Results';
            
            // Save progress if enabled
            if (saveProgressToggle.checked) {
                saveProgress();
            }
        }

        // Show feedback
        function showFeedback(isCorrect) {
            const question = questions[currentQuestionIndex];
            
            let feedbackHTML = `
                <div class="feedback-header">
                    <div class="feedback-icon ${isCorrect ? 'correct' : 'incorrect'}">
                        <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                    </div>
                    <div class="feedback-title ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? 'Correct!' : 'Incorrect!'}
                    </div>
                </div>
                <p class="feedback-text">${question.explanation}</p>
            `;
            
            // Add visualization button if available
            if (visualizationsToggle.checked && question.visualization) {
                feedbackHTML += `
                    <button id="show-visualization" class="hint-btn">
                        <i class="fas fa-image"></i> View Visual Explanation
                    </button>
                `;
            }
            
            feedback.innerHTML = feedbackHTML;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            
            // Add event listener to visualization button
            const visualizationBtn = document.getElementById('show-visualization');
            if (visualizationBtn) {
                visualizationBtn.addEventListener('click', () => showVisualization(question.visualization));
            }
        }

        // Show visualization
        function showVisualization(visualization) {
            if (!visualization) return;
            
            let visualizationHTML = '';
            
            if (visualization.image) {
                visualizationHTML += `
                    <img src="${visualization.image}" alt="Visualization" class="visualization-image">
                `;
            }
            
            if (visualization.description) {
                visualizationHTML += `
                    <p class="visualization-description">${visualization.description}</p>
                `;
            }
            
            visualizationContent.innerHTML = visualizationHTML;
            visualizationContainer.classList.add('visible');
        }

        // Show hint
        function showHint() {
            const question = questions[currentQuestionIndex];
            
            if (question.hint) {
                hintText.textContent = question.hint;
                hintContainer.classList.add('visible');
                hintBtn.style.display = 'none';
            }
        }

        // Next question or show results
        function nextQuestion() {
            if (!reviewMode && btnText.textContent === 'Check Answer') {
                // Check answer
                checkAnswer();
            } else {
                // Move to next question or show results
                currentQuestionIndex++;
                
                if (currentQuestionIndex < questions.length) {
                    // Show next question
                    showQuestion();
                    updateProgressBar();
                } else {
                    // End of quiz
                    if (reviewMode) {
                        // End review mode
                        reviewMode = false;
                        showResults();
                    } else {
                        // Complete quiz
                        completeQuiz();
                    }
                }
            }
        }

        // Complete quiz
        function completeQuiz() {
            quizCompleted = true;
            pauseTimer();
            showResults();
            
            // Clear saved progress if completed
            if (saveProgressToggle.checked) {
                localStorage.removeItem('geeQuizProgress');
            }
            
            // Show confetti for good scores
            if (score / questions.length >= 0.7) {
                showConfetti();
            }
        }

        // Show results
        function showResults() {
            // Calculate percentage
            const percentage = Math.round((score / questions.length) * 100);
            
            // Update results
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = score;
            incorrectAnswers.textContent = questions.length - score;
            completionTime.textContent = timeDisplay.textContent;
            
            // Update certificate
            certificateScore.textContent = `${percentage}%`;
            certificateName.textContent = userName;
            
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            certificateDate.textContent = today.toLocaleDateString('en-US', options);
            
            // Show results
            questionContainer.innerHTML = '';
            feedback.className = 'feedback';
            feedback.innerHTML = '';
            hintContainer.classList.remove('visible');
            visualizationContainer.classList.remove('visible');
            resultsContainer.classList.add('visible');
            nextBtn.style.display = 'none';
            hintBtn.style.display = 'none';
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Timer functions
        function updateTimer() {
            seconds++;
            if (seconds >= 60) {
                seconds = 0;
                minutes++;
            }
            
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
            
            timeDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
        }

        function startTimer() {
            if (!timerInterval) {
                timerInterval = setInterval(updateTimer, 1000);
                timerPaused = false;
                pauseTimerBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                timerPaused = true;
                pauseTimerBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            seconds = 0;
            minutes = 0;
            timeDisplay.textContent = '00:00';
            timerPaused = false;
            pauseTimerBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        // Toggle theme
        function toggleTheme() {
            const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
            
            if (isDarkMode) {
                document.body.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                darkModeToggle.checked = false;
            } else {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                darkModeToggle.checked = true;
            }
            
            // Save setting
            saveSettings();
        }

        // Toggle settings modal
        function toggleSettings() {
            settingsModal.classList.toggle('visible');
        }

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                darkMode: darkModeToggle.checked,
                showHints: hintsToggle.checked,
                showVisualizations: visualizationsToggle.checked,
                shuffleQuestions: shuffleToggle.checked,
                saveProgress: saveProgressToggle.checked,
                highContrast: contrastToggle.checked,
                largeText: largeTextToggle.checked,
                difficulty: currentDifficulty
            };
            
            localStorage.setItem('geeQuizSettings', JSON.stringify(settings));
        }

        // Load settings from localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('geeQuizSettings');
            
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // Apply settings
                darkModeToggle.checked = settings.darkMode;
                hintsToggle.checked = settings.showHints;
                visualizationsToggle.checked = settings.showVisualizations;
                shuffleToggle.checked = settings.shuffleQuestions;
                saveProgressToggle.checked = settings.saveProgress;
                contrastToggle.checked = settings.highContrast;
                largeTextToggle.checked = settings.largeText;
                currentDifficulty = settings.difficulty || 'all';
                
                // Apply theme
                if (settings.darkMode) {
                    document.body.setAttribute('data-theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
                
                // Apply high contrast
                if (settings.highContrast) {
                    document.body.classList.add('high-contrast');
                }
                
                // Apply large text
                if (settings.largeText) {
                    document.body.classList.add('large-text');
                }
                
                // Update difficulty buttons
                difficultyBtns.forEach(btn => {
                    if (btn.dataset.difficulty === currentDifficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            const progress = {
                currentQuestionIndex,
                score,
                userAnswers,
                seconds,
                minutes,
                questions,
                currentDifficulty
            };
            
            localStorage.setItem('geeQuizProgress', JSON.stringify(progress));
        }

        // Load progress from localStorage
        function loadProgress() {
            const savedProgress = localStorage.getItem('geeQuizProgress');
            
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                
                currentQuestionIndex = progress.currentQuestionIndex;
                score = progress.score;
                userAnswers = progress.userAnswers;
                seconds = progress.seconds;
                minutes = progress.minutes;
                questions = progress.questions;
                currentDifficulty = progress.currentDifficulty;
                
                // Update timer display
                const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
                const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
                timeDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
                
                // Update difficulty buttons
                difficultyBtns.forEach(btn => {
                    if (btn.dataset.difficulty === currentDifficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Start timer
                startTimer();
            }
        }

        // Change difficulty
        function changeDifficulty(difficulty) {
            if (difficulty === currentDifficulty) return;
            
            // Update active button
            difficultyBtns.forEach(btn => {
                if (btn.dataset.difficulty === difficulty) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update difficulty
            currentDifficulty = difficulty;
            
            // Save setting
            saveSettings();
            
            // Restart quiz with new difficulty
            initQuiz();
        }

        // Review answers
        function reviewAnswers() {
            reviewMode = true;
            currentQuestionIndex = 0;
            showQuestion();
            updateProgressBar();
            
            // Update button
            nextBtn.style.display = 'block';
            btnText.textContent = 'Next Question';
            
            // Hide results
            resultsContainer.classList.remove('visible');
        }

        // Generate certificate
        function generateCertificate() {
            // Show certificate
            certificateContainer.classList.add('visible');
            
            // Scroll to certificate
            certificateContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // Share results
        function shareResults() {
            const percentage = Math.round((score / questions.length) * 100);
            const text = `I scored ${percentage}% on the GEE Datatypes Quiz! Test your Google Earth Engine knowledge too!`;
            
            // Try to use Web Share API if available
            if (navigator.share) {
                navigator.share({
                    title: 'My GEE Quiz Results',
                    text: text,
                    url: window.location.href
                }).catch(err => {
                    console.error('Error sharing:', err);
                    // Fallback to clipboard
                    copyToClipboard(text);
                });
            } else {
                // Fallback to clipboard
                copyToClipboard(text);
            }
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            alert('Result copied to clipboard!');
        }

        // Show confetti animation
        function showConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            quizContainer.appendChild(confettiContainer);
            
            const colors = ['#4285F4', '#34A853', '#FBBC05', '#EA4335'];
            
            // Create confetti pieces
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.animationDelay = `${Math.random() * 3}s`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Random size
                const size = Math.random() * 10 + 5;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                
                // Random shape
                const shapes = ['circle', 'square', 'triangle'];
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                
                if (shape === 'circle') {
                    confetti.style.borderRadius = '50%';
                } else if (shape === 'triangle') {
                    confetti.style.width = '0';
                    confetti.style.height = '0';
                    confetti.style.backgroundColor = 'transparent';
                    confetti.style.borderLeft = `${size/2}px solid transparent`;
                    confetti.style.borderRight = `${size/2}px solid transparent`;
                    confetti.style.borderBottom = `${size}px solid ${colors[Math.floor(Math.random() * colors.length)]}`;
                }
                
                confettiContainer.appendChild(confetti);
            }
            
            // Remove confetti after animation
            setTimeout(() => {
                quizContainer.removeChild(confettiContainer);
            }, 5000);
        }

        // Ask for user name
        function askForName() {
            const name = prompt('Enter your name for the certificate:', 'Quiz Taker');
            if (name) {
                userName = name;
                certificateName.textContent = userName;
            }
        }

        // Event Listeners
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', initQuiz);
        reviewBtn.addEventListener('click', reviewAnswers);
        certificateBtn.addEventListener('click', () => {
            askForName();
            generateCertificate();
        });
        shareBtn.addEventListener('click', shareResults);
        pauseTimerBtn.addEventListener('click', pauseTimer);
        resetTimerBtn.addEventListener('click', resetTimer);
        themeToggle.addEventListener('click', toggleTheme);
        settingsBtn.addEventListener('click', toggleSettings);
        closeSettings.addEventListener('click', toggleSettings);
        hintBtn.addEventListener('click', showHint);
        closeVisualization.addEventListener('click', () => {
            visualizationContainer.classList.remove('visible');
        });

        // Settings event listeners
        darkModeToggle.addEventListener('change', toggleTheme);
        hintsToggle.addEventListener('change', saveSettings);
        visualizationsToggle.addEventListener('change', saveSettings);
        shuffleToggle.addEventListener('change', saveSettings);
        saveProgressToggle.addEventListener('change', saveSettings);
        
        contrastToggle.addEventListener('change', () => {
            document.body.classList.toggle('high-contrast', contrastToggle.checked);
            saveSettings();
        });
        
        largeTextToggle.addEventListener('change', () => {
            document.body.classList.toggle('large-text', largeTextToggle.checked);
            saveSettings();
        });
        
        // LLM Integration
        const generateAiQuestionBtn = document.getElementById('generate-ai-question');
        const aiTopicInput = document.getElementById('ai-topic-input');
        const aiStatus = document.getElementById('ai-status');
        
        // Function to generate a question using LLM
        async function generateAiQuestion() {
            const topic = aiTopicInput.value.trim() || "Google Earth Engine";
            
            // Show loading state
            generateAiQuestionBtn.classList.add('loading');
            generateAiQuestionBtn.disabled = true;
            aiStatus.textContent = `Generating question about ${topic}...`;
            aiStatus.classList.add('visible');
            
            try {
                // In a real implementation, this would call the OpenAI API
                // For demonstration purposes, we'll simulate the API call
                const question = await simulateLLMApiCall(topic);
                
                // Add the generated question to the questions array
                questions.push(question);
                
                // Update UI to show the new question
                currentQuestionIndex = questions.length - 1;
                showQuestion();
                updateProgressBar();
                
                // Success message
                aiStatus.textContent = `New question about ${topic} added!`;
                setTimeout(() => {
                    aiStatus.classList.remove('visible');
                }, 3000);
            } catch (error) {
                console.error('Error generating question:', error);
                aiStatus.textContent = `Error: ${error.message || 'Failed to generate question'}`;
            } finally {
                // Reset loading state
                generateAiQuestionBtn.classList.remove('loading');
                generateAiQuestionBtn.disabled = false;
            }
        }
        
        // Simulate LLM API call (in a real implementation, this would call the actual API)
        async function simulateLLMApiCall(topic) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // This is where you would normally make the actual API call
            // For demonstration, we'll generate a fully AI-driven question set based on the topic
            
            // Generate a complete question set based on the topic
            let questionSet;
            
            // Different question templates based on topic
            if (topic.toLowerCase().includes('ndvi')) {
                // NDVI topic
                questionSet = await generateAIQuestionSet('ndvi');
            } else if (topic.toLowerCase().includes('classification')) {
                // Classification topic
                questionSet = await generateAIQuestionSet('classification');
            } else if (topic.toLowerCase().includes('sentinel')) {
                // Sentinel topic
                questionSet = await generateAIQuestionSet('sentinel');
            } else if (topic.toLowerCase().includes('landsat')) {
                // Landsat topic
                questionSet = await generateAIQuestionSet('landsat');
            } else if (topic.toLowerCase().includes('scale') || topic.toLowerCase().includes('resolution')) {
                // Scale/resolution topic
                questionSet = await generateAIQuestionSet('scale');
            } else if (topic.toLowerCase().includes('reducer')) {
                // Reducer topic
                questionSet = await generateAIQuestionSet('reducer');
            } else if (topic.toLowerCase().includes('projection')) {
                // Projection topic
                questionSet = await generateAIQuestionSet('projection');
            } else {
                // General GEE topic
                questionSet = await generateAIQuestionSet(topic);
            }
            
            // Return the generated question in the same format as our original questions
            return {
                q: questionSet.question,
                options: questionSet.options,
                answer: questionSet.answer,
                explanation: questionSet.explanation,
                difficulty: questionSet.difficulty,
                hint: questionSet.hint,
                visualization: questionSet.visualization,
                isAiGenerated: true,
                generatedTopic: topic
            };
        }
        
        // Generate a complete AI question set
        async function generateAIQuestionSet(topic) {
            // In a real implementation, this would call an LLM API
            // For demonstration, we'll simulate different AI-generated question sets
            
            // Simulate thinking time for more realistic AI generation
            await new Promise(resolve => setTimeout(resolve, 800));
            
            const questionSets = {
                'ndvi': {
                    question: "What advantage does NDVI have over simple vegetation indices in Google Earth Engine?",
                    options: [
                        "It requires fewer computational resources",
                        "It normalizes values between -1 and 1, reducing the influence of illumination conditions",
                        "It only requires a single spectral band",
                        "It can only be calculated using Landsat imagery"
                    ],
                    answer: "It normalizes values between -1 and 1, reducing the influence of illumination conditions",
                    explanation: "NDVI (Normalized Difference Vegetation Index) normalizes the difference between NIR and red reflectance by their sum, producing values between -1 and 1. This normalization helps reduce the effects of different illumination conditions, shadows, and topographic variation, making it more robust than simple ratio-based indices.",
                    difficulty: "medium",
                    hint: "Think about what the 'N' in NDVI stands for and how that affects the index values.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/ndvi_comparison.png",
                        description: "This visualization shows how NDVI normalizes values compared to a simple vegetation index, making it more consistent across different lighting conditions."
                    }
                },
                'classification': {
                    question: "What is the primary advantage of using a Random Forest classifier over a single decision tree in Google Earth Engine?",
                    options: [
                        "Random Forest requires less training data",
                        "Random Forest is computationally less intensive",
                        "Random Forest reduces overfitting by averaging multiple decision trees",
                        "Random Forest can only classify into two categories"
                    ],
                    answer: "Random Forest reduces overfitting by averaging multiple decision trees",
                    explanation: "Random Forest is an ensemble learning method that constructs multiple decision trees during training and outputs the class that is the mode of the classes of individual trees. This approach helps reduce the risk of overfitting that can occur with a single decision tree, resulting in more robust and accurate classifications in Google Earth Engine.",
                    difficulty: "hard",
                    hint: "Consider how combining multiple models might improve performance compared to using just one model.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/random_forest.png",
                        description: "This visualization illustrates how Random Forest combines multiple decision trees to create a more robust classifier that is less prone to overfitting."
                    }
                },
                'sentinel': {
                    question: "Which Sentinel-2 bands are most useful for monitoring vegetation health in Google Earth Engine?",
                    options: [
                        "Bands 2 (Blue), 3 (Green), and 4 (Red)",
                        "Bands 8 (NIR), 11 (SWIR), and 12 (SWIR)",
                        "Bands 5 (Red Edge), 6 (Red Edge), and 7 (Red Edge)",
                        "Bands 1 (Coastal aerosol), 9 (Water vapor), and 10 (Cirrus)"
                    ],
                    answer: "Bands 8 (NIR), 11 (SWIR), and 12 (SWIR)",
                    explanation: "For vegetation health monitoring, the near-infrared (NIR) band 8 is crucial as healthy vegetation strongly reflects NIR light. The short-wave infrared (SWIR) bands 11 and 12 are sensitive to vegetation water content and canopy structure. Together, these bands provide valuable information about vegetation vigor, stress, and moisture content that isn't available in visible spectrum bands.",
                    difficulty: "medium",
                    hint: "Think about which parts of the electromagnetic spectrum are most sensitive to changes in plant physiology and water content.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/sentinel_bands.png",
                        description: "This visualization shows the spectral response patterns of different Sentinel-2 bands and how they interact with vegetation features."
                    }
                },
                'landsat': {
                    question: "What is a key advantage of the Landsat collection in Google Earth Engine compared to other satellite imagery?",
                    options: [
                        "It has the highest spatial resolution of any satellite imagery",
                        "It provides the longest continuous global record of Earth's surface",
                        "It offers daily revisit times for any location on Earth",
                        "It's the only collection that provides thermal imagery"
                    ],
                    answer: "It provides the longest continuous global record of Earth's surface",
                    explanation: "The Landsat program has been continuously collecting satellite imagery of Earth since 1972, providing the longest temporal record of moderate-resolution multispectral data of Earth's surface on a global basis. This extensive historical archive in Google Earth Engine is invaluable for long-term studies of land use change, deforestation, urbanization, and other environmental changes over multiple decades.",
                    difficulty: "medium",
                    hint: "Consider the historical significance of the Landsat program and when it began collecting data.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/landsat_timeline.png",
                        description: "This visualization shows the timeline of Landsat satellites and their continuous coverage of Earth's surface since the 1970s."
                    }
                },
                'scale': {
                    question: "How does changing the scale parameter affect computation time in Google Earth Engine?",
                    options: [
                        "Smaller scale values (higher resolution) generally increase computation time",
                        "Scale has no effect on computation time",
                        "Larger scale values (lower resolution) generally increase computation time",
                        "Computation time is only affected by the number of bands, not scale"
                    ],
                    answer: "Smaller scale values (higher resolution) generally increase computation time",
                    explanation: "In Google Earth Engine, the scale parameter determines the pixel resolution at which computations are performed. Smaller scale values (e.g., 10m) represent higher resolution, meaning more pixels need to be processed for the same geographic area compared to larger scale values (e.g., 1000m). This increase in data volume with higher resolution typically results in longer computation times and potentially higher memory usage.",
                    difficulty: "hard",
                    hint: "Think about the relationship between pixel size and the total number of pixels that need to be processed for a given area.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/scale_performance.png",
                        description: "This visualization demonstrates how computation time increases as the scale parameter decreases (resolution increases) due to the larger number of pixels being processed."
                    }
                },
                'reducer': {
                    question: "When using ee.Reducer.mean() to analyze values within regions in Google Earth Engine, what happens if some pixels have no data (masked pixels)?",
                    options: [
                        "The reducer fails and returns an error",
                        "Masked pixels are treated as zeros in the calculation",
                        "Masked pixels are ignored in the calculation",
                        "The result is always null if any pixels are masked"
                    ],
                    answer: "Masked pixels are ignored in the calculation",
                    explanation: "In Google Earth Engine, when using reducers like ee.Reducer.mean() to analyze values within regions, masked pixels (those with no data) are automatically excluded from the calculation. This behavior ensures that statistics are computed only from valid data points. For example, if you're calculating the mean NDVI within a region and some pixels are masked due to cloud cover, those pixels won't affect your result - the mean will be calculated using only the valid, unmasked pixels.",
                    difficulty: "hard",
                    hint: "Consider how statistical calculations should handle missing data to maintain accuracy.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/reducer_masked.png",
                        description: "This visualization shows how reducers process regions containing both valid data and masked pixels, focusing only on the valid data points."
                    }
                },
                'projection': {
                    question: "Why is it important to consider the projection when calculating areas in Google Earth Engine?",
                    options: [
                        "Projections only affect the visual display, not area calculations",
                        "Different projections can introduce significant distortions in area measurements",
                        "Google Earth Engine automatically corrects for projection distortions",
                        "Areas can only be calculated using the WGS84 projection"
                    ],
                    answer: "Different projections can introduce significant distortions in area measurements",
                    explanation: "When calculating areas in Google Earth Engine, the choice of projection is critical because all map projections distort Earth's surface in some way. Some projections preserve angles but distort areas, while others preserve areas but distort shapes. For accurate area measurements, especially over large regions or near the poles, it's important to use an equal-area projection (like EPSG:6933) that minimizes area distortion. Using an inappropriate projection can lead to significant errors in area calculations.",
                    difficulty: "hard",
                    hint: "Think about how a round Earth is represented on a flat map and what kinds of distortions occur in different regions.",
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/projection_comparison.png",
                        description: "This visualization compares area calculations using different projections, showing how the choice of projection affects measurement accuracy, especially near the poles."
                    }
                },
                'default': {
                    question: `What is a key consideration when working with ${topic} data in Google Earth Engine?`,
                    options: [
                        `Understanding the temporal resolution of ${topic} datasets`,
                        `Selecting appropriate visualization parameters for ${topic} data`,
                        `Managing computation limits when processing large ${topic} datasets`,
                        `Applying proper filtering techniques to ${topic} collections`
                    ],
                    answer: `Managing computation limits when processing large ${topic} datasets`,
                    explanation: `When working with ${topic} data in Google Earth Engine, one of the most important considerations is managing computation limits. GEE is powerful but has constraints on memory usage and processing time. For large ${topic} datasets, it's essential to use efficient coding practices such as filtering collections before processing, using appropriate scale parameters, and employing techniques like reduceRegions() instead of iterating through features. Breaking complex workflows into smaller steps and using exports for intensive computations can help overcome these limitations.`,
                    difficulty: "medium",
                    hint: `Think about the challenges that might arise when processing very large ${topic} datasets in a cloud-based platform.`,
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/computation_overview.png",
                        description: `This visualization illustrates strategies for optimizing ${topic} data processing in Google Earth Engine to work within computation limits.`
                    }
                }
            };
            
            // Return the appropriate question set or the default if the topic isn't specifically defined
            return questionSets[topic.toLowerCase()] || questionSets['default'];
        }
        
        // Function to call the actual LLM API (not used in this demo)
        async function callLLMApi(topic) {
            if (!API_KEY) {
                throw new Error("API key not set. Please add your API key in settings.");
            }
            
            const prompt = `
                Create a comprehensive multiple-choice question about Google Earth Engine related to ${topic}.
                
                Format your response as a JSON object with the following structure:
                {
                    "question": "The question text here",
                    "options": ["Option A", "Option B", "Option C", "Option D"],
                    "answer": "The correct option exactly as written in options",
                    "explanation": "A detailed explanation of why this answer is correct and educational information about the topic",
                    "difficulty": "easy|medium|hard",
                    "hint": "A hint to help answer the question",
                    "visualization": {
                        "description": "A description of what a visualization for this concept would show"
                    }
                }
                
                Requirements:
                - The question should be specific to Google Earth Engine and ${topic}
                - Make the options plausible but only one should be correct
                - The explanation should be detailed (100-150 words) and educational
                - The hint should give a subtle clue without revealing the answer
                - The difficulty should accurately reflect how challenging the question is
                - The visualization description should explain what would be helpful to visualize for this concept
            `;
            
            const response = await fetch(LLM_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: "gpt-4",
                    messages: [
                        {
                            role: "system",
                            content: "You are an expert in Google Earth Engine, remote sensing, and geospatial analysis with deep knowledge of Earth observation data, image processing, and GIS concepts."
                        },
                        {
                            role: "user",
                            content: prompt
                        }
                    ],
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || "Failed to generate question");
            }
            
            const data = await response.json();
            const result = JSON.parse(data.choices[0].message.content);
            
            // Add a placeholder image URL based on the topic
            const imageName = topic.toLowerCase().replace(/\s+/g, '_');
            
            return {
                q: result.question,
                options: result.options,
                answer: result.answer,
                explanation: result.explanation,
                difficulty: result.difficulty,
                hint: result.hint,
                visualization: {
                    image: `https://developers.google.com/earth-engine/images/${imageName}.png`,
                    description: result.visualization.description
                },
                isAiGenerated: true,
                generatedTopic: topic
            };
        }
        
        // Add API key setting to settings modal
        function addApiKeySettings() {
            const settingsSection = document.querySelector('.settings-section:nth-child(2)');
            
            const apiKeyOption = document.createElement('div');
            apiKeyOption.className = 'settings-option';
            apiKeyOption.innerHTML = `
                <div>
                    <div class="settings-option-label">LLM API Key</div>
                    <div class="settings-option-description">Set your API key for AI question generation</div>
                </div>
                <input type="password" id="api-key-input" placeholder="Enter API key" class="ai-topic-input" style="max-width: 200px;">
            `;
            
            settingsSection.appendChild(apiKeyOption);
            
            // Add event listener for API key input
            const apiKeyInput = document.getElementById('api-key-input');
            apiKeyInput.addEventListener('change', () => {
                API_KEY = apiKeyInput.value.trim();
                // In a real app, you might want to store this securely
                // For demo purposes, we just keep it in memory
            });
        }
        
        // Add event listener for generate button
        generateAiQuestionBtn.addEventListener('click', generateAiQuestion);
        
        // Add event listener for Enter key in topic input
        aiTopicInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateAiQuestion();
            }
        });
        
        // Add API key settings to settings modal
        addApiKeySettings();

        // Difficulty buttons event listeners
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                changeDifficulty(btn.dataset.difficulty);
            });
        });

        // Initialize quiz on load
        document.addEventListener('DOMContentLoaded', initQuiz);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !nextBtn.disabled) {
                nextQuestion();
            }
        });
    </script>
</body>
</html>
