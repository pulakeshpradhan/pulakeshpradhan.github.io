<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive Google Earth Engine Quiz with advanced features">
    <meta name="keywords" content="GEE, Google Earth Engine, Quiz, Geospatial, Remote Sensing">
    <title>Advanced GEE Datatypes Quiz</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* Light Theme Colors */
            --primary: #4285F4; /* Google Blue */
            --secondary: #34A853; /* Google Green */
            --accent: #FBBC05; /* Google Yellow */
            --error: #EA4335; /* Google Red */
            --text-dark: #202124;
            --text-light: #5F6368;
            --bg-light: #F8F9FA;
            --card-bg: #FFFFFF;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --border-color: #DADCE0;
            
            /* Shared Variables */
            --radius: 16px;
            --transition: all 0.3s ease;
            --font-primary: 'Inter', sans-serif;
            --font-heading: 'Montserrat', sans-serif;
        }

        [data-theme="dark"] {
            /* Dark Theme Colors */
            --primary: #8AB4F8; /* Light Blue */
            --secondary: #81C995; /* Light Green */
            --accent: #FDD663; /* Light Yellow */
            --error: #F28B82; /* Light Red */
            --text-dark: #E8EAED;
            --text-light: #9AA0A6;
            --bg-light: #202124;
            --card-bg: #303134;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --border-color: #5F6368;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        header {
            background: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            font-size: 1.75rem;
            color: var(--primary);
            animation: pulse 2s infinite;
        }

        .logo-text {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-dark);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary);
        }

        [data-theme="dark"] .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .settings-btn:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary);
        }

        [data-theme="dark"] .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 1rem;
        }

        .quiz-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 900px;
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
            animation: fadeIn 1s ease;
            border: 1px solid var(--border-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .quiz-title {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        .globe-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            animation: spin 12s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .difficulty-selector {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-light);
            padding: 0.5rem;
            border-radius: 30px;
        }

        .difficulty-btn {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
        }

        .difficulty-btn.active {
            background: var(--primary);
            color: white;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-light);
            padding: 0.75rem 1.25rem;
            border-radius: 30px;
            font-weight: 600;
        }

        .timer-icon {
            color: var(--primary);
        }

        .timer-display {
            font-family: monospace;
            font-size: 1.1rem;
        }

        .timer-controls {
            display: flex;
            gap: 0.25rem;
        }

        .timer-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.25rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .timer-btn:hover {
            color: var(--primary);
        }

        .progress-container {
            background: var(--bg-light);
            height: 8px;
            border-radius: 4px;
            margin: 2rem 0;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0.1)
            );
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        .question-container {
            margin-bottom: 2rem;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-number {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .question-number .badge {
            background: var(--primary);
            color: white;
            padding: 0.35rem 0.9rem;
            border-radius: 20px;
            font-size: 1rem;
        }

        .question {
            font-family: var(--font-heading);
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.4;
            margin-bottom: 1.5rem;
        }

        .hint-container {
            margin-bottom: 1.5rem;
            background: rgba(66, 133, 244, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .hint-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .hint-text {
            color: var(--text-dark);
            font-size: 1rem;
            line-height: 1.5;
        }

        .hint-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem 0;
        }

        .hint-btn:hover {
            text-decoration: underline;
        }

        .options {
            display: grid;
            gap: 1rem;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            background: var(--bg-light);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .option-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .option-label.selected {
            transform: scale(1.02);
            border-color: var(--primary);
            background: rgba(66, 133, 244, 0.1);
        }

        .option-input {
            display: none;
        }

        .option-radio {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--text-light);
            position: relative;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .option-input:checked + .option-radio {
            border-color: var(--primary);
            background: var(--primary);
        }

        .option-input:checked + .option-radio::after {
            content: '';
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .option-label.correct {
            border-color: var(--secondary);
            background: rgba(52, 168, 83, 0.1);
        }

        .option-label.correct .option-radio {
            border-color: var(--secondary);
            background: var(--secondary);
        }

        .option-label.incorrect {
            border-color: var(--error);
            background: rgba(234, 67, 53, 0.1);
        }

        .option-label.incorrect .option-radio {
            border-color: var(--error);
            background: var(--error);
        }

        .option-text {
            font-size: 1.2rem;
            color: var(--text-dark);
            font-weight: 500;
            line-height: 1.4;
        }

        .feedback {
            margin: 1.5rem 0;
            padding: 1.25rem;
            border-radius: 12px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .feedback.correct {
            background: rgba(52, 168, 83, 0.1);
            border-left: 4px solid var(--secondary);
            display: block;
        }

        .feedback.incorrect {
            background: rgba(234, 67, 53, 0.1);
            border-left: 4px solid var(--error);
            display: block;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .feedback-icon {
            font-size: 1.5rem;
        }

        .feedback-icon.correct {
            color: var(--secondary);
        }

        .feedback-icon.incorrect {
            color: var(--error);
        }

        .feedback-title {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .feedback-title.correct {
            color: var(--secondary);
        }

        .feedback-title.incorrect {
            color: var(--error);
        }

        .feedback-text {
            color: var(--text-dark);
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
            width: 100%;
        }

        .btn:hover {
            background: #3367d6; /* Darker blue */
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #c5c5c5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .results-container.visible {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .results-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
        }

        .score-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            color: white;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 60%);
            animation: pulse 3s infinite;
        }

        .score-value {
            font-size: 5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .score-text {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .detail-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .detail-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .detail-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .results-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
        }

        .action-btn.secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .certificate-container {
            display: none;
            margin-top: 2rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem;
            background: var(--bg-light);
            position: relative;
        }

        .certificate-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .certificate {
            background: white;
            border: 5px solid var(--primary);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .certificate::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 1px solid var(--accent);
            margin: 0.5rem;
            pointer-events: none;
        }

        .certificate-title {
            font-family: var(--font-heading);
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .certificate-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .certificate-name {
            font-family: var(--font-heading);
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--accent);
            display: inline-block;
            padding-bottom: 0.5rem;
        }

        .certificate-text {
            font-size: 1.1rem;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .certificate-date {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .certificate-signature {
            font-family: 'Pacifico', cursive;
            font-size: 1.5rem;
            color: var(--primary);
            margin-top: 1rem;
        }

        .certificate-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 100px;
            height: 100px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .settings-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .settings-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .settings-modal.visible .settings-content {
            transform: translateY(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--error);
        }

        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .settings-option-label {
            font-size: 1rem;
            color: var(--text-dark);
        }

        .settings-option-description {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .visualization-container {
            margin: 2rem 0;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            display: none;
        }

        .visualization-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .visualization-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .visualization-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .visualization-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .visualization-content {
            background: var(--bg-light);
            padding: 1.5rem;
            min-height: 200px;
        }

        .visualization-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .visualization-description {
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .quiz-container {
                padding: 1.5rem;
            }

            .quiz-title {
                font-size: 2rem;
            }

            .quiz-subtitle {
                font-size: 1rem;
            }

            .question {
                font-size: 1.5rem;
            }

            .option-text {
                font-size: 1rem;
            }

            .score-value {
                font-size: 4rem;
            }

            .certificate-title {
                font-size: 1.5rem;
            }

            .certificate-name {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                padding: 1rem;
            }

            .quiz-title {
                font-size: 1.75rem;
            }

            .globe-icon {
                font-size: 2.5rem;
            }

            .question {
                font-size: 1.25rem;
            }

            .option-label {
                padding: 1rem;
            }

            .option-radio {
                width: 20px;
                height: 20px;
            }

            .option-input:checked + .option-radio::after {
                width: 10px;
                height: 10px;
            }

            .btn {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }

            .score-value {
                font-size: 3rem;
            }

            .detail-value {
                font-size: 1.5rem;
            }

            .certificate-badge {
                width: 70px;
                height: 70px;
                font-size: 1.2rem;
            }
        }

        /* AI Controls Styles */
        .ai-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(66, 133, 244, 0.05);
            border-radius: var(--radius);
            border: 1px dashed var(--primary);
        }
        
        .ai-btn {
            background: linear-gradient(135deg, var(--primary), #8134af);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
        }
        
        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, 0.3);
        }
        
        .ai-btn:active {
            transform: translateY(0);
        }
        
        .ai-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .ai-btn.loading::after {
            content: '';
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
        
        .ai-topic-container {
            flex: 1;
            min-width: 200px;
        }
        
        .ai-topic-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            font-size: 1rem;
            background: var(--bg-light);
            color: var(--text-dark);
            transition: var(--transition);
        }
        
        .ai-topic-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        .ai-status {
            width: 100%;
            padding: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            text-align: center;
            display: none;
        }
        
        .ai-status.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Accessibility Styles */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        *:focus-visible {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* Animation for correct answer */
        @keyframes correctAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-label.correct {
            animation: correctAnimation 0.5s ease;
        }

        /* Animation for incorrect answer */
        @keyframes incorrectAnimation {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .option-label.incorrect {
            animation: incorrectAnimation 0.5s ease;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
            margin: 2rem auto;
        }

        .loading div {
            position: absolute;
            top: 33px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: var(--primary);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loading div:nth-child(1) {
            left: 8px;
            animation: loading1 0.6s infinite;
        }

        .loading div:nth-child(2) {
            left: 8px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(3) {
            left: 32px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(4) {
            left: 56px;
            animation: loading3 0.6s infinite;
        }

        @keyframes loading1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes loading2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        @keyframes loading3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        /* Confetti animation for celebration */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0.7;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh)) rotate(360deg);
                opacity: 0;
            }
        }
        /* Styles for question count input */
        .ai-question-count {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            background-color: var(--bg-light);
            border-radius: 5px;
        }
        
        .ai-question-count-input {
            width: 60px;
            padding: 8px;
            border: 1px solid var(--text-light);
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
            color: var(--text-dark);
            background-color: var(--card-bg);
        }
        
        /* Styles for question navigation slider */
        .question-navigation {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: var(--bg-light);
            border-radius: 5px;
            font-size: 14px;
            color: var(--text-dark);
        }
        
        .question-slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            outline: none;
            border-radius: 4px;
        }
        
        .question-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .question-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-globe-americas"></i></div>
            <div class="logo-text">GEE Quiz Pro</div>
        </div>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
            <button id="settings-btn" class="settings-btn" aria-label="Open settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <main>
        <div class="quiz-container" id="quiz-container">
            <div id="quiz-content">
                <div class="quiz-header">
                    <div class="globe-icon"><i class="fas fa-globe-americas"></i></div>
                    <h1 class="quiz-title">GEE Datatypes Quiz</h1>
                    <p class="quiz-subtitle">Test your Google Earth Engine expertise with this interactive quiz</p>
                </div>

                <div class="quiz-controls">
                    <div class="difficulty-selector">
                        <button class="difficulty-btn active" data-difficulty="all">All</button>
                        <button class="difficulty-btn" data-difficulty="easy">Easy</button>
                        <button class="difficulty-btn" data-difficulty="medium">Medium</button>
                        <button class="difficulty-btn" data-difficulty="hard">Hard</button>
                    </div>
                    <div class="timer-container">
                        <span class="timer-icon"><i class="fas fa-stopwatch"></i></span>
                        <span id="time-display" class="timer-display">00:00</span>
                        <div class="timer-controls">
                            <button id="pause-timer" class="timer-btn" aria-label="Pause timer">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button id="reset-timer" class="timer-btn" aria-label="Reset timer">
                                <i class="fas fa-redo-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="ai-controls">
                    <button id="generate-ai-question" class="ai-btn">
                        <i class="fas fa-robot"></i> Generate AI Question
                    </button>
                    <div class="ai-topic-container">
                        <input type="text" id="ai-topic-input" placeholder="Enter a GEE topic (e.g., NDVI, Classification)" class="ai-topic-input">
                    </div>
                    <div class="ai-question-count">
                        <label for="ai-question-count-input">Number of questions:</label>
                        <input type="number" id="ai-question-count-input" min="1" max="10" value="1" class="ai-question-count-input">
                    </div>
                    <div id="ai-status" class="ai-status">Generating question...</div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                
                <div class="question-navigation">
                    <label for="question-slider">Navigate to question:</label>
                    <input type="range" id="question-slider" min="1" value="1" class="question-slider">
                    <span id="question-slider-value">1</span>/<span id="question-slider-total">1</span>
                </div>

                <div id="question-container" class="question-container"></div>
                
                <div id="hint-container" class="hint-container">
                    <p id="hint-text" class="hint-text"></p>
                </div>
                
                <div id="visualization-container" class="visualization-container">
                    <div class="visualization-header">
                        <div class="visualization-title">Visual Explanation</div>
                        <button id="close-visualization" class="visualization-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="visualization-content" id="visualization-content">
                        <!-- Visualization content will be inserted here -->
                    </div>
                </div>
                
                <div id="feedback" class="feedback"></div>
                
                <button id="hint-btn" class="hint-btn">
                    <i class="fas fa-lightbulb"></i> Need a hint?
                </button>
                
                <button id="next-btn" class="btn" disabled>
                    <span id="btn-text">Check Answer</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                
                <div id="results-container" class="results-container">
                    <div class="results-header">
                        <h2 class="results-title">Quiz Completed!</h2>
                        <p class="results-subtitle">Here's how you performed</p>
                    </div>
                    
                    <div class="score-card">
                        <div class="score-value" id="score-percentage">0%</div>
                        <div class="score-text">Your Score</div>
                    </div>
                    
                    <div class="score-details">
                        <div class="detail-card">
                            <div class="detail-value" id="correct-answers">0</div>
                            <div class="detail-label">Correct</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-value" id="incorrect-answers">0</div>
                            <div class="detail-label">Incorrect</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-value" id="completion-time">00:00</div>
                            <div class="detail-label">Time</div>
                        </div>
                    </div>
                    
                    <div class="results-actions">
                        <button id="restart-btn" class="action-btn primary">
                            <i class="fas fa-redo-alt"></i> Restart Quiz
                        </button>
                        <button id="review-btn" class="action-btn secondary">
                            <i class="fas fa-search"></i> Review Answers
                        </button>
                        <button id="certificate-btn" class="action-btn secondary">
                            <i class="fas fa-award"></i> Get Certificate
                        </button>
                        <button id="share-btn" class="action-btn secondary">
                            <i class="fas fa-share-alt"></i> Share Results
                        </button>
                    </div>
                    
                    <div id="certificate-container" class="certificate-container">
                        <div class="certificate">
                            <div class="certificate-badge" id="certificate-score">90%</div>
                            <h3 class="certificate-title">Certificate of Achievement</h3>
                            <p class="certificate-subtitle">Google Earth Engine Datatypes Quiz</p>
                            <div class="certificate-name" id="certificate-name">Your Name</div>
                            <p class="certificate-text">
                                has successfully completed the Google Earth Engine Datatypes Quiz
                                with an outstanding performance, demonstrating proficiency in GEE concepts and applications.
                            </p>
                            <p class="certificate-date" id="certificate-date">March 21, 2025</p>
                            <div class="certificate-signature">GEE Quiz Pro</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="settings-modal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h3 class="settings-title">Settings</h3>
                <button id="close-settings" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Appearance</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Dark Mode</div>
                        <div class="settings-option-description">Switch between light and dark theme</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Quiz Settings</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Show Hints</div>
                        <div class="settings-option-description">Enable hint button for difficult questions</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="hints-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Show Visualizations</div>
                        <div class="settings-option-description">Display visual explanations for concepts</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="visualizations-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Shuffle Questions</div>
                        <div class="settings-option-description">Randomize question order</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="shuffle-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Save Progress</div>
                        <div class="settings-option-description">Save your progress for later</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="save-progress-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h4 class="settings-section-title">Accessibility</h4>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">High Contrast</div>
                        <div class="settings-option-description">Increase contrast for better readability</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="contrast-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div>
                        <div class="settings-option-label">Larger Text</div>
                        <div class="settings-option-description">Increase text size throughout the quiz</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="large-text-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        // LLM API Configuration
        const LLM_API_URL = "https://api.openai.com/v1/chat/completions";
        // Note: In a production environment, API keys should be handled securely on the server side
        // This is a placeholder for demonstration purposes
        let API_KEY = "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"; // Would be set by user in settings
        
        // Enhanced Quiz Questions with Difficulty Levels and Visualizations
        const originalQuestions = [
            { 
                q: "What is the primary purpose of the Google Earth Engine Data Catalog?", 
                options: [
                    "To store personal datasets", 
                    "To provide public geospatial datasets for analysis", 
                    "To visualize 3D maps", 
                    "To edit user data"
                ], 
                answer: "To provide public geospatial datasets for analysis", 
                explanation: "The GEE Data Catalog is designed to offer a wide range of public datasets for geospatial analysis and research.",
                difficulty: "easy",
                hint: "Think about the main resource that GEE provides to users for their analysis work.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/DataCatalog.png",
                    description: "The GEE Data Catalog contains petabytes of geospatial data from various sources, including satellite imagery, climate data, and more."
                }
            },
            { 
                q: "Which types of data can be found in the GEE Data Catalog?", 
                options: [
                    "Only satellite imagery", 
                    "Only vector data", 
                    "Both raster and vector data", 
                    "Only climate data"
                ], 
                answer: "Both raster and vector data", 
                explanation: "The catalog includes diverse data types, including satellite imagery, vector boundaries, digital elevation models, climate data, and more.",
                difficulty: "easy",
                hint: "Consider the different formats needed to represent both imagery and boundaries/shapes.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Datasets.png",
                    description: "GEE supports both raster data (like satellite imagery) and vector data (like country boundaries)."
                }
            },
            { 
                q: "How are datasets in the GEE Data Catalog typically organized?", 
                options: [
                    "By file size", 
                    "By acquisition date only", 
                    "By thematic categories and providers", 
                    "Alphabetically"
                ], 
                answer: "By thematic categories and providers", 
                explanation: "The GEE Data Catalog organizes datasets by thematic categories (like imagery, climate) and by data providers (like NASA, USGS).",
                difficulty: "medium",
                hint: "Think about how you would logically group similar types of Earth observation data.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/CatalogStructure.png",
                    description: "The catalog is organized hierarchically by themes and providers to make finding relevant datasets easier."
                }
            },
            { 
                q: "What is the function of the 'Inspector' tab in the GEE Code Editor?", 
                options: [
                    "To write and run code", 
                    "To inspect pixel values and properties", 
                    "To apply visualizations", 
                    "To view error messages"
                ], 
                answer: "To inspect pixel values and properties", 
                explanation: "The Inspector tool allows users to click on the map and view pixel values, properties, and feature details.",
                difficulty: "easy",
                hint: "This tool helps you examine what's at a specific location on your map.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Inspector.png",
                    description: "The Inspector tab shows detailed information about the data at locations you click on the map."
                }
            },
            { 
                q: "Which function is used to load an image collection from the Data Catalog in Google Earth Engine?", 
                options: [
                    "ee.Image()", 
                    "ee.ImageCollection()", 
                    "ee.FeatureCollection()", 
                    "ee.Catalog()"
                ], 
                answer: "ee.ImageCollection()", 
                explanation: "The ee.ImageCollection() function is used to load a collection of images from the catalog, such as a time series of satellite imagery.",
                difficulty: "medium",
                hint: "When you need to work with multiple images as a set, you use this function.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/ImageCollection.png",
                    description: "An ImageCollection represents a stack of images, often representing the same area at different times."
                }
            },
            { 
                q: "What does 'ee.Image' represent in Google Earth Engine?", 
                options: [
                    "A single satellite image or raster layer", 
                    "A vector feature", 
                    "A table of data", 
                    "A JavaScript object"
                ], 
                answer: "A single satellite image or raster layer", 
                explanation: "An ee.Image represents a raster dataset, often derived from satellite sensors or the result of computations.",
                difficulty: "easy",
                hint: "This is the basic raster data type in GEE.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Image.png",
                    description: "An ee.Image is a multi-band raster with values at each pixel position."
                }
            },
            { 
                q: "Which of the following is NOT a valid data type in GEE?", 
                options: [
                    "ee.Geometry", 
                    "ee.Number", 
                    "ee.Vector", 
                    "ee.String"
                ], 
                answer: "ee.Vector", 
                explanation: "GEE does not have an ee.Vector type; vector data is represented using ee.Geometry, ee.Feature, or ee.FeatureCollection.",
                difficulty: "medium",
                hint: "Look for the option that doesn't exist in the GEE API documentation.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/DataTypes.png",
                    description: "GEE has various data types including ee.Geometry, ee.Feature, ee.FeatureCollection for vector data, but no specific ee.Vector type."
                }
            },
            { 
                q: "How can you filter an ImageCollection in GEE by date?", 
                options: [
                    "Using Map.addLayer()", 
                    "Using ee.Filter.date()", 
                    "Using ee.Date()", 
                    "Using ee.filterByDate()"
                ], 
                answer: "Using ee.Filter.date()", 
                explanation: "The ee.Filter.date() function is used to filter an ImageCollection by a date range.",
                difficulty: "medium",
                hint: "This filter helps you select images from a specific time period.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/FilterDate.png",
                    description: "Filtering by date allows you to select images from a specific time period in your collection."
                }
            },
            { 
                q: "What is the purpose of the 'Map' object in GEE?", 
                options: [
                    "To store feature data", 
                    "To run reducers", 
                    "To display images and vectors on the map", 
                    "To filter datasets"
                ], 
                answer: "To display images and vectors on the map", 
                explanation: "The Map object is used for visualizing geospatial data as layers on the interactive map.",
                difficulty: "easy",
                hint: "This object controls what you see in the main visualization area.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Map.png",
                    description: "The Map object allows you to visualize your data and control the interactive map display."
                }
            },
            { 
                q: "Which file format is commonly used to export raster data from GEE?", 
                options: [
                    "CSV", 
                    "GeoJSON", 
                    "GeoTIFF", 
                    "Shapefile"
                ], 
                answer: "GeoTIFF", 
                explanation: "GeoTIFF is a popular format for exporting raster data as it preserves geospatial information and is widely supported.",
                difficulty: "medium",
                hint: "This format is specifically designed for georeferenced raster imagery.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Export.png",
                    description: "GeoTIFF is the standard format for exporting raster data with its geographic information intact."
                }
            },
            { 
                q: "What is a 'reducer' in Google Earth Engine?", 
                options: [
                    "A function that compresses file sizes", 
                    "A function that aggregates values across dimensions", 
                    "A tool that simplifies geometries", 
                    "A method to reduce the number of bands"
                ], 
                answer: "A function that aggregates values across dimensions", 
                explanation: "Reducers in GEE are functions that aggregate values across dimensions, such as calculating statistics over regions or time series.",
                difficulty: "hard",
                hint: "These functions help you summarize data across space, time, or bands.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Reducer.png",
                    description: "Reducers aggregate values across dimensions, like calculating the mean NDVI value for each country."
                }
            },
            { 
                q: "What is the significance of scale in Google Earth Engine?", 
                options: [
                    "It only affects visualization", 
                    "It determines the pixel resolution for computations", 
                    "It's only relevant for vector data", 
                    "It has no impact on analysis results"
                ], 
                answer: "It determines the pixel resolution for computations", 
                explanation: "Scale in GEE determines the pixel resolution at which computations are performed, affecting the accuracy and performance of analyses.",
                difficulty: "hard",
                hint: "This parameter affects how detailed your analysis will be.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Scale.png",
                    description: "Scale determines the pixel size for computations, which affects both accuracy and processing time."
                }
            },
            { 
                q: "Which method would you use to calculate the NDVI vegetation index in GEE?", 
                options: [
                    "image.normalizedDifference(['NIR', 'RED'])", 
                    "image.spectralIndex('NDVI')", 
                    "image.calculateIndex('NDVI')", 
                    "image.vegetation('NDVI')"
                ], 
                answer: "image.normalizedDifference(['NIR', 'RED'])", 
                explanation: "The normalizedDifference() method is used to calculate indices like NDVI by computing (NIR-RED)/(NIR+RED).",
                difficulty: "hard",
                hint: "This method computes (band1-band2)/(band1+band2) which is the formula for normalized difference indices.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/NDVI.png",
                    description: "NDVI is calculated using the normalized difference between near-infrared and red bands."
                }
            },
            { 
                q: "What is the purpose of the 'projection' parameter in GEE?", 
                options: [
                    "To determine how data is displayed on the map", 
                    "To specify the coordinate reference system for analysis", 
                    "To project data into the future", 
                    "To create 3D visualizations"
                ], 
                answer: "To specify the coordinate reference system for analysis", 
                explanation: "The projection parameter defines the coordinate reference system used for spatial operations and exports.",
                difficulty: "hard",
                hint: "This parameter defines how coordinates are mapped to positions on Earth's surface.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/Projection.png",
                    description: "Different projections represent Earth's curved surface on a flat plane in different ways."
                }
            },
            { 
                q: "What is the maximum size limit for exporting an image from GEE?", 
                options: [
                    "100 MB", 
                    "1 GB", 
                    "10 GB", 
                    "There is no fixed limit, but practical limits exist"
                ], 
                answer: "There is no fixed limit, but practical limits exist", 
                explanation: "While GEE doesn't impose a strict size limit, practical limitations exist based on memory, computation time, and download bandwidth.",
                difficulty: "hard",
                hint: "Think about the practical constraints rather than a specific number.",
                visualization: {
                    image: "https://developers.google.com/earth-engine/images/ExportLimits.png",
                    description: "Export size is limited by practical constraints like computation resources and download bandwidth."
                }
            }
        ];

        // DOM Elements
        const quizContainer = document.getElementById('quiz-container');
        const questionContainer = document.getElementById('question-container');
        const progressBar = document.getElementById('progress-bar');
        const nextBtn = document.getElementById('next-btn');
        const btnText = document.getElementById('btn-text');
        const feedback = document.getElementById('feedback');
        const resultsContainer = document.getElementById('results-container');
        const scorePercentage = document.getElementById('score-percentage');
        const correctAnswers = document.getElementById('correct-answers');
        const incorrectAnswers = document.getElementById('incorrect-answers');
        const completionTime = document.getElementById('completion-time');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const certificateBtn = document.getElementById('certificate-btn');
        const shareBtn = document.getElementById('share-btn');
        const certificateContainer = document.getElementById('certificate-container');
        const certificateScore = document.getElementById('certificate-score');
        const certificateName = document.getElementById('certificate-name');
        const certificateDate = document.getElementById('certificate-date');
        const timeDisplay = document.getElementById('time-display');
        const pauseTimerBtn = document.getElementById('pause-timer');
        const resetTimerBtn = document.getElementById('reset-timer');
        const themeToggle = document.getElementById('theme-toggle');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const hintsToggle = document.getElementById('hints-toggle');
        const visualizationsToggle = document.getElementById('visualizations-toggle');
        const shuffleToggle = document.getElementById('shuffle-toggle');
        const saveProgressToggle = document.getElementById('save-progress-toggle');
        const contrastToggle = document.getElementById('contrast-toggle');
        const largeTextToggle = document.getElementById('large-text-toggle');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const hintBtn = document.getElementById('hint-btn');
        const hintContainer = document.getElementById('hint-container');
        const hintText = document.getElementById('hint-text');
        const visualizationContainer = document.getElementById('visualization-container');
        const visualizationContent = document.getElementById('visualization-content');
        const closeVisualization = document.getElementById('close-visualization');
        const questionSlider = document.getElementById('question-slider');
        const questionSliderValue = document.getElementById('question-slider-value');
        const questionSliderTotal = document.getElementById('question-slider-total');

        // Quiz State
        let questions = [...originalQuestions];
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedOption = null;
        let quizCompleted = false;
        let reviewMode = false;
        let seconds = 0;
        let minutes = 0;
        let timerInterval;
        let timerPaused = false;
        let currentDifficulty = 'all';
        let userAnswers = [];
        let userName = 'Quiz Taker';

        // Initialize the quiz
        function initQuiz() {
            // Load saved settings
            loadSettings();
            
            // Load saved progress if enabled
            if (saveProgressToggle.checked && localStorage.getItem('geeQuizProgress')) {
                loadProgress();
            } else {
                // Apply difficulty filter
                filterQuestionsByDifficulty();
                
                // Shuffle questions if enabled
                if (shuffleToggle.checked) {
                    shuffleQuestions();
                }
                
                // Reset quiz state
                currentQuestionIndex = 0;
                score = 0;
                userAnswers = Array(questions.length).fill(null);
                quizCompleted = false;
                reviewMode = false;
                
                // Reset timer
                resetTimer();
                startTimer();
            }
            
            // Show first question
            showQuestion();
            updateProgressBar();
            
            // Hide results
            resultsContainer.classList.remove('visible');
            certificateContainer.classList.remove('visible');
        }

        // Filter questions by difficulty
        function filterQuestionsByDifficulty() {
            // First limit to 5 questions maximum from original questions
            let limitedOriginalQuestions = [...originalQuestions].slice(0, 5);
            
            if (currentDifficulty === 'all') {
                questions = [...limitedOriginalQuestions];
            } else {
                questions = limitedOriginalQuestions.filter(q => q.difficulty === currentDifficulty);
            }
        }

        // Shuffle questions
        function shuffleQuestions() {
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
        }

        // Show current question
        function showQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Reset state
            selectedOption = null;
            nextBtn.disabled = true;
            btnText.textContent = 'Check Answer';
            feedback.className = 'feedback';
            feedback.innerHTML = '';
            hintContainer.classList.remove('visible');
            visualizationContainer.classList.remove('visible');
            
            // Create question HTML
            const questionNumber = currentQuestionIndex + 1;
            const totalQuestions = questions.length;
            
            let questionHTML = `
                <div class="question-number">
                    <span class="badge">${questionNumber}/${totalQuestions}</span>
                    <span>Question ${questionNumber}</span>
                    ${question.difficulty ? `<span class="difficulty-tag ${question.difficulty}">(${question.difficulty})</span>` : ''}
                </div>
                <h2 class="question">${question.q}</h2>
                <div class="options">
            `;
            
            // Add options
            question.options.forEach((option, index) => {
                const isSelected = reviewMode && userAnswers[currentQuestionIndex] === index;
                const isCorrect = reviewMode && option === question.answer;
                
                let optionClass = 'option-label';
                if (reviewMode) {
                    if (isSelected && isCorrect) {
                        optionClass += ' correct';
                    } else if (isSelected && !isCorrect) {
                        optionClass += ' incorrect';
                    } else if (isCorrect) {
                        optionClass += ' correct';
                    }
                } else if (isSelected) {
                    optionClass += ' selected';
                }
                
                questionHTML += `
                    <label class="${optionClass}" data-index="${index}">
                        <input type="radio" name="quiz-option" class="option-input" ${isSelected ? 'checked' : ''} ${reviewMode ? 'disabled' : ''}>
                        <div class="option-radio"></div>
                        <span class="option-text">${option}</span>
                    </label>
                `;
            });
            
            questionHTML += `</div>`;
            
            // Update DOM
            questionContainer.innerHTML = questionHTML;
            
            // Add event listeners to options
            if (!reviewMode) {
                const optionLabels = document.querySelectorAll('.option-label');
                optionLabels.forEach(label => {
                    label.addEventListener('click', selectOption);
                });
            }
            
            // Show feedback in review mode
            if (reviewMode) {
                showFeedback(true);
                nextBtn.disabled = false;
                btnText.textContent = currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Review';
            }
            
            // Update hint button visibility
            hintBtn.style.display = hintsToggle.checked && !reviewMode ? 'flex' : 'none';
        }

        // Select an option
        function selectOption(e) {
            // Remove selected class from all options
            const optionLabels = document.querySelectorAll('.option-label');
            optionLabels.forEach(label => {
                label.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            const selectedLabel = e.currentTarget;
            selectedLabel.classList.add('selected');
            
            // Update selected option
            selectedOption = parseInt(selectedLabel.dataset.index);
            
            // Enable next button
            nextBtn.disabled = false;
        }

        // Check answer
        function checkAnswer() {
            const question = questions[currentQuestionIndex];
            const selectedOptionText = question.options[selectedOption];
            const isCorrect = selectedOptionText === question.answer;
            
            // Update score
            if (isCorrect) {
                score++;
            }
            
            // Save user answer
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // Update UI
            const optionLabels = document.querySelectorAll('.option-label');
            optionLabels.forEach(label => {
                const index = parseInt(label.dataset.index);
                const optionText = question.options[index];
                
                if (optionText === question.answer) {
                    label.classList.add('correct');
                } else if (index === selectedOption && !isCorrect) {
                    label.classList.add('incorrect');
                }
                
                // Disable all options
                const input = label.querySelector('.option-input');
                input.disabled = true;
            });
            
            // Show feedback
            showFeedback(isCorrect);
            
            // Update button
            btnText.textContent = currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'See Results';
            
            // Save progress if enabled
            if (saveProgressToggle.checked) {
                saveProgress();
            }
        }

        // Show feedback
        function showFeedback(isCorrect) {
            const question = questions[currentQuestionIndex];
            
            let feedbackHTML = `
                <div class="feedback-header">
                    <div class="feedback-icon ${isCorrect ? 'correct' : 'incorrect'}">
                        <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                    </div>
                    <div class="feedback-title ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? 'Correct!' : 'Incorrect!'}
                    </div>
                </div>
                <p class="feedback-text">${question.explanation}</p>
            `;
            
            // Add visualization button if available
            if (visualizationsToggle.checked && question.visualization) {
                feedbackHTML += `
                    <button id="show-visualization" class="hint-btn">
                        <i class="fas fa-image"></i> View Visual Explanation
                    </button>
                `;
            }
            
            feedback.innerHTML = feedbackHTML;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            
            // Add event listener to visualization button
            const visualizationBtn = document.getElementById('show-visualization');
            if (visualizationBtn) {
                visualizationBtn.addEventListener('click', () => showVisualization(question.visualization));
            }
        }

        // Show visualization
        function showVisualization(visualization) {
            if (!visualization) return;
            
            let visualizationHTML = '';
            
            if (visualization.image) {
                visualizationHTML += `
                    <img src="${visualization.image}" alt="Visualization" class="visualization-image">
                `;
            }
            
            if (visualization.description) {
                visualizationHTML += `
                    <p class="visualization-description">${visualization.description}</p>
                `;
            }
            
            visualizationContent.innerHTML = visualizationHTML;
            visualizationContainer.classList.add('visible');
        }

        // Show hint
        function showHint() {
            const question = questions[currentQuestionIndex];
            
            if (question.hint) {
                hintText.textContent = question.hint;
                hintContainer.classList.add('visible');
                hintBtn.style.display = 'none';
            }
        }

        // Next question or show results
        function nextQuestion() {
            if (!reviewMode && btnText.textContent === 'Check Answer') {
                // Check answer
                checkAnswer();
            } else {
                // Move to next question or show results
                currentQuestionIndex++;
                
                if (currentQuestionIndex < questions.length) {
                    // Show next question
                    showQuestion();
                    updateProgressBar();
                } else {
                    // End of quiz
                    if (reviewMode) {
                        // End review mode
                        reviewMode = false;
                        showResults();
                    } else {
                        // Complete quiz
                        completeQuiz();
                    }
                }
            }
        }

        // Complete quiz
        function completeQuiz() {
            quizCompleted = true;
            pauseTimer();
            showResults();
            
            // Clear saved progress if completed
            if (saveProgressToggle.checked) {
                localStorage.removeItem('geeQuizProgress');
            }
            
            // Show confetti for good scores
            if (score / questions.length >= 0.7) {
                showConfetti();
            }
        }

        // Show results
        function showResults() {
            // Calculate percentage
            const percentage = Math.round((score / questions.length) * 100);
            
            // Update results
            scorePercentage.textContent = `${percentage}%`;
            correctAnswers.textContent = score;
            incorrectAnswers.textContent = questions.length - score;
            completionTime.textContent = timeDisplay.textContent;
            
            // Update certificate
            certificateScore.textContent = `${percentage}%`;
            certificateName.textContent = userName;
            
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            certificateDate.textContent = today.toLocaleDateString('en-US', options);
            
            // Show results
            questionContainer.innerHTML = '';
            feedback.className = 'feedback';
            feedback.innerHTML = '';
            hintContainer.classList.remove('visible');
            visualizationContainer.classList.remove('visible');
            resultsContainer.classList.add('visible');
            nextBtn.style.display = 'none';
            hintBtn.style.display = 'none';
        }

        // Update progress bar and question navigation
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Update question slider
            // Update max value and total questions display
            questionSlider.max = questions.length;
            questionSliderTotal.textContent = questions.length;
            
            // Update current value (add 1 because slider is 1-based for user-friendliness)
            questionSlider.value = currentQuestionIndex + 1;
            questionSliderValue.textContent = currentQuestionIndex + 1;
        }

        // Timer functions
        function updateTimer() {
            seconds++;
            if (seconds >= 60) {
                seconds = 0;
                minutes++;
            }
            
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
            
            timeDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
        }

        function startTimer() {
            if (!timerInterval) {
                timerInterval = setInterval(updateTimer, 1000);
                timerPaused = false;
                pauseTimerBtn.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                timerPaused = true;
                pauseTimerBtn.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            seconds = 0;
            minutes = 0;
            timeDisplay.textContent = '00:00';
            timerPaused = false;
            pauseTimerBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        // Toggle theme
        function toggleTheme() {
            const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
            
            if (isDarkMode) {
                document.body.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                darkModeToggle.checked = false;
            } else {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                darkModeToggle.checked = true;
            }
            
            // Save setting
            saveSettings();
        }

        // Toggle settings modal
        function toggleSettings() {
            settingsModal.classList.toggle('visible');
        }

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                darkMode: darkModeToggle.checked,
                showHints: hintsToggle.checked,
                showVisualizations: visualizationsToggle.checked,
                shuffleQuestions: shuffleToggle.checked,
                saveProgress: saveProgressToggle.checked,
                highContrast: contrastToggle.checked,
                largeText: largeTextToggle.checked,
                difficulty: currentDifficulty
            };
            
            localStorage.setItem('geeQuizSettings', JSON.stringify(settings));
        }

        // Load settings from localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('geeQuizSettings');
            
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // Apply settings
                darkModeToggle.checked = settings.darkMode;
                hintsToggle.checked = settings.showHints;
                visualizationsToggle.checked = settings.showVisualizations;
                shuffleToggle.checked = settings.shuffleQuestions;
                saveProgressToggle.checked = settings.saveProgress;
                contrastToggle.checked = settings.highContrast;
                largeTextToggle.checked = settings.largeText;
                currentDifficulty = settings.difficulty || 'all';
                
                // Apply theme
                if (settings.darkMode) {
                    document.body.setAttribute('data-theme', 'dark');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
                
                // Apply high contrast
                if (settings.highContrast) {
                    document.body.classList.add('high-contrast');
                }
                
                // Apply large text
                if (settings.largeText) {
                    document.body.classList.add('large-text');
                }
                
                // Update difficulty buttons
                difficultyBtns.forEach(btn => {
                    if (btn.dataset.difficulty === currentDifficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            const progress = {
                currentQuestionIndex,
                score,
                userAnswers,
                seconds,
                minutes,
                questions,
                currentDifficulty
            };
            
            localStorage.setItem('geeQuizProgress', JSON.stringify(progress));
        }

        // Load progress from localStorage
        function loadProgress() {
            const savedProgress = localStorage.getItem('geeQuizProgress');
            
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                
                currentQuestionIndex = progress.currentQuestionIndex;
                score = progress.score;
                userAnswers = progress.userAnswers;
                seconds = progress.seconds;
                minutes = progress.minutes;
                questions = progress.questions;
                currentDifficulty = progress.currentDifficulty;
                
                // Update timer display
                const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
                const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
                timeDisplay.textContent = `${formattedMinutes}:${formattedSeconds}`;
                
                // Update difficulty buttons
                difficultyBtns.forEach(btn => {
                    if (btn.dataset.difficulty === currentDifficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Start timer
                startTimer();
            }
        }

        // Change difficulty
        function changeDifficulty(difficulty) {
            if (difficulty === currentDifficulty) return;
            
            // Update active button
            difficultyBtns.forEach(btn => {
                if (btn.dataset.difficulty === difficulty) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update difficulty
            currentDifficulty = difficulty;
            
            // Save setting
            saveSettings();
            
            // Restart quiz with new difficulty
            initQuiz();
        }

        // Review answers
        function reviewAnswers() {
            reviewMode = true;
            currentQuestionIndex = 0;
            showQuestion();
            updateProgressBar();
            
            // Update button
            nextBtn.style.display = 'block';
            btnText.textContent = 'Next Question';
            
            // Hide results
            resultsContainer.classList.remove('visible');
        }

        // Generate certificate
        function generateCertificate() {
            // Show certificate
            certificateContainer.classList.add('visible');
            
            // Scroll to certificate
            certificateContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // Share results
        function shareResults() {
            const percentage = Math.round((score / questions.length) * 100);
            const text = `I scored ${percentage}% on the GEE Datatypes Quiz! Test your Google Earth Engine knowledge too!`;
            
            // Try to use Web Share API if available
            if (navigator.share) {
                navigator.share({
                    title: 'My GEE Quiz Results',
                    text: text,
                    url: window.location.href
                }).catch(err => {
                    console.error('Error sharing:', err);
                    // Fallback to clipboard
                    copyToClipboard(text);
                });
            } else {
                // Fallback to clipboard
                copyToClipboard(text);
            }
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            alert('Result copied to clipboard!');
        }

        // Show confetti animation
        function showConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            quizContainer.appendChild(confettiContainer);
            
            const colors = ['#4285F4', '#34A853', '#FBBC05', '#EA4335'];
            
            // Create confetti pieces
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.animationDelay = `${Math.random() * 3}s`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Random size
                const size = Math.random() * 10 + 5;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                
                // Random shape
                const shapes = ['circle', 'square', 'triangle'];
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                
                if (shape === 'circle') {
                    confetti.style.borderRadius = '50%';
                } else if (shape === 'triangle') {
                    confetti.style.width = '0';
                    confetti.style.height = '0';
                    confetti.style.backgroundColor = 'transparent';
                    confetti.style.borderLeft = `${size/2}px solid transparent`;
                    confetti.style.borderRight = `${size/2}px solid transparent`;
                    confetti.style.borderBottom = `${size}px solid ${colors[Math.floor(Math.random() * colors.length)]}`;
                }
                
                confettiContainer.appendChild(confetti);
            }
            
            // Remove confetti after animation
            setTimeout(() => {
                quizContainer.removeChild(confettiContainer);
            }, 5000);
        }

        // Ask for user name
        function askForName() {
            const name = prompt('Enter your name for the certificate:', 'Quiz Taker');
            if (name) {
                userName = name;
                certificateName.textContent = userName;
            }
        }

        // Event Listeners
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', initQuiz);
        reviewBtn.addEventListener('click', reviewAnswers);
        certificateBtn.addEventListener('click', () => {
            askForName();
            generateCertificate();
        });
        shareBtn.addEventListener('click', shareResults);
        pauseTimerBtn.addEventListener('click', pauseTimer);
        resetTimerBtn.addEventListener('click', resetTimer);
        themeToggle.addEventListener('click', toggleTheme);
        settingsBtn.addEventListener('click', toggleSettings);
        closeSettings.addEventListener('click', toggleSettings);
        hintBtn.addEventListener('click', showHint);
        closeVisualization.addEventListener('click', () => {
            visualizationContainer.classList.remove('visible');
        });
        
        // Question navigation slider event listeners
        questionSlider.addEventListener('input', function() {
            // Update the displayed value while sliding
            questionSliderValue.textContent = this.value;
        });
        
        questionSlider.addEventListener('change', function() {
            // Navigate to the selected question when slider is released
            const newIndex = parseInt(this.value) - 1; // Convert to 0-based index
            if (newIndex >= 0 && newIndex < questions.length) {
                currentQuestionIndex = newIndex;
                showQuestion();
                updateProgressBar();
            }
        });

        // Settings event listeners
        darkModeToggle.addEventListener('change', toggleTheme);
        hintsToggle.addEventListener('change', saveSettings);
        visualizationsToggle.addEventListener('change', saveSettings);
        shuffleToggle.addEventListener('change', saveSettings);
        saveProgressToggle.addEventListener('change', saveSettings);
        
        contrastToggle.addEventListener('change', () => {
            document.body.classList.toggle('high-contrast', contrastToggle.checked);
            saveSettings();
        });
        
        largeTextToggle.addEventListener('change', () => {
            document.body.classList.toggle('large-text', largeTextToggle.checked);
            saveSettings();
        });
        
        // LLM Integration
        const generateAiQuestionBtn = document.getElementById('generate-ai-question');
        const aiTopicInput = document.getElementById('ai-topic-input');
        const aiQuestionCountInput = document.getElementById('ai-question-count-input');
        const aiStatus = document.getElementById('ai-status');
        
        // Function to generate questions using LLM
        async function generateAiQuestion() {
            const topic = aiTopicInput.value.trim() || "Google Earth Engine";
            const questionCount = parseInt(aiQuestionCountInput.value) || 1;
            
            // Show loading state
            generateAiQuestionBtn.classList.add('loading');
            generateAiQuestionBtn.disabled = true;
            aiStatus.textContent = `Generating ${questionCount} question${questionCount > 1 ? 's' : ''} about ${topic}...`;
            aiStatus.classList.add('visible');
            
            try {
                // Track the number of questions successfully generated
                let generatedCount = 0;
                
                // Generate the requested number of questions
                for (let i = 0; i < questionCount; i++) {
                    // In a real implementation, this would call the OpenAI API
                    // For demonstration purposes, we'll simulate the API call
                    const question = await simulateLLMApiCall(topic);
                    
                    // Add the generated question to the questions array
                    questions.push(question);
                    generatedCount++;
                    
                    // Update status for multiple questions
                    if (questionCount > 1) {
                        aiStatus.textContent = `Generated ${generatedCount} of ${questionCount} questions...`;
                    }
                }
                
                // Update UI to show the first new question
                currentQuestionIndex = questions.length - generatedCount;
                showQuestion();
                updateProgressBar();
                
                // Success message
                aiStatus.textContent = `${generatedCount} new question${generatedCount > 1 ? 's' : ''} about ${topic} added!`;
                setTimeout(() => {
                    aiStatus.classList.remove('visible');
                }, 3000);
            } catch (error) {
                console.error('Error generating question:', error);
                aiStatus.textContent = `Error: ${error.message || 'Failed to generate question'}`;
            } finally {
                // Reset loading state
                generateAiQuestionBtn.classList.remove('loading');
                generateAiQuestionBtn.disabled = false;
            }
        }
        
        // Simulate LLM API call (in a real implementation, this would call the actual API)
        async function simulateLLMApiCall(topic) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // This is where you would normally make the actual API call
            // For demonstration, we'll generate random questions based on the topic
            
            // Define question templates for different topics
            const questionTemplates = [
                {
                    topic: "ndvi",
                    questions: [
                        {
                            q: "What is the formula used to calculate NDVI in Google Earth Engine?",
                            options: [
                                "(NIR - RED) / (NIR + RED)",
                                "(RED - NIR) / (RED + NIR)",
                                "(NIR - RED) * (NIR + RED)",
                                "NIR / RED"
                            ],
                            answer: "(NIR - RED) / (NIR + RED)",
                            explanation: "NDVI (Normalized Difference Vegetation Index) is calculated as (NIR - RED) / (NIR + RED), where NIR is the near-infrared band and RED is the red band.",
                            difficulty: "medium",
                            hint: "Think about how to normalize the difference between two bands."
                        },
                        {
                            q: "What does NDVI stand for in Google Earth Engine?",
                            options: [
                                "Normalized Difference Vegetation Index",
                                "Natural Density Variation Index",
                                "Near-Distance Vegetation Indicator",
                                "Normalized Digital Value Index"
                            ],
                            answer: "Normalized Difference Vegetation Index",
                            explanation: "NDVI stands for Normalized Difference Vegetation Index, which is used to quantify vegetation greenness.",
                            difficulty: "easy",
                            hint: "It's a standard index used to measure vegetation health."
                        },
                        {
                            q: "What is the typical range of NDVI values for healthy vegetation?",
                            options: [
                                "0.6 to 0.9",
                                "0.0 to 0.3",
                                "-0.5 to 0.0",
                                "-1.0 to -0.5"
                            ],
                            answer: "0.6 to 0.9",
                            explanation: "Healthy vegetation typically has NDVI values between 0.6 and 0.9, with higher values indicating denser vegetation.",
                            difficulty: "medium",
                            hint: "Higher values indicate healthier vegetation."
                        }
                    ]
                },
                {
                    topic: "classification",
                    questions: [
                        {
                            q: "Which classifier is commonly used for land cover classification in Google Earth Engine?",
                            options: [
                                "Random Forest",
                                "Linear Regression",
                                "K-Means",
                                "Principal Component Analysis"
                            ],
                            answer: "Random Forest",
                            explanation: "Random Forest is a popular supervised classification algorithm in GEE due to its accuracy and ability to handle large datasets with many features.",
                            difficulty: "medium",
                            hint: "This ensemble learning method builds multiple decision trees."
                        },
                        {
                            q: "What type of classification is K-Means in Google Earth Engine?",
                            options: [
                                "Unsupervised classification",
                                "Supervised classification",
                                "Semi-supervised classification",
                                "Reinforcement learning"
                            ],
                            answer: "Unsupervised classification",
                            explanation: "K-Means is an unsupervised classification algorithm that groups data into k clusters based on feature similarity without training data.",
                            difficulty: "medium",
                            hint: "This algorithm doesn't require labeled training data."
                        },
                        {
                            q: "What is the purpose of training data in supervised classification in GEE?",
                            options: [
                                "To teach the algorithm to recognize different classes",
                                "To validate the final classification accuracy",
                                "To determine the number of classes",
                                "To visualize the classification results"
                            ],
                            answer: "To teach the algorithm to recognize different classes",
                            explanation: "Training data provides labeled examples that help the supervised classification algorithm learn to distinguish between different classes.",
                            difficulty: "easy",
                            hint: "Think about what 'supervised' means in this context."
                        }
                    ]
                },
                {
                    topic: "sentinel",
                    questions: [
                        {
                            q: "What is the spatial resolution of Sentinel-2 optical bands in Google Earth Engine?",
                            options: [
                                "10m, 20m, and 60m depending on the band",
                                "30m for all bands",
                                "5m for all bands",
                                "250m for all bands"
                            ],
                            answer: "10m, 20m, and 60m depending on the band",
                            explanation: "Sentinel-2 provides different resolutions: 10m for visible and NIR bands, 20m for red edge and SWIR bands, and 60m for atmospheric bands.",
                            difficulty: "easy",
                            hint: "Different bands have different resolutions based on their intended use."
                        },
                        {
                            q: "How often does Sentinel-2 revisit the same area on Earth?",
                            options: [
                                "Every 5 days (with two satellites)",
                                "Every 16 days",
                                "Every 30 days",
                                "Every 365 days"
                            ],
                            answer: "Every 5 days (with two satellites)",
                            explanation: "The Sentinel-2 mission consists of two satellites (2A and 2B) that together provide a revisit time of 5 days at the equator.",
                            difficulty: "medium",
                            hint: "The Sentinel-2 mission includes multiple satellites to increase temporal resolution."
                        },
                        {
                            q: "Which Sentinel-2 bands are best for vegetation analysis in GEE?",
                            options: [
                                "Red, NIR, and Red Edge bands",
                                "Thermal bands",
                                "Coastal aerosol bands",
                                "Water vapor bands"
                            ],
                            answer: "Red, NIR, and Red Edge bands",
                            explanation: "Red, NIR, and Red Edge bands are most useful for vegetation analysis as they capture chlorophyll absorption and leaf structure reflectance.",
                            difficulty: "medium",
                            hint: "Think about which wavelengths plants strongly absorb and reflect."
                        }
                    ]
                },
                {
                    topic: "landsat",
                    questions: [
                        {
                            q: "What is the spatial resolution of Landsat 8 optical bands in Google Earth Engine?",
                            options: [
                                "30m (15m for panchromatic)",
                                "10m for all bands",
                                "250m for all bands",
                                "1km for all bands"
                            ],
                            answer: "30m (15m for panchromatic)",
                            explanation: "Landsat 8 optical bands have a 30m resolution, while the panchromatic band has a higher resolution of 15m.",
                            difficulty: "medium",
                            hint: "The panchromatic band has a higher resolution than the multispectral bands."
                        },
                        {
                            q: "How long has the Landsat program been collecting Earth observation data?",
                            options: [
                                "Since the 1970s (over 50 years)",
                                "Since the 1990s (about 30 years)",
                                "Since 2010 (about 15 years)",
                                "Since 2020 (less than 5 years)"
                            ],
                            answer: "Since the 1970s (over 50 years)",
                            explanation: "The Landsat program is the longest-running Earth observation satellite program, beginning with Landsat 1 in 1972.",
                            difficulty: "easy",
                            hint: "It's the longest-running Earth observation program in history."
                        },
                        {
                            q: "What is the revisit time for a single Landsat satellite?",
                            options: [
                                "16 days",
                                "5 days",
                                "1 day",
                                "30 days"
                            ],
                            answer: "16 days",
                            explanation: "A single Landsat satellite has a revisit time of 16 days, meaning it passes over the same point on Earth every 16 days.",
                            difficulty: "medium",
                            hint: "This is longer than Sentinel-2's revisit time."
                        }
                    ]
                },
                {
                    topic: "reducers",
                    questions: [
                        {
                            q: "What are reducers in Google Earth Engine?",
                            options: [
                                "Functions that aggregate values across dimensions",
                                "Functions that compress file sizes",
                                "Functions that simplify code",
                                "Functions that reduce processing time"
                            ],
                            answer: "Functions that aggregate values across dimensions",
                            explanation: "Reducers in GEE are functions that aggregate values across dimensions, such as calculating statistics over regions or time series.",
                            difficulty: "medium",
                            hint: "These functions help you summarize data across space, time, or bands."
                        },
                        {
                            q: "Which reducer would you use to calculate the average value of pixels within a region?",
                            options: [
                                "ee.Reducer.mean()",
                                "ee.Reducer.sum()",
                                "ee.Reducer.count()",
                                "ee.Reducer.first()"
                            ],
                            answer: "ee.Reducer.mean()",
                            explanation: "ee.Reducer.mean() calculates the average value of all pixels within a region or across an image collection.",
                            difficulty: "easy",
                            hint: "Think about which statistical function calculates an average."
                        },
                        {
                            q: "What is the purpose of ee.Reducer.percentile() in GEE?",
                            options: [
                                "To calculate values at specified percentiles of a distribution",
                                "To reduce the size of an image by a percentage",
                                "To count the percentage of pixels meeting a condition",
                                "To calculate the percent change between images"
                            ],
                            answer: "To calculate values at specified percentiles of a distribution",
                            explanation: "ee.Reducer.percentile() calculates values at specified percentiles of a distribution, useful for finding medians or creating robust composites.",
                            difficulty: "hard",
                            hint: "This is useful for finding values like the median (50th percentile)."
                        }
                    ]
                },
                {
                    topic: "default",
                    questions: [
                        {
                            q: "What is the purpose of the scale parameter in Google Earth Engine?",
                            options: [
                                "To determine the pixel resolution for computations",
                                "To set the visual size of the output",
                                "To scale values between 0 and 1",
                                "To set the maximum extent of the analysis"
                            ],
                            answer: "To determine the pixel resolution for computations",
                            explanation: "The scale parameter in GEE determines the pixel resolution at which computations are performed, affecting both accuracy and processing time.",
                            difficulty: "hard",
                            hint: "This parameter affects how detailed your analysis will be."
                        },
                        {
                            q: "What is the Earth Engine Data Catalog?",
                            options: [
                                "A repository of geospatial datasets available in GEE",
                                "A tool for cataloging your own datasets",
                                "A visualization platform for Earth data",
                                "A programming language for GEE"
                            ],
                            answer: "A repository of geospatial datasets available in GEE",
                            explanation: "The Earth Engine Data Catalog is a repository of petabytes of geospatial datasets that are ready to use in Google Earth Engine.",
                            difficulty: "easy",
                            hint: "It contains many public datasets that you can access through GEE."
                        },
                        {
                            q: "What is the difference between client-side and server-side operations in GEE?",
                            options: [
                                "Server-side runs on Google's servers, client-side runs in your browser",
                                "Server-side is for data storage, client-side is for processing",
                                "Server-side is for visualization, client-side is for analysis",
                                "There is no difference in GEE"
                            ],
                            answer: "Server-side runs on Google's servers, client-side runs in your browser",
                            explanation: "Server-side operations in GEE run on Google's distributed computing infrastructure, while client-side operations run locally in your web browser.",
                            difficulty: "hard",
                            hint: "Think about where the computation actually happens."
                        }
                    ]
                }
            ];
            
            // Improved topic matching logic
            let matchedTopic = "default";
            let bestMatchScore = 0;
            
            // Define related keywords for each topic to improve matching
            const topicKeywords = {
                "ndvi": ["ndvi", "vegetation", "index", "normalized difference", "plant", "chlorophyll", "greenness", "health", "biomass", "forest", "agriculture", "crop", "photosynthesis", "leaf", "canopy"],
                "classification": ["classification", "classifier", "supervised", "unsupervised", "random forest", "land cover", "land use", "classes", "training", "machine learning", "categorize", "segment", "cluster", "decision tree", "svm", "neural network", "accuracy", "confusion matrix", "validation"],
                "sentinel": ["sentinel", "esa", "copernicus", "s2", "sentinel-2", "sentinel2", "optical", "multispectral", "10m", "20m", "60m", "bands", "satellite", "imagery", "remote sensing", "revisit", "temporal", "resolution", "swir", "nir", "red edge"],
                "landsat": ["landsat", "usgs", "nasa", "l8", "landsat-8", "landsat8", "30m", "15m", "panchromatic", "oli", "tirs", "thermal", "tm", "etm+", "collection", "tier", "surface reflectance", "top of atmosphere", "landsat 7", "landsat 5", "landsat 9"],
                "reducers": ["reducer", "reduce", "aggregate", "statistics", "mean", "median", "sum", "min", "max", "percentile", "count", "standard deviation", "variance", "mode", "histogram", "frequency", "zonal", "regional", "summarize", "calculate"],
                "image": ["image", "raster", "pixel", "band", "composite", "mosaic", "stack", "collection", "mask", "clip", "projection", "resolution", "scale", "extent", "boundary"],
                "vector": ["vector", "feature", "geometry", "polygon", "point", "line", "shapefile", "geojson", "buffer", "intersection", "union", "dissolve", "merge", "boundary", "area", "perimeter", "distance"],
                "time series": ["time series", "temporal", "trend", "change", "dynamic", "seasonal", "annual", "monthly", "daily", "frequency", "period", "cycle", "pattern", "anomaly", "forecast", "historical", "monitoring"]
            };
            
            // Add new template categories for the additional topics
            const imageQuestions = [
                {
                    topic: "image",
                    questions: [
                        {
                            q: "What is the purpose of image masking in Google Earth Engine?",
                            options: [
                                "To remove unwanted pixels from analysis",
                                "To change the visual appearance of images",
                                "To increase image resolution",
                                "To convert raster data to vector data"
                            ],
                            answer: "To remove unwanted pixels from analysis",
                            explanation: "Image masking in GEE is used to exclude specific pixels (like clouds, shadows, or areas outside a region of interest) from analysis calculations.",
                            difficulty: "medium",
                            hint: "Think about how you might want to exclude certain areas from your analysis."
                        },
                        {
                            q: "What does the 'scale' parameter control when working with images in GEE?",
                            options: [
                                "The pixel resolution for computations",
                                "The visual size of the output",
                                "The color intensity of the image",
                                "The geographic projection of the data"
                            ],
                            answer: "The pixel resolution for computations",
                            explanation: "The scale parameter in GEE determines the pixel resolution (in meters) at which computations are performed on images.",
                            difficulty: "medium",
                            hint: "This parameter affects the spatial detail of your analysis."
                        }
                    ]
                }
            ];
            
            const vectorQuestions = [
                {
                    topic: "vector",
                    questions: [
                        {
                            q: "What is a FeatureCollection in Google Earth Engine?",
                            options: [
                                "A group of vector features with geometry and properties",
                                "A collection of satellite images",
                                "A set of pixel values",
                                "A database of Earth Engine users"
                            ],
                            answer: "A group of vector features with geometry and properties",
                            explanation: "A FeatureCollection in GEE is a group of vector features (points, lines, or polygons) that each have geometry and can contain properties (attributes).",
                            difficulty: "easy",
                            hint: "Think about how vector data is organized in GIS systems."
                        },
                        {
                            q: "Which function would you use to calculate the area of a polygon in GEE?",
                            options: [
                                "feature.area()",
                                "feature.size()",
                                "feature.perimeter()",
                                "feature.dimension()"
                            ],
                            answer: "feature.area()",
                            explanation: "The area() function calculates the area of a polygon feature's geometry in square meters.",
                            difficulty: "easy",
                            hint: "This is a common measurement for polygon features."
                        }
                    ]
                }
            ];
            
            const timeSeriesQuestions = [
                {
                    topic: "time series",
                    questions: [
                        {
                            q: "What is the purpose of the 'timeField' parameter in time series analysis in GEE?",
                            options: [
                                "To specify which property contains the timestamp for each feature",
                                "To set the time zone for analysis",
                                "To determine how long the analysis will run",
                                "To control the temporal resolution of the output"
                            ],
                            answer: "To specify which property contains the timestamp for each feature",
                            explanation: "The timeField parameter identifies which property in each feature contains the timestamp information needed for temporal analysis.",
                            difficulty: "hard",
                            hint: "This parameter helps GEE know when each data point occurred."
                        },
                        {
                            q: "Which reducer is commonly used to create a monthly composite from a daily image collection?",
                            options: [
                                "ee.Reducer.median()",
                                "ee.Reducer.count()",
                                "ee.Reducer.first()",
                                "ee.Reducer.toList()"
                            ],
                            answer: "ee.Reducer.median()",
                            explanation: "The median reducer is often used to create monthly composites as it helps eliminate outliers and cloud effects in time series data.",
                            difficulty: "medium",
                            hint: "This statistical measure is less affected by extreme values than mean."
                        }
                    ]
                }
            ];
            
            // Add the new question templates to the existing array
            questionTemplates.push(...imageQuestions, ...vectorQuestions, ...timeSeriesQuestions);
            // Calculate match score for each topic based on keyword matches
            for (const template of questionTemplates) {
                const keywords = topicKeywords[template.topic] || [];
                let score = 0;
                
                // Direct match with template topic
                if (topic.toLowerCase().includes(template.topic)) {
                    score += 10; // High score for direct match
                }
                
                // Check for keyword matches
                for (const keyword of keywords) {
                    if (topic.toLowerCase().includes(keyword)) {
                        score += 5; // Add points for each keyword match
                    }
                }
                
                // Check if this is the best match so far
                if (score > bestMatchScore) {
                    bestMatchScore = score;
                    matchedTopic = template.topic;
                }
            }
            
            // If no good match found, customize a default question with the user's topic
            if (bestMatchScore === 0) {
                // Create a custom default question that incorporates the user's topic
                return {
                    q: `What is the significance of ${topic} in Google Earth Engine applications?`,
                    options: [
                        `${topic} is essential for accurate spatial analysis`,
                        `${topic} is primarily used for visualization purposes`,
                        `${topic} helps optimize computational efficiency`,
                        `${topic} is mainly used for data preprocessing`
                    ],
                    answer: `${topic} is essential for accurate spatial analysis`,
                    explanation: `${topic} plays an important role in Google Earth Engine as it contributes to more accurate spatial analysis and interpretation of Earth observation data.`,
                    difficulty: "medium",
                    hint: `Consider how ${topic} might be applied in different GEE analysis workflows.`,
                    visualization: {
                        image: "https://developers.google.com/earth-engine/images/analysis.png",
                        description: `Visualization related to ${topic} analysis in Google Earth Engine.`
                    },
                    isAiGenerated: true
                };
            }
            
            // Find the template for the matched topic
            const topicTemplate = questionTemplates.find(t => t.topic === matchedTopic) || 
                                 questionTemplates.find(t => t.topic === "default");
            
            // Select a random question from the template
            const randomIndex = Math.floor(Math.random() * topicTemplate.questions.length);
            const questionTemplate = topicTemplate.questions[randomIndex];
            
            // Create a copy of the question to avoid modifying the template
            let question = questionTemplate.q;
            const options = [...questionTemplate.options]; // Create a copy of the options array
            const answer = questionTemplate.answer;
            let explanation = questionTemplate.explanation;
            const difficulty = questionTemplate.difficulty;
            let hint = questionTemplate.hint;
            
            // Customize the question with the user's specific topic if it's not already included
            if (!question.toLowerCase().includes(topic.toLowerCase()) && matchedTopic !== "default") {
                // Add the specific topic to the question for more relevance
                question = question.replace("in Google Earth Engine", `for ${topic} in Google Earth Engine`);
                explanation = explanation.replace("in GEE", `for ${topic} in GEE`);
                hint = `When working with ${topic}, ${hint.toLowerCase()}`;
            }
            
            // Randomize the order of options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            // Create visualization object with more variety
            let visualization;
            
            // Create more varied visualizations based on topic
            if (topic.toLowerCase().includes('ndvi')) {
                const ndviVisuals = [
                    {
                        image: "https://developers.google.com/earth-engine/images/NDVI.png",
                        description: "NDVI visualization showing vegetation health across a landscape."
                    },
                    {
                        image: "https://developers.google.com/earth-engine/images/ndvi_timeseries.png",
                        description: "Time series of NDVI values showing seasonal vegetation changes."
                    }
                ];
                visualization = ndviVisuals[Math.floor(Math.random() * ndviVisuals.length)];
            } else if (topic.toLowerCase().includes('classification')) {
                const classVisuals = [
                    {
                        image: "https://developers.google.com/earth-engine/images/classification.png",
                        description: "Land cover classification showing different surface types."
                    },
                    {
                        image: "https://developers.google.com/earth-engine/images/RandomForest.png",
                        description: "Random Forest classification results showing land use categories."
                    }
                ];
                visualization = classVisuals[Math.floor(Math.random() * classVisuals.length)];
            } else if (topic.toLowerCase().includes('sentinel')) {
                const sentinelVisuals = [
                    {
                        image: "https://developers.google.com/earth-engine/images/Sentinel2.png",
                        description: "Sentinel-2 imagery showing true color composite."
                    },
                    {
                        image: "https://developers.google.com/earth-engine/images/sentinel_bands.png",
                        description: "Different band combinations from Sentinel-2 satellite imagery."
                    }
                ];
                visualization = sentinelVisuals[Math.floor(Math.random() * sentinelVisuals.length)];
            } else {
                // Default visualization with some randomness
                const defaultVisuals = [
                    {
                        image: `https://developers.google.com/earth-engine/images/GEE_general.png`,
                        description: `Visualization related to ${topic} in Google Earth Engine.`
                    },
                    {
                        image: `https://developers.google.com/earth-engine/images/analysis.png`,
                        description: `Example analysis of ${topic} using Google Earth Engine tools.`
                    }
                ];
                visualization = defaultVisuals[Math.floor(Math.random() * defaultVisuals.length)];
            }
            
            // Return the generated question in the same format as our original questions
            return {
                q: question,
                options: options,
                answer: answer,
                explanation: explanation,
                difficulty: difficulty,
                hint: hint,
                visualization: visualization,
                isAiGenerated: true
            };
        }
        
        // Function to call the actual LLM API (not used in this demo)
        async function callLLMApi(topic) {
            if (!API_KEY) {
                throw new Error("API key not set. Please add your API key in settings.");
            }
            
            const prompt = `
                Create a multiple-choice question about Google Earth Engine related to ${topic}.
                The question should test knowledge about GEE concepts, functions, or applications.
                
                Format your response as a JSON object with the following structure:
                {
                    "question": "The question text here",
                    "options": ["Option A", "Option B", "Option C", "Option D"],
                    "answer": "The correct option exactly as written in options",
                    "explanation": "A detailed explanation of why this answer is correct",
                    "difficulty": "easy|medium|hard",
                    "hint": "A hint to help answer the question"
                }
                
                Make sure the options are plausible but only one is correct.
                The explanation should be educational and informative.
            `;
            
            const response = await fetch(LLM_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: "gpt-4",
                    messages: [
                        {
                            role: "system",
                            content: "You are an expert in Google Earth Engine and geospatial analysis."
                        },
                        {
                            role: "user",
                            content: prompt
                        }
                    ],
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || "Failed to generate question");
            }
            
            const data = await response.json();
            const result = JSON.parse(data.choices[0].message.content);
            
            return {
                q: result.question,
                options: result.options,
                answer: result.answer,
                explanation: result.explanation,
                difficulty: result.difficulty,
                hint: result.hint,
                visualization: {
                    image: `https://developers.google.com/earth-engine/images/${topic.replace(/\s+/g, '')}.png`,
                    description: `This visualization shows an example of ${topic} analysis in Google Earth Engine.`
                },
                isAiGenerated: true
            };
        }
        
        // Add API key setting to settings modal
        function addApiKeySettings() {
            const settingsSection = document.querySelector('.settings-section:nth-child(2)');
            
            const apiKeyOption = document.createElement('div');
            apiKeyOption.className = 'settings-option';
            apiKeyOption.innerHTML = `
                <div>
                    <div class="settings-option-label">LLM API Key</div>
                    <div class="settings-option-description">Set your API key for AI question generation</div>
                </div>
                <input type="password" id="api-key-input" placeholder="Enter API key" class="ai-topic-input" style="max-width: 200px;">
            `;
            
            settingsSection.appendChild(apiKeyOption);
            
            // Add event listener for API key input
            const apiKeyInput = document.getElementById('api-key-input');
            apiKeyInput.addEventListener('change', () => {
                API_KEY = apiKeyInput.value.trim();
                // In a real app, you might want to store this securely
                // For demo purposes, we just keep it in memory
            });
        }
        
        // Add event listener for generate button
        generateAiQuestionBtn.addEventListener('click', generateAiQuestion);
        
        // Add event listener for Enter key in topic input
        aiTopicInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateAiQuestion();
            }
        });
        
        // Add API key settings to settings modal
        addApiKeySettings();

        // Difficulty buttons event listeners
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                changeDifficulty(btn.dataset.difficulty);
            });
        });

        // Initialize quiz on load
        document.addEventListener('DOMContentLoaded', initQuiz);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !nextBtn.disabled) {
                nextQuestion();
            }
        });
    </script>
</body>
</html>
