var geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            -16.745176557183022,
            65.03345804077915
          ]
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Point([-16.745176557183022, 65.03345804077915]),
    geometry2 = ui.import && ui.import("geometry2", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -16.79109546770859,
                65.02950884104823
              ],
              [
                -16.79094523945873,
                65.0291283863944
              ],
              [
                -16.790365867761388,
                65.02882039883362
              ],
              [
                -16.787705119195827,
                65.02824970860837
              ],
              [
                -16.786503560110855,
                65.02786017377434
              ],
              [
                -16.78622459252539,
                65.02756122140342
              ],
              [
                -16.78564522602462,
                65.02722603262713
              ],
              [
                -16.78440072231672,
                65.02597586107903
              ],
              [
                -16.784958582931793,
                65.02506082538548
              ],
              [
                -16.784915600524034,
                65.02430886075379
              ],
              [
                -16.78358534031784,
                65.02253302011685
              ],
              [
                -16.784272013018814,
                65.02184435470552
              ],
              [
                -16.78311331320999,
                65.02121004808498
              ],
              [
                -16.77959423366804,
                65.0196515624921
              ],
              [
                -16.773414466056867,
                65.01863663593004
              ],
              [
                -16.766548057582938,
                65.01936158739466
              ],
              [
                -16.761484071085285,
                65.01812921605364
              ],
              [
                -16.75938126243615,
                65.01828324925629
              ],
              [
                -16.75809379285751,
                65.0184553908331
              ],
              [
                -16.756849230414456,
                65.01836026837202
              ],
              [
                -16.755089704480962,
                65.01842824873256
              ],
              [
                -16.752750846839,
                65.01855058316633
              ],
              [
                -16.750755318109615,
                65.01834664980599
              ],
              [
                -16.745948832181302,
                65.01718667389389
              ],
              [
                -16.73667918074107,
                65.01602664758045
              ],
              [
                -16.728439490570132,
                65.01573663313133
              ],
              [
                -16.722603043366213,
                65.01573663313752
              ],
              [
                -16.715049994048844,
                65.01631665890717
              ],
              [
                -16.708870226427102,
                65.016751669968
              ],
              [
                -16.70303377924187,
                65.01805666060048
              ],
              [
                -16.697883972939618,
                65.02153632373941
              ],
              [
                -16.697712302958852,
                65.02298603043391
              ],
              [
                -16.69693983131778,
                65.02367462897504
              ],
              [
                -16.696596521394966,
                65.02436321604816
              ],
              [
                -16.697175847343868,
                65.02494305309563
              ],
              [
                -16.698270173793222,
                65.0251604909325
              ],
              [
                -16.699085594480557,
                65.02577654991485
              ],
              [
                -16.698828153135267,
                65.02708105842306
              ],
              [
                -16.698098587166918,
                65.02780579319032
              ],
              [
                -16.697712312828834,
                65.02845805459866
              ],
              [
                -16.69805559672698,
                65.02959940714415
              ],
              [
                -16.698227293486976,
                65.03016103251497
              ],
              [
                -16.70234713857416,
                65.03171898092184
              ],
              [
                -16.70303377943093,
                65.03269718110484
              ],
              [
                -16.703548740311682,
                65.03340362543722
              ],
              [
                -16.702862068405764,
                65.0336753288416
              ],
              [
                -16.70337701221074,
                65.03414628351132
              ],
              [
                -16.70412804436221,
                65.03436364712837
              ],
              [
                -16.705437015417978,
                65.03507007262623
              ],
              [
                -16.705479930722667,
                65.03562249862618
              ],
              [
                -16.705179499232223,
                65.03615680746489
              ],
              [
                -16.706059267697942,
                65.03655527490544
              ],
              [
                -16.70681029747491,
                65.03711675075802
              ],
              [
                -16.707196501918514,
                65.03771441528734
              ],
              [
                -16.707840204196117,
                65.03831207970602
              ],
              [
                -16.708913092845,
                65.03878295621413
              ],
              [
                -16.71037225019131,
                65.03907271996117
              ],
              [
                -16.713290474478526,
                65.03988766586984
              ],
              [
                -16.714749533707742,
                65.04084744232635
              ],
              [
                -16.716423275967337,
                65.04182532001829
              ],
              [
                -16.72004954392163,
                65.04204264451516
              ],
              [
                -16.72126190301898,
                65.04244101019061
              ],
              [
                -16.722731794251832,
                65.04283936385727
              ],
              [
                -16.723193117909226,
                65.04340522023708
              ],
              [
                -16.723783201540186,
                65.04364514211773
              ],
              [
                -16.72462005540659,
                65.04354554877679
              ],
              [
                -16.725161817438163,
                65.04394617108632
              ],
              [
                -16.725102779589694,
                65.04445543311505
              ],
              [
                -16.72568748965584,
                65.04511858275492
              ],
              [
                -16.726559215270594,
                65.04545014992745
              ],
              [
                -16.72742423447318,
                65.0454529754823
              ],
              [
                -16.728074665608133,
                65.04536527036015
              ],
              [
                -16.728911568840786,
                65.04539241272737
              ],
              [
                -16.731314793118308,
                65.04568210696416
              ],
              [
                -16.736679178480884,
                65.04566400313242
              ],
              [
                -16.74024111575014,
                65.0455373023835
              ],
              [
                -16.743974738002265,
                65.04548294447609
              ],
              [
                -16.748223329082375,
                65.04550110705455
              ],
              [
                -16.752471920162463,
                65.04530188459333
              ],
              [
                -16.758093790592945,
                65.04481301873629
              ],
              [
                -16.759391983967443,
                65.04484924774823
              ],
              [
                -16.76077600256711,
                65.0447044008722
              ],
              [
                -16.76332942759197,
                65.0445776357217
              ],
              [
                -16.765367942850087,
                65.0445052247644
              ],
              [
                -16.766751951405446,
                65.04450522374842
              ],
              [
                -16.769509211502648,
                65.0443603622464
              ],
              [
                -16.771247310388045,
                65.04385337015918
              ],
              [
                -16.77237381970789,
                65.04340069054481
              ],
              [
                -16.77341447167511,
                65.04314719484076
              ],
              [
                -16.77547442037533,
                65.0427940980408
              ],
              [
                -16.77706225377793,
                65.04235045679555
              ],
              [
                -16.77796348361341,
                65.04203356712847
              ],
              [
                -16.77895051144012,
                65.04142693841321
              ],
              [
                -16.77963719366726,
                65.04117341633085
              ],
              [
                -16.780152199013088,
                65.040738802996
              ],
              [
                -16.781825899418457,
                65.04001441797215
              ],
              [
                -16.782641256554886,
                65.03957073620167
              ],
              [
                -16.783456584930434,
                65.03894594537273
              ],
              [
                -16.785130270892562,
                65.03766008688157
              ],
              [
                -16.78601004851112,
                65.03734766085564
              ],
              [
                -16.78658940307812,
                65.03689034617362
              ],
              [
                -16.78706145218527,
                65.03666395812543
              ],
              [
                -16.78824165126417,
                65.03647378644459
              ],
              [
                -16.788821019015362,
                65.03613871323672
              ],
              [
                -16.789293070378974,
                65.03563156624581
              ],
              [
                -16.790194275212677,
                65.03545043987204
              ],
              [
                -16.79049466108958,
                65.03519686406449
              ],
              [
                -16.790752162603496,
                65.03487082656282
              ],
              [
                -16.79109547720242,
                65.03432742678734
              ],
              [
                -16.791610452945434,
                65.03383837002147
              ],
              [
                -16.791589005849783,
                65.03357571160167
              ],
              [
                -16.791739206158887,
                65.0329688827568
              ],
              [
                -16.792297094747717,
                65.03226243187642
              ],
              [
                -16.79195377383443,
                65.03178238275673
              ],
              [
                -16.792468746809682,
                65.03137478720308
              ],
              [
                -16.792640390479303,
                65.03081321628233
              ],
              [
                -16.79139585756848,
                65.03008856623697
              ]
            ]
          ],
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-16.79109546770859, 65.02950884104823],
          [-16.79094523945873, 65.0291283863944],
          [-16.790365867761388, 65.02882039883362],
          [-16.787705119195827, 65.02824970860837],
          [-16.786503560110855, 65.02786017377434],
          [-16.78622459252539, 65.02756122140342],
          [-16.78564522602462, 65.02722603262713],
          [-16.78440072231672, 65.02597586107903],
          [-16.784958582931793, 65.02506082538548],
          [-16.784915600524034, 65.02430886075379],
          [-16.78358534031784, 65.02253302011685],
          [-16.784272013018814, 65.02184435470552],
          [-16.78311331320999, 65.02121004808498],
          [-16.77959423366804, 65.0196515624921],
          [-16.773414466056867, 65.01863663593004],
          [-16.766548057582938, 65.01936158739466],
          [-16.761484071085285, 65.01812921605364],
          [-16.75938126243615, 65.01828324925629],
          [-16.75809379285751, 65.0184553908331],
          [-16.756849230414456, 65.01836026837202],
          [-16.755089704480962, 65.01842824873256],
          [-16.752750846839, 65.01855058316633],
          [-16.750755318109615, 65.01834664980599],
          [-16.745948832181302, 65.01718667389389],
          [-16.73667918074107, 65.01602664758045],
          [-16.728439490570132, 65.01573663313133],
          [-16.722603043366213, 65.01573663313752],
          [-16.715049994048844, 65.01631665890717],
          [-16.708870226427102, 65.016751669968],
          [-16.70303377924187, 65.01805666060048],
          [-16.697883972939618, 65.02153632373941],
          [-16.697712302958852, 65.02298603043391],
          [-16.69693983131778, 65.02367462897504],
          [-16.696596521394966, 65.02436321604816],
          [-16.697175847343868, 65.02494305309563],
          [-16.698270173793222, 65.0251604909325],
          [-16.699085594480557, 65.02577654991485],
          [-16.698828153135267, 65.02708105842306],
          [-16.698098587166918, 65.02780579319032],
          [-16.697712312828834, 65.02845805459866],
          [-16.69805559672698, 65.02959940714415],
          [-16.698227293486976, 65.03016103251497],
          [-16.70234713857416, 65.03171898092184],
          [-16.70303377943093, 65.03269718110484],
          [-16.703548740311682, 65.03340362543722],
          [-16.702862068405764, 65.0336753288416],
          [-16.70337701221074, 65.03414628351132],
          [-16.70412804436221, 65.03436364712837],
          [-16.705437015417978, 65.03507007262623],
          [-16.705479930722667, 65.03562249862618],
          [-16.705179499232223, 65.03615680746489],
          [-16.706059267697942, 65.03655527490544],
          [-16.70681029747491, 65.03711675075802],
          [-16.707196501918514, 65.03771441528734],
          [-16.707840204196117, 65.03831207970602],
          [-16.708913092845, 65.03878295621413],
          [-16.71037225019131, 65.03907271996117],
          [-16.713290474478526, 65.03988766586984],
          [-16.714749533707742, 65.04084744232635],
          [-16.716423275967337, 65.04182532001829],
          [-16.72004954392163, 65.04204264451516],
          [-16.72126190301898, 65.04244101019061],
          [-16.722731794251832, 65.04283936385727],
          [-16.723193117909226, 65.04340522023708],
          [-16.723783201540186, 65.04364514211773],
          [-16.72462005540659, 65.04354554877679],
          [-16.725161817438163, 65.04394617108632],
          [-16.725102779589694, 65.04445543311505],
          [-16.72568748965584, 65.04511858275492],
          [-16.726559215270594, 65.04545014992745],
          [-16.72742423447318, 65.0454529754823],
          [-16.728074665608133, 65.04536527036015],
          [-16.728911568840786, 65.04539241272737],
          [-16.731314793118308, 65.04568210696416],
          [-16.736679178480884, 65.04566400313242],
          [-16.74024111575014, 65.0455373023835],
          [-16.743974738002265, 65.04548294447609],
          [-16.748223329082375, 65.04550110705455],
          [-16.752471920162463, 65.04530188459333],
          [-16.758093790592945, 65.04481301873629],
          [-16.759391983967443, 65.04484924774823],
          [-16.76077600256711, 65.0447044008722],
          [-16.76332942759197, 65.0445776357217],
          [-16.765367942850087, 65.0445052247644],
          [-16.766751951405446, 65.04450522374842],
          [-16.769509211502648, 65.0443603622464],
          [-16.771247310388045, 65.04385337015918],
          [-16.77237381970789, 65.04340069054481],
          [-16.77341447167511, 65.04314719484076],
          [-16.77547442037533, 65.0427940980408],
          [-16.77706225377793, 65.04235045679555],
          [-16.77796348361341, 65.04203356712847],
          [-16.77895051144012, 65.04142693841321],
          [-16.77963719366726, 65.04117341633085],
          [-16.780152199013088, 65.040738802996],
          [-16.781825899418457, 65.04001441797215],
          [-16.782641256554886, 65.03957073620167],
          [-16.783456584930434, 65.03894594537273],
          [-16.785130270892562, 65.03766008688157],
          [-16.78601004851112, 65.03734766085564],
          [-16.78658940307812, 65.03689034617362],
          [-16.78706145218527, 65.03666395812543],
          [-16.78824165126417, 65.03647378644459],
          [-16.788821019015362, 65.03613871323672],
          [-16.789293070378974, 65.03563156624581],
          [-16.790194275212677, 65.03545043987204],
          [-16.79049466108958, 65.03519686406449],
          [-16.790752162603496, 65.03487082656282],
          [-16.79109547720242, 65.03432742678734],
          [-16.791610452945434, 65.03383837002147],
          [-16.791589005849783, 65.03357571160167],
          [-16.791739206158887, 65.0329688827568],
          [-16.792297094747717, 65.03226243187642],
          [-16.79195377383443, 65.03178238275673],
          [-16.792468746809682, 65.03137478720308],
          [-16.792640390479303, 65.03081321628233],
          [-16.79139585756848, 65.03008856623697]]]),
    imageVisParam = ui.import && ui.import("imageVisParam", "imageVisParam", {
      "params": {
        "opacity": 1,
        "bands": [
          "thermal1"
        ],
        "min": -21.459007119999967,
        "max": 0,
        "palette": [
          "0013ff",
          "00f5ff",
          "00ff57",
          "ddff00",
          "fffd00",
          "ffc200",
          "ff0000"
        ]
      }
    }) || {"opacity":1,"bands":["thermal1"],"min":-21.459007119999967,"max":0,"palette":["0013ff","00f5ff","00ff57","ddff00","fffd00","ffc200","ff0000"]},
    imageVisParam2 = ui.import && ui.import("imageVisParam2", "imageVisParam", {
      "params": {
        "opacity": 1,
        "bands": [
          "thermal1"
        ],
        "min": -3.752308400000004,
        "max": 37.512091940000005,
        "palette": [
          "0043ff",
          "00fffd",
          "00ff9e",
          "aeff00",
          "fffd00",
          "ffda00",
          "ff0000"
        ]
      }
    }) || {"opacity":1,"bands":["thermal1"],"min":-3.752308400000004,"max":37.512091940000005,"palette":["0043ff","00fffd","00ff9e","aeff00","fffd00","ffda00","ff0000"]};
Map.style().set('cursor', 'crosshair')
Map.setOptions('HYBRID')
//cloudmask
function maskcloud(image) {
  // Bits 3 and 5 are cloud shadow and cloud, respectively.
  var cloudsBitMask = (1 << 3);
  var cloudShadowBitMask = (1 << 5);
  // Get the pixel QA band.
  var qa = image.select('pixel_qa');
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudsBitMask).eq(0)
                 .and(qa.bitwiseAnd(cloudShadowBitMask).eq(0));
  return image.updateMask(mask);
}
//datasets
 var l5 = ee.ImageCollection("LANDSAT/LT05/C02/T1_L2")
 .merge(ee.ImageCollection('LANDSAT/LT05/C02/T2_L2'))
    .select(
      ['SR_B1', 'SR_B2', 'SR_B3', 'SR_B4', 'SR_B5', 'SR_B7', 'ST_B6','QA_PIXEL'], 
      ['blue', 'green', 'red', 'nir', 'swir1', 'swir2', 'thermal1','pixel_qa']
    )
    var l7 = ee.ImageCollection('LANDSAT/LE07/C02/T1_L2')
    .merge(ee.ImageCollection('LANDSAT/LE07/C02/T2_L2'))
    .select(
      ['SR_B1', 'SR_B2', 'SR_B3', 'SR_B4', 'SR_B5', 'SR_B7', 'ST_B6','QA_PIXEL'], 
      ['blue', 'green', 'red', 'nir', 'swir1', 'swir2', 'thermal1','pixel_qa']
    )
  var l8 = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
    .merge(ee.ImageCollection('LANDSAT/LC08/C02/T2_L2'))
    .select(
      ['SR_B2', 'SR_B3', 'SR_B4', 'SR_B5', 'SR_B6', 'SR_B7', 'ST_B10','QA_PIXEL'], 
      ['blue', 'green', 'red', 'nir', 'swir1', 'swir2', 'thermal1','pixel_qa']
    )
  var l9 = ee.ImageCollection('LANDSAT/LC09/C02/T1_L2')
    .merge(ee.ImageCollection('LANDSAT/LC09/C02/T2_L2'))
    .select(
      ['SR_B2', 'SR_B3', 'SR_B4', 'SR_B5', 'SR_B6', 'SR_B7', 'ST_B10','QA_PIXEL'], 
      ['blue', 'green', 'red', 'nir', 'swir1', 'swir2', 'thermal1','pixel_qa']
    )
var RT = l5.merge(l7).merge(l8).merge(l9).sort('system:time_start').map(maskcloud)
var inspectorPanel = ui.Panel({style: {width: '30%'}});
//
// Create an intro panel with labels.
var intro = ui.Panel([
  ui.Label({
    value: 'Time Series of Surface Temperature and Water Extent for Askja volcano and lake (Iceland)',
    style: {fontSize: '20px', fontWeight: 'bold'}
  }),
   ui.Label('This app is designed to monitor geothermal activity over Lake Askja, Iceland using the Google Earth Engine Platform. Surface temperature data is derived from LANDSAT series (5-9) satellite images with TIRS and OLI sensors. There are four main charts available in this app: (1) Temperature statistics for winter during the period of January-February to monitor geothermal activity during that time; (2) Temperature statistics for all available satellite data to observe the temperature trend from 1999 to 2023; (3) Water presence in the lake during winter only, specifically in January-February; and (4) Water presence for all available satellite data to observe the water trend from 1999 to 2023. The app will automatically update the charts when new datasets become available. This is a beta app, and any comments or suggestions to improve it can be sent to m.aufaristama@utwente.nl.')
]);
inspectorPanel.add(intro);
inspectorPanel.add(ui.Label('[Chart]'));
Map.centerObject(geometry,12);
var aoi = geometry.buffer(3500);
var l8 = RT.filterDate('1984-01-01','2023-12-31').filterBounds(geometry);
function addindices(image) {
  var NDWI = image.normalizedDifference(['green', 'swir1']).rename(['NDWI'])
  return image.addBands(NDWI)
}
var l8c = l8.map(function(image) {
  return image
    .multiply(0.00341802)
    .add(149)
    .subtract(273.15)
    .copyProperties(image, ['system:time_start']);
});
var l8o= l8.map(function(image) {
  return image
  .multiply(2.75e-05)
  .add(-0.2)
  .copyProperties(image, ['system:time_start']);
})
var l8t = l8c.map(addindices)
var l8m = l8o.map(addindices)
var Threshold = 50; 
var Threshold_w = 0.92
// mask function water:
var maskfunction = function(image){
  //get pixels above the threshold
var ndwi01 = image.select(['NDWI']).gt(Threshold_w);
  //mask those pixels from the image
  image = image.updateMask(ndwi01)
  var area = ee.Image.pixelArea();
  var waterArea = ndwi01.multiply(area).rename('waterArea');
image = image.addBands(waterArea);
  var stats = waterArea.reduceRegion({
    reducer: ee.Reducer.sum(), 
    geometry: geometry2, 
    scale: 30,
});
 return image.set(stats);
};
var collection = l8m.map(maskfunction);
print(collection);
//time series
var reducers = ee.Reducer.max().combine({
  reducer2: ee.Reducer.median(),
  sharedInputs: true
}).combine({
  reducer2: ee.Reducer.mean(),
  sharedInputs: true
}).combine({
  reducer2: ee.Reducer.min(),
  sharedInputs: true
});
var charts = ui.Chart.image.series({
  imageCollection: l8c.select('thermal1').filter(ee.Filter.calendarRange(1, 2, 'month')), 
  region: geometry2,
  reducer: reducers,
  scale: 30,
})
        .setOptions({
          title: 'Annual surface temperature statistics of Askja Lake for January & February',
          hAxis: {title: 'Date', format: 'YYYY-MMMM',titleTextStyle: {italic: false, bold: true}},
          vAxis: {
            title: 'Temperature (C)',
            titleTextStyle: {italic: false, bold: true}
          },
          lineWidth: 1,
          pointSize: 6,
          curveType: 'points',
          interpolateNulls: true
        });
//print(chart);
inspectorPanel.widgets().set(1, charts);
var chart = ui.Chart.image.series({
  imageCollection: l8c.select('thermal1'), 
  region: geometry2,
  reducer: reducers,
  scale: 30,
})
        .setOptions({
          title: 'Time Series surface temperature statistics of Askja Lake 1984-2003',
          hAxis: {title: 'Date', format: 'YYYY-MMMM',titleTextStyle: {italic: false, bold: true}},
          vAxis: {
            title: 'Temperature (C)',
            titleTextStyle: {italic: false, bold: true}
          },
          lineWidth: 0,
          pointSize: 6,
          curveType: 'points',
          trendlines: {
      0: {
        type: 'polynomial',
        degree: 9,
        visibleInLegend: false,
      }
    }
          //interpolateNulls: true
        });
//print(chart);
inspectorPanel.widgets().set(2, chart);
// Create a time series chart of maximum water detected.
var chart2 = ui.Chart.image.series({
  imageCollection: collection.select('waterArea').filter(ee.Filter.calendarRange(1, 2, 'month')), 
  region: geometry2,
  reducer: ee.Reducer.sum(),
  scale: 30,
})
        .setOptions({
          title: 'Annual Water extent of Askja Lake for January & February',
          hAxis: {title: 'Date', format: 'YYYY-MMMM',titleTextStyle: {italic: false, bold: true}},
          vAxis: {
            title: 'Area (m2)',
            titleTextStyle: {italic: false, bold: true}
          },
          lineWidth: 1,
          pointSize: 6,
          curveType: 'points',
          interpolateNulls: true
        });
//print(chart);
inspectorPanel.widgets().set(3, chart2);
var chart3 = ui.Chart.image.series({
  imageCollection: collection.select('waterArea'), 
  region: geometry2,
  reducer: ee.Reducer.sum(),
  scale: 30,
})
        .setOptions({
          title: 'Time Series water extent of Askja Lake 1984-2003',
          hAxis: {title: 'Date', titleTextStyle: {italic: false, bold: true}},
          vAxis: {
            title: 'Area (m2)',
            titleTextStyle: {italic: false, bold: true}
          },
          lineWidth: 2,
          curveType: 'line'
        });
//print(chart);
inspectorPanel.widgets().set(4, chart3);
//ui.root.clear();
ui.root.add(inspectorPanel)
//Map.addLayer(l8r.max().select(['swir2','swir1','nir']).clip(aoi).multiply(2.75e-05).add(-0.2), {min: 0, max: 91}, 'Radiance');
//Map.addLayer(l8c.select(['thermal1']).max().clip(aoi), {min: 0, max: 100}, 'Temperature Max (C)');
//Map.addLayer(collection.max().select('NDWI').clip(aoi), {min: 0, max: 100}, 'Flux (W)');
var water= l8m.select(['NDWI']).max().gt(Threshold_w)
  .selfMask()
  .rename('hotspots');
/*var radiance = l8r.select(['NHISWNIR']).max().gt(0)
  .selfMask()
  .rename('radiance');*/
// Display the water hotspots on the Map.
//Map.addLayer(water.clip(geometry2), {palette: 'FF0000'}, 'Maximum Water Extend');
//Map.addLayer(radiance, {palette: 'FF0000'}, 'radiance');
Export.image.toDrive({
  image: l8c.select(['thermal1']).max().clip(aoi), 
  description: 'Thermal', 
  folder: 'Iceland_GEE', 
  region: geometry,                 // smaller area
  scale: 30,
  maxPixels: 1e8
})
// Create a label on the map.
var label = ui.Label('Click a point on the chart to show the image for that date.');
Map.add(label);
//Create callbakc function that adds image to the map coresponding with clicked data point on chart
charts.onClick(function(xValue, yValue, seriesName) {
    if (!xValue) return;  // Selection was cleared.
    // Show the image for the clicked date.
    var equalDate = ee.Filter.equals('system:time_start', xValue);
    //Find image coresponding with clicked data and clip water classification to roi 
    //var classification = ee.Image(l8c.filter(equalDate).first()).clip(aoi).select('Water'); 
    var l8image = ee.Image(l8c.filter(equalDate).first());
    //Make map layer based on thermal image, reset the map layers, and add this new layer
    var l8Layer = ui.Map.Layer(l8image, {
      bands: ['thermal1'],
      max: 94,
      min: 0
    });
    //Add water classification on top of SAR image
   // Map.addLayer(classification,visParams,'Water')
   //var stringt = 'thermal'
   Map.addLayer(l8image.select('thermal1').clip(aoi), imageVisParam,((new Date(xValue)).toUTCString())+ ' Thermal');
   Map.addLayer(l8image.select('swir2','swir1','nir').clip(aoi).multiply(2.75e-05).add(-0.2), {min: -0.2027, max: -0.2014}, ((new Date(xValue)).toUTCString())+ ' Reflectance');
    // Show a label with the date on the map.
    label.setValue((new Date(xValue)).toUTCString()); });
    chart.onClick(function(xValue, yValue, seriesName) {
    if (!xValue) return;  // Selection was cleared.
    // Show the image for the clicked date.
    var equalDate = ee.Filter.equals('system:time_start', xValue);
    //Find image coresponding with clicked data and clip water classification to roi 
    //var classification = ee.Image(l8c.filter(equalDate).first()).clip(aoi).select('Water'); 
    var l8image = ee.Image(l8c.filter(equalDate).first());
    //Make map layer based on thermal image, reset the map layers, and add this new layer
    var l8Layer = ui.Map.Layer(l8image, {
      bands: ['thermal1'],
      max: 94,
      min: 0
    });
    //Add water classification on top of SAR image
   // Map.addLayer(classification,visParams,'Water')
   //var stringt = 'thermal'
   Map.addLayer(l8image.select('thermal1').clip(aoi),imageVisParam2,((new Date(xValue)).toUTCString())+ ' Thermal');
   Map.addLayer(l8image.select('swir2','swir1','nir').clip(aoi).multiply(2.75e-05).add(-0.2), {min: -0.2027, max: -0.2014}, ((new Date(xValue)).toUTCString())+ ' Reflectance');
      // Show a label with the date on the map.
    label.setValue((new Date(xValue)).toUTCString()); });
    chart3.onClick(function(xValue, yValue, seriesName) {
    if (!xValue) return;  // Selection was cleared.
    // Show the image for the clicked date.
    var equalDate = ee.Filter.equals('system:time_start', xValue);
    //Find image coresponding with clicked data and clip water classification to roi 
    var classification = ee.Image(collection.select('waterArea').filter(equalDate).first()).clip(geometry2); 
    var l8image = ee.Image(l8c.filter(equalDate).first());
    //Make map layer based on thermal image, reset the map layers, and add this new layer
    var l8Layer = ui.Map.Layer(l8image, {
      bands: ['thermal1'],
      max: 94,
      min: 0
    });
    //Add water classification on top of SAR image
   // Map.addLayer(classification,visParams,'Water')
   //var stringt = 'thermal'
   //Map.addLayer(l8image.select('thermal1').clip(aoi),imageVisParam2,((new Date(xValue)).toUTCString())+ ' Thermal');
   //Map.addLayer(l8image.select('swir2','swir1','nir').clip(aoi).multiply(2.75e-05).add(-0.2), {min: -0.2027, max: -0.2014}, ((new Date(xValue)).toUTCString())+ ' Reflectance');
  Map.addLayer(classification.clip(geometry2), {palette: 'FF0000'}, ((new Date(xValue)).toUTCString())+ ' water extent');  
     // Show a label with the date on the map.
    label.setValue((new Date(xValue)).toUTCString()); });
    chart2.onClick(function(xValue, yValue, seriesName) {
    if (!xValue) return;  // Selection was cleared.
    // Show the image for the clicked date.
    var equalDate = ee.Filter.equals('system:time_start', xValue);
    //Find image coresponding with clicked data and clip water classification to roi 
    var classification = ee.Image(collection.select('waterArea').filter(equalDate).first()).clip(geometry2); 
    var l8image = ee.Image(l8c.filter(equalDate).first());
    //Make map layer based on thermal image, reset the map layers, and add this new layer
    var l8Layer = ui.Map.Layer(l8image, {
      bands: ['thermal1'],
      max: 94,
      min: 0
    });
    //Add water classification on top of SAR image
   // Map.addLayer(classification,visParams,'Water')
   //var stringt = 'thermal'
   //Map.addLayer(l8image.select('thermal1').clip(aoi),imageVisParam2,((new Date(xValue)).toUTCString())+ ' Thermal');
  // Map.addLayer(l8image.select('swir2','swir1','nir').clip(aoi).multiply(2.75e-05).add(-0.2), {min: -0.2027, max: -0.2014}, ((new Date(xValue)).toUTCString())+ ' Reflectance');
  Map.addLayer(classification, {palette: 'FF0000'}, ((new Date(xValue)).toUTCString())+ ' water extent');  
    // Show a label with the date on the map.
    label.setValue((new Date(xValue)).toUTCString()); });