var roi2 = ui.import && ui.import("roi2", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                28.65200203034091,
                43.72084679068942
              ],
              [
                28.765298539129972,
                43.71638037867347
              ],
              [
                29.045449906317472,
                43.68808537114294
              ],
              [
                29.128653644419565,
                43.676664306036656
              ],
              [
                29.213797687388315,
                43.67964392394034
              ],
              [
                29.331214069224252,
                43.680140512539005
              ],
              [
                29.347693561411752,
                43.680637097027564
              ],
              [
                29.52553474793519,
                43.67865073441276
              ],
              [
                29.660600969165653,
                43.675174441598855
              ],
              [
                29.96203834709534,
                43.66424763879462
              ],
              [
                30.427265374399347,
                43.63810509687081
              ],
              [
                30.93239879303076,
                43.43976774000082
              ],
              [
                31.331339833069823,
                43.44026630960444
              ],
              [
                31.410244168639725,
                44.04778057293749
              ],
              [
                31.17308053181472,
                44.737596429303714
              ],
              [
                30.973720012211565,
                44.77814833795762
              ],
              [
                30.899562297367815,
                44.80348799394146
              ],
              [
                30.79656547119594,
                44.83855530494077
              ],
              [
                30.40888931709857,
                44.96967068476774
              ],
              [
                30.156308637662942,
                45.05579631294909
              ],
              [
                30.054685102506692,
                45.08537723504183
              ],
              [
                30.040555184751767,
                45.08976568573202
              ],
              [
                30.004162972837705,
                45.16437154057506
              ],
              [
                30.00004309979083,
                45.17114905247404
              ],
              [
                29.991116708189267,
                45.1914767496605
              ],
              [
                29.948544686704892,
                45.189541091192154
              ],
              [
                29.905972665220517,
                45.18808930414008
              ],
              [
                29.850354379087705,
                45.18663748005865
              ],
              [
                29.805722421079892,
                45.183249746532375
              ],
              [
                29.804349130064267,
                45.16921270279063
              ],
              [
                29.829068368345517,
                45.15759322225575
              ],
              [
                29.837308114439267,
                45.14403416635198
              ],
              [
                29.837308114439267,
                45.12465849089679
              ],
              [
                29.830441659361142,
                45.10963781450302
              ],
              [
                29.80503577557208,
                45.107214754463854
              ],
              [
                29.765210336118955,
                45.118359978957805
              ],
              [
                29.734997933775205,
                45.130471884754684
              ],
              [
                29.710965341001767,
                45.13483154133591
              ],
              [
                29.68143958416583,
                45.105276232372816
              ],
              [
                29.664273446470517,
                45.05291125179966
              ],
              [
                29.650767237279627,
                44.93415484219848
              ],
              [
                29.648020655248377,
                44.891849497271956
              ],
              [
                29.646647364232752,
                44.86606201111403
              ],
              [
                29.632914454076502,
                44.84269733333338
              ],
              [
                29.611628443334315,
                44.814452366702824
              ],
              [
                29.563502502868623,
                44.76781499168048
              ],
              [
                29.522990417907685,
                44.75757668384602
              ],
              [
                29.485224914977998,
                44.75221303657575
              ],
              [
                29.44745941204831,
                44.76488994601491
              ],
              [
                29.440592956970185,
                44.7907227249969
              ],
              [
                29.410380554626435,
                44.794133737455006
              ],
              [
                29.32660980267331,
                44.783412733719636
              ],
              [
                29.23597259564206,
                44.76586497769406
              ],
              [
                29.140270287061266,
                44.74743790076055
              ],
              [
                29.062679344678454,
                44.70792335953051
              ],
              [
                29.018734032178454,
                44.6752180936615
              ],
              [
                28.969386240108747,
                44.623221935964665
              ],
              [
                28.935740610225935,
                44.577753739057165
              ],
              [
                28.91788782702281,
                44.545464400156405
              ],
              [
                28.85907771333106,
                44.483030143609014
              ],
              [
                28.72533456255923,
                44.3600466743172
              ],
              [
                28.715119328179046,
                44.338132113544695
              ],
              [
                28.722672428764984,
                44.32487070019434
              ],
              [
                28.704133000054046,
                44.30472726449051
              ],
              [
                28.653954660769898,
                44.303024572263176
              ],
              [
                28.640221750613648,
                44.26468271294936
              ],
              [
                28.64914814221521,
                44.25779819190268
              ],
              [
                28.653954660769898,
                44.240091436026134
              ],
              [
                28.673180734988648,
                44.23123605915972
              ],
              [
                28.688286936160523,
                44.16131681613432
              ],
              [
                28.702019846316773,
                44.1430882992775
              ],
              [
                28.716439401980836,
                44.13323270272423
              ],
              [
                28.724679148074586,
                44.12238964650711
              ],
              [
                28.726739084598023,
                44.11154459982712
              ],
              [
                28.725365793582398,
                44.10168373924008
              ],
              [
                28.718499338504273,
                44.09280755825868
              ],
              [
                28.71506611096521,
                44.08393004486152
              ],
              [
                28.711632883426148,
                44.07406457839308
              ],
              [
                28.694466745730836,
                44.073077941275145
              ],
              [
                28.68210712659021,
                44.073571261890265
              ],
              [
                28.664254343387086,
                44.0691312283115
              ],
              [
                28.664254343387086,
                44.056302593555664
              ],
              [
                28.672494089480836,
                44.045445423659714
              ],
              [
                28.675927317019898,
                44.03409261799201
              ],
              [
                28.68236715789534,
                44.0062893613983
              ],
              [
                28.687173676450026,
                43.99492905492226
              ],
              [
                28.68786032195784,
                43.98504875942287
              ],
              [
                28.683740448910964,
                43.97319023375533
              ],
              [
                28.67687399383284,
                43.9647890117714
              ],
              [
                28.6693208932469,
                43.95490369984774
              ],
              [
                28.65558798309065,
                43.94847736513223
              ],
              [
                28.653528046567214,
                43.935622611082266
              ],
              [
                28.65490133758284,
                43.92523789603341
              ],
              [
                28.65427653914685,
                43.91495532436568
              ],
              [
                28.6460367930531,
                43.90654586912304
              ],
              [
                28.6350504649281,
                43.896650871127676
              ],
              [
                28.62681071883435,
                43.88329001515094
              ],
              [
                28.62681071883435,
                43.86992616201357
              ],
              [
                28.634192600935695,
                43.85895342771038
              ],
              [
                28.628699436873195,
                43.84756494487319
              ],
              [
                28.61633981773257,
                43.83567899193242
              ],
              [
                28.61084665367007,
                43.821809053986456
              ],
              [
                28.617026463240382,
                43.81140448542534
              ],
              [
                28.621146336287257,
                43.799511330033766
              ],
              [
                28.612906590193507,
                43.78811150087122
              ],
              [
                28.599173680037257,
                43.77175142589887
              ],
              [
                28.596427098006007,
                43.752907006393244
              ],
              [
                28.593680515974757,
                43.73455278926188
              ]
            ]
          ],
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[28.65200203034091, 43.72084679068942],
          [28.765298539129972, 43.71638037867347],
          [29.045449906317472, 43.68808537114294],
          [29.128653644419565, 43.676664306036656],
          [29.213797687388315, 43.67964392394034],
          [29.331214069224252, 43.680140512539005],
          [29.347693561411752, 43.680637097027564],
          [29.52553474793519, 43.67865073441276],
          [29.660600969165653, 43.675174441598855],
          [29.96203834709534, 43.66424763879462],
          [30.427265374399347, 43.63810509687081],
          [30.93239879303076, 43.43976774000082],
          [31.331339833069823, 43.44026630960444],
          [31.410244168639725, 44.04778057293749],
          [31.17308053181472, 44.737596429303714],
          [30.973720012211565, 44.77814833795762],
          [30.899562297367815, 44.80348799394146],
          [30.79656547119594, 44.83855530494077],
          [30.40888931709857, 44.96967068476774],
          [30.156308637662942, 45.05579631294909],
          [30.054685102506692, 45.08537723504183],
          [30.040555184751767, 45.08976568573202],
          [30.004162972837705, 45.16437154057506],
          [30.00004309979083, 45.17114905247404],
          [29.991116708189267, 45.1914767496605],
          [29.948544686704892, 45.189541091192154],
          [29.905972665220517, 45.18808930414008],
          [29.850354379087705, 45.18663748005865],
          [29.805722421079892, 45.183249746532375],
          [29.804349130064267, 45.16921270279063],
          [29.829068368345517, 45.15759322225575],
          [29.837308114439267, 45.14403416635198],
          [29.837308114439267, 45.12465849089679],
          [29.830441659361142, 45.10963781450302],
          [29.80503577557208, 45.107214754463854],
          [29.765210336118955, 45.118359978957805],
          [29.734997933775205, 45.130471884754684],
          [29.710965341001767, 45.13483154133591],
          [29.68143958416583, 45.105276232372816],
          [29.664273446470517, 45.05291125179966],
          [29.650767237279627, 44.93415484219848],
          [29.648020655248377, 44.891849497271956],
          [29.646647364232752, 44.86606201111403],
          [29.632914454076502, 44.84269733333338],
          [29.611628443334315, 44.814452366702824],
          [29.563502502868623, 44.76781499168048],
          [29.522990417907685, 44.75757668384602],
          [29.485224914977998, 44.75221303657575],
          [29.44745941204831, 44.76488994601491],
          [29.440592956970185, 44.7907227249969],
          [29.410380554626435, 44.794133737455006],
          [29.32660980267331, 44.783412733719636],
          [29.23597259564206, 44.76586497769406],
          [29.140270287061266, 44.74743790076055],
          [29.062679344678454, 44.70792335953051],
          [29.018734032178454, 44.6752180936615],
          [28.969386240108747, 44.623221935964665],
          [28.935740610225935, 44.577753739057165],
          [28.91788782702281, 44.545464400156405],
          [28.85907771333106, 44.483030143609014],
          [28.72533456255923, 44.3600466743172],
          [28.715119328179046, 44.338132113544695],
          [28.722672428764984, 44.32487070019434],
          [28.704133000054046, 44.30472726449051],
          [28.653954660769898, 44.303024572263176],
          [28.640221750613648, 44.26468271294936],
          [28.64914814221521, 44.25779819190268],
          [28.653954660769898, 44.240091436026134],
          [28.673180734988648, 44.23123605915972],
          [28.688286936160523, 44.16131681613432],
          [28.702019846316773, 44.1430882992775],
          [28.716439401980836, 44.13323270272423],
          [28.724679148074586, 44.12238964650711],
          [28.726739084598023, 44.11154459982712],
          [28.725365793582398, 44.10168373924008],
          [28.718499338504273, 44.09280755825868],
          [28.71506611096521, 44.08393004486152],
          [28.711632883426148, 44.07406457839308],
          [28.694466745730836, 44.073077941275145],
          [28.68210712659021, 44.073571261890265],
          [28.664254343387086, 44.0691312283115],
          [28.664254343387086, 44.056302593555664],
          [28.672494089480836, 44.045445423659714],
          [28.675927317019898, 44.03409261799201],
          [28.68236715789534, 44.0062893613983],
          [28.687173676450026, 43.99492905492226],
          [28.68786032195784, 43.98504875942287],
          [28.683740448910964, 43.97319023375533],
          [28.67687399383284, 43.9647890117714],
          [28.6693208932469, 43.95490369984774],
          [28.65558798309065, 43.94847736513223],
          [28.653528046567214, 43.935622611082266],
          [28.65490133758284, 43.92523789603341],
          [28.65427653914685, 43.91495532436568],
          [28.6460367930531, 43.90654586912304],
          [28.6350504649281, 43.896650871127676],
          [28.62681071883435, 43.88329001515094],
          [28.62681071883435, 43.86992616201357],
          [28.634192600935695, 43.85895342771038],
          [28.628699436873195, 43.84756494487319],
          [28.61633981773257, 43.83567899193242],
          [28.61084665367007, 43.821809053986456],
          [28.617026463240382, 43.81140448542534],
          [28.621146336287257, 43.799511330033766],
          [28.612906590193507, 43.78811150087122],
          [28.599173680037257, 43.77175142589887],
          [28.596427098006007, 43.752907006393244],
          [28.593680515974757, 43.73455278926188]]]);
// #1 Setare extent
var Basemap_Raul_Deatcu= [
    {
        "featureType": "all",
        "elementType": "labels.text",
        "stylers": [
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "all",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "color": "#ffffff"
            }
        ]
    },
    {
        "featureType": "all",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "color": "#000000"
            },
            {
                "lightness": 13
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#144b53"
            },
            {
                "lightness": 14
            },
            {
                "weight": 1.4
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "administrative.province",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "administrative.locality",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "administrative.neighborhood",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "color": "#08304b"
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#0c4152"
            },
            {
                "lightness": 5
            }
        ]
    },
    {
        "featureType": "poi.attraction",
        "elementType": "labels",
        "stylers": [
            {
                "invert_lightness": true
            }
        ]
    },
    {
        "featureType": "poi.attraction",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "poi.park",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "invert_lightness": true
            }
        ]
    },
    {
        "featureType": "poi.park",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "labels.text",
        "stylers": [
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#0b434f"
            },
            {
                "lightness": 25
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "labels",
        "stylers": [
            {
                "lightness": "0"
            },
            {
                "saturation": "0"
            },
            {
                "invert_lightness": true
            },
            {
                "visibility": "simplified"
            },
            {
                "hue": "#00e9ff"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "labels.text",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "road.highway.controlled_access",
        "elementType": "labels.text",
        "stylers": [
            {
                "color": "#a1f7ff"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#0b3d51"
            },
            {
                "lightness": 16
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "labels",
        "stylers": [
            {
                "invert_lightness": true
            }
        ]
    },
    {
        "featureType": "road.local",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#000000"
            }
        ]
    },
    {
        "featureType": "road.local",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "simplified"
            },
            {
                "invert_lightness": true
            }
        ]
    },
    {
        "featureType": "transit",
        "elementType": "all",
        "stylers": [
            {
                "color": "#146474"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "color": "#021019"
            }
        ]
    }
]
Map.setOptions( 'Basemap_Raul_Deatcu', {Basemap_Raul_Deatcu: Basemap_Raul_Deatcu});
Map.setCenter(29.368999613244807,44.3362532078328, 8.5)
Map.drawingTools().setShown(false);
var panel = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  style: {width: '580px', 
  height: '620px',
  position: 'bottom-left',
  backgroundColor: '00000090',
  padding: '30px',
  }
});
Map.add(panel)
var creditUVT0 = ui.Label('Universitatea de Vest din Timișoara', {position:'bottom-right',color:"FFFFFF" , backgroundColor: '16ECDA00'});
var creditUVT1 = ui.Label('Facultatea de Chimie, Biologie, Geografie', {position:'bottom-right',color:"FFFFFF" , backgroundColor: '16ECDA00'});
var creditUVT2 = ui.Label('Departamentul de Geografie', {position:'bottom-right',color:"FFFFFF" , backgroundColor: '16ECDA00'});
var label0 = ui.Label('Student: Raul DEATCU ', {position:'bottom-right' ,color:"FFFFFF" , backgroundColor: '16ECDA00'});
var label1 = ui.Label('Coordonator: Prof. univ. dr. habil. DRĂGUȚ LUCIAN ', {position:'bottom-right',color:"FFFFFF" , backgroundColor: '16ECDA00'});
var label2 = ui.Label('Aplicație Google Earth Engine pentru identificarea navelor în apele zonei economice exclusive a României', {position:'bottom-left', fontSize:'18px',fontWeight:'bold', color:"269985" , backgroundColor: '16ECDA00'});
Map.add(label0);
Map.add(label1);
Map.add(creditUVT2);
Map.add(creditUVT1);
Map.add(creditUVT0);
panel.add(label2);
var msgIntro0 = ui.Label('Acest panou va fi folosit pentru selectarea datelor', {fontWeight:'bold',color:"FFFFFF" , backgroundColor: '16ECDA00'});
var msgIntro2 = ui.Label('Primul pas este selectarea unei date calendaristice. ', {fontWeight:'bold',color:"FFFFFF" , backgroundColor: '16ECDA00'});
panel.add(msgIntro0);
panel.add(msgIntro2);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A L
// #2 Initializare UI Text - Selectarea colectiei de imagini
var data = ui.Textbox({
  placeholder: 'Scrie o data sub acest format: Anul-Luna-Ziua (Exemplu: 2020-07-11)',
  onChange: function(text) {
var collection = ee.ImageCollection("COPERNICUS/S2_SR")
  .filterBounds(roi2)
  .filterDate(text+'T00:00:00Z', text+'T23:59:00Z')
var lista = collection.toList(collection.size())
var numarImagini = (ee.String('S-au identificat ')
  .cat(ee.Algorithms.String(collection.size()))
  .cat(' imagini în colecția din data selectată. Treceți la pasul 2 daca s-au găsit imagini, în caz contrar introduceți altă dată.')).getInfo();
var msgIntro3 = ui.Label('Al treilea pas este selectarea unei imagini din colecție', {fontWeight:'bold',color:"FFFFFF" , backgroundColor: '16ECDA00'});  
var label3 = ui.Label(''+numarImagini,{position:'top-left',color:"CF5E5E" , backgroundColor: '16ECDA00'})
label3.style().set('fontWeight', 'bold');
var label4 = ui.Label('Imaginile sunt ordonate ascendent dupa ore',{position:'top-left',color:"FFFFFF" , backgroundColor: '16ECDA00'})
var label5 = ui.Label('Prima imagine se identifica cu cifra 0, a doua cu cifra 1, a treia cu cifra 2, ... ! ATENȚIE ! Ultima imagine se identifică după valoarea (numărul de imagini identificate-1), exemplu: Avem 8 imagini, atunci ultima imagine are valoarea 8-1, adica 7.',{position:'top-left',color:"FFFFFF" , backgroundColor: '16ECDA00'})
panel.add(label3)
panel.add(msgIntro3)
panel.add(label5)
panel.add(label4)
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A L
// #3 UI Text - Selectarea imaginii din colectie
var imagine = ui.Textbox({
  placeholder: 'Alege o imagine (0, 1, 2, ... etc)',
  onChange: function(key) {
var scena = ee.Image(lista.get(parseInt(key))).clip(roi2)
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A L
var pro4 = scena.log().add(ee.Number(1))
//Produsul 4
var texture = pro4.select("B8").reduceNeighborhood({
  reducer: ee.Reducer.stdDev(),
  kernel: ee.Kernel.square(3)
});
//Threshold B4
var histogramB4 = pro4.clip(roi2).select('B4').reduceRegion({reducer: ee.Reducer.histogram(),geometry: roi2, scale: 10, maxPixels: 1000000000})
var b4Select= ee.Dictionary(histogramB4).get('B4')
var arrayHistoB4= ee.Array(ee.Dictionary(b4Select).get('histogram'))
print(arrayHistoB4, "arrayHistoB4")
var sortArrayHistoB4 = arrayHistoB4.sort();
print(sortArrayHistoB4, "sortArrayHistoB4")
var medianListB4 = sortArrayHistoB4.toList()
var q1B4 = medianListB4.reduce(ee.Reducer.percentile([25]))
var q3B4 = medianListB4.reduce(ee.Reducer.percentile([75]))
var iqrB4 = ee.Number(q3B4).subtract(ee.Number(q1B4))
var Q3iqrB4 = ee.Number(q3B4).add(ee.Number(iqrB4).multiply(ee.Number(1.5)))
print(Q3iqrB4)
var LastSortArrayHistoB4 = sortArrayHistoB4.get([-1])
var listHistoB4= arrayHistoB4.toList()
var PositionListHistoB4 = listHistoB4.indexOf(LastSortArrayHistoB4)
var arrayBucketMeansB4= ee.Array(ee.Dictionary(b4Select).get('bucketMeans'))
print(arrayBucketMeansB4, "arrayBucketMeansB4")
var ValueBucketMeansB4 = arrayBucketMeansB4.get([PositionListHistoB4])
var listBucketB4 = arrayBucketMeansB4.gt(ValueBucketMeansB4).and(arrayHistoB4.lte(Q3iqrB4)).and(arrayHistoB4.gt(0))
var listBoolen1B4 = listBucketB4.toList()
var listBoolen2B4 = listBoolen1B4.indexOf(1)
var tresB4 = arrayBucketMeansB4.get([listBoolen2B4])
//Final Threshold B4
//Threshold B8
var histogramB8 = pro4.clip(roi2).select('B8').reduceRegion({reducer: ee.Reducer.histogram(), geometry: roi2, scale: 10, maxPixels: 1000000000})
var b8Select= ee.Dictionary(histogramB8).get('B8')
var arrayHistoB8= ee.Array(ee.Dictionary(b8Select).get('histogram'))
var sortArrayHistoB8 = arrayHistoB8.sort();
var medianListB8 = sortArrayHistoB8.toList()
var q1B8 = medianListB8.reduce(ee.Reducer.percentile([25]))
var q3B8 = medianListB8.reduce(ee.Reducer.percentile([75]))
var iqrB8 = ee.Number(q3B8).subtract(ee.Number(q1B8))
var Q3iqrB8 = ee.Number(q3B8).add(ee.Number(iqrB8).multiply(ee.Number(1.5)))
var LastSortArrayHistoB8 = sortArrayHistoB8.get([-1])
var listHistoB8= arrayHistoB8.toList()
var PositionListHistoB8 = listHistoB8.indexOf(LastSortArrayHistoB8)
var arrayBucketMeansB8= ee.Array(ee.Dictionary(b8Select).get('bucketMeans'))
var ValueBucketMeansB8 = arrayBucketMeansB8.get([PositionListHistoB8])
var listBucketB8 = arrayBucketMeansB8.gt(ValueBucketMeansB8).and(arrayHistoB8.lte(Q3iqrB8)).and(arrayHistoB8.gt(0))
var listBoolen1B8 = listBucketB8.toList()
var listBoolen2B8 = listBoolen1B8.indexOf(1)
var tresB8 = arrayBucketMeansB8.get([listBoolen2B8])
//Final Threshold B8
//Threshold STD
var histogramSTD = texture.clip(roi2).select('B8_stdDev').reduceRegion({reducer: ee.Reducer.histogram(), geometry: roi2, scale: 10, maxPixels: 1000000000})
var STDSelect= ee.Dictionary(histogramSTD).get('B8_stdDev')
var arrayHistoSTD= ee.Array(ee.Dictionary(STDSelect).get('histogram'))
var sortArrayHistoSTD = arrayHistoSTD.sort();
var medianListSTD = sortArrayHistoSTD.toList()
var q1STD = medianListSTD.reduce(ee.Reducer.percentile([25]))
var q3STD = medianListSTD.reduce(ee.Reducer.percentile([75]))
var iqrSTD = ee.Number(q3STD).subtract(ee.Number(q1STD))
var Q3iqrSTD = ee.Number(q3STD).add(ee.Number(iqrSTD).multiply(ee.Number(1.5)))
var LastSortArrayHistoSTD = sortArrayHistoSTD.get([-1])
var listHistoSTD= arrayHistoSTD.toList()
var PositionListHistoSTD = listHistoSTD.indexOf(LastSortArrayHistoSTD)
var arrayBucketMeansSTD= ee.Array(ee.Dictionary(STDSelect).get('bucketMeans'))
var ValueBucketMeansSTD = arrayBucketMeansSTD.get([PositionListHistoSTD])
var listBucketSTD = arrayBucketMeansSTD.gt(ValueBucketMeansSTD).and(arrayHistoSTD.lte(Q3iqrSTD)).and(arrayHistoSTD.gt(0))
var listBoolen1STD = listBucketSTD.toList()
var listBoolen2STD = listBoolen1STD.indexOf(1)
var tresSTD = arrayBucketMeansSTD.get([listBoolen2STD])
//Final Threshold STD
//Filtrare spectrala scena
var vase3 = pro4.select(["B4"]).gt(tresB4)
      .and(pro4.select(["B8"]).gt(tresB8))
      .and(texture.select(['B8_stdDev']).gt(tresSTD))
  .selfMask()
  .rename('Vase3');
//Filtrare dimensiune obiecte
var objectId3 = vase3.clip(roi2).connectedComponents({
  connectedness: ee.Kernel.square(3),
  maxSize: 100
});
var objectSize3 = objectId3.select('labels')
  .connectedPixelCount({
  maxSize: 100, eightConnected: false
  });
var pixelArea3 = ee.Image.pixelArea();
var objectArea3 = objectSize3.multiply(pixelArea3);
var VaseSIZE3 = objectArea3.gte(1200).selfMask();
//Vectorizarea si afisarea rezultatelor
var vectorizare3 = VaseSIZE3.reduceToVectors({
  crs: vase3.projection(),
  scale: 10,
  geometryType: 'polygon',
  eightConnected: false,
  labelProperty: 'objectId',
  maxPixels: 1e12
});
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A L
// #5 Afisarea rezultatelor
var vizParams = {
  bands: ['B4'],
  min: 265,
  max: 629,
  palette: ['08304b', '000000']
};
Map.addLayer(scena,vizParams,"Scenă satelitară")
Map.addLayer(vectorizare3, {color:'16ECDA'}, "Vase detectate")
var msgIntro4 = ui.Label('Puteți vizualiza datele folosind LAYERS din colțul drept-sus. Descărcarea se face utilizând link-ul de jos în cazul prezenței unor vase detectate',{color:"FFFFFF" , backgroundColor: '16ECDA00'}); 
panel.add(msgIntro4)
var download = ui.Label(vectorizare3.getDownloadURL('kml',"",'Vase_RaulDEATCU'))
panel.add(download)}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A L
// #6 Finalizare UI Text
})
imagine.style().set({width: '250px'})
panel.add(imagine)
}
})
data.style().set({width: '415px'})
panel.add(data);
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////F I N A