var naip = ee.ImageCollection("USDA/NAIP/DOQQ"),
    buildings = ee.FeatureCollection("users/GinaMazza/Buildings"),
    HUCs = ee.FeatureCollection("users/GinaMazza/WBDHU8"),
    shadows = /* color: #d452ff */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.14622934691323,
                47.69938328057728
              ],
              [
                -107.14180906645669,
                47.696350487310696
              ],
              [
                -107.13683088652505,
                47.69285533533652
              ],
              [
                -107.13485678069009,
                47.68852217708705
              ],
              [
                -107.12871988646401,
                47.68462202683624
              ],
              [
                -107.14970548979653,
                47.68488204592586
              ],
              [
                -107.16921002088202,
                47.690797699395326
              ],
              [
                -107.17275110019841,
                47.68966337174702
              ],
              [
                -107.1593185269059,
                47.68335080374047
              ],
              [
                -107.14931925169839,
                47.68008592975612
              ],
              [
                -107.14112242094888,
                47.67780328587846
              ],
              [
                -107.13905194666978,
                47.67833080417167
              ],
              [
                -107.1402053695528,
                47.67954806883476
              ],
              [
                -107.13775390334314,
                47.68070753315456
              ],
              [
                -107.13620356166189,
                47.6800900308776
              ],
              [
                -107.13293659653334,
                47.68091714779017
              ],
              [
                -107.12133844725503,
                47.68135723241235
              ],
              [
                -107.11640318266763,
                47.68080826461124
              ],
              [
                -107.11185415617837,
                47.68109719575296
              ],
              [
                -107.10837801329507,
                47.6818195166065
              ],
              [
                -107.10859259001626,
                47.683148560846206
              ],
              [
                -107.11091001860513,
                47.682715180575414
              ],
              [
                -107.11275537840737,
                47.68424644141863
              ],
              [
                -107.1146865688981,
                47.68456424464031
              ],
              [
                -107.11460073820962,
                47.68609545120617
              ],
              [
                -107.11550196043862,
                47.68696215198195
              ],
              [
                -107.1164890133561,
                47.687077710997286
              ],
              [
                -107.1176048123063,
                47.6862110121417
              ],
              [
                -107.11932142607583,
                47.68713549040894
              ],
              [
                -107.12193926207436,
                47.6876555022336
              ],
              [
                -107.12498625151528,
                47.689099952321996
              ],
              [
                -107.12593038908852,
                47.690486586771655
              ],
              [
                -107.12558706633462,
                47.691382101926834
              ],
              [
                -107.12326963774575,
                47.690544362407
              ],
              [
                -107.12103803984536,
                47.68990882689799
              ],
              [
                -107.11837728850259,
                47.69008215553215
              ],
              [
                -107.11992224089516,
                47.691902071412024
              ],
              [
                -107.11786230437173,
                47.692739789122214
              ],
              [
                -107.11640318266763,
                47.692739789122214
              ],
              [
                -107.11481531493081,
                47.69143987657008
              ],
              [
                -107.1130128704728,
                47.69031325948161
              ],
              [
                -107.1109958492936,
                47.689504391178104
              ],
              [
                -107.10915048949136,
                47.69039992319865
              ],
              [
                -107.1071763836564,
                47.69031325948161
              ],
              [
                -107.10545976988686,
                47.68930217214208
              ],
              [
                -107.10417230955971,
                47.68881106550458
              ],
              [
                -107.10241278044595,
                47.690197707634866
              ],
              [
                -107.1005674206437,
                47.69126655244831
              ],
              [
                -107.09885080687417,
                47.69057325020066
              ],
              [
                -107.0968767010392,
                47.688002173903136
              ],
              [
                -107.09516008726968,
                47.68647102331052
              ],
              [
                -107.09387262694253,
                47.68667325332351
              ],
              [
                -107.09387262694253,
                47.68531540819484
              ],
              [
                -107.09151228300942,
                47.68551764268825
              ],
              [
                -107.08928068510903,
                47.684217550120664
              ],
              [
                -107.0875640713395,
                47.68444868005644
              ],
              [
                -107.08674867979897,
                47.68644213324465
              ],
              [
                -107.08893736235513,
                47.688926620423565
              ],
              [
                -107.09176977507485,
                47.691613200115846
              ],
              [
                -107.09331472746743,
                47.69455961225927
              ],
              [
                -107.09352930418862,
                47.6986900862406
              ],
              [
                -107.09790666930093,
                47.70126063562347
              ],
              [
                -107.10134372592336,
                47.70442352017818
              ],
              [
                -107.12589130282765,
                47.70442352017818
              ],
              [
                -107.14357242465383,
                47.7045390405022
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.68118104763636,
                47.975360267862186
              ],
              [
                -106.66435823269495,
                47.96363722676859
              ],
              [
                -106.65131196804651,
                47.95811958075141
              ],
              [
                -106.64564714260706,
                47.95834949443476
              ],
              [
                -106.64169893093714,
                47.96283260676227
              ],
              [
                -106.6370640737594,
                47.96225787051294
              ],
              [
                -106.631227586943,
                47.961568178573046
              ],
              [
                -106.62367448635706,
                47.95444082267067
              ],
              [
                -106.62384614773401,
                47.96133827921348
              ],
              [
                -106.61886796780237,
                47.96007381444759
              ],
              [
                -106.61320314236292,
                47.95788966604494
              ],
              [
                -106.61131486721644,
                47.95559046270734
              ],
              [
                -106.60908326931605,
                47.95800462352606
              ],
              [
                -106.60547838040003,
                47.9562802344516
              ],
              [
                -106.60496339626917,
                47.95915418426936
              ],
              [
                -106.60616502590784,
                47.96248776578002
              ],
              [
                -106.60462007351526,
                47.963982060077456
              ],
              [
                -106.6008435232223,
                47.964326891084326
              ],
              [
                -106.59758195706019,
                47.963982060077456
              ],
              [
                -106.59363374539026,
                47.96214292249575
              ],
              [
                -106.58745393581995,
                47.95915418426936
              ],
              [
                -106.58350572415003,
                47.96363722676859
              ],
              [
                -106.5847073537887,
                47.968234814945085
              ],
              [
                -106.5856943232115,
                47.97039689714011
              ],
              [
                -106.58498620326117,
                47.9716215959696
              ],
              [
                -106.58608053606855,
                47.97261644011608
              ],
              [
                -106.58848390408167,
                47.974182337432794
              ],
              [
                -106.59101590939173,
                47.97645198426593
              ],
              [
                -106.59273250252966,
                47.97843423658486
              ],
              [
                -106.59449205227503,
                47.97915244672285
              ],
              [
                -106.60135850735315,
                47.982140027835584
              ],
              [
                -106.59260377712855,
                47.98168041122563
              ],
              [
                -106.5876255971969,
                47.980990978637855
              ],
              [
                -106.59346208401331,
                47.986621075327484
              ],
              [
                -106.60204515286097,
                47.99110173381241
              ],
              [
                -106.61285981960901,
                47.99133150068466
              ],
              [
                -106.62264451809534,
                47.985587021972215
              ],
              [
                -106.61886796780237,
                47.98271454284337
              ],
              [
                -106.609254930693,
                47.97777350481822
              ],
              [
                -106.60341844387659,
                47.97386630274571
              ],
              [
                -106.6037617666305,
                47.96915428347147
              ],
              [
                -106.61938295193323,
                47.96697051899288
              ],
              [
                -106.62693605251917,
                47.96961401159607
              ],
              [
                -106.63242921658167,
                47.968119880228315
              ],
              [
                -106.63878068752894,
                47.97248721965741
              ],
              [
                -106.64530381985315,
                47.975819940740344
              ],
              [
                -106.64993867703089,
                47.97673927421987
              ],
              [
                -106.66178331204065,
                47.97467075087187
              ],
              [
                -106.66950807400355,
                47.97168273751387
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.55439486803533,
                47.99517288239554
              ],
              [
                -106.55362239183904,
                47.9953739126037
              ],
              [
                -106.55237784685613,
                47.99428259634472
              ],
              [
                -106.5497600108576,
                47.9938518072571
              ],
              [
                -106.54503932299139,
                47.99382308785671
              ],
              [
                -106.55074706377508,
                48.00211505243089
              ],
              [
                -106.55194869341375,
                48.0029190603692
              ],
              [
                -106.55478110613348,
                48.00346463004765
              ],
              [
                -106.55808558763982,
                48.004613178930896
              ],
              [
                -106.56375041307928,
                48.005187443782205
              ],
              [
                -106.56774154009344,
                48.004728032412636
              ],
              [
                -106.57087436022283,
                48.00455575209409
              ],
              [
                -106.57645335497381,
                48.003120060395744
              ],
              [
                -106.57662501635076,
                48.00116745555866
              ],
              [
                -106.57495131792547,
                47.999272209594416
              ],
              [
                -106.57164683641912,
                47.9978076536608
              ],
              [
                -106.57035937609197,
                47.99743432883223
              ],
              [
                -106.56817069353582,
                47.997290741640406
              ],
              [
                -106.56465163530828,
                47.99720458913351
              ],
              [
                -106.56319251360418,
                47.997290741640406
              ],
              [
                -106.5616475612116,
                47.99645792804766
              ],
              [
                -106.56001677813055,
                47.99556766416935
              ],
              [
                -106.55915847124578,
                47.995711256156454
              ],
              [
                -106.55902972521307,
                47.99651536389942
              ],
              [
                -106.55799975695135,
                47.9975204809555
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.58400645555975,
                47.98086172909767
              ],
              [
                -106.58314814867498,
                47.979224285700326
              ],
              [
                -106.58211818041326,
                47.97873591533415
              ],
              [
                -106.58065905870916,
                47.9780751716031
              ],
              [
                -106.57834163012029,
                47.97882209867563
              ],
              [
                -106.5770112544489,
                47.978879554156684
              ],
              [
                -106.57546630205633,
                47.97882209867563
              ],
              [
                -106.57276263536932,
                47.97778788908246
              ],
              [
                -106.57130351366521,
                47.977816617406454
              ],
              [
                -106.56851401628973,
                47.97862100398835
              ],
              [
                -106.56937232317449,
                47.97977010593677
              ],
              [
                -106.5717326671076,
                47.98083300246808
              ],
              [
                -106.57495131792547,
                47.98293000441708
              ],
              [
                -106.57705416979314,
                47.983964111001804
              ],
              [
                -106.58293357195379,
                47.985773747675935
              ],
              [
                -106.58623805346014,
                47.98565885199554
              ],
              [
                -106.58838382067205,
                47.986692903911774
              ],
              [
                -106.59031501116277,
                47.98606098575797
              ],
              [
                -106.58962836565496,
                47.98471095287354
              ],
              [
                -106.58778300585271,
                47.98295872987973
              ],
              [
                -106.58696761431219,
                47.98180969890549
              ],
              [
                -106.58533683123113,
                47.98086172909767
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.7759044339034,
                47.92556419100896
              ],
              [
                -106.76277233856649,
                47.91147115587925
              ],
              [
                -106.75255848663778,
                47.907098658724934
              ],
              [
                -106.75041271942587,
                47.91302445409415
              ],
              [
                -106.7469794918868,
                47.91774159248258
              ],
              [
                -106.7429454495284,
                47.921595520469445
              ],
              [
                -106.7374522854659,
                47.922458300835935
              ],
              [
                -106.73513485687704,
                47.92539164644737
              ],
              [
                -106.73230244415731,
                47.92556419100896
              ],
              [
                -106.73238827484579,
                47.93045271440302
              ],
              [
                -106.7327315975997,
                47.93608832085604
              ],
              [
                -106.7367656399581,
                47.93850339274767
              ],
              [
                -106.7440612484786,
                47.93833089135366
              ],
              [
                -106.74929692047567,
                47.93936589108438
              ],
              [
                -106.75556256073446,
                47.93896339365119
              ],
              [
                -106.7524726559493,
                47.93534077574142
              ],
              [
                -106.7601974179122,
                47.93689335735428
              ],
              [
                -106.7565066983077,
                47.93304056913877
              ],
              [
                -106.76011158722372,
                47.932177965282726
              ],
              [
                -106.76517559784384,
                47.93292555612264
              ],
              [
                -106.77023960846395,
                47.93534077574142
              ],
              [
                -106.7741019894454,
                47.93614582387874
              ],
              [
                -106.77573277252645,
                47.93482323817704
              ],
              [
                -106.77650524872274,
                47.93223547265412
              ],
              [
                -106.77607609528036,
                47.92976259793517
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.78933693664999,
                47.921422962669396
              ],
              [
                -106.79577423828573,
                47.921020325564186
              ],
              [
                -106.79826332825155,
                47.91952478887972
              ],
              [
                -106.79671837585897,
                47.916936257834756
              ],
              [
                -106.79483010071249,
                47.914635232626175
              ],
              [
                -106.79646088379354,
                47.91279433878208
              ],
              [
                -106.79946495789022,
                47.90997534316175
              ],
              [
                -106.79216934936971,
                47.90496980930191
              ],
              [
                -106.79903580444784,
                47.90686851706258
              ],
              [
                -106.8006665875289,
                47.89961853088039
              ],
              [
                -106.79980828064413,
                47.894669544561175
              ],
              [
                -106.79122521179647,
                47.89559032201957
              ],
              [
                -106.78315712707968,
                47.898237466005334
              ],
              [
                -106.770969169316,
                47.90111464292144
              ],
              [
                -106.76642014282675,
                47.905832866918345
              ],
              [
                -106.76573349731893,
                47.90940001906584
              ],
              [
                -106.77165581482382,
                47.914865339751834
              ],
              [
                -106.77886559265585,
                47.91883452659751
              ],
              [
                -106.78495957153768,
                47.9206752055512
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.94995514640016,
                47.99152027351371
              ],
              [
                -106.94205872306031,
                47.9829033471914
              ],
              [
                -106.9303857494275,
                47.97118201863121
              ],
              [
                -106.90429322013063,
                47.956469135464076
              ],
              [
                -106.88472382315797,
                47.95474469514239
              ],
              [
                -106.87202088126344,
                47.94876618977729
              ],
              [
                -106.85485474356813,
                47.94405188057171
              ],
              [
                -106.85227982291383,
                47.94727145536426
              ],
              [
                -106.87184921988649,
                47.959917843452686
              ],
              [
                -106.88712708243531,
                47.96819380339849
              ],
              [
                -106.89897171744508,
                47.97957108332858
              ],
              [
                -106.89004532584352,
                47.98267354279608
              ],
              [
                -106.88626877555055,
                47.976353521016584
              ],
              [
                -106.85914627799195,
                47.96382610088219
              ],
              [
                -106.84163681754274,
                47.95669905649194
              ],
              [
                -106.82841889151734,
                47.95922812027137
              ],
              [
                -106.81657425650758,
                47.96819380339849
              ],
              [
                -106.81605927237672,
                47.975778935217285
              ],
              [
                -106.81090943106813,
                47.9803754425754
              ],
              [
                -106.79614655265016,
                47.97980090153506
              ],
              [
                -106.80301300772828,
                47.99772356967614
              ],
              [
                -106.81090943106813,
                48.00473009979091
              ],
              [
                -106.83047882804078,
                48.023907043031244
              ],
              [
                -106.89347855338258,
                48.03550161359349
              ],
              [
                -106.91218964347047,
                48.02895846374739
              ],
              [
                -106.95922486075563,
                47.99829791122749
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.82054032574513,
                47.777252650162474
              ],
              [
                -106.80483330975392,
                47.77200355255521
              ],
              [
                -106.7994259763799,
                47.77200355255521
              ],
              [
                -106.7928170133672,
                47.78054027657012
              ],
              [
                -106.79642190228321,
                47.78463509941435
              ],
              [
                -106.80079926739552,
                47.78861426608897
              ],
              [
                -106.80946816693165,
                47.789017932644825
              ],
              [
                -106.81933869610646,
                47.78884493307621
              ],
              [
                -106.83281411419728,
                47.787864591310154
              ],
              [
                -106.835646526917,
                47.785038796874694
              ],
              [
                -106.82878007183888,
                47.78013654417375
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.78559905579755,
                47.79650853261382
              ],
              [
                -106.77933341553876,
                47.794144496114114
              ],
              [
                -106.77272445252606,
                47.789531432290545
              ],
              [
                -106.76027900269696,
                47.78728241520243
              ],
              [
                -106.76877624085614,
                47.79673916456267
              ],
              [
                -106.77564269593427,
                47.79893011701914
              ],
              [
                -106.78628570130536,
                47.80256228200763
              ],
              [
                -106.7956412463493,
                47.80682831021426
              ],
              [
                -106.79744369080731,
                47.80169750385317
              ],
              [
                -106.79443961671063,
                47.796393216255495
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.56427455192977,
                47.483060367820656
              ],
              [
                -107.56236481911117,
                47.4813854444558
              ],
              [
                -107.5595431352275,
                47.48008027234894
              ],
              [
                -107.55868482834273,
                47.48156671579513
              ],
              [
                -107.5555627370494,
                47.48287910163511
              ],
              [
                -107.55565929657394,
                47.48340839714359
              ],
              [
                -107.55832004791671,
                47.482813845655215
              ],
              [
                -107.55939829587368,
                47.48349902530337
              ],
              [
                -107.55833077675277,
                47.48412620034029
              ],
              [
                -107.55990791565353,
                47.48614179727965
              ],
              [
                -107.562053687142,
                47.48899106375135
              ],
              [
                -107.5631265664714,
                47.48702631540364
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.62715625178225,
                47.49318682296477
              ],
              [
                -107.62913036388238,
                47.48906908175471
              ],
              [
                -107.62028977486938,
                47.48036856693792
              ],
              [
                -107.61936693467993,
                47.47757684773325
              ],
              [
                -107.61325163605625,
                47.475669689740634
              ],
              [
                -107.6061276556535,
                47.47682995019171
              ],
              [
                -107.60406772321949,
                47.47816420774072
              ],
              [
                -107.59994783708237,
                47.48187675941697
              ],
              [
                -107.60308049069306,
                47.48425509148536
              ],
              [
                -107.60406772321335,
                47.48640107708269
              ],
              [
                -107.6052268410225,
                47.4896491170844
              ],
              [
                -107.60271631541332,
                47.49144716314028
              ],
              [
                -107.60292004249311,
                47.49292606661855
              ],
              [
                -107.60338107551718,
                47.49469464744033
              ],
              [
                -107.60647099012061,
                47.49829005415602
              ],
              [
                -107.60999005953386,
                47.49457866248106
              ],
              [
                -107.61762901508337,
                47.49173695092037
              ],
              [
                -107.62226385125547,
                47.49182405074308
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.56114814533038,
                47.45253892311906
              ],
              [
                -107.56020400775714,
                47.4502753623099
              ],
              [
                -107.55539748920245,
                47.44824387863464
              ],
              [
                -107.5555691505794,
                47.4448772472195
              ],
              [
                -107.55634162677569,
                47.4419167553498
              ],
              [
                -107.55599830402178,
                47.43883998922412
              ],
              [
                -107.55093429340167,
                47.436984063708714
              ],
              [
                -107.549732663763,
                47.434661775012614
              ],
              [
                -107.54672858966632,
                47.43338447254338
              ],
              [
                -107.54338119281573,
                47.4317587700156
              ],
              [
                -107.54217956317706,
                47.43210713907074
              ],
              [
                -107.53977630389971,
                47.43367477128153
              ],
              [
                -107.54381034625811,
                47.43640350114311
              ],
              [
                -107.54501197589678,
                47.439074035906664
              ],
              [
                -107.540548780096,
                47.43739045369332
              ],
              [
                -107.54157874835772,
                47.43878376695458
              ],
              [
                -107.538746335638,
                47.437680730332055
              ],
              [
                -107.53642890704913,
                47.43773878546763
              ],
              [
                -107.53539893878741,
                47.435822932171895
              ],
              [
                -107.5306782509212,
                47.43617127432329
              ],
              [
                -107.53119323505206,
                47.43849349640116
              ],
              [
                -107.53333900226397,
                47.43971262196432
              ],
              [
                -107.5361714149837,
                47.44273128749622
              ],
              [
                -107.53934715045733,
                47.44133807877325
              ],
              [
                -107.54226539386553,
                47.44290543599236
              ],
              [
                -107.53977630389971,
                47.446040010342976
              ],
              [
                -107.54243705524249,
                47.45039327596818
              ],
              [
                -107.54398200763507,
                47.45352740412019
              ],
              [
                -107.55539748920245,
                47.45608100007214
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -108.84353752975642,
                47.66189437849837
              ],
              [
                -108.84182091598689,
                47.66039136614772
              ],
              [
                -108.83967514877497,
                47.659524223954264
              ],
              [
                -108.835898598482,
                47.65831020068702
              ],
              [
                -108.83246537094294,
                47.656691459085216
              ],
              [
                -108.82963295822321,
                47.65541955547715
              ],
              [
                -108.82336731796443,
                47.652008388297475
              ],
              [
                -108.81401177292048,
                47.649290858375714
              ],
              [
                -108.80894776230036,
                47.648539176198035
              ],
              [
                -108.80354042892634,
                47.64772966021577
              ],
              [
                -108.78225441818415,
                47.64744054432429
              ],
              [
                -108.78122444992243,
                47.648886107778196
              ],
              [
                -108.78508683090388,
                47.65206620654671
              ],
              [
                -108.78963585739314,
                47.65472577681422
              ],
              [
                -108.79873391037165,
                47.654899222344106
              ],
              [
                -108.80328293686091,
                47.662125607327035
              ],
              [
                -108.8113510215777,
                47.66570952320524
              ],
              [
                -108.81624337082087,
                47.66686557261285
              ],
              [
                -108.8205349052447,
                47.67021797110462
              ],
              [
                -108.82800217514216,
                47.67235645764593
              ],
              [
                -108.83512612228571,
                47.674437063145994
              ],
              [
                -108.84370919113337,
                47.675130579878235
              ],
              [
                -108.85418053512751,
                47.67622862918713
              ],
              [
                -108.85958786850154,
                47.67882918011574
              ],
              [
                -108.86722679977595,
                47.67963821396948
              ],
              [
                -108.87091751938044,
                47.678886968664195
              ],
              [
                -108.86920090561091,
                47.6756507113786
              ],
              [
                -108.86654015426814,
                47.673512359831804
              ],
              [
                -108.85381915311473,
                47.667212382442344
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -108.87700271257177,
                47.77205718100249
              ],
              [
                -108.88043594011083,
                47.768797862627736
              ],
              [
                -108.8821954692246,
                47.76490371890179
              ],
              [
                -108.88159465440526,
                47.761240073101455
              ],
              [
                -108.87283992418065,
                47.758355131057314
              ],
              [
                -108.86429977067723,
                47.756220170951835
              ],
              [
                -108.85807704576268,
                47.755066101987474
              ],
              [
                -108.85073852189794,
                47.7538254493027
              ],
              [
                -108.84618949540868,
                47.75327724450759
              ],
              [
                -108.84271335252538,
                47.754056270646544
              ],
              [
                -108.84224128373876,
                47.756479832941295
              ],
              [
                -108.84391498216405,
                47.75806662805422
              ],
              [
                -108.8486785853745,
                47.759509127072064
              ],
              [
                -108.85022353776708,
                47.76184589060587
              ],
              [
                -108.85344218858495,
                47.765451801203284
              ],
              [
                -108.85288428910985,
                47.76868248478267
              ],
              [
                -108.85369968065038,
                47.771912967694455
              ],
              [
                -108.8602228129746,
                47.77626803326345
              ],
              [
                -108.86640262254491,
                47.77609499125901
              ],
              [
                -108.87275409349218,
                47.7756047024525
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -109.02790381679927,
                47.95912120041459
              ],
              [
                -109.01279761562739,
                47.96004083117998
              ],
              [
                -109.00902106533442,
                47.96320193708269
              ],
              [
                -108.99854972134028,
                47.97124751563016
              ],
              [
                -108.9871342397729,
                47.97412063280916
              ],
              [
                -108.98086859951411,
                47.97423555417132
              ],
              [
                -108.97108390102778,
                47.97366094480286
              ],
              [
                -108.96679236660395,
                47.97762561929121
              ],
              [
                -108.97142722378169,
                47.982739025219004
              ],
              [
                -108.97631957302485,
                47.98555405499667
              ],
              [
                -108.98910834560786,
                47.99210271388872
              ],
              [
                -108.99339988003169,
                47.988368931255366
              ],
              [
                -109.00387122402583,
                47.986817895980344
              ],
              [
                -109.01065184841548,
                47.981647441755015
              ],
              [
                -109.01193930874263,
                47.9782001845398
              ],
              [
                -109.01520087490474,
                47.97532729435531
              ],
              [
                -109.01992156277095,
                47.9719945414749
              ],
              [
                -109.0241272665063,
                47.969695965884924
              ],
              [
                -109.02756049404536,
                47.96906383966163
              ],
              [
                -109.0314228750268,
                47.96756969237701
              ],
              [
                -109.0285046316186,
                47.96458126812953
              ],
              [
                -109.0270455099145,
                47.96193751793368
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -108.94857489109916,
                48.02611619262694
              ],
              [
                -108.94763075352591,
                48.021523759188796
              ],
              [
                -108.94599997044486,
                48.01761986906513
              ],
              [
                -108.92969213963431,
                48.00734203909071
              ],
              [
                -108.9264305734722,
                48.005332168099216
              ],
              [
                -108.92110907078666,
                48.006710373789915
              ],
              [
                -108.91638838292045,
                48.01147638456959
              ],
              [
                -108.91716085911673,
                48.01687350346961
              ],
              [
                -108.91664587498587,
                48.0211793101868
              ],
              [
                -108.93003546238822,
                48.023590404869
              ],
              [
                -108.93106543064994,
                48.02623099822059
              ],
              [
                -108.93793188572806,
                48.02801045222219
              ],
              [
                -108.93454157353324,
                48.019657966230845
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.53592401148057,
                47.44996520195167
              ],
              [
                -107.5363960802672,
                47.44944282484888
              ],
              [
                -107.53667503000474,
                47.448934953246955
              ],
              [
                -107.53817132208235,
                47.44814074447108
              ],
              [
                -107.53885796759016,
                47.447865036527475
              ],
              [
                -107.53905108663923,
                47.44735714969026
              ],
              [
                -107.53847172949202,
                47.446254292814714
              ],
              [
                -107.53787091467268,
                47.44644294102492
              ],
              [
                -107.53776362631208,
                47.446994370375464
              ],
              [
                -107.53761342260725,
                47.44732812743717
              ],
              [
                -107.53696969244368,
                47.44686376920961
              ],
              [
                -107.53673365805037,
                47.44732812743717
              ],
              [
                -107.53636887762434,
                47.44713948240164
              ],
              [
                -107.53559640142805,
                47.4465154978487
              ],
              [
                -107.53503850195295,
                47.44697985915081
              ],
              [
                -107.53424456808455,
                47.448010146151624
              ],
              [
                -107.53426602575666,
                47.44843096179778
              ],
              [
                -107.53411582205183,
                47.44893883826626
              ],
              [
                -107.53422311041243,
                47.449141987480516
              ],
              [
                -107.53495267126448,
                47.449446709830646
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -107.53839154220788,
                47.444986252225185
              ],
              [
                -107.53789801574914,
                47.444463825672365
              ],
              [
                -107.53738303161828,
                47.44472503959736
              ],
              [
                -107.53742594696251,
                47.44418809845549
              ],
              [
                -107.5367393014547,
                47.44388334563964
              ],
              [
                -107.5353874681112,
                47.44369468824979
              ],
              [
                -107.53570933319298,
                47.44450736141662
              ],
              [
                -107.53523726440636,
                47.44421712244114
              ],
              [
                -107.53450770355431,
                47.44394139393115
              ],
              [
                -107.53313441253869,
                47.4442026104503
              ],
              [
                -107.53298420883385,
                47.44450736141662
              ],
              [
                -107.53240485168664,
                47.44463796843314
              ],
              [
                -107.53167529083458,
                47.44421712244114
              ],
              [
                -107.53105301834313,
                47.444449313749615
              ],
              [
                -107.5309028146383,
                47.444971740446555
              ],
              [
                -107.53028054214684,
                47.444971740446555
              ],
              [
                -107.52992408914787,
                47.445918245808265
              ],
              [
                -107.52915161295158,
                47.44667283941046
              ],
              [
                -107.52904432459098,
                47.44593275732579
              ],
              [
                -107.52936618967277,
                47.44561350301569
              ],
              [
                -107.52981680078727,
                47.44522168825965
              ],
              [
                -107.52981680078727,
                47.44469926404505
              ],
              [
                -107.52902286691887,
                47.444365490302744
              ],
              [
                -107.52801435632927,
                47.44462670471601
              ],
              [
                -107.52773540659172,
                47.44471377589885
              ],
              [
                -107.527606660559,
                47.44513461791752
              ],
              [
                -107.52732771082145,
                47.44549741005892
              ],
              [
                -107.52767103357536,
                47.44577313041295
              ],
              [
                -107.5278212372802,
                47.44629554396251
              ],
              [
                -107.5282718483947,
                47.44655674879162
              ],
              [
                -107.52867954416496,
                47.446774418491756
              ],
              [
                -107.52852934046012,
                47.4470211097296
              ],
              [
                -107.52878683252555,
                47.44742742218752
              ],
              [
                -107.52913015527946,
                47.44754351088469
              ],
              [
                -107.52994554681999,
                47.44751448873443
              ],
              [
                -107.53138321085197,
                47.446614794133076
              ],
              [
                -107.53187673731071,
                47.44622298683533
              ],
              [
                -107.53245609445793,
                47.44549741005892
              ],
              [
                -107.53337877435905,
                47.44513461791752
              ],
              [
                -107.53432291193229,
                47.44500401213409
              ],
              [
                -107.53533142252189,
                47.44484438240289
              ],
              [
                -107.53571766062004,
                47.44513461791752
              ],
              [
                -107.53616827173454,
                47.44536680517625
              ],
              [
                -107.53715532465202,
                47.44549741005892
              ],
              [
                -107.53756302042228,
                47.44543936348443
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -106.3369655830628,
                47.55378434411031
              ],
              [
                -106.33782388994757,
                47.55172789723748
              ],
              [
                -106.33576395342413,
                47.54859962613033
              ],
              [
                -106.33318903276984,
                47.54468902466613
              ],
              [
                -106.33645059893195,
                47.5418790049655
              ],
              [
                -106.34198667833869,
                47.54043048236973
              ],
              [
                -106.3452482445008,
                47.53909780623391
              ],
              [
                -106.3406563026673,
                47.53489675759853
              ],
              [
                -106.33610727617804,
                47.535939807979986
              ],
              [
                -106.33215906450812,
                47.536866946456655
              ],
              [
                -106.32576467821661,
                47.53918472092752
              ],
              [
                -106.31962778399054,
                47.54205282498748
              ],
              [
                -106.31709577868048,
                47.544978708854075
              ],
              [
                -106.31937029192511,
                47.54775959560623
              ],
              [
                -106.32443430254523,
                47.54909205155755
              ],
              [
                -106.33087160418097,
                47.55337885393117
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    dem = ee.Image("USGS/NED"),
    NHD = ee.FeatureCollection("users/GinaMazza/NHDWaterbody_Final"),
    water_not_picked_up = /* color: #d9e618 */ee.Geometry.MultiPoint(
        [[-107.01335189017374, 48.042459181928606],
         [-106.97884795340616, 48.005834759726966],
         [-107.76854117535697, 48.041397554832976],
         [-107.75570948742973, 48.05468066377876],
         [-107.85774149475162, 47.740017849253185],
         [-107.86658205566471, 47.712766515227244],
         [-107.85722651062076, 47.765351102664994],
         [-107.87093968497805, 47.88364613430026],
         [-108.62149913839437, 47.549727602210375],
         [-108.60858402589645, 47.55095824179904],
         [-108.71226651203813, 47.516500117114134],
         [-107.87178102818444, 47.55180469624589],
         [-109.0293583446948, 47.46295447237969]]),
    ceruleanWB = /* color: #15cdd6 */ee.Geometry.MultiPolygon(
        [[[[-108.62167079977132, 47.5500100171637],
           [-108.62173517278768, 47.54964794643556],
           [-108.6213060193453, 47.54948139306072],
           [-108.62104852727987, 47.54936552953121],
           [-108.6208017640505, 47.5491627677383],
           [-108.62005074552633, 47.54882241582251],
           [-108.61978252462484, 47.548909314394095],
           [-108.62006147436239, 47.5491555262312],
           [-108.62036188177206, 47.54933656360883],
           [-108.62095196775533, 47.54961898066926],
           [-108.62120945982076, 47.54988691339679],
           [-108.62139185003377, 47.5500100171637]]],
         [[[-108.60908962229576, 47.55093470770352],
           [-108.60902390817489, 47.55092022517795],
           [-108.60895685294952, 47.550907552964794],
           [-108.60890454987373, 47.55091932001997],
           [-108.60884822348442, 47.55092022517795],
           [-108.60880396703567, 47.550907552964794],
           [-108.60871008972015, 47.550847812490055],
           [-108.60863901118125, 47.55079078742793],
           [-108.60855049828376, 47.55075729648951],
           [-108.60851026514854, 47.550764537775294],
           [-108.60844320992317, 47.55079078742793],
           [-108.60840700010147, 47.55085052796767],
           [-108.60838956574287, 47.55094556959509],
           [-108.60840431789245, 47.5510179821479],
           [-108.60843650440063, 47.55107953273913],
           [-108.60848746637191, 47.55111754924465],
           [-108.60854245165672, 47.551123885326255],
           [-108.60860816577758, 47.55110306676962],
           [-108.60868192652549, 47.5510641450981],
           [-108.60876239279594, 47.55102522339768],
           [-108.608862975634, 47.550992637765795],
           [-108.60895685294952, 47.550976344942256],
           [-108.6090628002056, 47.550975439785255],
           [-108.60914594868507, 47.55095462116966]]],
         [[[-108.71225041878404, 47.51672655469777],
           [-108.71248645317735, 47.51662511078112],
           [-108.71268493664445, 47.51652910117936],
           [-108.71278686058702, 47.51647294453843],
           [-108.71285391581239, 47.516422222359466],
           [-108.71288073790254, 47.51636425409489],
           [-108.71288342011155, 47.516302662743655],
           [-108.71282441151322, 47.516230202237836],
           [-108.71275467407884, 47.51618491437087],
           [-108.71270102989854, 47.51615411859902],
           [-108.71259642374696, 47.5161341919135],
           [-108.71244890225114, 47.51612332280911],
           [-108.71234161389054, 47.51615411859902],
           [-108.71223164332093, 47.516206652551894],
           [-108.71212971937837, 47.51623744829293],
           [-108.71203852427186, 47.516286359138554],
           [-108.71196074021043, 47.51634251597918],
           [-108.71186686289491, 47.5163932382352],
           [-108.7117756677884, 47.516371500131484],
           [-108.71163887512864, 47.5163515735285],
           [-108.71153963339509, 47.516391426726905],
           [-108.71153426897706, 47.51643671441561],
           [-108.7116120530385, 47.516500117114134],
           [-108.71167106163682, 47.5165707657451],
           [-108.71171129477204, 47.516641414280954],
           [-108.71184272301377, 47.51677184209723],
           [-108.7119741512555, 47.516804449000645]]],
         [[[-107.87332598057702, 47.552152269889056],
           [-107.87302557316735, 47.55157297920312],
           [-107.87405554142907, 47.55128333145889],
           [-107.87276808110192, 47.55122540171795],
           [-107.8719526895614, 47.551254366596424],
           [-107.87062231389001, 47.55073299633457],
           [-107.86946359959558, 47.551051612110925],
           [-107.86886278477624, 47.5513412611358],
           [-107.86899153080896, 47.55183366080419],
           [-107.8708368906112, 47.55221019860544],
           [-107.87165228215173, 47.55252880540109],
           [-107.87263933506921, 47.55273155417161]]],
         [[[-106.97891382031457, 48.00799957991177],
           [-106.97910693936365, 48.00766939640638],
           [-106.97949317746179, 48.00749712591227],
           [-106.9798365002157, 48.00748277001176],
           [-106.98005107693689, 48.00728178698544],
           [-106.9797292118551, 48.00695159888475],
           [-106.97996524624841, 48.006592696377794],
           [-106.9802871113302, 48.00633428502633],
           [-106.98082355313318, 48.00606151608412],
           [-106.98069480710046, 48.00565953817156],
           [-106.98050168805139, 48.00527191364603],
           [-106.98071626477258, 48.004927356066716],
           [-106.98075918011682, 48.00462586629674],
           [-106.98041585736291, 48.00433873154414],
           [-106.97996524624841, 48.00439615862253],
           [-106.9793858891012, 48.00443922888937],
           [-106.97902110867517, 48.004554082758446],
           [-106.97859195523279, 48.004554082758446],
           [-106.97788385205286, 48.00439615862253],
           [-106.97713283352869, 48.004956069286244],
           [-106.97698262982385, 48.00535805268122],
           [-106.97706846051233, 48.00574567655941],
           [-106.97728303723352, 48.006592696377794],
           [-106.97717574887292, 48.0070808031759],
           [-106.97661784939783, 48.00712387120101],
           [-106.97734741024988, 48.007583261231275],
           [-106.97706846051233, 48.00834411696806],
           [-106.97732595257776, 48.00880349612947],
           [-106.97889236264245, 48.008516384633104]]],
         [[[-107.0160468134377, 48.04352362309043],
           [-107.01663689942097, 48.042383113972356],
           [-107.0159395250771, 48.042002938654804],
           [-107.01524215073323, 48.041515162440014],
           [-107.01379375786519, 48.04119236681713],
           [-107.0129139933083, 48.04054676950331],
           [-107.01143341393208, 48.04006615291623],
           [-107.01107936234212, 48.040482209326946],
           [-107.01076822609639, 48.04099151518649],
           [-107.01046781868672, 48.041931207148195],
           [-107.01032834381795, 48.04302151526938],
           [-107.010339072654, 48.04345906664476],
           [-107.01098280281758, 48.043473412528584],
           [-107.01199131340718, 48.043573833603354],
           [-107.01288180680012, 48.043803366753444],
           [-107.01356845230794, 48.0440400717432],
           [-107.01424436897969, 48.044118973164736],
           [-107.01494174332356, 48.04402572601721],
           [-107.01569276184773, 48.043910960065446]]],
         [[[-106.31977798769537, 47.5553555889187],
           [-106.31952049562994, 47.55500803652147],
           [-106.31937029192511, 47.554703926282926],
           [-106.31937029192511, 47.55438533271147],
           [-106.31939174959723, 47.553965365498684],
           [-106.31915571520392, 47.553617803880684],
           [-106.31883385012213, 47.55342954037511],
           [-106.31849052736823, 47.55348746767964],
           [-106.31810428927008, 47.55353091311601],
           [-106.31765367815558, 47.55350194949577],
           [-106.31718160936896, 47.553458504035376],
           [-106.31688120195929, 47.55363228566078],
           [-106.31679537127081, 47.554023292210886],
           [-106.31720306704108, 47.55412466380317],
           [-106.31780388186041, 47.5541391454432],
           [-106.31838323900763, 47.55428396162344],
           [-106.31849052736823, 47.55468944479898],
           [-106.31885530779425, 47.55499355512157],
           [-106.31939174959723, 47.5552107757]]]]),
    vectorGeom = /* color: #d63000 */ee.Geometry.Polygon(
        [[[-107.98758544921873, 47.68779562300997],
          [-108.02054443359373, 47.66005449811206],
          [-108.10294189453123, 47.62859672750955],
          [-108.04251708984373, 47.55821085076396],
          [-107.69232788085935, 47.53781832178539],
          [-107.46710815429685, 47.52020020704376],
          [-107.32565917968748, 47.57303679765662],
          [-107.08395996093748, 47.58044819750757],
          [-107.03177490234373, 47.75062091192031],
          [-107.28171386718748, 47.71736990190588],
          [-107.43002929687498, 47.72937966033953],
          [-107.54007619859095, 47.70171151532783],
          [-107.69095458984373, 47.69519076567296],
          [-107.80081787109373, 47.656354567176784]]]);
/*
Gina Mazza
April 29, 2019
Water Classification from 2009 NAIP
Based off of ArcPy workflow
Montana State Library
NAIP Source: U. S. Department of Agriculture, Farm Service Agency
HUC, National Hydro Data, and Building Footprint polygon source: Montana State Library
DEM Source: USGS
---------------------------------------------------------------------------------------------------------------------------------------------
This Code: 
1. Identifies Fort Peck Reservoir Study Area (Fort Peck Reservoir: HUC8, 10040104)
  and Slope
2. Imports 2009 NAIP
  a. Mosaics from an image collection(many images) to a single image
  b. Displays the NIR image
3. Calculates NDWI for each year (G-N)/(G+N)
  a. Prints histograms of NDWI for:
      i. the water pixels within Fort Peck Reservoir (imported NHD and filtered to "Fort Peck Lake" for boundary)
      ii. pixels within designated shadowed areas (polygon geometries)
  b. Sets a threshold for "water", represented in Viz Params based off of the histogram results
4. Makes a binary product (ex: NDWI >= 0.3) Used the thresholds identified in above steps to pull out water
        a. Creates a product that maintains the pixel values above the threshold, but everything less than, becomes 0
5. Computes Low NIR
  a. Print histograms to the console for areas
      i. within Fort Peck Reservoir
      ii. in shadowed areas
  a. Gathers thresholds for creating binary product from the histograms
6. Computes NDVI 
  a. Prints histograms of NDVI for:
      i. pixels within Fort Peck Reservoir
      ii. shadowed pixels
  b. Manually finds thresholds for the NDVI from the histograms
7. Converts NDVI rasters to a Binary product based on thresholds
  a. Threshold at 
8. Sums Binary versions of: (1+1+1 = 3) 3 is the max
  a. NDWI
  b. NIR (low)
  c. NDVI 
9. Pulls out areas less than 8% Slope and displays the result 
10. Buffers Building Footprint Layer to 30m --> Only within the study area
11. Displays the likelihood of water 
  a. pixel values range from 0 to 3 with 3 being the highest probability of water
  b. excludes any pixel that equals 0 or 1
  c. Displays top values in the gradient layer
  d. Displays the top values as a binary layer (dark blue)
12. Adds the study area Boundary
13. Adds a Title
14. Creates a legend
15. Renders Histograms of water bodies this code doesn't find
  a. Called "Cerulean Waterbodies"
16. Generates histograms of regions of interest to help obtain the best thresholds  
Notes: 
 - The magenta polygons are to gather shadowed areas for histogram rendering
 - The yellow points are markers for waterbodies not pick up by the code
 - The light blue polygons are around the waterbodies not picked up to try and determine a classification for them
----------------------------------------------------------------------------------------------------------------------------------------------
*/
//--------------------------------------------------------------------------------------------------------------------------------------------
//1. --------------------------------Identify Study Area (FP HUC) and slope---------------------------------------------------------------------------------------
Map.setCenter(-106.65, 47.794, 9);    //Fort Peck, Montana
//Load Study Area and Filter out the Fort Peck HUC
var fpHUC = ee.FeatureCollection(HUCs.filter(ee.Filter.eq('HUC8', '10040104')));
//Make the Fort Peck HUC transparent
var empty = ee.Image().byte();
var outline = empty.paint({featureCollection: fpHUC, width: 3});
var slope = ee.Terrain.slope(dem);
//--------------------------------------------------------------------------------------------------------------------------------
//2.---------------------------------Import NAIP 2009 and Display----------------------------------------------------
// Load  NAIP image collection
var naip2009 = naip.filterDate('2009-01-01', '2009-12-31').mosaic();
//Display in NIR
var nirColorVis = {min: 0.0,max: 255.0};  //Visualization Parameters
var nirColor09 = naip2009.select(['N', 'R', 'G']); //Choose the bands to display
Map.addLayer(nirColor09, nirColorVis, 'NIR False Color 2009', false);  //Add to the Map
//--------------------------------------------------------------------------------------------------------------------------------
//3. -------------------------------Calculate NDWI and Print Histograms to Console --------------------------------------------------------
//Create NDWI image
var ndwi09 = naip2009.normalizedDifference(['G', 'N']);
//Bring in NHD so we can pull out the fort peck boundary "GNIS_NAME: Fort Peck Lake"
var fortPeck = NHD.filter(ee.Filter.eq('GNIS_NAME','Fort Peck Lake'));
Map.addLayer(fortPeck, {color: 'blue'}, 'Fort Peck Lake', false);
//.........................Print Water Histogram: 
var histogram_ndwi09 = ui.Chart.image.histogram({
                      image: ndwi09,
                      region: fortPeck,
                      scale: 20,                // Aggregated to 20x20 Cell size
                      minBucketWidth: 0.05      // used to control the width of the histogram buckets
                      }).setSeriesNames(['NDWI']);
            histogram_ndwi09.setOptions({
            title: 'Histogram of 2009 NDWI',
            fontSize: 12,
            hAxis: {title: 'NDWI Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['blue']
            });
print(histogram_ndwi09);     //Explore the histogram interactively by placing cursor over the bars
//.........................Print Shadow Histogram:
var histogram_ndwi09_shad = ui.Chart.image.histogram({
                      image: ndwi09,
                      region: shadows,
                      scale: 20,
                      minBucketWidth: 0.05    
                      }).setSeriesNames(['NDWI']);
            histogram_ndwi09_shad.setOptions({
            title: 'Histogram of 2009 NDWI: Shadow',
            fontSize: 12,
            hAxis: {title: 'NDWI Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['purple']
            });
print(histogram_ndwi09_shad);  
//Define visualization parameters from Histograms
var ndwiViz09 = {min: 0.3, max: 1, palette: ['00FFFF', '0000FF']};  //Everything greater than 0.3 we are calling water
//Display
Map.addLayer(ndwi09, ndwiViz09, 'NDWI 2009', false);   
//--------------------------------------------------------------------------------------------------------------------------------
//4. -------------------------------Make a Binary NDWI Product Based on above Threshold --------------------------------------------------------
var sumViz = {min: 0, max: 1, palette: ['FFFA89', '6330B2']}; //visualization parameters
//Binary
var ndwi09_gte03 = ndwi09.gte(0.3).and(slope.lt(8));  //taking the slope out here helps me understand what shadows I don't need to worry about
Map.addLayer(ndwi09_gte03, sumViz, '2009 NDWI and Slope Less Than 8%: Binary', false);
//everything not "water" = 0 (the yellow layer) and all else maintains values, another way to look at Quality Control
var masked09 = ndwi09.updateMask(ndwi09_gte03);
var maskNDWI09 = masked09.unmask(0); 
var sumViz_grade = {min: 0.3, max: 1, palette: ['FFFA89', '6330B2']}; //visualization parameters
Map.addLayer(maskNDWI09, sumViz_grade, '2009 NDWI and Slope Less Than 8%: Gradient', false);
//--------------------------------------------------------------------------------------------------------------------------------
//5. ---------------------------------------Compute Low NIR and Print Histograms----------------------------------------------------------------------------
var lowNIRViz = {min: 0, max: 1, palette: ['white', 'black']};
//Calculate Low Near Infrared
var lowNIR09 = naip2009.select('N').lt(50).and(slope.lt(8));  
//.................Print NIR Water Histogram
var histogram_NIR09 = ui.Chart.image.histogram({
                  image: naip2009.select('N'),
                  region: fortPeck,
                  scale: 20,
                  minBucketWidth: 0.025     
                  }).setSeriesNames(['NIR Band']);
            histogram_NIR09.setOptions({
            title: 'Histogram of 2009 NIR Band',
            fontSize: 12,
            hAxis: {title: 'Near Infrared Band Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['magenta']
            });
print(histogram_NIR09); 
//.................Print NIR Shadow Histogram
var histogram_NIR09_shad = ui.Chart.image.histogram({
                  image: naip2009.select('N'),
                  region: shadows,
                  scale: 20,
                  minBucketWidth: 0.025     
                  }).setSeriesNames(['NIR Band']);
            histogram_NIR09_shad.setOptions({
            title: 'Histogram of 2009 NIR Band: Shadows',
            fontSize: 12,
            hAxis: {title: 'Near Infrared Band Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['purple']
            });
print(histogram_NIR09_shad); 
//Display
Map.addLayer(lowNIR09, lowNIRViz, '2009 Low NIR', false);
//--------------------------------------------------------------------------------------------------------------------------------
//6.-----------------------------------------NDVI and Histograms -----------------------------------------------------------
var ndvi09 = naip2009.normalizedDifference(['N', 'R']);
//...................NDVI Water Histogram
var histogram_ndvi09 = ui.Chart.image.histogram({
                image: ndvi09,
                region: fortPeck,
                scale: 20,
                minBucketWidth: 0.05    
                }).setSeriesNames(['NDVI']);
            histogram_ndvi09.setOptions({
            title: 'Histogram of 2009 NDVI',
            fontSize: 12,
            hAxis: {title: 'NDVI Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['#2CFF9B']
            });
print(histogram_ndvi09);
//....................NDVI Shadow Histogram
var histogram_ndvi09_shad = ui.Chart.image.histogram({
                  image: ndvi09,
                  region: shadows,
                  scale: 20,
                  minBucketWidth: 0.05    
                  }).setSeriesNames(['NDVI']);
              histogram_ndvi09_shad.setOptions({
              title: 'Histogram of 2009 NDVI: Shadows',
              fontSize: 12,
              hAxis: {title: 'NDVI Value'},
              vAxis: {title: 'Pixel Count'},
              colors: ['purple']
              });
print(histogram_ndvi09_shad);
var ndviViz = {min: -1, max: 1, palette: ['red', 'white', 'green']};  //Visualization Parameters
Map.addLayer(ndvi09, ndviViz, '2009 NDVI', false);  //Display
//--------------------------------------------------------------------------------------------------------------------------------
//7. ---------------------------------Convert NDVI to Binary ------------------------------------------------------------------------
//Binary
var ndvi09_bin = ndvi09.lt(-0.40).and(slope.lt(8)); 
//Visualization Parameters
var ndvi_binViz = {min: 0, max: 1, palette: ['69FFC3', 'FF7357']};
//Display
Map.addLayer(ndvi09_bin, ndvi_binViz, '2009 NDVI Binary', false); 
//--------------------------------------------------------------------------------------------------------------------------------
//8. ---------------------------Sum Binary Versions of NDWI + lowNIR + NDVI---------------------------------------
//Visualization Parameters
var fPViz = {min: 0, max: 3, palette: ['ADFFC4', 'FF801C', '456AFF', '291985']};  //'69F3DD'
//Sum all binary layers (later try to use the non binary ndwi and mndwi...??)
var final_sum09 = ndwi09_gte03.add(lowNIR09.add(ndvi09_bin));
//Display
Map.addLayer(final_sum09, fPViz, '2009 Prediction of Water using Indices', false);
//--------------------------------------------------------------------------------------------------------------------------------
//9. -----------------------------------Filter out Areas greater than 8% Slope (Y. Allen 2015 =10%) ------------------------------------------
//Calculated slope (above)
//Filter out slope
var slope_lt8 = slope.lt(8); 
var flat09 = final_sum09.updateMask(slope_lt8);
var water_lt8 = flat09.unmask(0)
Map.addLayer(water_lt8, fPViz, '2009 Water Less Than 8% Slope', false);
//--------------------------------------------------------------------------------------------------------------------------------
//10. -----------------------------------Filter Out Building Footprints (30m Buffer) IN STUDY AREA ONLY------------------------------------------
var fpBuildings = buildings.filterBounds(fpHUC);
var buffer30 = function(feature) {return feature.buffer(30)};
var fpBuildings_buffer = fpBuildings.map(buffer30);
//Map.addLayer(fpBuildings_buffer, {}, 'Building Footprints Buffered', false);
var foreground = 1; //buildings
var background = 0;  //everything else
//define images
var roi_image = ee.Image(background).clip(fpHUC);
var example_image = ee.Image(foreground).clip(fpBuildings_buffer);
//replace background image with the foreground value where the example polygons occus using ee.Image.where()
var binary_buildings = roi_image.where({test:example_image, value:example_image});
//Map.addLayer(binary_buildings, {min:0, max:1}, 'Binary Buildings', false);
//Update water prediction minus building footprints
var water_no_buildings = water_lt8.updateMask(binary_buildings.eq(0)).unmask(0);
Map.addLayer(water_no_buildings, fPViz, 'Water without Building footprints', false );
//--------------------------------------------------------------------------------------------------------------------------------
//11. -----------------------------------Display Water Likelihood 2009 -----------------------------------------------------------------
//Display Water Only
var water09_gte1 = water_no_buildings.gt(1); //Values are 0-3 //Better to just go greater than 1?
var water = final_sum09.updateMask(water09_gte1);
var fpViz2 = {min: 0, max: 1, palette: ['69F3DD', '291985']};
Map.addLayer(water, fpViz2, 'Water Present in 2009', false);  //Binary
//Display with gradient:
var maskFinal09 = water_no_buildings.updateMask(water09_gte1);
var gradientViz = {min: 1, max: 3, palette: ['FF4728', '456AFF', '291985']};    //'69F3DD', 
Map.addLayer(maskFinal09, gradientViz, 'Water Likelihood', false);
//Display Binary
var finalBinary = maskFinal09.gt(1);
Map.addLayer(finalBinary, fpViz2, 'Water 2009 Binary');
// Export the image to an asset
Export.image.toAsset({
  image: finalBinary,
  description: 'NAIP_water_2009',
  assetId: 'NAIP2009_Export',
  scale: 1,
  region: fpHUC,
  maxPixels: 3000000000000
});
//--------------------------------------------------------------------------------------------------------------------------------
// 12. --------------------------------------------Add Study Area Boundary to the Map-----------------------------------------------------------
Map.addLayer(outline, {palette: 'yellow'}, 'Fort Peck Reservoir');
//--------------------------------------------------------------------------------------------------------------------------------
// 12.5. --------------------------------------------Raster to Vector-----------------------------------------------------------
var waterVector = finalBinary.reduceToVectors({
  geometry: vectorGeom,
  scale: 20,
  geometryType: 'polygon',
  eightConnected: false
});
Map.addLayer(waterVector, {min:0, max: 1, palette: ['white', 'black']});
// Export the vectors
//Export.table.toAsset(waterVector, 'Water_Vector_Test');
//--------------------------------------------------------------------------------------------------------------------------------
// 13. --------------------------------------------Add a title to the map-----------------------------------------------------------
var title = ui.Label('Water Classifed from NAIP Imagery 2009');
title.style().set('position', 'top-center');
Map.add(title);
//--------------------------------------------------------------------------------------------------------------------------------
//14.---------------------------------------------- Create Legend and Title-----------------------------------------------------------
// Create the panel for the legend items.
var legend = ui.Panel({
  style: {
    position: 'bottom-left',
    padding: '8px 15px'
  }
});
// Create and add the legend title.
var legendTitle = ui.Label({
  value: 'Water Gradient',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
  }
});
legend.add(legendTitle);
// Create and style 1 row of the legend.
var makeRow = function(color, name) {
  // Create the label that is actually the colored box.
  var colorBox = ui.Label({
    style: {
      backgroundColor: '#' + color,
      // Use padding to give the box height and width.
      padding: '8px',
      margin: '0 0 4px 0'
    }
  });
  // Create the label filled with the description text.
  var description = ui.Label({value: name, style: {margin: '0 0 4px 6px'}});
  return ui.Panel({widgets: [colorBox, description], layout: ui.Panel.Layout.Flow('horizontal')});};
// Palette with the colors
var palette =['FF4728', '456AFF', '291985']; //'E8E3C8', <--ADD IN WHEN MAX SUM IS 4, NOT 3 AND 'Not Water',
// Name of features
var names = ['Low Probability of Water (value = 1, not displayed)', 'Medium Probability of Water (value = 2)', 'High Probability of Water (value = 3)'];
// Add color and and names
for (var i = 0; i < 3; i++) {legend.add(makeRow(palette[i], names[i]));} //change i < 3 to 4 or however many labels needed
// Add the legend to the map.
Map.add(legend);
//--------------------------------------------------------------------------------------------------------------------------------
//15.---------------------------------------------- Cerulean Water Bodies Histograms -----------------------------------------------------------
//................Histogram of Low NIR values 
var histogram_cerulean09 = ui.Chart.image.histogram({
                image: naip2009.select('N'),
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['NIR Value']);
            histogram_cerulean09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- NIR',
            fontSize: 12,
            hAxis: {title: 'NIR Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['black']
            });
print(histogram_cerulean09);
//................Histogram of NDWI
var histogram_ceruleanNDWI09 = ui.Chart.image.histogram({
                image: ndwi09,
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['NDWI Value']);
            histogram_ceruleanNDWI09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- NDWI',
            fontSize: 12,
            hAxis: {title: 'NDWI Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['#48A9FF']
            });
print(histogram_ceruleanNDWI09);
//................Histogram of NDVI
var histogram_ceruleanNDVI09 = ui.Chart.image.histogram({
                image: ndvi09,
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['NDVI Value']);
            histogram_ceruleanNDVI09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- NDVI',
            fontSize: 12,
            hAxis: {title: 'NDVI Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['#FC45FF']
            });
print(histogram_ceruleanNDVI09);
//...................Histogram of Blue Band
var histogram_ceruleanBLUE09 = ui.Chart.image.histogram({
                image: naip2009.select('B'),
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['Blue Value']);
            histogram_ceruleanBLUE09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- Blue',
            fontSize: 12,
            hAxis: {title: 'Blue Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['blue']
            });
print(histogram_ceruleanBLUE09);
//...................Histogram of Red Band
var histogram_ceruleanRED09 = ui.Chart.image.histogram({
                image: naip2009.select('R'),
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['Red Value']);
            histogram_ceruleanRED09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- Red',
            fontSize: 12,
            hAxis: {title: 'Red Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['red']
            });
print(histogram_ceruleanRED09);
//...................Histogram of Green Band
var histogram_ceruleanGREEN09 = ui.Chart.image.histogram({
                image: naip2009.select('G'),
                region: ceruleanWB,
                scale: 1,
                minBucketWidth: 0.05    
                }).setSeriesNames(['Green Value']);
            histogram_ceruleanGREEN09.setOptions({
            title: 'Histogram of 2009 Cerulean Water Bodies -- Green',
            fontSize: 12,
            hAxis: {title: 'Green Value'},
            vAxis: {title: 'Pixel Count'},
            colors: ['green']
            });
print(histogram_ceruleanGREEN09);