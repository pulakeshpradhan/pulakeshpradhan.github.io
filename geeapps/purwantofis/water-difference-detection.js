var AirJernihLaut = ui.import && ui.import("AirJernihLaut", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            112.32517863296415,
            -8.368590812387172
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.34234477065947,
            -8.38353587983984
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.38766337417509,
            -8.401876768264625
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.42817545913603,
            -8.410707257246997
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.46044779800322,
            -8.413424290306402
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.49615336440947,
            -8.412065776158439
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "label": "Air Jernih",
        "system:index": "0"
      },
      "color": "#0318d6",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #0318d6 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[112.32517863296415, -8.368590812387172],
             [112.34234477065947, -8.38353587983984],
             [112.38766337417509, -8.401876768264625],
             [112.42817545913603, -8.410707257246997],
             [112.46044779800322, -8.413424290306402],
             [112.49615336440947, -8.412065776158439]]),
        {
          "label": "Air Jernih",
          "system:index": "0"
        }),
    AirJernihDanau = ui.import && ui.import("AirJernihDanau", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            113.00669612345196,
            -7.726252458236881
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.00935687479473,
            -7.725997303683472
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.01141681131817,
            -7.7258272005622315
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.01012935099102,
            -7.7281235869177145
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.00858439859844,
            -7.730675112663821
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.00600947794415,
            -7.7296545042160645
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "label": "Air Jernih Danau",
        "system:index": "0"
      },
      "color": "#5a72ff",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #5a72ff */ee.Feature(
        ee.Geometry.MultiPoint(
            [[113.00669612345196, -7.726252458236881],
             [113.00935687479473, -7.725997303683472],
             [113.01141681131817, -7.7258272005622315],
             [113.01012935099102, -7.7281235869177145],
             [113.00858439859844, -7.730675112663821],
             [113.00600947794415, -7.7296545042160645]]),
        {
          "label": "Air Jernih Danau",
          "system:index": "0"
        }),
    AirKeruhWaduk = ui.import && ui.import("AirKeruhWaduk", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            112.47066888096394,
            -8.178263741149774
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.47684869053425,
            -8.183191263871562
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.48646172764363,
            -8.18557004613578
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.49178323032918,
            -8.191177119542493
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.45865258457722,
            -8.167728833154236
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.45058449986043,
            -8.160592124592748
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "label": "Air Keruh Algae",
        "system:index": "0"
      },
      "color": "#33d678",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #33d678 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[112.47066888096394, -8.178263741149774],
             [112.47684869053425, -8.183191263871562],
             [112.48646172764363, -8.18557004613578],
             [112.49178323032918, -8.191177119542493],
             [112.45865258457722, -8.167728833154236],
             [112.45058449986043, -8.160592124592748]]),
        {
          "label": "Air Keruh Algae",
          "system:index": "0"
        }),
    AirKeruhMuara1 = ui.import && ui.import("AirKeruhMuara1", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            112.94990474837292,
            -7.616306118494817
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.96260769026745,
            -7.629577375443224
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.96466762679088,
            -7.634341315999785
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.8664773191737,
            -7.580573770148048
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.8723138059901,
            -7.550964719800054
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.88124019759167,
            -7.582275377908203
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.05904298640202,
            -7.658745310749474
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.0689993462653,
            -7.66725172867317
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            113.07586580134343,
            -7.683243333963972
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "label": "Air Keruh Lumpur",
        "system:index": "0"
      },
      "color": "#ffcc77",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #ffcc77 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[112.94990474837292, -7.616306118494817],
             [112.96260769026745, -7.629577375443224],
             [112.96466762679088, -7.634341315999785],
             [112.8664773191737, -7.580573770148048],
             [112.8723138059901, -7.550964719800054],
             [112.88124019759167, -7.582275377908203],
             [113.05904298640202, -7.658745310749474],
             [113.0689993462653, -7.66725172867317],
             [113.07586580134343, -7.683243333963972]]),
        {
          "label": "Air Keruh Lumpur",
          "system:index": "0"
        }),
    AirKeruhMuara2 = ui.import && ui.import("AirKeruhMuara2", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            112.92003566878307,
            -7.225133000296059
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.91351253645885,
            -7.24693065928356
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.94097835677135,
            -7.247271239346592
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.92758876936901,
            -7.26089423063308
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.8884499754237,
            -7.22751717051138
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            112.92964870589245,
            -7.295971531890356
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "label": "Air Keruh Pantai",
        "system:index": "0"
      },
      "color": "#19fbf6",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #19fbf6 */ee.Feature(
        ee.Geometry.MultiPoint(
            [[112.92003566878307, -7.225133000296059],
             [112.91351253645885, -7.24693065928356],
             [112.94097835677135, -7.247271239346592],
             [112.92758876936901, -7.26089423063308],
             [112.8884499754237, -7.22751717051138],
             [112.92964870589245, -7.295971531890356]]),
        {
          "label": "Air Keruh Pantai",
          "system:index": "0"
        }),
    geom = ui.import && ui.import("geom", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.0201853768524,
                -7.491546564202538
              ],
              [
                112.0201853768524,
                -8.147314369371534
              ],
              [
                112.77000227138365,
                -8.147314369371534
              ],
              [
                112.77000227138365,
                -7.491546564202538
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[112.0201853768524, -7.491546564202538],
          [112.0201853768524, -8.147314369371534],
          [112.77000227138365, -8.147314369371534],
          [112.77000227138365, -7.491546564202538]]], null, false);
// Creating the Graphical User Interface for Water Identification
// Set Style-------------------------------------------------------------
// Fonts & Colors //
// (pulled from Scripts/User Interface/Mosaic Editor) //
var colors = {'transparent': '#11ffee00', 'gray': '#F8F9FA', 'dark': '#080c16'};
var TITLE_STYLE = {
  fontWeight: 'bold',
  fontSize: '32px',
  padding: '8px',
  color: '#e8e8e8',
  //textAlign: 'center',
  backgroundColor: colors.transparent,
};
var SUBTITLE_STYLE = {
  fontWeight: '350',
  fontSize: '16px',
  padding: '8px',
  color: '#e8e8e8',
  textAlign: 'center',
  //maxWidth: '450px',
  backgroundColor: colors.transparent,
};
var PARAGRAPH_STYLE = {
  fontSize: '14px',
  fontWeight: '50',
  color: '#e8e8e8',
  textAlign: 'justify',
  padding: '8px',
  maxWidth: '500px',
  backgroundColor: colors.transparent,
};
var BUTTON_STYLE = {
  fontSize: '14px',
  fontWeight: '100',
  color: '#5b5b5b',
  padding: '8px',
  backgroundColor: colors.transparent,
};
var SELECT_STYLE = {
  fontSize: '14px',
  fontWeight: '50',
  color: '#5b5b5b',
  padding: '2px',
  backgroundColor: colors.transparent,
  width: '115px'
};
var LABEL_STYLE = {
  fontWeight: '50',
  textAlign: 'center',
  fontSize: '14px',
  color: '#eeeeee',
  padding: '2px',
  backgroundColor: colors.transparent,
};
// Create root panel, i.e., side panel and map panel for hold the other widgets
var infoPanel = ui.Panel({
    layout: ui.Panel.Layout.flow(),
    style: {
      stretch: 'horizontal',
      height: '100%',
      width: '450px',
      backgroundColor: colors.dark
    }
});
// Adding new root widget and clear original widget
var mappingPanel = ui.root.widgets().get(0);
ui.root.clear();
// Split the new panel
ui.root.add(ui.SplitPanel(mappingPanel, infoPanel));
Map.setCenter(112.71180642578709,-7.8026539793840985, 8);
// Create visualization panel and graph panel for side panel---------------------------------
var datePanel = ui.Panel({layout: ui.Panel.Layout.flow('horizontal'), 
                            style: {backgroundColor: colors.transparent}});
var visPanel = ui.Panel({style: {backgroundColor: colors.transparent}}); 
var graphPanel = ui.Panel({style: {backgroundColor: colors.transparent}});
// Settings for side panel info--------------------------------------------------------------
// Adding the text for title and sub-title using "ui.label" function
infoPanel.add(ui.Label('Perbedaan Objek Air Keruh dan Air Jernih', TITLE_STYLE));
var app_description = 'Pada umumnya air jernih dan air keruh menunjukkan perbedaan ' + 
'visual yang mencolok pada komposit citra natural color. Air jernih menampilkan '+
'warna biru gelap, sedangkan air keruh menampilkan warna yang berbeda tergantung campuran ' +
'material dan intensitas, contohnya warna cokelat karena partikel tanah yang tersuspensi, warna biru kehijauan karena campuran algae. ' + 
'';
infoPanel.add(ui.Label(app_description, PARAGRAPH_STYLE));
// Add temporal settings--------------------------------------------------------------------
infoPanel.add(datePanel);
infoPanel.insert(2, ui.Label('PENGATURAN TEMPORAL', SUBTITLE_STYLE));
// Add start date
var sDate = ui.Textbox({
  value: '2019-01-01',
  style: {stretch:'horizontal', textAlign: 'center', maxWidth: '200px'}
});
var sDateLabel = ui.Label({
  value: 'Mulai Tanggal: (YYYY-MM-DD)',
  style: LABEL_STYLE
});
// Add end date
var eDate = ui.Textbox({
  value: '2019-12-31',
  style: {stretch:'horizontal', textAlign:'center', maxWidth: '200px'}
});
var eDateLabel = ui.Label({
  value: 'Hingga Tanggal: (YYYY-MM-DD)',
  style: LABEL_STYLE
});
infoPanel.add(sDateLabel).add(sDate);
infoPanel.add(eDateLabel).add(eDate);
// Settings for visualization panel----------------------------------------------------------
infoPanel.add(visPanel);
var visTitle = ui.Label('VISUALISASI CITRA', SUBTITLE_STYLE);
var visText = ui.Label('Menampilkan Komposit citra atau Grayscale (hanya satu band):', LABEL_STYLE);
// Create list of bands for widgets pull from
var band_list = [
    {label: 'B1/Aerosol',     value: 'B1'},
    {label: 'B2/Blue',        value: 'B2'},
    {label: 'B3/Green',       value: 'B3'},
    {label: 'B4/Red',         value: 'B4'},
    {label: 'B5/NIR',         value: 'B5'},
    {label: 'B6/SWIR1',       value: 'B6'},
    {label: 'B7/SWIR2',       value: 'B7'}
  ];
//Each Color's Panel
var redPanel = ui.Panel({style: {backgroundColor: colors.transparent}});
var red_band_label = ui.Label('Red:', LABEL_STYLE);
var U_red_band = ui.Select({items: band_list, style: SELECT_STYLE, placeholder: 'B4/Red', value: 'B4'});
redPanel.add(red_band_label).add(U_red_band);
var greenPanel = ui.Panel({style: {backgroundColor: colors.transparent}});
var green_band_label = ui.Label('Green:', LABEL_STYLE);
var U_green_band = ui.Select({items: band_list, style: SELECT_STYLE, placeholder: 'B3/Green', value: 'B3'});
greenPanel.add(green_band_label).add(U_green_band);
var bluePanel = ui.Panel({style: {backgroundColor: colors.transparent}});
var blue_band_label = ui.Label('Blue:', LABEL_STYLE);
var U_blue_band = ui.Select({items: band_list, style: SELECT_STYLE, placeholder: 'B2/Blue', value: 'B2'});
bluePanel.add(blue_band_label).add(U_blue_band);
var grayPanel = ui.Panel({style: {backgroundColor: colors.transparent}});
var gray_band_label = ui.Label('Grayscale - (satu band)', LABEL_STYLE);
var U_gray_band = ui.Select({items: band_list, style: SELECT_STYLE, placeholder: 'B2/Blue', value: 'B2'});
grayPanel.add(gray_band_label).add(U_gray_band);
// Each Composite Type's Panel
var RGBPanel = ui.Panel({layout: ui.Panel.Layout.flow('horizontal'), style: {backgroundColor: colors.transparent}});
var GrayPanel = ui.Panel({layout: ui.Panel.Layout.flow('horizontal'), style: {backgroundColor: colors.transparent}});
RGBPanel.add(redPanel).add(greenPanel).add(bluePanel);
GrayPanel.add(grayPanel);
//  Description of some composite bands
var comp_desc1 = ui.Label({
  value: 'Beberapa contoh komposit citra yang dapat ditampilkan:', 
  style: {
    fontWeight: '50',
    fontSize  : '14px',
    color     : '#eeeeee',
    padding   : '4px',
    backgroundColor: colors.transparent,
    stretch   : 'horizontal'
  }
});
var comp_desc2 = ui.Label({
  value: 'Natural Color: B4/B3/B2, '+'Infrared Color: B5/B4/B3, '+'Agriculture: B7/B5/B2, '+'Coastal Aerosol: B4/B3/B1', 
  style: {
    fontWeight: '50',
    fontSize  : '14px',
    color     : '#eeeeee',
    padding   : '4px',
    backgroundColor: colors.transparent,
    stretch   : 'vertical'
  }
});
var comp_Panel = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  style : {
    backgroundColor: colors.transparent,
    maxWidth: '200px',
    padding : '1px'
  }
});
// Panel to host the color options
var visColors = ui.Panel({layout: ui.Panel.Layout.flow('horizontal'), style: {backgroundColor: colors.transparent, padding: '4px'}});
// This sets it up for a default RGB panel
visColors.add(RGBPanel);
// Give the user the option to choose RGB or Grayscale
var U_Vis_Selector = ui.Select({
  items: [
    {label: 'RGB', value: 1},
    {label: 'Grayscale', value: 2},
  ],
  placeholder: 'RGB',
  value: 1, 
  style: SELECT_STYLE
});
U_Vis_Selector.onChange(function(x) {
  if (x == 1) {
    visColors.clear();
    visColors.add(RGBPanel);
  }
  else {
    visColors.clear();
    visColors.add(GrayPanel);
  }
});
// Populate our vis panel!
visPanel.add(visTitle).add(visText).add(U_Vis_Selector).add(comp_desc1).add(comp_Panel.add(comp_desc2)).add(visColors);
// Build composite panel from visualization script--------------------------------------------------------------------------------------------
// Make a panel to host the buttons (for layout purposes)
var buttonDesc1 = ui.Label('Tekan tombol bawah ini untuk menampilkan dan menghapus peta:', LABEL_STYLE);
/*var buttonDesc2 = ui.Label({value: 'Catatan: untuk mengatur kontras dan kecerahan citra ' + 
'dapat dilakukan melalui widget Layers > klik ikon ⚙️ > ubah Stretch menjadi 100%', style:{
  fontSize: '12px', fontWeight: '30', textAlign: 'left', color: '#E7615D', backgroundColor: colors.transparent
  }
})*/
var buttonHold = ui.Panel({layout: ui.Panel.Layout.flow('horizontal'), style: {backgroundColor: colors.transparent, 
                            textAlign: 'center', stretch: 'both', padding: '4px'}});
infoPanel.add(buttonDesc1).add(buttonHold);
// Add the run & clear buttons
var runButton = ui.Button({label: 'Tampilkan Komposit Citra', style: {width: '150px', maxWidth: '250px', color: '#5b5b5b'}});
var clearButton = ui.Button({label: 'Bersihkan Peta', style: {width: '150px', maxWidth: '250px', color: '#5b5b5b'}});
buttonHold.add(runButton).add(clearButton);
// Add the clear map onClick button
var clearMap = clearButton.onClick(function() {
  var layers = mappingPanel.layers();
  layers.forEach(function(x) {
    mappingPanel.remove(x) ;
  });
});
// Add the input data----------------------------------------------------------------------------------
// Function for Cloud Masking
function fmask(img) {
  var cloudShadowBitMask = 1 << 4;
  var cloudsBitMask = 1 << 3;
  var qa = img.select('QA_PIXEL');
  var ra = img.select('QA_RADSAT').eq(0);
  var mask = qa.bitwiseAnd(cloudShadowBitMask)
                 .eq(0)
                 .and(qa.bitwiseAnd(cloudsBitMask).eq(0));
  return img.updateMask(mask)
          .updateMask(ra)
          .toFloat();
}
// Calling Landsat 8 collection
var bandsIn = ee.List(['B1','B2','B3','B4','B5','B6','B7']);
var wavelengths =[443,483,560,660,865,1650,2220];
var dataset = ee.ImageCollection('LANDSAT/LC08/C02/T1_TOA');
// Add the run button onClick function for displaying composite image
var buildComposite = runButton.onClick(function() {
  var start = sDate.getValue();
  var end = eDate.getValue();
  //var year = U_year_selector.getValue();  
  var red_band = U_red_band.getValue();
  var green_band = U_green_band.getValue();
  var blue_band = U_blue_band.getValue();
  var gray_band = U_gray_band.getValue();
  var vis_value = U_Vis_Selector.getValue();
  var L8 = dataset.filterDate(start, end);
  var L8_cloud = L8.filter(ee.Filter.lt('CLOUD_COVER',50));
  var L8_proc = L8_cloud.map(fmask).select(bandsIn).median();
  //var L8_startEnd = L8_proc.filter(ee.Filter.calendarRange(start, end, 'month')).median();
  var composite = ee.Image.cat([L8_proc]);
  // Calculate the stretch value for visualization based on percentile
  var lower_percentile = ee.Number(100).subtract(98).divide(2);
  var upper_percentile = ee.Number(100).subtract(lower_percentile);
  var min = composite.reduceRegion({
    reducer: ee.Reducer.percentile([lower_percentile]),
    geometry: geom,
    scale: 30,
    maxPixels: 1e9
  });
  var max = composite.reduceRegion({
    reducer: ee.Reducer.percentile([upper_percentile]),
    geometry: geom,
    scale: 30,
    maxPixels: 1e9
  });
  // cast to numbers
  var maxRed = max.get(red_band).getInfo();
  var minRed = min.get(red_band).getInfo();
  var maxGreen = max.get(green_band).getInfo();
  var minGreen = min.get(green_band).getInfo();
  var maxBlue = max.get(blue_band).getInfo();
  var minBlue = min.get(blue_band).getInfo();
  var maxGray = max.get(gray_band).getInfo();
  var minGray = min.get(gray_band).getInfo();
  if (vis_value == 1) {
    var comp = ui.Map.Layer(composite, {min   : [minRed, minGreen, minBlue], 
                                        max   : [maxRed ,maxGreen ,maxBlue], 
                                        bands : [red_band, green_band, blue_band]}, 'Komposit RGB');
    mappingPanel.add(comp);
  }
  else {
    var comp1 = ui.Map.Layer(composite, {min: minGray, max: maxGray, bands: gray_band}, 'Gray band');
    mappingPanel.add(comp1);
  }
});
// We made the graphPanel above!
infoPanel.add(graphPanel);
var chartOnly = ui.Panel();
var displayGraph = ui.Button({label: 'Menampilkan Grafik', style: BUTTON_STYLE});
var graphTitle = ui.Label('POLA GRAFIK SPEKTRAL AIR JERNIH DAN AIR KERUH', SUBTITLE_STYLE);
// Populating the graph panel
graphPanel.add(graphTitle).add(chartOnly).add(displayGraph);
displayGraph.onClick(function(){
  chartOnly.clear();
  var center_point = mappingPanel.getCenter();
  // Menggabungkan fitur objek yang telah dibuat.
  var points = ee.FeatureCollection([AirJernihLaut,AirJernihDanau,AirKeruhWaduk,AirKeruhMuara1,AirKeruhMuara2]);
  // Mendefinisikan pengaturan visualisasi grafik.
  var options = {
  title: 'Karakteristik Pantulan Spektral Air Jernih dan Air Keruh ', // Judul grafik
  hAxis: {title: 'Panjang Gelombang (nm)'}, // Penamaan pada sumbu x
  vAxis: {title: 'Nilai Pantulan Spektral'}, // Penamaan pada sumbu y
  curveType: 'function',
  lineWidth: 2.5,
  //pointSize: 4,
  // Mendefinisikan warna garis dalam grafik setiap objek
  series: {
  0: {color: '0318d6'}, // untuk objek air jernih laut
  1: {color: '5a72ff'}, // untuk objek air jernih danau
  2: {color: '33d678'}, // untuk objek air keruh waduk
  3: {color: 'ffcc77'}, // untuk objek air keruh muara sungai
  4: {color: '19fbf6'} // untuk objek air keruh muara
  }};
  // Add dataset
  var start = sDate.getValue();
  var end = eDate.getValue();
  //var year = U_year_selector.getValue();
  var L8 = dataset.filterDate(start, end);
  var L8_cloud = L8.filter(ee.Filter.lt('CLOUD_COVER',50));
  var L8_proc = L8_cloud.map(fmask).select(bandsIn).median();
  //var L8_startEnd = L8_proc.filter(ee.Filter.calendarRange(start, end, 'month')).median();
  // Create the chart and set options.
  var spectraChart = ui.Chart.image.regions(
  L8_proc, points, ee.Reducer.mean(), 30, 'label', wavelengths)
  .setChartType('LineChart')
  .setOptions(options);
  chartOnly.add(spectraChart);
});
infoPanel.add(ui.Label());