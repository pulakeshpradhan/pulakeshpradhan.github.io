var cartas = ee.FeatureCollection("users/jonasjunnior/Bacia_Paraguai"),
    flem = /* color: #d63000 */ee.Geometry.MultiPolygon(
        [[[[-62.80712821234874, -19.881185501547368],
           [-63.20263602484874, -21.361799170250393],
           [-63.208815834419056, -21.4055964627534],
           [-63.20263602484874, -21.407833928491137],
           [-63.18718650092296, -21.402400023711206],
           [-63.16830374945812, -21.404637538380168],
           [-63.1617806171339, -21.40719465606139],
           [-63.16075064887218, -21.417103064447705],
           [-63.1617806171339, -21.419340353984147],
           [-63.153884193794056, -21.425093226850493],
           [-63.141181251899525, -21.43116545787435],
           [-63.13259818305187, -21.431485041984327],
           [-63.12710501898937, -21.43468084459862],
           [-63.123671791450306, -21.440752676765015],
           [-63.12229850043468, -21.451617429943536],
           [-63.11955191840343, -21.45513232385446],
           [-62.65369391321116, -19.819269737162244]]],
         [[[-63.74674132081793, -23.32447542545501],
           [-63.7450247070484, -23.32762804307211],
           [-63.730948474138245, -23.328889069174096],
           [-63.72030546876715, -23.3329873213404],
           [-63.71481230470465, -23.33424829656969],
           [-63.70313933107184, -23.342444343736137],
           [-63.69043638917731, -23.352846290389774],
           [-63.68013670656012, -23.356943803114174],
           [-63.67258360597418, -23.355367851656148],
           [-63.6571340820484, -23.36230189804595],
           [-63.64575406983079, -23.35232235503236],
           [-63.125419377078344, -21.481661186588475],
           [-63.130912541140844, -21.47527157080274],
           [-63.13777899621897, -21.46856217250713],
           [-63.140868901004126, -21.45450338371131],
           [-63.144645451297094, -21.450349391158156],
           [-63.149108647097876, -21.445556175785008],
           [-63.15528845666819, -21.4426801709504],
           [-63.16078162073069, -21.442360611357525],
           [-63.168334721316626, -21.436608418994172],
           [-63.17554449914866, -21.430536414393195],
           [-63.185844181765844, -21.42670133397344],
           [-63.1944272506135, -21.416473960384938],
           [-63.20575690149241, -21.411679632489303],
           [-63.210906742801, -21.41327775926902]]],
         [[[-64.04480553090525, -24.360462616909043],
           [-64.08899413359018, -24.50143919704528],
           [-64.05088530790658, -24.52580456782392],
           [-64.03680907499643, -24.509561512282346],
           [-64.01277648222299, -24.504563226558332],
           [-63.994923699019864, -24.512060580599332],
           [-63.99629699003549, -24.581077678454875],
           [-64.04161559355111, -24.66596961303066],
           [-64.13225280058236, -24.729600691675962],
           [-64.15010558378549, -24.71976755994466],
           [-64.18993102323861, -24.716337030505535],
           [-64.2112170339808, -24.721326860250137],
           [-64.22254668485971, -24.706044874945846],
           [-64.2218600393519, -24.69637571149552],
           [-64.2167101980433, -24.68857745238654],
           [-64.20332061064096, -24.688265511871933],
           [-64.19645415556283, -24.698871051335377],
           [-64.15525542509408, -24.68296240367886],
           [-64.15662871610971, -24.615562104063812],
           [-64.20332061064096, -24.618059060056613],
           [-64.65340212627893, -23.01708316648293],
           [-64.75777224346643, -22.57143871833104],
           [-64.82369021221643, -22.596798368682396],
           [-64.23592165752893, -24.625076270135594],
           [-64.15352419659143, -25.14332437663596],
           [-63.663132595320576, -23.37754624772796],
           [-63.67308895518386, -23.377231107897597],
           [-63.677895473738545, -23.37817652514086],
           [-63.683388637801045, -23.380697604820185],
           [-63.69094173838698, -23.380067339396312],
           [-63.705361294051045, -23.369352368646634],
           [-63.71840755869948, -23.36147316122455],
           [-63.731797146101826, -23.35737578838406],
           [-63.74484341075026, -23.357690975403145],
           [-63.75548641612136, -23.355484650545467]]],
         [[[-63.28507481300335, -22.42979672123249],
           [-63.06534825050335, -23.270093128372697],
           [-62.23038731300335, -23.07819563606861],
           [-62.24137364112835, -23.0478709175169],
           [-63.0461221762846, -23.244859189282476],
           [-63.26310215675335, -22.409484860663568]]],
         [[[-62.84562168800335, -22.056157770400908],
           [-62.9747110434721, -22.52883793365343],
           [-62.94449864112835, -22.556741911021668],
           [-62.82364903175335, -22.066339711130404]]],
         [[[-63.34680164028481, -24.037663986439266],
           [-63.259255619234295, -23.68763234418401],
           [-63.264748783296795, -23.686374747794932],
           [-63.271271915621014, -23.687317946222006],
           [-63.27985498446867, -23.72409736974077],
           [-63.357765115429174, -24.000245562251976],
           [-63.371498025585424, -24.025334342987996]]],
         [[[-63.23624702690938, -23.629854589993418],
           [-62.51664253472188, -23.459894928978947],
           [-62.51664253472188, -23.446036694954852],
           [-63.24174019097188, -23.622305496106502],
           [-63.21976753472188, -23.553085210847286],
           [-63.23624702690938, -23.549308509199676],
           [-63.255976044224326, -23.624351343932137],
           [-63.266962372349326, -23.628440426596867],
           [-63.27279885916573, -23.63347296846382],
           [-63.26043924002511, -23.636303688267624],
           [-63.26318582205636, -23.65360120143264],
           [-63.25734933523995, -23.657689370425906],
           [-63.25940927176339, -23.66712311883186],
           [-63.25563272147042, -23.674355198285596]]],
         [[[-62.53812867534623, -21.049008738939627],
           [-62.08768922222123, -19.38409963444115],
           [-62.17557984722123, -19.389281334955534],
           [-62.60404664409623, -21.05006154674608]]],
         [[[-59.806764410469725, -16.230061514890615],
           [-60.163820074532225, -17.664526735575944],
           [-61.95339670812268, -24.210976015575202],
           [-62.17861643468518, -24.990119052633688],
           [-62.06875315343518, -24.970201849073288],
           [-61.88747873937268, -24.376198378149606],
           [-60.768301638059995, -20.410619657922055],
           [-60.113295600001095, -17.936780511563743],
           [-59.679335639063595, -16.244136145189067]]],
         [[[-59.360732123438595, -16.323228240019613],
           [-59.87847119754366, -18.43317695779721],
           [-59.82353955691866, -18.43317695779721],
           [-59.311887027141836, -16.339729379295292]]],
         [[[-60.09627727829786, -17.168629557184783],
           [-59.19539837204786, -17.399414345145154],
           [-59.16793255173536, -17.331258059962963],
           [-60.11275677048536, -17.095137568306804]]],
         [[[-60.16768841111036, -17.31552608895324],
           [-59.25033001267286, -17.55136364086982],
           [-59.20089153611036, -17.514697847846442],
           [-60.10177044236036, -17.263076464677585]]],
         [[[-60.19515423142286, -17.504220546061113],
           [-59.27779583298536, -17.755508284452983],
           [-59.23934368454786, -17.67178464724635],
           [-60.14022259079786, -17.45706521467181]]],
         [[[-60.77742962204786, -19.63381265359064],
           [-59.81612591111036, -19.897458264616166],
           [-59.79964641892286, -19.835463261653405],
           [-60.71700481736036, -19.597592057722103]]],
         [[[-60.88729290329786, -19.964592128260428],
           [-59.93697552048536, -20.217377760655655],
           [-59.89852337204786, -20.165822021103843],
           [-60.80489544236036, -19.897458264616166]]],
         [[[-60.84884075486036, -22.088113600863885],
           [-60.44783977829786, -21.965900771580102],
           [-60.45333294236036, -21.920043805316116],
           [-60.87630657517286, -22.03720440720297]]],
         [[[-61.17293743454786, -23.434432580191707],
           [-61.21688274704786, -23.595616087602554],
           [-61.15096477829786, -23.600649890073345],
           [-61.10701946579786, -23.454591301515556]]],
         [[[-60.326035901359035, -25.65747393765757],
           [-60.216172620109035, -25.716877497482944],
           [-59.318282590281115, -22.578369600048735],
           [-59.32995556391393, -22.57393140452729],
           [-59.34231518305455, -22.583441648462024],
           [-59.35467480219518, -22.573297364927715],
           [-59.381453976999865, -22.58217365386435],
           [-59.39862011469518, -22.573297364927715],
           [-59.38282726801549, -22.568859006063956],
           [-59.378707394968615, -22.55744542714681],
           [-59.39106701410924, -22.551104141820232],
           [-59.408919797312365, -22.559347755901527],
           [-59.403426633249865, -22.56695680851875],
           [-59.419906125437365, -22.57266332241133],
           [-59.46522472895299, -22.740582363167345]]],
         [[[-59.41181202439759, -22.535414129545195],
           [-59.38709278611634, -22.543024502128805],
           [-59.37061329392884, -22.529071831962447],
           [-59.363746838850716, -22.549366158776603],
           [-59.330787854475716, -22.556975762051508],
           [-59.317054944319466, -22.556975762051508],
           [-59.32392139939759, -22.546829531086313],
           [-59.31568165330384, -22.534145693330224],
           [-59.30469532517884, -22.53795096701916],
           [-59.208841193057765, -22.190245680257338],
           [-59.21193109784292, -22.188656198670877],
           [-59.215364325381984, -22.19215303441968],
           [-59.22291742596792, -22.189291993463698],
           [-59.22669397626089, -22.19056357441635],
           [-59.23115717206167, -22.19501401709759],
           [-59.227037299014796, -22.198510694552184],
           [-59.23047052655386, -22.202007284929678],
           [-59.24111353192495, -22.198510694552184],
           [-59.240770209171046, -22.189609889781],
           [-59.23150049481558, -22.19056357441635],
           [-59.226350653506984, -22.18420555455287],
           [-59.21364771161245, -22.182298092487127],
           [-59.20678125653433, -22.182298092487127],
           [-58.56770443335398, -19.89084094264605],
           [-57.96857040623257, -17.586913384387394],
           [-57.98367660740445, -17.579058595821877],
           [-57.991229707990385, -17.568585013712685],
           [-58.007709200177885, -17.566621149569208],
           [-58.007512064045386, -17.56081983300812],
           [-58.00373551375242, -17.562620100318096],
           [-57.99892899519773, -17.56327473853762],
           [-57.99789902693601, -17.565238638991566],
           [-57.99515244490476, -17.56442034972523],
           [-57.99360749251218, -17.562783760094927],
           [-57.990345926350074, -17.56392937438976],
           [-57.989315958088355, -17.56703886235535],
           [-57.98450943953367, -17.56883906781238],
           [-57.98742768294187, -17.571621168293426],
           [-57.9836511326489, -17.57767618028054],
           [-57.98124787337156, -17.57554876673188],
           [-57.97489640242429, -17.578167118315175],
           [-57.97987458235593, -17.579639924423038],
           [-57.97438141829343, -17.582421858788816],
           [-57.97163483626218, -17.581112718536254],
           [-57.967343301838355, -17.58258550065393],
           [-57.96476838118406, -17.572603075896954],
           [-57.966828317707495, -17.570966560263923],
           [-57.96476838118406, -17.56982099051362],
           [-57.96305176741453, -17.56491132372895],
           [-57.97026154524656, -17.562783760094927],
           [-57.97094819075437, -17.56442034972523],
           [-57.974553079670386, -17.56491132372895],
           [-57.97249314314695, -17.562620100318096],
           [-57.97678467757078, -17.562129120099893],
           [-57.98090455061765, -17.566875206425834],
           [-57.978844614094214, -17.5673661737704],
           [-57.976098032062964, -17.5673661737704],
           [-57.9752397251782, -17.571457516508072],
           [-57.97678467757078, -17.5721121227613],
           [-57.978329629963355, -17.568511759061263],
           [-57.98176285750242, -17.569330029829032],
           [-57.98244950301023, -17.566711550348348],
           [-57.98038956648679, -17.56327473853762],
           [-57.98193451887937, -17.56327473853762],
           [-57.98399445540281, -17.559183210828515],
           [-57.98674103743406, -17.561474477737598],
           [-57.98897263533445, -17.561310816777144],
           [-57.988285989826636, -17.5593468737122],
           [-57.99068924910398, -17.556728249822232],
           [-57.99086091048093, -17.55394592044936],
           [-57.987599344318824, -17.557873902433677],
           [-57.98674103743406, -17.5593468737122],
           [-57.98468110091062, -17.557710238218654],
           [-57.98176285750242, -17.558692221289913],
           [-57.98124787337156, -17.56081983300812],
           [-57.97918793684812, -17.561474477737598],
           [-57.976613016193824, -17.558364894191204],
           [-57.97970292097898, -17.557219244686074],
           [-57.98176285750242, -17.557219244686074],
           [-57.98262116438718, -17.555091590661874],
           [-57.98742768294187, -17.548872150976038],
           [-57.987599344318824, -17.547726441428782],
           [-57.99120423323484, -17.54952683889309],
           [-57.992577524250464, -17.548217460693294],
           [-57.995839090412574, -17.549363167135606],
           [-57.99738404280515, -17.551163548335232],
           [-57.99635407454343, -17.555091590661874],
           [-57.99875733382078, -17.553618584771883],
           [-58.00116059309812, -17.553127580146455],
           [-58.00184723860593, -17.555746256100896],
           [-58.00150391585203, -17.558692221289913],
           [-58.00545212752195, -17.55689191492477],
           [-58.008027048176245, -17.554273255535282],
           [-58.00974366194578, -17.55034519546251],
           [-58.005795450275855, -17.551327218466177],
           [-58.003563852375464, -17.55394592044936],
           [-58.0027055454907, -17.550836207629754],
           [-57.99892899519773, -17.550672537055206],
           [-57.99892899519773, -17.548708478627127],
           [-58.00287720686765, -17.544780297899628],
           [-58.003048868244605, -17.547071747006243],
           [-58.00613877302976, -17.54412559283298],
           [-58.008027048176245, -17.543470885401195],
           [-58.01643845564695, -17.538396822620186],
           [-58.017811746662574, -17.532013122568248],
           [-58.02742478377195, -17.530539929104968],
           [-58.032746286457495, -17.527266123015238],
           [-58.03411957747312, -17.53004886195817],
           [-58.036522836750464, -17.5282482710459],
           [-58.041501016682105, -17.532504184396863],
           [-58.043732614582495, -17.53397736190484],
           [-58.0466508579907, -17.543143530798407],
           [-58.04905411726804, -17.543798239412737],
           [-58.04939744002195, -17.547071747006243],
           [-58.04579255110593, -17.55034519546251],
           [-58.04630753523679, -17.55263657419006],
           [-58.04853913313718, -17.55263657419006],
           [-58.050770731037574, -17.54952683889309],
           [-58.05162903792234, -17.546908073030995],
           [-58.050255746906714, -17.541179390765553],
           [-58.04562088972898, -17.531849434996577],
           [-58.04544922835203, -17.527102431159854],
           [-58.042016000812964, -17.529230413759183],
           [-58.038239450519995, -17.525465504482828],
           [-58.031544656818824, -17.52644766226133],
           [-58.027768106525855, -17.5282482710459],
           [-58.029484720295386, -17.523664868080594],
           [-58.033776254719214, -17.522191606824645],
           [-58.03446290022703, -17.517116948732465],
           [-58.03635117537351, -17.51351549240715],
           [-58.03841111189695, -17.518753950715972],
           [-58.045277566975074, -17.51597103856036],
           [-58.049225778644995, -17.52022723987835],
           [-58.05712220198484, -17.522027910391227]]],
         [[[-57.74772813035463, -16.736667757559772],
           [-57.75081803513979, -16.73305115367455],
           [-57.75253464890932, -16.727954913527775],
           [-57.74944474412416, -16.73107843171706],
           [-57.74978806687807, -16.724666944355164],
           [-57.75098969651674, -16.7213789184854],
           [-57.75304963304018, -16.721050112780443],
           [-57.76043107224916, -16.71430947092078],
           [-57.763349315657365, -16.71398065303046],
           [-57.7679841728351, -16.710199206566088],
           [-57.767125865950334, -16.70444468775759],
           [-57.76592423631166, -16.703293763180262],
           [-57.76643922044252, -16.70839066220525],
           [-57.76352097703432, -16.712665375802718],
           [-57.763864299788224, -16.707239761417036],
           [-57.76128937913393, -16.70378701742007],
           [-57.75974442674135, -16.69885441768501],
           [-57.76180436326479, -16.695072671611968],
           [-57.76455094529604, -16.694414969000157],
           [-57.824855029074286, -16.897173639691513],
           [-57.82622832008991, -17.056100828331633]]],
         [[[-57.08772667119729, -14.145671829223396],
           [-57.12892540166604, -14.145671829223396],
           [-57.47457207684312, -15.583818399792891],
           [-57.46770562176499, -15.604982217039044],
           [-57.48693169598374, -15.608950189803586],
           [-57.50320536568199, -15.6480914981677],
           [-57.53616435005699, -15.907115314384898]]],
         [[[-56.91609460917118, -14.770046616813698],
           [-57.30061609354618, -16.378592935201052],
           [-57.25941736307743, -16.336426394095714],
           [-56.891783545748126, -14.769651929000664]]],
         [[[-57.312694046695526, -16.427815072415946],
           [-57.389598343570526, -16.760786505150023],
           [-57.375865433414276, -16.755526633988914],
           [-57.362132523258026, -16.75815658774466],
           [-57.3168139197424, -16.72264914703546],
           [-57.222056839664276, -16.33295148964889],
           [-57.244029495914276, -16.315818428015938],
           [-57.30857417364865, -16.409372993443206]]],
         [[[-57.30857417364865, -16.42913229682605],
           [-57.7507738806799, -16.33031573169032],
           [-57.752147171695526, -16.339540729082724],
           [-57.31406733771115, -16.4423040497049]]],
         [[[-57.790599320133026, -16.322408244675078],
           [-58.095469925601776, -16.248589639058853],
           [-58.089976761539276, -16.260455216563255],
           [-57.78647944708615, -16.328997839388233]]],
         [[[-57.789438792557235, -16.91510988861196],
           [-57.789438792557235, -16.924306811295985],
           [-57.60404450544786, -16.96765767870417],
           [-57.60953766951036, -16.958462875483082]]],
         [[[-59.52136684810364, -25.02086621032877],
           [-59.63123012935364, -25.3638420821721],
           [-59.603530842425755, -25.541847130117795],
           [-57.3454529395724, -16.83177918171548],
           [-57.33721319347865, -16.795628141857534],
           [-57.34785619884974, -16.797928867872955],
           [-57.34991613537318, -16.8002295659993],
           [-57.35403600842005, -16.809432079546657],
           [-57.360971995682235, -16.809970367978504],
           [-57.35135895857286, -16.794194401979585],
           [-57.33762604841661, -16.791564946815914],
           [-57.319773265213485, -16.72318634585594],
           [-57.341745921463485, -16.737653098362443],
           [-57.352732249588485, -16.758693686438022],
           [-57.369211741775985, -16.762638537776315],
           [-57.388437815994735, -16.769213108203633]]],
         [[[-55.09399932862652, -14.148354366598383],
           [-56.67995479506283, -20.196283296537782],
           [-58.72341182631283, -27.31912891958373],
           [-58.60256221693783, -27.32888944771756],
           [-55.13088252943783, -14.568761140027657],
           [-55.14186885756283, -14.387924972290559]]],
         [[[-55.2130703377245, -16.146404899920828],
           [-57.64807591344578, -25.69142007729123],
           [-57.50525364782078, -25.513082635101366],
           [-55.131775908807754, -16.161788353268086]]],
         [[[-53.687591661302804, -16.757571607168043],
           [-54.676361192552804, -20.411924812081146],
           [-54.555511583177804, -20.308925528547103],
           [-53.709564317552804, -17.072901684731747]]],
         [[[-53.412933458177804, -17.272336069617936],
           [-54.028167833177804, -19.668810656650322],
           [-53.885345567552804, -19.53426520169278],
           [-53.336029161302804, -17.324783055211576]]],
         [[[-55.559974470787495, -23.57683339355607],
           [-56.559730330162495, -26.983528114816426],
           [-56.471839705162495, -26.954153312142918],
           [-55.483070173912495, -23.63723491910357]]],
         [[[-55.175452986412495, -24.019128815381215],
           [-55.362220564537495, -24.948965692530383],
           [-55.197425642662495, -24.829374235699753],
           [-54.999671736412495, -24.009093406085203]]],
         [[[-58.78966498723116, -18.92692841929214],
           [-57.99864936223116, -19.1035043925008],
           [-57.88329291691866, -19.098313661616153],
           [-58.77867865910616, -18.890551305744392]]],
         [[[-58.155359560003205, -20.114207994738006],
           [-58.15947943305008, -20.092284404617466],
           [-58.259729677190705, -20.441404869796596],
           [-58.235010438909455, -20.445265265338545]]],
         [[[-56.136300672599646, -16.827242187642376],
           [-56.125314344474646, -16.820669626685955],
           [-56.17337953002152, -16.808838442614025]]],
         [[[-56.169259656974646, -16.807523821038384],
           [-56.182992567130896, -16.81541141380186],
           [-56.158273328849646, -16.821984157114787],
           [-56.15140687377152, -16.810153055077812]]],
         [[[-56.10196839720902, -16.824613190617377],
           [-56.103341688224646, -16.83381452058243],
           [-55.411203016349646, -16.991481902184045],
           [-55.40982972533402, -16.978347998263207]]],
         [[[-55.70371400267777, -16.707585967891195],
           [-55.463388074943396, -16.764136201410984],
           [-55.45377503783402, -16.758876422857604],
           [-55.69272767455277, -16.69706314378806]]],
         [[[-55.78611146361527, -17.040069343228797],
           [-55.12693177611527, -17.198875085410112],
           [-55.120065321037146, -17.188379722620983],
           [-55.776498426505896, -17.033504209891415]]],
         [[[-57.479147086581065, -17.347445586494846],
           [-57.157796988924815, -17.428698756704545],
           [-57.14269078775294, -17.419526819645615],
           [-57.468160758456065, -17.340891340385713]]],
         [[[-57.32121861978419, -17.026013631471443],
           [-57.31572545572169, -17.041770195359348],
           [-57.064413199862315, -17.094282477019913],
           [-57.064413199862315, -17.081155792237947]]],
         [[[-59.967145180303135, -24.842298571494695],
           [-59.200848793584385, -25.034066911706525],
           [-59.200848793584385, -25.011667844985453],
           [-59.964398598271885, -24.824850303033912]]],
         [[[-60.090741371709385, -25.17086115354757],
           [-59.382123207646885, -25.339776565639113],
           [-59.324444984990635, -25.332329372230543],
           [-60.071515297490635, -25.158431639399403]]]]),
    landsat_water = ee.ImageCollection("users/wwfrioparaguai/bap_swsc_1990_2018"),
    sentinel_col = ee.ImageCollection("users/wwfrioparaguai/s1_bap_water_vii"),
    check_col = ee.ImageCollection("users/wwfrioparaguai/check_sedi_green_col"),
    rgb = ee.Image("users/wwfrioparaguai/rgb_max2end-min-freq_bap");
rgb = rgb.set("system:index", "rgb_max2end-min-freq_bap");
var functions_last_first = require("users/jonasjunnior/Pantanal:last_first");
var legendyze = require('users/frederickirchhoff/shortcuts:legendyze_background_position');
var six_classes = require('users/wwfrioparaguai/amz:six_classes').classification;
//Sentinel Correction 
var freq = sentinel_col.reduce(ee.Reducer.sum()).clip(cartas);
freq = freq.where(freq.eq(1), 0).selfMask();
var spec_freq = freq.clip(flem);
var correct = function (img) {
  var img_correct = img
    .where(freq.eq(1), 0)
    .where(spec_freq.lt(12), 0)
    .selfMask();
  return img_correct.clip(cartas);
};
var water_iii = sentinel_col.map(correct);
var water = landsat_water;
water = water.map(function(i){
  var year = i.get("year");
  var month = i.get("month");
  var date = ee.Date.fromYMD(year, month, 1);
  return i.set('system:time_start', date);
});
water_iii = water_iii.map(function(i){
  var year = i.get("year");
  var month = i.get("month");
  var date = ee.Date.fromYMD(year, month, 1);
  return i.set('system:time_start', date);
});
var geometry = cartas.geometry();
var contour = ee.Image(0).mask(0).paint(geometry,'ffffff' ,2);
var visParams = {
  min: 0,
  max: 2500,
  palette : ['blue']
};
var months_list = { "Janeiro" : 1, "Fevereiro" : 2, "Março" : 3, "Abril" : 4,
                    "Maio" : 5, "Junho" : 6, "Julho" : 7, "Agosto": 8,
                    "Setembro": 9, "Outubro": 10, "Novembro" : 11, "Dezembro": 12};
var landsat_years_dict = {"1990": 1990, "1991": 1991, "1992": 1992, "1993": 1993, "1994": 1994, "1995": 1995, 
                  "1996": 1996, "1997": 1997, "1998": 1998, "1999": 1999, "2000": 2000, "2001": 2001,
                  "2002": 2002, "2003": 2003, "2004": 2004, "2005": 2005, "2006": 2006, "2007": 2007,
                  "2008": 2008, "2009": 2009, "2010": 2010, "2011": 2011, "2012": 2012, "2013": 2013,
                  "2014": 2014, "2015": 2015, "2016": 2016, "2017": 2017, "2018": 2018};
var s1_years_dict = {"2017": 2017, "2018": 2018};
var layers, index, date_t0, date_t1;
var selector, selector_2, period_selector, period_selector_2;
var image, freq_legend, freq_first_legend, freq_last_legend;
var comp = "_";
//-------------------------------Mapas-----------------------------------//
var map = ui.Map();
map.addLayer(contour, {}, "Bacia do Alto Paraguai");
map.centerObject(geometry);
var second_map = ui.Map();
second_map.centerObject(geometry);
second_map.addLayer(contour, {}, "Bacia do Alto Paraguai");
//-------------------------------Painel de opções-----------------------------------//
//-------------------------------Map Labels-----------------------------------------//
var map_label = ui.Label({
  value: "Landsat",
  style:{
    textAlign : "center",
    margin: 'auto',
    fontWeight: "bold",
    fontSize: '15px',
  }
});
var map_panel = ui.Panel({
  widgets : [map_label],
  layout: ui.Panel.Layout.absolute(),
  style: {
    position: "middle-left",
    shown: false,
    width: "80px",
    height: "50px"
  }
});
map.add(map_panel)
var second_map_label = ui.Label({
  value: "Sentinel",
  style:{
    textAlign : "center",
    margin: 'auto',
    fontWeight: "bold",
    fontSize: '15px',
  }
})
var second_map_panel = ui.Panel({
  widgets : [second_map_label],
  layout: ui.Panel.Layout.absolute(),
  style: {
    position: "middle-right",
    width: "80px",
    height: "50px"
  }
})
second_map.add(second_map_panel)
//-------------------------------Componentes de controle do primeiro mapa-----------------------------------------//
var project_label = ui.Label({
  value: "Bacia do Alto Paraguai - BAP",
  style:{
    textAlign : "center",
    margin: '30px auto',
    fontWeight: "bold",
    fontSize: '25px',
    width: '800px',
    height: '35px',
  }
});
var ls_label = ui.Label({
  value: "Landsat",
  style:{
    textAlign : "center",
    margin: '30px 0px 0px 75px',
    fontSize: '15px',
  }
});
var s1_label = ui.Label({
  value: "Sentinel 1",
  style:{
    textAlign : "center",
    fontSize: '15px',
    margin: '30px 0px 0px 75px'
  }
});
var ls_ck_box = ui.Checkbox({
  label: "Ativar",
  value: true,
  style:{
    textAlign : "center",
    margin: 'auto',
  },
  disabled: true
});
var s1_ck_box = ui.Checkbox({
  label: "Ativar",
  value: false,
  style:{
    textAlign : "center",
    margin: 'auto',
  }
});
var ls_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [ls_label, ls_ck_box],
  style: {textAlign : 'center',
    height: "100px",
    width: "200px",
    backgroundColor: "FFFFFF"
  }
});
var s1_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [s1_label, s1_ck_box],
  style: {textAlign : 'center',
    height: "100px",
    width: "200px",
    backgroundColor: "FFFFFF",
    margin: "-100px 0px 0px 200px"
  }
});
var map1_label = ui.Label({
  value: "Mapa 1",
  style:{
    textAlign : "center",
    margin: 'auto',
    fontWeight: "bold",
    fontSize: '15px',
    width: '800px'
  }
});
var meses_select = ui.Select({
      items : Object.keys(months_list),
      placeholder: "Escolha o mês",
      style : {
        margin: '5px auto',
        width: "150px"
      }
});
var months_label = ui.Label({
  value: "Mês",
  style:{
    textAlign : "center",
    margin: '0 auto'
  }
});
var meses_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [months_label, meses_select],
  style: {textAlign : 'center',
    width: "200px",
    backgroundColor: "FFFFFF",
    margin: "-58px 0px 0px 200px"
  }
});
var years_select = ui.Select({
      items : Object.keys(landsat_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: '5px auto',
        width: "150px"
      }
});
var years_select_s1 = ui.Select({
      items : Object.keys(s1_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: '5px auto',
        width: "150px"
      }
});
var years_label = ui.Label({
  value: "Ano",
  style:{
    textAlign : "center",
    margin: '0 auto'
  }
});
var years_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [years_label, years_select],
  style: {textAlign : 'center',
    width: "200px",
    backgroundColor: "FFFFFF",
  }
});
var sed_ck_box = ui.Checkbox({
  label: "Verificar",
  value: false,
  disabled: true,
  style:{
    textAlign : "center",
    margin: '0 auto',
  }
});
var sed_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [sed_ck_box],
  style: {textAlign : 'center',
    width: "400px",
    margin: "20px 0 0 0",
    backgroundColor: "FFFFFF"
  }
});
var export_label = ui.Label({
  value: "Exportar imagem",
  style:{
    textAlign : "center",
    margin: '0 auto',
    fontWeight: "bold"
  }
});
var export_ck_box = ui.Checkbox({
  label: "Ativar",
  value: false,
  disabled: false,
  style: {
    textAlign : "center",
    margin: '5px auto'
  }
});
var export_panel = ui.Panel({
  widgets : [export_label, export_ck_box],
  layout: ui.Panel.Layout.flow('vertical'),
  style: {
    width: "265px",
    margin: "30px auto",
    textAlign: "center"
  }
});
var rgb_label = ui.Label({
  value: "Imagem RGB",
  style:{
    textAlign : "center",
    margin: '0 auto',
    fontWeight: "bold"
  }
});
var rgb_ck_box = ui.Checkbox({
  label: "Ativar",
  value: false,
  disabled: false,
  style: {
    textAlign : "center",
    margin: '5px auto'
  }
});
var rgb_panel = ui.Panel({
  widgets : [rgb_label, rgb_ck_box],
  layout: ui.Panel.Layout.flow('vertical'),
  style: {
    width: "265px",
    margin: "30px auto",
    textAlign: "center"
  }
});
var split_label = ui.Label({
  value: "Visualizar épocas lado a lado",
  style:{
    textAlign : "center",
    margin: 'auto',
    fontWeight : 'bold',
  }
});
var split_map = ui.Checkbox({
  label: "Ativar",
  style:{
    textAlign : "center",
    margin: '5px auto',
  }
});
var split_panel = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets : [split_label, split_map],
  style: {textAlign : 'center',
    width: "265px",
    backgroundColor: "FFFFFF",
    margin: "30px 0px 0px 0px"
  }
});
var middle_panel = ui.Panel({
  widgets : [export_panel ,rgb_panel, split_panel],
  layout: ui.Panel.Layout.flow("horizontal"),
  style: {
    width: "800px",
    margin: "30px auto"
  }
});
var select_period = ui.Checkbox({
  label: "Período",
  value: false,
  style:{
    textAlign : "center",
    margin: "0px 0px 0px 0px"
  },
  disabled: true
});
var period_months_label = ui.Label({
  value: "Mês",
  style:{
    textAlign : "center",
    margin: "0px 0px 20px 280px"
  }
});
var period_months_select = ui.Select({
      items : Object.keys(months_list),
      placeholder: "Escolha o mês",
      style : {
        margin: "0px 0px 20px 223px",
        width: "150px"
      },
      disabled: true
});
var period_years_label = ui.Label({
  value: "Ano",
  style:{
    textAlign : "center",
    margin: "-85px 0px 20px 85px"
  }
});
var period_years_select = ui.Select({
      items : Object.keys(landsat_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: "0px 0px 20px 25px",
        width: "150px"
      },
      disabled: true
});
var period_years_select_s1 = ui.Select({
      items : Object.keys(s1_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: "0px 0px 20px 25px",
        width: "150px"
      },
      disabled: true
});
var freq_ck_box = ui.Checkbox({
  label: "Frequência do período",
  value: false,
  style:{
    textAlign : "center",
    margin: 'auto',
  },
  disabled: true
});
var first_ck_box = ui.Checkbox({
  label: "Primeira Ocorrência",
  value: false,
  style:{
    textAlign : "center",
    margin: "20px 0px 0px 25px",
  },
  disabled: true
});
var last_ck_box = ui.Checkbox({
  label: "Ultima Ocorrência",
  value: false,
  style:{
    textAlign : "center",
    margin: "-18px 0px 10px 223px",
  },
  disabled: true
});
var period_choices = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  widgets: [period_months_label, period_months_select, 
            period_years_label, period_years_select, freq_ck_box, first_ck_box, last_ck_box],
  style: {
    color: "grey",
  }
});
var period_panel = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  widgets: [select_period, period_choices],
  style : {
    width: "400px",
    margin: "-161px 0px 0px 400px",
  }
});
var painel_mapa_1 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets : [project_label, map1_label, ls_panel, s1_panel,
              years_panel, meses_panel, sed_panel, period_panel, middle_panel],
  style: {
    textAlign: "center",
    width: "800px",
    backgroundColor: "FFFFFF",
  }
});
//-------------------------------Componentes de controle do segundo mapa-----------------------------------------//
var map2_label = ui.Label({
  value: "Mapa 2",
  style:{
    textAlign : "center",
    margin: '30px 0px 0px 0px',
    fontWeight: "bold",
    fontSize: '15px',
    width: '800px'
  }
});
var ls_label2 = ui.Label({
  value: "Landsat",
  style:{
    textAlign : "center",
    margin: '30px 0px 0px 75px',
    fontSize: '15px',
  }
});
var s1_label2 = ui.Label({
  value: "Sentinel 1",
  style:{
    textAlign : "center",
    fontSize: '15px',
    margin: '30px 0px 0px 75px',
  }
});
var ls_ck_box2 = ui.Checkbox({
  label: "Ativar",
  value: false,
  style:{
    textAlign : "center",
    margin: 'auto',
  },
  disabled: true
});
var s1_ck_box2 = ui.Checkbox({
  label: "Ativar",
  value: true,
  style:{
    textAlign : "center",
    margin: 'auto',
  },
  disabled: true
});
var ls_panel2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [ls_label2, ls_ck_box2],
  style: {textAlign : 'center',
    height: "100px",
    width: "200px",
    backgroundColor: "FFFFFF"
  }
});
var s1_panel2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [s1_label2, s1_ck_box2],
  style: {textAlign : 'center',
    height: "100px",
    width: "200px",
    backgroundColor: "FFFFFF",
    margin: "-100px 0px 0px 200px"
  }
});
var meses_select2 = ui.Select({
      items : Object.keys(months_list),
      placeholder: "Escolha o mês",
      style : {
        margin: '5px auto',
        width: "150px"
      },
      disabled: true
});
var months_label2 = ui.Label({
  value: "Meses",
  style:{
    textAlign : "center",
    margin: '0 auto'
  }
});
var meses_panel2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [months_label2, meses_select2],
  style: {textAlign : 'center',
    width: "200px",
    backgroundColor: "FFFFFF",
    margin: "-58px 0px 0px 200px"
  }
});
var years_select2 = ui.Select({
      items : Object.keys(landsat_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: '5px auto',
        width: "150px"
      }
});
var years_select2_s1 = ui.Select({
      items : Object.keys(s1_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: '5px auto',
        width: "150px"
      },
      disabled: true
});
var years_label2 = ui.Label({
  value: "Anos",
  style:{
    textAlign : "center",
    margin: '0 auto'
  }
});
var years_panel2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [years_label2, years_select2_s1],
  style: {textAlign : 'center',
    width: "200px",
    backgroundColor: "FFFFFF",
  }
});
var sed_ck_box2 = ui.Checkbox({
  label: "Verificar",
  value: false,
  disabled: true,
  style:{
    textAlign : "center",
    margin: '15px auto'
  }
});
var sed_panel_2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets: [sed_ck_box2],
  style: {textAlign : 'center',
    width: "400px",
    margin: "5px 0 0 0",
    backgroundColor: "FFFFFF"
  }
});
var select_period_2 = ui.Checkbox({
  label: "Período",
  value: false,
  style:{
    textAlign : "center",
    margin: "0px 0px 0px 0px"
  },
  disabled: true
});
var period_months_label_2 = ui.Label({
  value: "Mês",
  style:{
    textAlign : "center",
    margin: "0px 0px 20px 280px"
  }
});
var period_months_select_2 = ui.Select({
      items : Object.keys(months_list),
      placeholder: "Escolha o mês",
      style : {
        margin: "0px 0px 20px 223px",
        width: "150px"
      },
      disabled: true
});
var period_years_label_2 = ui.Label({
  value: "Ano",
  style:{
    textAlign : "center",
    margin: "-85px 0px 20px 85px"
  }
});
var period_years_select_2 = ui.Select({
      items : Object.keys(landsat_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: "0px 0px 20px 25px",
        width: "150px"
      },
      disabled: true
});
var period_years_select_s1_2 = ui.Select({
      items : Object.keys(s1_years_dict),
      placeholder: "Escolha o ano",
      style : {
        margin: "0px 0px 20px 25px",
        width: "150px"
      },
      disabled: true
});
var freq_ck_box_2 = ui.Checkbox({
  label: "Frequência do período",
  value: false,
  style:{
    textAlign : "center",
    margin: 'auto',
  },
  disabled: true
});
var first_ck_box_2 = ui.Checkbox({
  label: "Primeira Ocorrência",
  value: false,
  style:{
    textAlign : "center",
    margin: "20px 0px 0px 25px",
  },
  disabled: true
});
var last_ck_box_2 = ui.Checkbox({
  label: "Ultima Ocorrência",
  value: false,
  style:{
    textAlign : "center",
    margin: "-18px 0px 10px 223px",
  },
  disabled: true
});
var period_choices_2 = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  widgets: [period_months_label_2, period_months_select_2, 
            period_years_label_2, period_years_select_s1_2, freq_ck_box_2, first_ck_box_2, last_ck_box_2],
  style: {
    color: "grey",
  }
});
var period_panel_2 = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  widgets: [select_period_2, period_choices_2],
  style : {
    width: "400px",
    margin: "-175px 0px 0px 400px",
  }
});
var painel_mapa_2 = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets : [map2_label, ls_panel2, s1_panel2, years_panel2, meses_panel2, sed_panel_2, period_panel_2],
  style: {
    textAlign: "center",
    width: "800px",
    height: "400px",
    backgroundColor: "FFFFFF",
    color: "grey"
  }
});
var painel_geral = ui.Panel({
  layout : ui.Panel.Layout.flow('vertical'),
  widgets : [painel_mapa_1, painel_mapa_2],
  style: {
    textAlign: "center",
    width: "800px",
    backgroundColor: "FFFFFF"
  }
});
ui.Map.Linker([map, second_map]);
var splitPanel = ui.SplitPanel({
      firstPanel: map,
      secondPanel: second_map,
      orientation: 'horizontal',
      wipe: true,
      style: {stretch: 'both'}
});
//------------------------------------------------Funções------------------------------------------------//
selector = years_select;
selector_2 = years_select2_s1;
period_selector = period_years_select;
period_selector_2 = period_years_select_s1_2;
//----------------------------------Radio Button Like Functionality-------------------------------------//
ls_ck_box.onChange(function(state){
  if(state === true){
    s1_ck_box.setValue(false);
    freq_ck_box.setValue(false);
    first_ck_box.setValue(false);
    last_ck_box.setValue(false);
    select_period.setValue(false);
    meses_select.setValue(null);
    period_months_select.setValue(null);
    s1_ck_box.setDisabled(false);
    ls_ck_box.setDisabled(true);
    years_panel.remove(years_select_s1);
    years_select.setValue(null);
    years_panel.add(years_select);
    period_choices.remove(period_years_select_s1);
    period_years_select.setValue(null);
    period_choices.insert(3,period_years_select);
    period_years_select_s1.setDisabled(true);
    period_years_select.setDisabled(true);
    selector = years_select;
    period_selector = period_years_select;
    map_label.setValue("Landsat");
  }
});
s1_ck_box.onChange(function(state){
  if(state === true){
    ls_ck_box.setValue(false);
    select_period.setValue(false);
    freq_ck_box.setValue(false);
    first_ck_box.setValue(false);
    last_ck_box.setValue(false);
    meses_select.setValue(null);
    period_months_select.setValue(null);
    ls_ck_box.setDisabled(false);
    s1_ck_box.setDisabled(true);
    years_panel.remove(years_select);
    years_select_s1.setValue(null);
    years_panel.add(years_select_s1);
    period_choices.remove(period_years_select);
    period_years_select_s1.setValue(null);
    period_choices.insert(3, period_years_select_s1);
    period_years_select.setDisabled(true);
    period_years_select_s1.setDisabled(true);
    selector = years_select_s1;
    period_selector = period_years_select_s1;
    map_label.setValue("Sentinel");
  }
});
ls_ck_box2.onChange(function(state){
  if(state === true){
    s1_ck_box2.setValue(false);
    freq_ck_box_2.setValue(false);
    first_ck_box_2.setValue(false);
    last_ck_box_2.setValue(false);
    select_period_2.setValue(false);
    meses_select2.setValue(null);
    period_months_select_2.setValue(null);
    s1_ck_box2.setDisabled(false);
    ls_ck_box2.setDisabled(true);
    years_panel2.remove(years_select2_s1);
    years_select2.setValue(null);
    years_panel2.add(years_select2);
    period_choices_2.remove(period_years_select_s1_2);
    period_years_select_2.setValue(null);
    period_choices_2.insert(3,period_years_select_2);
    period_years_select_s1_2.setDisabled(true);
    period_years_select_2.setDisabled(false);
    selector_2 = years_select2;
    period_selector_2 = period_years_select_2;
    second_map_label.setValue("Landsat");
  }
});
s1_ck_box2.onChange(function(state){
  if(state === true){
    ls_ck_box2.setValue(false);
    freq_ck_box_2.setValue(false);
    first_ck_box_2.setValue(false);
    last_ck_box_2.setValue(false);
    select_period_2.setValue(false);
    meses_select2.setValue(null);
    period_months_select_2.setValue(null);
    ls_ck_box2.setDisabled(false);
    s1_ck_box2.setDisabled(true);
    years_panel2.remove(years_select2);
    years_select2_s1.setValue(null);
    years_panel2.add(years_select2_s1);
    period_choices_2.remove(period_years_select_2);
    period_years_select_s1_2.setValue(null);
    period_choices_2.insert(3, period_years_select_s1_2);
    period_years_select_2.setDisabled(true);
    period_years_select_s1_2.setDisabled(false);
    selector_2 = years_select2_s1;
    period_selector_2 = period_years_select_s1_2;
    second_map_label.setValue("Sentinel");
  }
});
//----------------------------------------------Period Function 1-----------------------------------------//
select_period.onChange(function(state){
  state ? [period_choices.style().set({color: "black" }),
           freq_ck_box.style().set({color: "grey"}),
           first_ck_box.style().set({color: "grey"}),
           last_ck_box.style().set({color: "grey"}),
           period_years_select_s1.setDisabled(false),
           period_years_select.setDisabled(false),
           period_months_select.setDisabled(false)
          ]
        : [period_choices.style().set({color: "grey"}),
           period_years_select_s1.setDisabled(true),
           period_years_select_s1.setValue(null),
           period_years_select.setValue(null),
           period_months_select.setValue(null),
           period_choices.widgets().map(function(i){
            try{
              i.setDisabled(true);
            } 
            catch(err){
            }
            })
    ];
});
period_selector.onChange(function(i){
  var year_t0 = selector.getValue();
  var month_t0 = meses_select.getValue();
  var month_t1 = period_months_select.getValue();
  if (year_t0 !== null && month_t0 !== null && month_t1 !== null){
    period_choices.widgets().map(function(i){
      try{
        i.style().set({color : "black"});
        i.setDisabled(false);
      } 
      catch(err){
      }
    });
  }
});
period_months_select.onChange(function(i){
  var year_t0 = selector.getValue();
  var month_t0 = meses_select.getValue();
  var year_t1 = period_selector.getValue();
  if (year_t0 !== null && month_t0 !== null && year_t1 !== null){
    period_choices.widgets().map(function(i){
      try{
        i.style().set({color : "black"});
        i.setDisabled(false);
      } 
      catch(err){
      }
    });
  }
});
freq_ck_box.onChange(function(state){
  if(state === true){
    var year_t0 = selector.getValue();
    var month_t0 = meses_select.getValue();
    var year_t1 = period_selector.getValue();
    var month_t1 = period_months_select.getValue();
    var sat = ls_ck_box.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_legend = legendyze.legendyze("Frequência Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, '808080', 'top-center');
      map.addLayer(imgCol.reduce(ee.Reducer.sum()).set("system:index", "Frequência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol.size().getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, "Frequência");
      map.add(freq_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_legend = legendyze.legendyze("Frequência Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, '808080', 'top-center');
      map.addLayer(imgCol_s1.reduce(ee.Reducer.sum()).set("system:index", "Frequência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol_s1.size().getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, "Frequência");
      map.add(freq_legend);
    }
  }
  else{
    map.remove(freq_legend);
    map.layers().forEach(function(i){
        if(i.get("name") == "Frequência"){
          map.remove(i);
        }
    });
  }
});
first_ck_box.onChange(function(state){
  if(state === true){
    var year_t0 = selector.getValue();
    var month_t0 = meses_select.getValue();
    var year_t1 = period_selector.getValue();
    var month_t1 = period_months_select.getValue();
    var sat = ls_ck_box.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_first_legend = legendyze.legendyze("Primeira Detecção Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'top-center');
      map.addLayer(functions_last_first.first_detection(imgCol).set("system:index", "Primeira_ocorrência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Primeira Detecção");
      map.add(freq_first_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_first_legend = legendyze.legendyze("Primeira Detecção Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'top-center');
      map.addLayer(functions_last_first.first_detection(imgCol_s1).set("system:index", "Primeira_ocorrência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Primeira Detecção");
      map.add(freq_first_legend);
    }
  }
  else{
    map.remove(freq_first_legend);
    map.layers().forEach(function(i){
        if(i.get("name") == "Primeira Detecção"){
          map.remove(i);
        }
    });
  }
});
last_ck_box.onChange(function(state){
  if(state === true){
    var year_t0 = selector.getValue();
    var month_t0 = meses_select.getValue();
    var year_t1 = period_selector.getValue();
    var month_t1 = period_months_select.getValue();
    var sat = ls_ck_box.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_last_legend = legendyze.legendyze("Última Detecção Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'bottom-center');
      map.addLayer(functions_last_first.last_detection(imgCol).set("system:index", "Ultima_ocorrência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Ultima Detecção");
      map.add(freq_last_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_last_legend = legendyze.legendyze("Última Detecção Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'bottom-center');
      map.addLayer(functions_last_first.last_detection(imgCol_s1).set("system:index", "Ultima_ocorrência_" + date_t0 + "_" + date_t1), {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Ultima Detecção");
      map.add(freq_last_legend);
    }
  }
  else{
    map.remove(freq_last_legend);
    map.layers().forEach(function(i){
        if(i.get("name") == "Ultima Detecção"){
          map.remove(i);
        }
    });
  }
});
//-------------------------------------------------Export Image Function-----------------------------------//
var export_info = ui.Label({
  value: "Escolha dois pontos no mapa para formar o retângulo da image que se deseja exportar",
  style: {
    width: "400px",
    textAlign: "center"
  }
});
var reset_button = ui.Button({
  label: "Recomeçar",
  disabled: true,
  style: {
    position: "bottom-center",
    color: "grey"
  }
});
var export_button = ui.Button({
  label: "Exportar",
  disabled: true,
  style: {
    position: "bottom-center",
    color: "grey"
  }
});
export_ck_box.onChange(function(state){
  var points = [];
  var exclude_layers = [];
  var layers = [];
  var rectangle = null;
  if (state === true){
    map.add(export_info);
    map.add(reset_button);
    map.add(export_button);
    map.onClick(function(coords){
      if(points.length < 2){
        points.push([coords.lon, coords.lat]);
        map.addLayer(ee.Geometry.Point(points[points.length - 1]), {palette: "red"}, "point" + points.length);
        if(points.length == 2){
          export_info.setValue("Para fazer escolher outro poligono, clique em recomeçar. Ou se quiser exporta a imagem, clique em exportar");
          rectangle = ee.Geometry.Rectangle(points);
          map.addLayer(rectangle, {}, "rectangle");
          export_button.setDisabled(false).style().set({color: "black"});
          reset_button.setDisabled(false).style().set({color: "black"});
        } 
      }
    });
    reset_button.onClick(function(event){
        map.layers().map(function(i){
            if(i.get("name") == "point1" || i.get("name") == "rectangle" || i.get("name") == "point2"){
              exclude_layers.push(i);
            }
          });
          for (var y = 0; y<= exclude_layers.length - 1; y++){
            map.remove(exclude_layers[y]);
          }
        export_button.setDisabled(true).style().set({color: "grey"});
        reset_button.setDisabled(true).style().set({color: "grey"});
        export_info.setValue("Escolha dois pontos no mapa para formar o retângulo da image que se deseja exportar");
        points.length = 0;
        layers.length = 0;
      });
      export_button.onClick(function(event){
        layers = [];
        map.layers().map(function(i){
          if(i.get("name") != "point1" && i.get("name") != "rectangle" && i.get("name") != "point2" && i.get("name") != "Bacia do Alto Paraguai"){
            layers.push(i);
          }
        });
        layers.map(function(i){
          var des;
          var img_col = i.getEeObject();
          try{
             des = img_col.first();
          }
          catch(e){
             des = img_col;
          }
          var description = des.id();
          description.evaluate(function(y){
            Export.image.toDrive({image: des.clip(rectangle),
                                description: "export_" + y,
                                folder: "Bap_images",
                                region: rectangle,
                              });
          });
        });
      });
  }
  else{
    map.remove(export_info);
    map.remove(reset_button);
    map.remove(export_button);
    map.layers().map(function(i){
      if(i.get("name") == "point1" || i.get("name") == "rectangle" || i.get("name") == "point2"){
        exclude_layers.push(i);
      }
    });
    for (var y = 0; y<= exclude_layers.length - 1; y++){
      map.remove(exclude_layers[y]);
    }
  }
});
//-------------------------------------------------RGB Image Function-----------------------------------//
var legend_tool = require('users/frederickirchhoff/shortcuts:legendize').legendize;
var names = [
  'permanent presence',
  'sporadic reoccurrence',
  'disappearing ',
  'appearing'
  ];
var colors = [
  '0000ff',
  '000000',
  'ff0000',
  '00ff00'
  ];
var legend = legend_tool('max2end - min - freq', names, colors);
rgb_ck_box.onChange(function(state){
  if(state === true){
    map.addLayer(rgb, {min: 0, max: 348}, "RGB Image");
    map.add(legend);
  }
  else{
    map.layers().forEach(function(i){
        if(i.get("name") == "RGB Image"){
          map.remove(i);
        }
    });
    map.remove(legend)
  }
});
//-------------------------------------------------Split Map Function-----------------------------------//
split_map.onChange(function(state){
  if(state === true){
    ui.root.clear();
    ui.root.add(painel_geral);
    ui.root.add(splitPanel);
    ls_ck_box2.setDisabled(false);
    meses_select2.setDisabled(false);
    years_select2.setDisabled(false);
    years_select2_s1.setDisabled(false);
    map_panel.style().set({shown: true});
    painel_mapa_2.style().set({color: "black"});
  }
  else{
    ls_ck_box2.setDisabled(true);
    s1_ck_box2.setDisabled(true);
    meses_select2.setDisabled(true);
    years_select2.setDisabled(true);
    years_select2_s1.setDisabled(true);
    second_map.layers().map(function(i){
      if(i != second_map.layers().get(0)){
       second_map.remove(i);
      } 
    });
    map_panel.style().set({shown: false});
    years_select2.setValue(null);
    years_select2_s1.setValue(null);
    meses_select2.setValue(null);
    painel_mapa_2.style().set({color: "grey"});
    ui.root.clear();
    ui.root.add(painel_geral);
    map = ui.Map();
    map.setControlVisibility({
      layerList: false
    });
    map.addLayer(contour, {}, "Bacia do Alto Paraguai");
    map.centerObject(geometry);
    ui.root.add(map);
  }
});
//----------------------------------------------Period Function 2-----------------------------------------//
select_period_2.onChange(function(state){
  state ? [period_choices_2.style().set({color: "black" }),
           freq_ck_box_2.style().set({color: "grey"}),
           first_ck_box_2.style().set({color: "grey"}),
           last_ck_box_2.style().set({color: "grey"}),
           period_years_select_s1_2.setDisabled(false),
           period_years_select_2.setDisabled(false),
           period_months_select_2.setDisabled(false)
          ]
        : [period_choices_2.style().set({color: "grey"}),
           period_years_select_s1_2.setDisabled(true),
           period_years_select_s1_2.setValue(null),
           period_years_select_2.setValue(null),
           period_months_select_2.setValue(null),
           period_choices_2.widgets().map(function(i){
            try{
              i.setDisabled(true);
            } 
            catch(err){
            }
            })
    ];
});
period_selector_2.onChange(function(i){
  var year_t0 = selector_2.getValue();
  var month_t0 =period_months_select_2.getValue();
  var month_t1 = period_months_select_2.getValue();
  if (year_t0 !== null && month_t0 !== null && month_t1 !== null){
    period_choices.widgets().map(function(i){
      try{
        i.style().set({color : "black"});
        i.setDisabled(false);
      } 
      catch(err){
      }
    });
  }
});
period_months_select_2.onChange(function(i){
  var year_t0 = selector_2.getValue();
  var month_t0 = meses_select2.getValue();
  var year_t1 = period_selector_2.getValue();
  if (year_t0 !== null && month_t0 !== null && year_t1 !== null){
    period_choices.widgets().map(function(i){
      freq_ck_box_2.setDisabled(false);
      try{
        i.style().set({color : "black"});
        i.setDisabled(false);
      } 
      catch(err){
      }
    });
  }
});
freq_ck_box_2.onChange(function(state){
  if(state === true){
    var year_t0 = selector_2.getValue();
    var month_t0 = meses_select2.getValue();
    var year_t1 = period_selector_2.getValue();
    var month_t1 = period_months_select_2.getValue();
    var sat = ls_ck_box2.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_legend = legendyze.legendyze("Frequência Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, '808080', 'top-center');
      second_map.addLayer(imgCol.reduce(ee.Reducer.sum()), {min: 0,  max: imgCol.size().getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, "Frequência");
      second_map.add(freq_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_legend = legendyze.legendyze("Frequência Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, '808080', 'top-center');
      second_map.addLayer(imgCol_s1.reduce(ee.Reducer.sum()), {min: 0,  max: imgCol_s1.size().getInfo(),  palette: ['ffffff', '00ffff', '00c6ff', '008bff', '0048ff', '0000ac', '00004e']}, "Frequência");
      second_map.add(freq_legend);
    }
  }
  else{
    second_map.remove(freq_legend);
    second_map.layers().forEach(function(i){
        if(i.get("name") == "Frequência"){
          second_map.remove(i);
        }
    });
  }
});
first_ck_box_2.onChange(function(state){
  if(state === true){
    var year_t0 = selector_2.getValue();
    var month_t0 = meses_select2.getValue();
    var year_t1 = period_selector_2.getValue();
    var month_t1 = period_months_select_2.getValue();
    var sat = ls_ck_box2.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_first_legend = legendyze.legendyze("Primeira Detecção Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'top-center');
      second_map.addLayer(functions_last_first.first_detection(imgCol), {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Primeira Detecção");
      second_map.add(freq_first_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_first_legend = legendyze.legendyze("Primeira Detecção Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'top-center');
      second_map.addLayer(functions_last_first.first_detection(imgCol_s1), {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Primeira Detecção");
      second_map.add(freq_first_legend);
    }
  }
  else{
    second_map.remove(freq_first_legend);
    second_map.layers().forEach(function(i){
        if(i.get("name") == "Primeira Detecção"){
          second_map.remove(i);
        }
    });
  }
});
last_ck_box_2.onChange(function(state){
  if(state === true){
    var year_t0 = selector_2.getValue();
    var month_t0 = meses_select2.getValue();
    var year_t1 = period_selector_2.getValue();
    var month_t1 = period_months_select_2.getValue();
    var sat = ls_ck_box2.getValue();
    if (months_list[month_t0] > 9){
      date_t0 = year_t0.concat('-').concat(String(months_list[month_t0])).concat('-01');
    }
    else{
      date_t0 = year_t0.concat('-').concat('0').concat(String(months_list[month_t0])).concat('-01');
    }
    if(months_list[month_t1] > 9){
      date_t1 = year_t1.concat('-').concat(String(months_list[month_t1])).concat('-01');
    }
    else{
      date_t1 = year_t1.concat('-').concat('0').concat(String(months_list[month_t1])).concat('-01'); 
    }
    if(sat === true){
      var imgCol = water.filterDate(date_t0, date_t1);
      freq_last_legend = legendyze.legendyze("Última Detecção Legenda", {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'bottom-center');
      second_map.addLayer(functions_last_first.last_detection(imgCol), {min: 0,  max: imgCol.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Ultima Detecção");
      second_map.add(freq_last_legend);
    }
    else{
      var imgCol_s1 = water_iii.filterDate(date_t0, date_t1);
      freq_last_legend = legendyze.legendyze("Última Detecção Legenda", {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, '808080', 'bottom-center');
      second_map.addLayer(functions_last_first.last_detection(imgCol_s1), {min: 0,  max: imgCol_s1.size().subtract(1).getInfo(),  palette: ['d73027','f46d43','fdae61','fee090','ffffbf','e0f3f8','abd9e9','74add1','4575b4']}, "Ultima Detecção");
      second_map.add(freq_last_legend);
    }
  }
  else{
    second_map.remove(freq_last_legend);
    second_map.layers().forEach(function(i){
        if(i.get("name") == "Ultima Detecção"){
          second_map.remove(i);
        }
    });
  }
});
//-------------------------------------------------Verify Function------------------------------------//
sed_ck_box.onChange(function(i){
  if(i){
    var img = check_col.filter(ee.Filter.eq('year', ee.Number.parse(selector.getValue())))
    map.addLayer(img, {min:0, max:1, palette: ["FF0000"]}, "Verificação");
  }
  else{
    map.remove(map.widgets().get(map.widgets().length() - 1))
    map.layers().forEach(function(i){
        if(i.get("name") == "Verificação"){
          map.remove(i)
        }
    })
  }
})
//-------------------------------------------------Selection Function------------------------------------//
//------------------Map 1--------------//
selector.onChange(function(i){
  map.layers().map(function(i){
    if(i !== map.layers().get(0)){
      return map.remove(i)  ;
    }
  });
  var month = meses_select.getValue();
  var sat = ls_ck_box.getValue();
  if(sat === true){
    if(month !== null){
      select_period.setDisabled(false);
      sed_ck_box.setDisabled(false);
      image = water.filter(ee.Filter.eq("month", months_list[month]))
                .filter(ee.Filter.eq("year", landsat_years_dict[i]));
      map.addLayer(image, visParams, "Surface Water landsat");
    } 
  }
  else{
    if(month !== null){
      select_period.setDisabled(false);
      sed_ck_box.setDisabled(false);
      image = water_iii.filter(ee.Filter.stringContains(ee.String("system:index"), comp.concat(String(months_list[month]))))
              .filter(ee.Filter.stringContains(ee.String("system:index"), String(s1_years_dict[i])));
      map.addLayer(image, visParams, "Surface Water Sentinel");
    }
  }
});
meses_select.onChange(function(i){
  map.layers().map(function(i){
    if(i != map.layers().get(0)){
       map.remove(i);
    } 
  });
  var year = selector.getValue();
  var sat = ls_ck_box.getValue();
  if (sat === true){
    if(year !== null){
      select_period.setDisabled(false);
      sed_ck_box.setDisabled(false);
      image =  water.filter(ee.Filter.eq("month", months_list[i]))
                        .filter(ee.Filter.eq("year", landsat_years_dict[year]));
      map.addLayer(image, visParams, "Surface Water landsat");
    }  
  }
  else{
     if (year !== null){
      select_period.setDisabled(false);
      sed_ck_box.setDisabled(false);
      image = water_iii.filter(ee.Filter.stringContains(ee.String("system:index"), comp.concat(String(months_list[i]))))
                  .filter(ee.Filter.stringContains(ee.String("system:index"), String(s1_years_dict[year])));
      map.addLayer(image, visParams, "Surface Water Sentinel");
      } 
  }
});
//------------------Map 2--------------//
selector_2.onChange(function(i){
  second_map.layers().map(function(i){
    if(i != second_map.layers().get(0)){
       second_map.remove(i);
    } 
  });
  var month = meses_select2.getValue();
  var sat = ls_ck_box2.getValue();
  if(sat === true){
    if(month !== null){
      select_period_2.setDisabled(false);
      first_ck_box_2.setDisabled(false);
      last_ck_box_2.setDisabled(false);
      sed_ck_box2.setDisabled(false);
      image = water.filter(ee.Filter.eq("month", months_list[month]))
                .filter(ee.Filter.eq("year", landsat_years_dict[i]));
      second_map.addLayer(image, visParams, "Surface Water landsat");
    } 
  }
  else{
    if(month !== null){
      select_period_2.setDisabled(false);
      first_ck_box_2.setDisabled(false);
      last_ck_box_2.setDisabled(false);
      sed_ck_box2.setDisabled(false);
      image = water_iii.filter(ee.Filter.eq("month", months_list[month]))
                .filter(ee.Filter.eq("year", landsat_years_dict[i]));
      second_map.addLayer(image, visParams, "Surface Water Sentinel");
    }
  }
});
meses_select2.onChange(function(i){
  second_map.layers().map(function(i){
    if(i != second_map.layers().get(0)){
       second_map.remove(i);
    } 
  });
  var year = selector_2.getValue();
  var sat = ls_ck_box2.getValue();
  if (sat === true){
    if(year !== null){
      select_period_2.setDisabled(false);
      first_ck_box_2.setDisabled(false);
      last_ck_box_2.setDisabled(false);
      sed_ck_box2.setDisabled(false);
      image =  water.filter(ee.Filter.eq("month", months_list[i]))
                        .filter(ee.Filter.eq("year", landsat_years_dict[year]));
      second_map.addLayer(image, visParams, "Surface Water landsat");
    }  
  }
  else{
     if (year !== null){
      select_period_2.setDisabled(false);
      first_ck_box_2.setDisabled(false);
      last_ck_box_2.setDisabled(false);
      sed_ck_box2.setDisabled(false);
      image = water_iii.filter(ee.Filter.eq("month", months_list[i]))
                .filter(ee.Filter.eq("year", landsat_years_dict[year]));
      second_map.addLayer(image, visParams, "Surface Water Sentinel 1");
      } 
  }
});
ui.root.clear();
ui.root.add(painel_geral);
ui.root.add(map);