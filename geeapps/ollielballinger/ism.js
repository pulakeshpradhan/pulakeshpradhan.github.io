var metal_roof = ui.import && ui.import("metal_roof", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            39.26741572591091,
            -6.799597112234682
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.26740499707485,
            -6.79971429932429
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.266553930314984,
            -6.799646464455595
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.266795329126325,
            -6.799458698737626
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.26651772049328,
            -6.799417416903273
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.26640372661015,
            -6.799405431853919
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.266287050518,
            -6.799390783459866
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27128989039692,
            -6.770127663582867
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27128452597889,
            -6.770239530832594
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.270605927098124,
            -6.770660364539759
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27133175153252,
            -6.771208210377959
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27081140298363,
            -6.7712295183798155
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.271109128184285,
            -6.772122723145485
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.233067672608065,
            -6.799620747125661
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.23333156135756,
            -6.8007969183483725
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.230660081178726,
            -6.800818225040858
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.233471036226334,
            -6.801995418332324
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.23437225845534,
            -6.80217119807854
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.23499453094679,
            -6.801590592005497
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.230976581842484,
            -6.802837029867221
          ]
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                39.27747943600178,
                -6.835318217605542
              ],
              [
                39.27684643467426,
                -6.833794896372009
              ],
              [
                39.27565553387165,
                -6.833613801916541
              ],
              [
                39.27595594128132,
                -6.835307565026354
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 1
      },
      "color": "#d63000",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([39.26741572591091, -6.799597112234682]),
            {
              "class": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([39.26740499707485, -6.79971429932429]),
            {
              "class": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([39.266553930314984, -6.799646464455595]),
            {
              "class": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([39.266795329126325, -6.799458698737626]),
            {
              "class": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([39.26651772049328, -6.799417416903273]),
            {
              "class": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([39.26640372661015, -6.799405431853919]),
            {
              "class": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([39.266287050518, -6.799390783459866]),
            {
              "class": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27128989039692, -6.770127663582867]),
            {
              "class": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27128452597889, -6.770239530832594]),
            {
              "class": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([39.270605927098124, -6.770660364539759]),
            {
              "class": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27133175153252, -6.771208210377959]),
            {
              "class": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27081140298363, -6.7712295183798155]),
            {
              "class": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([39.271109128184285, -6.772122723145485]),
            {
              "class": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([39.233067672608065, -6.799620747125661]),
            {
              "class": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([39.23333156135756, -6.8007969183483725]),
            {
              "class": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([39.230660081178726, -6.800818225040858]),
            {
              "class": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([39.233471036226334, -6.801995418332324]),
            {
              "class": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([39.23437225845534, -6.80217119807854]),
            {
              "class": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([39.23499453094679, -6.801590592005497]),
            {
              "class": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([39.230976581842484, -6.802837029867221]),
            {
              "class": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[39.27747943600178, -6.835318217605542],
                  [39.27684643467426, -6.833794896372009],
                  [39.27565553387165, -6.833613801916541],
                  [39.27595594128132, -6.835307565026354]]]),
            {
              "class": 1,
              "system:index": "20"
            })]),
    highrise = ui.import && ui.import("highrise", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            39.28889960206715,
            -6.814155886577735
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.289189280640755,
            -6.814550049264474
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.28502447458101,
            -6.820984448228873
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.28627974839998,
            -6.8204091913818985
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.277814696748976,
            -6.817109586263046
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.278125832994704,
            -6.81704566835282
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27802927347017,
            -6.8168006496179645
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27269704194856,
            -6.820007189239923
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27204258294893,
            -6.8210192155623135
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.275572370012526,
            -6.822105809864981
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27547581048799,
            -6.8219460167397745
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.280078481157545,
            -6.822563883195053
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.276838372667555,
            -6.824971424191158
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27976734491182,
            -6.824992729809646
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.27392012925935,
            -6.8225532303318905
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 2
      },
      "color": "#98ff00",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([39.28889960206715, -6.814155886577735]),
            {
              "class": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([39.289189280640755, -6.814550049264474]),
            {
              "class": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([39.28502447458101, -6.820984448228873]),
            {
              "class": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([39.28627974839998, -6.8204091913818985]),
            {
              "class": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([39.277814696748976, -6.817109586263046]),
            {
              "class": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([39.278125832994704, -6.81704566835282]),
            {
              "class": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27802927347017, -6.8168006496179645]),
            {
              "class": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27269704194856, -6.820007189239923]),
            {
              "class": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27204258294893, -6.8210192155623135]),
            {
              "class": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([39.275572370012526, -6.822105809864981]),
            {
              "class": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27547581048799, -6.8219460167397745]),
            {
              "class": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([39.280078481157545, -6.822563883195053]),
            {
              "class": 2,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([39.276838372667555, -6.824971424191158]),
            {
              "class": 2,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27976734491182, -6.824992729809646]),
            {
              "class": 2,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([39.27392012925935, -6.8225532303318905]),
            {
              "class": 2,
              "system:index": "14"
            })]),
    suburban = ui.import && ui.import("suburban", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            39.10579876932703,
            -6.808208239599947
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.1058658245524,
            -6.808051105138972
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10576926502787,
            -6.807915277004134
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.104945826860295,
            -6.808607733760551
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10510675940119,
            -6.808690295845624
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10600529942118,
            -6.808562457772398
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10600261721216,
            -6.8084266297822875
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10669194492899,
            -6.808482558959342
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10693334374033,
            -6.808543814717209
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10461055073343,
            -6.808653009744444
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.104819763036595,
            -6.809041850371364
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10459177527033,
            -6.807952563162627
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.1040097359141,
            -6.809028533916758
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.104095566602574,
            -6.8090977794767165
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10395072731577,
            -6.809172351607042
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10486804279886,
            -6.807470878185146
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10572634968363,
            -6.807548113867453
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.10760926041208,
            -6.807787810733425
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.107697773309575,
            -6.807654645822665
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 3
      },
      "color": "#0b4a8b",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([39.10579876932703, -6.808208239599947]),
            {
              "class": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([39.1058658245524, -6.808051105138972]),
            {
              "class": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10576926502787, -6.807915277004134]),
            {
              "class": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([39.104945826860295, -6.808607733760551]),
            {
              "class": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10510675940119, -6.808690295845624]),
            {
              "class": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10600529942118, -6.808562457772398]),
            {
              "class": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10600261721216, -6.8084266297822875]),
            {
              "class": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10669194492899, -6.808482558959342]),
            {
              "class": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10693334374033, -6.808543814717209]),
            {
              "class": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10461055073343, -6.808653009744444]),
            {
              "class": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([39.104819763036595, -6.809041850371364]),
            {
              "class": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10459177527033, -6.807952563162627]),
            {
              "class": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([39.1040097359141, -6.809028533916758]),
            {
              "class": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([39.104095566602574, -6.8090977794767165]),
            {
              "class": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10395072731577, -6.809172351607042]),
            {
              "class": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10486804279886, -6.807470878185146]),
            {
              "class": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10572634968363, -6.807548113867453]),
            {
              "class": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([39.10760926041208, -6.807787810733425]),
            {
              "class": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([39.107697773309575, -6.807654645822665]),
            {
              "class": 3,
              "system:index": "18"
            })]),
    vegetation = ui.import && ui.import("vegetation", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            39.19278582362021,
            -6.8118956641857515
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.19094046381797,
            -6.8120448075649955
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.19061859873618,
            -6.813152728358947
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.1906400564083,
            -6.814303258781952
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.19169148234214,
            -6.8159438251656095
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.195253455913914,
            -6.817371326411772
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.19503887919272,
            -6.814622850076191
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.2001672628292,
            -6.81227917563869
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.202441776073826,
            -6.812321788003427
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.205445850170506,
            -6.812513543597872
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 4
      },
      "color": "#ffc82d",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ffc82d */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([39.19278582362021, -6.8118956641857515]),
            {
              "class": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([39.19094046381797, -6.8120448075649955]),
            {
              "class": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([39.19061859873618, -6.813152728358947]),
            {
              "class": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([39.1906400564083, -6.814303258781952]),
            {
              "class": 4,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([39.19169148234214, -6.8159438251656095]),
            {
              "class": 4,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([39.195253455913914, -6.817371326411772]),
            {
              "class": 4,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([39.19503887919272, -6.814622850076191]),
            {
              "class": 4,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([39.2001672628292, -6.81227917563869]),
            {
              "class": 4,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([39.202441776073826, -6.812321788003427]),
            {
              "class": 4,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([39.205445850170506, -6.812513543597872]),
            {
              "class": 4,
              "system:index": "9"
            })]),
    roads = ui.import && ui.import("roads", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            39.259111038405706,
            -6.804898603351617
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25883208866816,
            -6.805175587914733
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25874625797968,
            -6.805367346364831
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25858532543879,
            -6.805601717699829
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25847803707819,
            -6.805782822743973
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25829564686518,
            -6.806059806796954
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25822054501276,
            -6.806176992309731
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25793086643915,
            -6.807434071465527
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.258166900832464,
            -6.807519297051843
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25958310719233,
            -6.808051956623408
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.259883514601995,
            -6.808190448015174
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.260130277831365,
            -6.80827567346717
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.2603341257165,
            -6.808339592546249
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.26059161778193,
            -6.8083928584389595
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.260784736831,
            -6.808456777502416
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25378953572016,
            -6.805900008324357
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25400411244135,
            -6.805985234183031
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25429379101496,
            -6.8061024197140005
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25445472355585,
            -6.806155685854998
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25472294445734,
            -6.806251564893884
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.25505553837519,
            -6.806390056805135
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.255613437850286,
            -6.806517895456981
          ]
        },
        {
          "type": "Point",
          "coordinates": [
            39.257405153472234,
            -6.807210354229463
          ]
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 5
      },
      "color": "#00ffff",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #00ffff */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([39.259111038405706, -6.804898603351617]),
            {
              "class": 5,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25883208866816, -6.805175587914733]),
            {
              "class": 5,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25874625797968, -6.805367346364831]),
            {
              "class": 5,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25858532543879, -6.805601717699829]),
            {
              "class": 5,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25847803707819, -6.805782822743973]),
            {
              "class": 5,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25829564686518, -6.806059806796954]),
            {
              "class": 5,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25822054501276, -6.806176992309731]),
            {
              "class": 5,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25793086643915, -6.807434071465527]),
            {
              "class": 5,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([39.258166900832464, -6.807519297051843]),
            {
              "class": 5,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25958310719233, -6.808051956623408]),
            {
              "class": 5,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([39.259883514601995, -6.808190448015174]),
            {
              "class": 5,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([39.260130277831365, -6.80827567346717]),
            {
              "class": 5,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([39.2603341257165, -6.808339592546249]),
            {
              "class": 5,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([39.26059161778193, -6.8083928584389595]),
            {
              "class": 5,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([39.260784736831, -6.808456777502416]),
            {
              "class": 5,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25378953572016, -6.805900008324357]),
            {
              "class": 5,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25400411244135, -6.805985234183031]),
            {
              "class": 5,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25429379101496, -6.8061024197140005]),
            {
              "class": 5,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25445472355585, -6.806155685854998]),
            {
              "class": 5,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25472294445734, -6.806251564893884]),
            {
              "class": 5,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([39.25505553837519, -6.806390056805135]),
            {
              "class": 5,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([39.255613437850286, -6.806517895456981]),
            {
              "class": 5,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([39.257405153472234, -6.807210354229463]),
            {
              "class": 5,
              "system:index": "22"
            })]),
    Classified = ui.import && ui.import("Classified", "image", {
      "id": "users/ollielballinger/Tanzania_Classified"
    }) || ee.Image("users/ollielballinger/Tanzania_Classified"),
    Tanzania_Density = ui.import && ui.import("Tanzania_Density", "image", {
      "id": "users/ollielballinger/Tanzania_Density"
    }) || ee.Image("users/ollielballinger/Tanzania_Density"),
    Classified2 = ui.import && ui.import("Classified2", "image", {
      "id": "users/ollielballinger/Tanzania_RF_OSM_Sentinel"
    }) || ee.Image("users/ollielballinger/Tanzania_RF_OSM_Sentinel"),
    drone22 = ui.import && ui.import("drone22", "image", {
      "id": "users/ollielballinger/block22_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block22_transparent_mosaic_group1"),
    drone2 = ui.import && ui.import("drone2", "image", {
      "id": "users/ollielballinger/block2_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block2_transparent_mosaic_group1"),
    drone3 = ui.import && ui.import("drone3", "image", {
      "id": "users/ollielballinger/block3_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block3_transparent_mosaic_group1"),
    drone5 = ui.import && ui.import("drone5", "image", {
      "id": "users/ollielballinger/block5_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block5_transparent_mosaic_group1"),
    InformalSettlements = ui.import && ui.import("InformalSettlements", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                39.253758475101684,
                -6.764801517304968
              ],
              [
                39.253758475101684,
                -6.777117548971763
              ],
              [
                39.27487282446692,
                -6.777117548971763
              ],
              [
                39.27487282446692,
                -6.764801517304968
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [
        {
          "type": "rectangle"
        }
      ],
      "properties": {},
      "color": "#d63000",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[39.253758475101684, -6.764801517304968],
                  [39.253758475101684, -6.777117548971763],
                  [39.27487282446692, -6.777117548971763],
                  [39.27487282446692, -6.764801517304968]]], null, false),
            {
              "system:index": "0"
            })]),
    drone16 = ui.import && ui.import("drone16", "image", {
      "id": "users/ollielballinger/block16_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block16_transparent_mosaic_group1"),
    drone9 = ui.import && ui.import("drone9", "image", {
      "id": "users/ollielballinger/block9_transparent_mosaic_group1"
    }) || ee.Image("users/ollielballinger/block9_transparent_mosaic_group1"),
    footprints = ui.import && ui.import("footprints", "table", {
      "id": "users/ollielballinger/Tanzania_Footprints"
    }) || ee.FeatureCollection("users/ollielballinger/Tanzania_Footprints");
Map.setCenter(39.2854, -6.8167, 14)
var LSMS = ee.FeatureCollection("users/ollielballinger/Tanzania_LSMS"),
    DHS = ee.FeatureCollection("users/ollielballinger/Tanzania_DHS"),
    wards=ee.FeatureCollection("users/ollielballinger/Tanzania_Wards"),
    subwards=ee.FeatureCollection("users/ollielballinger/Tanzania_SubWards")
var sentinel_2C = ee.ImageCollection("COPERNICUS/S2")
//var drone=ee.ImageCollection([drone2,drone3,drone5,drone9,drone22,drone16]).mosaic().clip(InformalSettlements)
var drone=ee.ImageCollection([drone5]).mosaic().clip(InformalSettlements)
var VIIRS= ee.ImageCollection('NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG')
                  .filter(ee.Filter.date('2018-01-01','2019-01-01'))
                  .select('avg_rad')
                  .reduce(ee.Reducer.median())
                  .clip(wards);
var OSM_clean=ee.FeatureCollection("users/ollielballinger/Tanzania_OSM_clean")
          .filter(ee.Filter.or(
          ee.Filter.eq('building_3', ''),
          ee.Filter.eq('building_3', 0),
          ee.Filter.eq('building_3', 1)))
          .filter(ee.Filter.or(
          ee.Filter.eq('building', 'yes'),
          ee.Filter.eq('building', 'residential'),
          ee.Filter.eq('building', '')
          ))
var OSM = OSM_clean.map(function(feature) {
  return feature.set({area: feature.geometry().area()}).set({const: 1})})
  .filter(ee.Filter.gt('area',10))
var empty = ee.Image().byte();
var boxcar = ee.Kernel.gaussian({
  radius: 60, units: 'meters', normalize: true, sigma:15
});
var OSM_color = empty.paint({
  featureCollection: OSM,
  color: 'area',
}).clip(wards)
var sums= OSM_color.unmask(0).reduceNeighborhood({
  reducer: ee.Reducer.sum(),
  kernel: boxcar
}).clip(wards)
var OSM_smooth = OSM_color.convolve(boxcar);
var wards_outline = ee.Image().byte().paint({
  featureCollection: wards,
  color: 5,
  width: 2
});
var subwards_outline = ee.Image().byte().paint({
  featureCollection: subwards,
  color: "red",
  width: 2
});
var palette =["0034f5","1e7d83","4da910","b3c120","fcc228","ff8410","fd3000"]
var VIIRS_smooth = VIIRS.convolve(boxcar);
function maskS2clouds(image) {
  var qa = image.select('QA60')
  var cloudBitMask = 1 << 10;
  var cirrusBitMask = 1 << 11;
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0).and(
             qa.bitwiseAnd(cirrusBitMask).eq(0))
  return image.updateMask(mask).divide(10000)
      .select("B.*")
      .copyProperties(image, ["system:time_start"])
}
var collection = ee.ImageCollection('COPERNICUS/S2')
    .filterDate('2016-01-01', '2016-12-31')
    .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 20))
    .map(maskS2clouds)
var image = collection.median().addBands(OSM_color).clip(wards)
var subwards_outline = ee.Image().byte().paint({
  featureCollection: subwards,
  width: 1
});
var wards_outline = ee.Image().byte().paint({
  featureCollection: wards,
  width: 2
});
  var Vis= [
  '49cc47', 
  '0008ff',
  '2ff5ff',
  'ff0000',
  'fff700', 
  'ffffff',
  '47b2ff',
  '2700ff',
  '00a1ff']
var is=Classified2.gt(3).and(Classified2.lt(6))
var is2=is.updateMask(is.neq(0))
var vectors = is2.reduceToVectors({
  geometry: wards,
  scale: 5,
  geometryType: 'polygon',
  eightConnected: true,
  labelProperty: 'zone',
  maxPixels:1653602926
  }).map(function(feature) {
  return feature.set({area: feature.geometry().area(10)})
  })
  .filter(ee.Filter.gt('area',10000))
var test=OSM_color.addBands(is).select('classification').updateMask(is.neq(0)).updateMask(OSM_color.neq(0))
var spatialFilter = ee.Filter.intersects({
  leftField: '.geo',
  rightField: '.geo',
  maxError: 10
});
var saveAllJoin = ee.Join.saveAll({
  matchesKey: 'zone',
  outer:false
});
var buildings = saveAllJoin.apply(OSM, vectors, spatialFilter)
var osm_outline = ee.Image().byte().paint({
featureCollection: OSM,
width: 2,
color:'red'
});
function core_layers(){
Map.addLayer(Classified.clip(wards),{min:1, max:9, palette: Vis, format:'png'},'RF Sentinel',false);
Map.addLayer(Classified2.clip(wards),{min:1, max:9, palette: Vis, format:'png'},'RF Sentinel+OSM');
Map.addLayer(subwards_outline,{color:'black'}, 'Sub-Wards',false);
Map.addLayer(image, {bands: ['B4', 'B3', 'B2'], min: 0, max: 0.3}, 'Sentinel-2', false)
Map.addLayer(Tanzania_Density,{palette:palette, min:0, max:1}, 'Reciprocal Area Density', false);
Map.addLayer(wards_outline,{color:'red'}, 'Wards');
}
core_layers()
// create the main panel 
var console = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  style: {
    position: 'top-right',
    padding: '8px 15px',
    width: '350px',
    height: '450px'
  }
});
// Create legend title
var title = ui.Label({
  value: 'Informal Settlement Mapper',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    }
});
var home= function(){
  Map.setCenter(39.2854, -6.8167, 14)
  Map.setOptions("Terrain")
  console.clear()
  console.add(title);
  console.add(intro1);
  console.add(zoom);
  console.add(stats_label)
  console.add(ward_stats);
  console.add(info_label)
  console.add(details)
  console.add(contact)
}
var home_button = ui.Button({
  style:{stretch: 'horizontal'},
  label: 'Home',
  onClick: function(){
    home()
    Map.layers().get(1).setShown(true)
    Map.remove(Map.layers().get(6))
  }
})
var zoom = ui.Button({
  style:{stretch: 'horizontal'},
  label: 'Zoom to Informal Settlement',
  onClick: 
  function() {
    Map.setOptions("Satellite")
    console.clear()
    console.add(title);
    Map.addLayer(drone, {bands: ['b1', 'b2', 'b3'], min: 0, max: 255}, 'Drone')
    Map.setCenter(39.27145, -6.771062, 17)
    console.add(ui.Label('This is a sample informal settlement identified in the Namanga area of Dar es Salaam. Use the slider below to compare drone imagery to the model prediction:', {whiteSpace: 'wrap'}))
    console.add(ui.Label({
      value: 'Drone Layer Opacity:',
      style: {
      fontWeight: 'bold',
      fontSize: '14px',
      padding: '0'}}))
    var slider = ui.Slider({style:{stretch: 'horizontal'}});
    slider.setValue(0.9);  // Set a default value.
    slider.onChange(function(value) {
      Map.layers().get(6).setOpacity(value);
    });
    console.add(slider)
    console.add(ui.Label('The informal settlement on the left and the suburban neighborhood on the right are both located in the Msasani Ward of Dar es Salaam. Because most statistics are aggregated at the ward level, data on population density, income, health outcomes, and other developmental indicators are likely to be highly biased by variation within city wards. By identifying the geographic extent of informal settlements, policy interventions and crisis responses can be targeted with a high degree of precision.', {whiteSpace: 'wrap'}))
    console.add(home_button)
  }
});
var details = ui.Button({
  style:{stretch: 'horizontal'},
  label: 'How it Works',
  onClick: 
  function() {
    console.clear()
    console.add(title);
      console.add(intro2);
      console.add(rfs_label);
      console.add(rfs_desc);
      console.add(rfsosm_label);
      console.add(rfsosm_desc)
      console.add(s_label)
      console.add(s_desc)
      console.add(rad_label)
      console.add(rad_desc)
    console.add(home_button)
  }
});
var ward_stats = ui.Button({
  style:{stretch: 'horizontal'},
  label: 'Ward Statistics',
  onClick: 
  function ward_stats_panel() {
    Map.setOptions("Satellite")
    Map.addLayer(buildings,{color:'red', max:1}, 'Informal Dwellings',false)
    console.clear()
    console.add(title)
    console.add(ui.Label('Click on the map to get a rough estimate of the number of informal dwellings in a given Ward.', {whiteSpace: 'wrap'}))
      Map.onClick(function(coords) {
          Map.layers().get(1).setShown(false)
          ward_stats_panel()
          var point = ee.Geometry.Point(coords.lon, coords.lat);
          var saveAllJoin = ee.Join.saveAll({
                matchesKey: 'Ward_Name',
                outer:true
              });
          var ward_name = ee.Feature(ee.List(saveAllJoin.apply(point, wards, spatialFilter).first().get("Ward_Name")).getInfo()[0]).get('Ward_Name')
          ward_name.evaluate(function(val){ward_name.setValue(val)});
          ward_stats(ward_name) 
        })
          function ward_stats(ward_name){
            var ward=wards.filter(ee.Filter.eq('Ward_Name', ward_name))
            var centroid=ward.geometry().centroid()
            var sum=buildings.filterBounds(ward).size()
            var allBuildings=OSM.filterBounds(ward).size()
            var mean = ee.Number(ee.Image(is).reduceRegions({collection: ward, reducer: ee.Reducer.mean()}).first().get('mean')).multiply(100)
            var ward_highlight = ee.Image().byte().paint({
            featureCollection: buildings.filterBounds(ward),
            width: 2,
            color:'red'
            });
            var sumLabel = ui.Label({
                value: 'Calculating...'
              })
            var allLabel = ui.Label({
                value: 'Calculating...'
              })
            var meanLabel = ui.Label({
                value: 'Calculating...'
              })
            sum.evaluate(function(val){sumLabel.setValue(val)});
            allBuildings.evaluate(function(val){allLabel.setValue(val)});
            mean.evaluate(function(val){meanLabel.setValue(val)});
            console.add(ui.Label({
              value: ward_name.getInfo(),
              style: {
              fontWeight: 'bold',
              fontSize: '18px',
              padding: '0'}}))
            console.add(ui.Label('Total number of buildings:', {whiteSpace: 'wrap'}))
            console.add(allLabel, {whiteSpace: 'wrap'})
            console.add(ui.Label('Estimated number of informal dwellings:', {whiteSpace: 'wrap'}))
            console.add(sumLabel, {whiteSpace: 'wrap'})
            console.add(ui.Label('Percent of ward under informal settlement:', {whiteSpace: 'wrap'}))
            console.add(meanLabel, {whiteSpace: 'wrap'})
            Map.remove(Map.layers().get(6))
            Map.addLayer(buildings.filterBounds(ward),{color:'red', max:1}, 'Informal Dwellings')
            Map.remove(Map.layers().get(6))
            Map.setCenter(ee.Number(centroid.coordinates().get(0)).getInfo(), 
                        ee.Number(centroid.coordinates().get(1)).getInfo(), 15);
          }
      console.add(home_button)     
        }
      });
var intro1= ui.Label('This tool uses machine learning to map informal settlements in Dar es Salaam. Data layers can be toggled using the "Layers" tab. To compare the model\'s prediction to high-resolution imagery, click \"Zoom to Informal Settlement\": ', {whiteSpace: 'wrap'})
var stats_label= ui.Label('To explore Ward-level data on informal settlements, click \"Ward Statistics\": ', {whiteSpace: 'wrap'})
var info_label= ui.Label('For more information about the model or any of its input layers, click \"How it Works\": ', {whiteSpace: 'wrap'})
var intro2= ui.Label('These maps were generated by a Random Forest algorithm built to identify informal settlements. The identification strategy exploits two characteristics of informal settlements: variation in roofing material, and the spatial distribution of structures. Further details about the data layers can be found below:', {whiteSpace: 'wrap'})
var contact= ui.Label('Please direct queries to ollie.ballinger@sant.ox.ac.uk', {whiteSpace: 'wrap'})
var rfs_label=ui.Checkbox({
  label: 'RF Sentinel',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 6px 0',
    padding: '0'
    },
  onChange: function(checked) {
  Map.layers().get(0).setShown(checked)
  Map.layers().get(1).setShown(false)
  Map.layers().get(2).setShown(false)
  Map.layers().get(3).setShown(false)
  Map.layers().get(4).setShown(false)
  }
})
var rfs_desc=ui.Label("The \"RF Sentinel\" layer predicts the locations of informal settlements using freely available Sentinel-2 satellite imagery as its sole input. Accuracy: 81%", {whiteSpace: 'wrap'})
var rfsosm_label=ui.Checkbox({
  label: 'RF Sentinel+OSM',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    },
  onChange: function(checked) {
  Map.layers().get(1).setShown(checked)
  Map.layers().get(0).setShown(false)
  Map.layers().get(2).setShown(false)
  Map.layers().get(3).setShown(false)
  Map.layers().get(4).setShown(false)
  }
})
var rfsosm_desc=ui.Label("The \"RF Sentinel+OSM\" layer utilizes an additional input layer on housing density derived from Open Street Maps. Accuracy: 92%", {whiteSpace: 'wrap'})
var s_label=ui.Checkbox({
  label: 'Sentinel-2',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    },
  onChange: function(checked) {
  Map.layers().get(3).setShown(checked)
  Map.layers().get(0).setShown(false)
  Map.layers().get(1).setShown(false)
  Map.layers().get(2).setShown(false)
  Map.layers().get(4).setShown(false)
  }
})
var s_desc=ui.Label("Satellite images from Sentinel-2 are the primary input for supervised classification. Images have a resolution of 10 meters per pixel, and are split into 12 spectral bands. Despite its low resolution, multispectral imagery allows us to distinguish materials based on how they reflect light. Here, we exploit the fact that the roofing of informal settlements are primarily built using corrugated iron and plastic rather than concrete.", {whiteSpace: 'wrap'})
var rad_label=ui.Checkbox({
  label: 'Reciprocal Area Density',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    },
  onChange: function(checked) {
  Map.layers().get(4).setShown(checked)
  Map.layers().get(0).setShown(false)
  Map.layers().get(1).setShown(false)
  Map.layers().get(2).setShown(false)
  Map.layers().get(3).setShown(false)
  }
})
var rad_desc=ui.Label("Data extracted from Open Street Maps provide information on a second important characteristic of informal settlements. Unlike planned developments, which are mainly composed of larger structures that are spaced apart, informal settlements are composed of smaller structures that are closer together. This layer uses freely available data from Open Street Maps to detect clusters of small structures", {whiteSpace: 'wrap'})
Map.add(console)
home()
// set position of panel
var legend = ui.Panel({
  style: {
    position: 'bottom-left',
    padding: '8px 15px'
  }
});
// Create legend title
var legendTitle = ui.Label({
  value: 'Legend',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    }
});
// Creates and styles 1 row of the legend.
var makeRow = function(color, name) {
      // Create the label filled with the description text.
      var description = ui.Label({
        value: name,
        style: {margin: '0 0 4px 6px'}
      });
      // return the panel
      return ui.Panel({
        widgets: [colorBox, description],
        layout: ui.Panel.Layout.Flow('horizontal')
      });
};
// set position of panel
var legend = ui.Panel({
  style: {
    position: 'bottom-left',
    padding: '8px 15px'
  }
});
// Create legend title
var legendTitle = ui.Label({
  value: 'Legend',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    }
});
// Add the title to the panel
legend.add(legendTitle);
// Creates and styles 1 row of the legend.
var makeRow = function(color, name, border) {
      // Create the label that is actually the colored box.
      var colorBox = ui.Label({
        style: {
          backgroundColor: '#' + color,
          // Use padding to give the box height and width.
          padding: '7px',
          margin: '0 0 4px 0',
          border: '3px solid #'+border
        }
      });
      // Create the label filled with the description text.
      var description = ui.Label({
        value: name,
        style: {margin: '0 0 4px 6px'}
      });
      // return the panel
      return ui.Panel({
        widgets: [colorBox, description],
        layout: ui.Panel.Layout.Flow('horizontal')
      });
};
//  Palette with the colors
var palette_vis= [
  '49cc47', 
  '0008ff',
  'fff700']
// name of the legend
var names = ['vegetation','urban','informal settlement'];
// Add color and and names
legend.add(makeRow('49cc47', 'vegetation', '000000'));
legend.add(makeRow('2ff5ff', 'urban','0008ff'));
legend.add(makeRow('fff700', 'informal settlement','ff0000'));
// add legend to map (alternatively you can also print the legend to the console)
Map.add(legend);