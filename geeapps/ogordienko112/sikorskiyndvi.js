var geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.453051293898472,
                50.45157942059264
              ],
              [
                30.462213719893345,
                50.450042336751764
              ],
              [
                30.463737214613804,
                50.449844220090554
              ],
              [
                30.46410199503983,
                50.449885209812656
              ],
              [
                30.464509690810093,
                50.45020629474059
              ],
              [
                30.465646947432408,
                50.451162705018525
              ],
              [
                30.453056907453213,
                50.453238330697864
              ],
              [
                30.453013992108975,
                50.45222731217584
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.26160992621274,
                50.37631216747434
              ],
              [
                30.259678735722016,
                50.376558487280924
              ],
              [
                30.25757588385434,
                50.3743689330455
              ],
              [
                30.256717576969574,
                50.37315323417628
              ],
              [
                30.254400148380707,
                50.37033396204491
              ],
              [
                30.25628842352719,
                50.370005492260425
              ],
              [
                30.265386476505707,
                50.3665837967977
              ],
              [
                30.27241413722435,
                50.373914449499175
              ],
              [
                30.26241486201683,
                50.377910348183256
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.26149290973807,
                50.36673335936553
              ],
              [
                30.25977629596854,
                50.365583617935144
              ],
              [
                30.252667202638083,
                50.361154965630675
              ],
              [
                30.252881779359274,
                50.3608264323084
              ],
              [
                30.252624287293845,
                50.36041576245777
              ],
              [
                30.25326801745742,
                50.35904683729434
              ],
              [
                30.26073528735488,
                50.35598030166534
              ],
              [
                30.2726623368478,
                50.36364409007721
              ],
              [
                30.26249140026333,
                50.36733973943821
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.286066760348177,
                50.37259441955285
              ],
              [
                30.28271936349759,
                50.367776864334985
              ],
              [
                30.289156665133333,
                50.36553215452894
              ],
              [
                30.29370569162259,
                50.370897382041136
              ],
              [
                30.292847384737826,
                50.371718536803606
              ],
              [
                30.290358294772005,
                50.37221122283962
              ],
              [
                30.287182559298373,
                50.373798731931686
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.326374039545726,
                50.36640061455498
              ],
              [
                30.329120621576976,
                50.36114438948443
              ],
              [
                30.33203886498518,
                50.35983024225861
              ],
              [
                30.342853531733226,
                50.365798368295096
              ],
              [
                30.341566071406078,
                50.36645536383599
              ],
              [
                30.34379766930647,
                50.36771457986602
              ],
              [
                30.337250688396942,
                50.37164714650502
              ],
              [
                30.334761598431122,
                50.37142817296179
              ],
              [
                30.333216646038544,
                50.372304061071226
              ],
              [
                30.331671693645966,
                50.37159240321394
              ],
              [
                30.327637651287567,
                50.36803395381192
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.36892715455859,
                50.3504051282106
              ],
              [
                30.36794010164111,
                50.3470641770592
              ],
              [
                30.37390533449023,
                50.34353127630918
              ],
              [
                30.375836524980954,
                50.34273702212881
              ],
              [
                30.378497276323728,
                50.34695463369742
              ],
              [
                30.379012260454587,
                50.347995285432354
              ],
              [
                30.378239784258298,
                50.34848821776826
              ],
              [
                30.371888313311032,
                50.35037774432055
              ],
              [
                30.36974254609912,
                50.351171870720016
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.382693295676344,
                50.35561002805088
              ],
              [
                30.381362920004957,
                50.35588383606435
              ],
              [
                30.379431729514234,
                50.35643144735368
              ],
              [
                30.378144269187086,
                50.35621240359596
              ],
              [
                30.377457623679273,
                50.35552788533889
              ],
              [
                30.377414708335035,
                50.35489811982516
              ],
              [
                30.379131322104566,
                50.35396714680663
              ],
              [
                30.379174237448805,
                50.35347427134724
              ],
              [
                30.378230099875562,
                50.35325521394512
              ],
              [
                30.37853050728523,
                50.35278971360974
              ],
              [
                30.38132000466072,
                50.35226944312802
              ],
              [
                30.38226414223396,
                50.353364742772534
              ],
              [
                30.38848686714851,
                50.351694400699614
              ],
              [
                30.389860158164137,
                50.353364742772534
              ],
              [
                30.383680348593824,
                50.35506240728632
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#2c8b54",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #2c8b54 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.453051293898472,
                50.45157942059264
              ],
              [
                30.462213719893345,
                50.450042336751764
              ],
              [
                30.463737214613804,
                50.449844220090554
              ],
              [
                30.46410199503983,
                50.449885209812656
              ],
              [
                30.464509690810093,
                50.45020629474059
              ],
              [
                30.465646947432408,
                50.451162705018525
              ],
              [
                30.453056907453213,
                50.453238330697864
              ],
              [
                30.453013992108975,
                50.45222731217584
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.26160992621274,
                50.37631216747434
              ],
              [
                30.259678735722016,
                50.376558487280924
              ],
              [
                30.25757588385434,
                50.3743689330455
              ],
              [
                30.256717576969574,
                50.37315323417628
              ],
              [
                30.254400148380707,
                50.37033396204491
              ],
              [
                30.25628842352719,
                50.370005492260425
              ],
              [
                30.265386476505707,
                50.3665837967977
              ],
              [
                30.27241413722435,
                50.373914449499175
              ],
              [
                30.26241486201683,
                50.377910348183256
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.26149290973807,
                50.36673335936553
              ],
              [
                30.25977629596854,
                50.365583617935144
              ],
              [
                30.252667202638083,
                50.361154965630675
              ],
              [
                30.252881779359274,
                50.3608264323084
              ],
              [
                30.252624287293845,
                50.36041576245777
              ],
              [
                30.25326801745742,
                50.35904683729434
              ],
              [
                30.26073528735488,
                50.35598030166534
              ],
              [
                30.2726623368478,
                50.36364409007721
              ],
              [
                30.26249140026333,
                50.36733973943821
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.286066760348177,
                50.37259441955285
              ],
              [
                30.28271936349759,
                50.367776864334985
              ],
              [
                30.289156665133333,
                50.36553215452894
              ],
              [
                30.29370569162259,
                50.370897382041136
              ],
              [
                30.292847384737826,
                50.371718536803606
              ],
              [
                30.290358294772005,
                50.37221122283962
              ],
              [
                30.287182559298373,
                50.373798731931686
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.326374039545726,
                50.36640061455498
              ],
              [
                30.329120621576976,
                50.36114438948443
              ],
              [
                30.33203886498518,
                50.35983024225861
              ],
              [
                30.342853531733226,
                50.365798368295096
              ],
              [
                30.341566071406078,
                50.36645536383599
              ],
              [
                30.34379766930647,
                50.36771457986602
              ],
              [
                30.337250688396942,
                50.37164714650502
              ],
              [
                30.334761598431122,
                50.37142817296179
              ],
              [
                30.333216646038544,
                50.372304061071226
              ],
              [
                30.331671693645966,
                50.37159240321394
              ],
              [
                30.327637651287567,
                50.36803395381192
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.36892715455859,
                50.3504051282106
              ],
              [
                30.36794010164111,
                50.3470641770592
              ],
              [
                30.37390533449023,
                50.34353127630918
              ],
              [
                30.375836524980954,
                50.34273702212881
              ],
              [
                30.378497276323728,
                50.34695463369742
              ],
              [
                30.379012260454587,
                50.347995285432354
              ],
              [
                30.378239784258298,
                50.34848821776826
              ],
              [
                30.371888313311032,
                50.35037774432055
              ],
              [
                30.36974254609912,
                50.351171870720016
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.382693295676344,
                50.35561002805088
              ],
              [
                30.381362920004957,
                50.35588383606435
              ],
              [
                30.379431729514234,
                50.35643144735368
              ],
              [
                30.378144269187086,
                50.35621240359596
              ],
              [
                30.377457623679273,
                50.35552788533889
              ],
              [
                30.377414708335035,
                50.35489811982516
              ],
              [
                30.379131322104566,
                50.35396714680663
              ],
              [
                30.379174237448805,
                50.35347427134724
              ],
              [
                30.378230099875562,
                50.35325521394512
              ],
              [
                30.37853050728523,
                50.35278971360974
              ],
              [
                30.38132000466072,
                50.35226944312802
              ],
              [
                30.38226414223396,
                50.353364742772534
              ],
              [
                30.38848686714851,
                50.351694400699614
              ],
              [
                30.389860158164137,
                50.353364742772534
              ],
              [
                30.383680348593824,
                50.35506240728632
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    geometry2 = ui.import && ui.import("geometry2", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            30.312073458956576,
            50.35781173228841
          ]
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Point([30.312073458956576, 50.35781173228841]);
var aoi = ee.FeatureCollection(geometry);
var aoi2 = ee.FeatureCollection(geometry2);
Map.centerObject (aoi2,13);
var imageCollection = ee.ImageCollection('COPERNICUS/S2')
  .filterBounds(aoi)
  .filterDate(ee.Date('2021-08-01'), ee.Date('2021-08-12'))
  .filter(ee.Filter.lt('CLOUD_COVERAGE_ASSESSMENT',15))
 .sort('CLOUD_COVERAGE_ASSESSMENT',false);
var image = imageCollection
 .median()
 .clip(aoi);
Map.addLayer (image,{bands: ['B4','B3','B2'],gamma:2, min:300, max:5000},'RGB');
function addNDVI(image) {
 var ndvi = image.normalizedDifference(['B8', 'B4']).rename('NDVI');
 return image.addBands(ndvi);
}
var collection_with_ndvi = imageCollection.map(addNDVI);
var imageNDVI = addNDVI(image);
var vis_collection = {bands: ['NDVI'], min: 0, max: 2, palette: [
      'FFFFFF', 'CE7E45', 'FCD163', '66A000', '207401',
      '056201', '004C00', '023B01', '012E01', '011301']};
Map.addLayer (imageNDVI,vis_collection,'NDVI сегодня');
var imageCollection2 = ee.ImageCollection('COPERNICUS/S2')
  .filterBounds(aoi)
  .filterDate(ee.Date('2021-05-01'), ee.Date('2021-05-12'))
  .filter(ee.Filter.lt('CLOUD_COVERAGE_ASSESSMENT',15))
 .sort('CLOUD_COVERAGE_ASSESSMENT',false);
var image2 = imageCollection2
 .median()
 .clip(aoi);
//Map.addLayer (image2,{bands: ['B4','B3','B2'],gamma:2, min:300, max:5000},'RGB');
function addNDVI2(image) {
 var ndvi = image2.normalizedDifference(['B8', 'B4']).rename('NDVI');
 return image2.addBands(ndvi);
}
var collection_with_ndvi2 = imageCollection2.map(addNDVI);
var imageNDVI2 = addNDVI2(image);
Map.addLayer (imageNDVI2,vis_collection,'NDVI май', false);
////////////////////////////////////////////////////////////////////////////////////////
// set position of panel
var legend = ui.Panel({
  style: {
    position: 'bottom-left',
    padding: '8px 15px'
  }
});
// Create legend title
var legendTitle = ui.Label({
  value: 'NDVI индекс расстительности',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    }
});
// Add the title to the panel
legend.add(legendTitle);
// Creates and styles 1 row of the legend.
var makeRow = function(color, name) {
      // Create the label that is actually the colored box.
      var colorBox = ui.Label({
        style: {
          backgroundColor: '#' + color,
          // Use padding to give the box height and width.
          padding: '8px',
          margin: '0 0 4px 0'
        }
      });
      // Create the label filled with the description text.
      var description = ui.Label({
        value: name,
        style: {margin: '0 0 4px 6px'}
      });
      // return the panel
      return ui.Panel({
        widgets: [colorBox, description],
        layout: ui.Panel.Layout.Flow('horizontal')
      });
};
//  Palette with the colors
var palette =['FFFFFF', 'CE7E45', 'FCD163', '66A000',
    '023B01', '012E01', '011301'];
// name of the legend
var names = ['отсутствие растений','голая почва','угнетенная растительность','низкая вегетация','средняя вегетация','хорошая вегетация','высокая вегетация(сорняк)',''];
// Add color and and names
for (var i = 0; i < 7; i++) {
  legend.add(makeRow(palette[i], names[i]));
  }  
// add legend to map (alternatively you can also print the legend to the console)  
Map.add(legend);  
//////////////////////////////////////////////////////////////////////////////////
print (collection_with_ndvi)
// Create an inspector panel with a horizontal layout.
var inspector2 = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  style: {position:'top-right'}
});
inspector2.add(ui.Label('Кликни чтобы узнать о здоровье растений'));
Map.add(inspector2);
Map.style().set('cursor', 'crosshair');
Map.onClick(function(coords) {
  inspector2.clear();
  inspector2.style().set('shown', true);
  inspector2.add(ui.Label('Загрузка...', {color: 'gray'}));
  var point = ee.Geometry.Point(coords.lon, coords.lat);
  var sampledPoint = imageNDVI.reduceRegion(ee.Reducer.mean(), point, 30);
  var computedValue = sampledPoint.get('NDVI');
  computedValue.evaluate(function(result) {
    inspector2.clear();
    inspector2.add(ui.Label({
      value: 'NDVI в этой точке: ' + result.toFixed(4),
      style: {stretch: 'vertical'}
    }));
    inspector2.add(ui.Button({
      label: 'Закрыть',
      onClick: function() {
        inspector2.style().set('shown', false);
      }
    }));
  });
});
/////////////////////////////////////////////////////////////////////////////////////////////