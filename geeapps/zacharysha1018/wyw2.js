var geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.93054803647549,
                40.54718133415859
              ],
              [
                116.92505487241299,
                40.54170260966443
              ],
              [
                116.9422210101083,
                40.540919898153774
              ],
              [
                116.93913110532314,
                40.54822484991863
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.85021051206142,
                40.55918078371293
              ],
              [
                116.84540399350674,
                40.563354001229065
              ],
              [
                116.84162744321377,
                40.5583982764645
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.84849389829189,
                40.48741294874452
              ],
              [
                116.85089715756924,
                40.498378825904425
              ],
              [
                116.83956750669033,
                40.489240719386
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.87973626889736,
                40.51456327390505
              ],
              [
                116.87767633237392,
                40.52709048682493
              ],
              [
                116.86943658628017,
                40.52630760460266
              ],
              [
                116.8598235491708,
                40.51691230464602
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.06444391049892,
                40.53987626857972
              ],
              [
                117.06925042905361,
                40.54770309407103
              ],
              [
                117.05723413266689,
                40.55031183266006
              ],
              [
                117.05277093686611,
                40.54535514245437
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.98238977231533,
                40.49733453386093
              ],
              [
                116.99886926450283,
                40.49550698367136
              ],
              [
                117.0026458147958,
                40.50386109244608
              ],
              [
                116.98753961362392,
                40.50568841506205
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.9696868304208,
                40.478795645248205
              ],
              [
                116.97106012143642,
                40.48610736780988
              ],
              [
                116.95973047055752,
                40.48845739520639
              ],
              [
                116.95080407895595,
                40.481407066160976
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.9480574969247,
                40.53335321538281
              ],
              [
                116.93741449155361,
                40.52108815608689
              ],
              [
                116.95732721128017,
                40.52082717299231
              ],
              [
                116.95664056577236,
                40.53100476076178
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.98479303159267,
                40.53987626857972
              ],
              [
                116.9916594866708,
                40.538571708748286
              ],
              [
                116.99131616391689,
                40.54378979564732
              ],
              [
                116.98479303159267,
                40.54483336425015
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.8272078875497,
                40.55722449844217
              ],
              [
                116.8213714007333,
                40.55996328181486
              ],
              [
                116.81673654355556,
                40.557094077391575
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.83252939023525,
                40.51873927165718
              ],
              [
                116.82755121030361,
                40.52239305631887
              ],
              [
                116.82377466001064,
                40.51952224227831
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.96934350766689,
                40.446536223306516
              ],
              [
                116.95698388852627,
                40.455418905138714
              ],
              [
                116.9535506609872,
                40.44810384071066
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.86377176084072,
                40.58375989538192
              ],
              [
                116.86403831478907,
                40.58050746798116
              ],
              [
                116.86635574337794,
                40.58044228017128
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.85997516713714,
                40.54661036466378
              ],
              [
                116.86152011952971,
                40.54308834890895
              ],
              [
                116.86804325185393,
                40.541783851630356
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.03163654409026,
                40.526388865237045
              ],
              [
                117.01962024770354,
                40.5303031801528
              ],
              [
                117.01241046987151,
                40.523257248696325
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.9740206520719,
                40.47147967227781
              ],
              [
                116.98775356222815,
                40.47513603150185
              ],
              [
                116.98260372091956,
                40.482970416541974
              ],
              [
                116.97539394308752,
                40.48270928510365
              ],
              [
                116.9743639748258,
                40.47879219162708
              ],
              [
                116.96234767843909,
                40.476441825831095
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.80647914816565,
                40.55735146966213
              ],
              [
                116.8092257301969,
                40.558133989146214
              ],
              [
                116.79926937033362,
                40.56048149271943
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.8612391274137,
                40.57469517242717
              ],
              [
                116.85995166708655,
                40.57573825936527
              ],
              [
                116.85617511679358,
                40.572413363056064
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.85128276755042,
                40.57130502757041
              ],
              [
                116.84990947653479,
                40.570392266915654
              ],
              [
                116.84930866171545,
                40.56863190763672
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.79652278830237,
                40.56674109979526
              ],
              [
                116.79557865072913,
                40.5723481673592
              ],
              [
                116.79429119040198,
                40.57202218792208
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "Class": 0
      },
      "color": "#0000ff",
      "mode": "Feature",
      "shown": true,
      "locked": false
    }) || /* color: #0000ff */ee.Feature(
        ee.Geometry.MultiPolygon(
            [[[[116.93054803647549, 40.54718133415859],
               [116.92505487241299, 40.54170260966443],
               [116.9422210101083, 40.540919898153774],
               [116.93913110532314, 40.54822484991863]]],
             [[[116.85021051206142, 40.55918078371293],
               [116.84540399350674, 40.563354001229065],
               [116.84162744321377, 40.5583982764645]]],
             [[[116.84849389829189, 40.48741294874452],
               [116.85089715756924, 40.498378825904425],
               [116.83956750669033, 40.489240719386]]],
             [[[116.87973626889736, 40.51456327390505],
               [116.87767633237392, 40.52709048682493],
               [116.86943658628017, 40.52630760460266],
               [116.8598235491708, 40.51691230464602]]],
             [[[117.06444391049892, 40.53987626857972],
               [117.06925042905361, 40.54770309407103],
               [117.05723413266689, 40.55031183266006],
               [117.05277093686611, 40.54535514245437]]],
             [[[116.98238977231533, 40.49733453386093],
               [116.99886926450283, 40.49550698367136],
               [117.0026458147958, 40.50386109244608],
               [116.98753961362392, 40.50568841506205]]],
             [[[116.9696868304208, 40.478795645248205],
               [116.97106012143642, 40.48610736780988],
               [116.95973047055752, 40.48845739520639],
               [116.95080407895595, 40.481407066160976]]],
             [[[116.9480574969247, 40.53335321538281],
               [116.93741449155361, 40.52108815608689],
               [116.95732721128017, 40.52082717299231],
               [116.95664056577236, 40.53100476076178]]],
             [[[116.98479303159267, 40.53987626857972],
               [116.9916594866708, 40.538571708748286],
               [116.99131616391689, 40.54378979564732],
               [116.98479303159267, 40.54483336425015]]],
             [[[116.8272078875497, 40.55722449844217],
               [116.8213714007333, 40.55996328181486],
               [116.81673654355556, 40.557094077391575]]],
             [[[116.83252939023525, 40.51873927165718],
               [116.82755121030361, 40.52239305631887],
               [116.82377466001064, 40.51952224227831]]],
             [[[116.96934350766689, 40.446536223306516],
               [116.95698388852627, 40.455418905138714],
               [116.9535506609872, 40.44810384071066]]],
             [[[116.86377176084072, 40.58375989538192],
               [116.86403831478907, 40.58050746798116],
               [116.86635574337794, 40.58044228017128]]],
             [[[116.85997516713714, 40.54661036466378],
               [116.86152011952971, 40.54308834890895],
               [116.86804325185393, 40.541783851630356]]],
             [[[117.03163654409026, 40.526388865237045],
               [117.01962024770354, 40.5303031801528],
               [117.01241046987151, 40.523257248696325]]],
             [[[116.9740206520719, 40.47147967227781],
               [116.98775356222815, 40.47513603150185],
               [116.98260372091956, 40.482970416541974],
               [116.97539394308752, 40.48270928510365],
               [116.9743639748258, 40.47879219162708],
               [116.96234767843909, 40.476441825831095]]],
             [[[116.80647914816565, 40.55735146966213],
               [116.8092257301969, 40.558133989146214],
               [116.79926937033362, 40.56048149271943]]],
             [[[116.8612391274137, 40.57469517242717],
               [116.85995166708655, 40.57573825936527],
               [116.85617511679358, 40.572413363056064]]],
             [[[116.85128276755042, 40.57130502757041],
               [116.84990947653479, 40.570392266915654],
               [116.84930866171545, 40.56863190763672]]],
             [[[116.79652278830237, 40.56674109979526],
               [116.79557865072913, 40.5723481673592],
               [116.79429119040198, 40.57202218792208]]]]),
        {
          "Class": 0,
          "system:index": "0"
        }),
    table = ui.import && ui.import("table", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.79395587597244,
                40.59021404281215
              ],
              [
                116.79395587597244,
                40.43464845329869
              ],
              [
                117.10019977245682,
                40.43464845329869
              ],
              [
                117.10019977245682,
                40.59021404281215
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [
        {
          "type": "rectangle"
        }
      ],
      "properties": {},
      "color": "#999900",
      "mode": "Geometry",
      "shown": true,
      "locked": false
    }) || 
    /* color: #999900 */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[116.79395587597244, 40.59021404281215],
          [116.79395587597244, 40.43464845329869],
          [117.10019977245682, 40.43464845329869],
          [117.10019977245682, 40.59021404281215]]], null, false);
function maskS2clouds(image) {
  var qa = image.select('QA60');
  // Bits 10 and 11 are clouds and cirrus, respectively.
  var cloudBitMask = 1 << 10;
  var cirrusBitMask = 1 << 11;
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0)
      .and(qa.bitwiseAnd(cirrusBitMask).eq(0));
  return image.updateMask(mask).divide(10000);
}
var features = [ee.Feature(geometry)]; 
/**********************************ONE Class SVM******************************/
var MultibandImgSVM_Classification=function(GreenHouse,testImage,ScaleMeter){ 
var TrainBand=ee.Image(testImage);
var training = TrainBand.sampleRegions({
  collection: features,
  properties: ['Class'],
  scale: ScaleMeter //分辨率
});
// Create an SVM classifier with custom parameters.
var classifier = ee.Classifier.svm({
  svmType: 'ONE_CLASS',  // one-svm
  kernelType: 'RBF',
  gamma: 0.2,
  //cost: 100,
  nu:0.1
});
// Train the classifier.
var trained = classifier.train(training, 'Class');
var classified = TrainBand.classify(trained);
return classified;
}
/**********************************ONE Class SVM******************************/
var dataset = ee.ImageCollection('COPERNICUS/S2')
                  .filterDate('2019-06-01', '2019-09-30')
                  // Pre-filter to get less cloudy granules.
                  .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 20))
                  .map(maskS2clouds);
var bj = dataset.median().clip(table)
var rgbVis = {
  min: 0.0,
  max: 0.3,
  bands: ['B8', 'B4', 'B3'],
};
var ndwi = bj.expression(
    '(green - nir) / (green + nir)',
    {
        green: bj.select('B3'),  
        nir: bj.select('B8')    
    });
var water = ndwi.where(ndwi.gt(0),1).where(ndwi.lt(0),0)
var classify_bjwater=MultibandImgSVM_Classification(features,bj.select(['B2', 'B3', 'B4', 'B8', 'B11', 'B12']), 20);
Map.addLayer(water,{min:0,max:1},'water')
Map.addLayer(bj, rgbVis, 'NIRGB');
Map.addLayer(classify_bjwater, {min: 0, max: 1, palette: ["green", "black"]}, 'classify_bjwater');
Map.setCenter(116.9400, 40.5000, 11);