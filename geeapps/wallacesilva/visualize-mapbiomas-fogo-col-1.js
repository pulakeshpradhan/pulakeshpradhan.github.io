var cerrado_geometry = ui.import && ui.import("cerrado_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -61.30063671551424,
                -0.4380184975494845
              ],
              [
                -61.30063671551424,
                -25.640236868483356
              ],
              [
                -40.118996090514244,
                -25.640236868483356
              ],
              [
                -40.118996090514244,
                -0.4380184975494845
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-61.30063671551424, -0.4380184975494845],
          [-61.30063671551424, -25.640236868483356],
          [-40.118996090514244, -25.640236868483356],
          [-40.118996090514244, -0.4380184975494845]]], null, false),
    amazonia_geometry = ui.import && ui.import("amazonia_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -76.50571484051424,
                5.442446218098085
              ],
              [
                -76.50571484051424,
                -16.719015161350978
              ],
              [
                -42.579933590514244,
                -16.719015161350978
              ],
              [
                -42.579933590514244,
                5.442446218098085
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#0b4a8b",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-76.50571484051424, 5.442446218098085],
          [-76.50571484051424, -16.719015161350978],
          [-42.579933590514244, -16.719015161350978],
          [-42.579933590514244, 5.442446218098085]]], null, false),
    caatinga_geometry = ui.import && ui.import("caatinga_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -46.622902340514244,
                -1.756107122853905
              ],
              [
                -46.622902340514244,
                -17.642658948854034
              ],
              [
                -34.933449215514244,
                -17.642658948854034
              ],
              [
                -34.933449215514244,
                -1.756107122853905
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#ffc82d",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-46.622902340514244, -1.756107122853905],
          [-46.622902340514244, -17.642658948854034],
          [-34.933449215514244, -17.642658948854034],
          [-34.933449215514244, -1.756107122853905]]], null, false),
    mata_atlantica_geometry = ui.import && ui.import("mata_atlantica_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -58.136574215514244,
                -4.739249915822113
              ],
              [
                -58.136574215514244,
                -30.371641132062337
              ],
              [
                -34.230324215514244,
                -30.371641132062337
              ],
              [
                -34.230324215514244,
                -4.739249915822113
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#00ffff",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-58.136574215514244, -4.739249915822113],
          [-58.136574215514244, -30.371641132062337],
          [-34.230324215514244, -30.371641132062337],
          [-34.230324215514244, -4.739249915822113]]], null, false),
    pampa_geometry = ui.import && ui.import("pampa_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -58.31235546551424,
                -27.13609545229076
              ],
              [
                -58.31235546551424,
                -34.30596232986922
              ],
              [
                -48.117042965514244,
                -34.30596232986922
              ],
              [
                -48.117042965514244,
                -27.13609545229076
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#bf04c2",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #bf04c2 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-58.31235546551424, -27.13609545229076],
          [-58.31235546551424, -34.30596232986922],
          [-48.117042965514244, -34.30596232986922],
          [-48.117042965514244, -27.13609545229076]]], null, false),
    pantanal_geometry = ui.import && ui.import("pantanal_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -59.71860546551424,
                -15.367570682056055
              ],
              [
                -59.71860546551424,
                -22.835627675337726
              ],
              [
                -53.917824215514244,
                -22.835627675337726
              ],
              [
                -53.917824215514244,
                -15.367570682056055
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#ff0000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-59.71860546551424, -15.367570682056055],
          [-59.71860546551424, -22.835627675337726],
          [-53.917824215514244, -22.835627675337726],
          [-53.917824215514244, -15.367570682056055]]], null, false),
    brasil_geometry = ui.import && ui.import("brasil_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -74.27281607176396,
                5.590083826285442
              ],
              [
                -74.27281607176396,
                -34.06634555817831
              ],
              [
                -33.88222470174418,
                -34.06634555817831
              ],
              [
                -33.88222470174418,
                5.590083826285442
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-74.27281607176396, 5.590083826285442],
          [-74.27281607176396, -34.06634555817831],
          [-33.88222470174418, -34.06634555817831],
          [-33.88222470174418, 5.590083826285442]]], null, false);
/**
 * 
 * utilize o dicionario options para definir os parametros iniciais
 * utilize o dicionario visParams para alterar a composição dos mosaicos
 * altere o tamanho das thumbnails nos parametros widht e heigth na função
 * 'setThumbnails()', estes parametros estão entre as linha 53 e 56
 * 
 * 
*/
var options = {
  year:'2020',
  region:'Brasil',//'Brasil','Amazônia','Caatinga','Cerrado','Mata Atlântica','Pampa','Pantanal',
  vis:{
    palette:['ff0000'],
  },
  visName: 'anual',
};
var visParams = {
  mosaic:{
    //falseColor
    bands:['swir1_median','nir_median','red_median'],
    min:138,
    max:4540,
  },
  standart:{
    palette:['ff0000'],
    forceRgbOutput:true,
  },
  monthly:{
    palette:['a900ff', '6f02ff', '020aff', '0675ff', '06ffff', 'ffee00', 'ff7700', 'ff0800', 'c20202', '0aa602', '0cff00'],
    min:1,
    max:12,
    forceRgbOutput:true,
  },
  landcover:{
    min:0,
    max:49,
    palette:require('users/mapbiomas/modules:Palettes.js').get('classification6'),
    forceRgbOutput:true,
  },
};
function getFire(year){
  return ee.ImageCollection('projects/mapbiomas-workspace/FOGO1/monthly-coverage-collection-1-v9')
    .median()
    .select('monthly_' + year);
}
function setThumbs (biome){
  biome = biome || 'Cerrado';
  var yearsList = ee.List.sequence(1985,2020,1).getInfo();
    options.panel.clear();
  yearsList.forEach(function(year){
      var backgrondColor = 'f9eac3';
      var fire = getFire(year)
        .clip(options.geometry);
      var landcover = ee.ImageCollection('projects/mapbiomas-workspace/COLECAO6/mapbiomas-collection60-integration-v0-12')
      .median()
      .select('classification_'+year);
      var mapa = {
        'anual':ee.Image(1).updateMask(fire).visualize(visParams.standart),
        'mensal':fire.visualize(visParams.monthly),
        'cobertura':landcover.updateMask(fire).visualize(visParams.landcover),
      };
      var line = ee.Image(1).paint(options.geometry, '000000', 0.5);
      line = line.updateMask(line.neq(1)).visualize({palette:'000000'});
      var image = mapa[options.visName]
        .blend(line);
      var thumbFire_standart = ui.Thumbnail({
        image:image,
        params:{
          region:options.geometry.geometry().bounds()
        },
        onClick:function(){
          if(options.year === ''+year){
            switchLayer(null);
            return ;
          }
          options.year = ''+year;
          aktualizer(''+year);
          return ;
        }, 
        style:{
          width:'150px',
          height:'150px',
          backgroundColor:backgrondColor,
        }
        });
      var thumbs = ui.Panel({
        widgets:[
          thumbFire_standart,
          ],
        layout:ui.Panel.Layout.Flow('vertical',true),
        // style:{}
        });
      var label = ui.Label({
        value:''+year,
        style:{
          // position:''
        },
        // targetUrl:
        })
      var panel = ui.Panel({
        widgets:[label,thumbs],
        layout:ui.Panel.Layout.Flow('vertical',true),
        style:{}
      });
      options.panel.add(panel);
  });
}
function plotLayer(obj, position, mapp){
  mapp = mapp || Map;
  position = position || 0;
  var layer = mapp.layers().get(position);
  if (layer === undefined){
    mapp.addLayer(ee.Image().select(),{},''+position,false);
  }
  layer = mapp.layers().get(position);
  var layerObject = 
  ui.Map.Layer({  
    eeObject:   obj.eeObject  ||  layer.getEeObject(),
    visParams:  obj.visParams ||  layer.getVisParams(),
    name:       obj.name      ||  layer.getName(),
    shown:      obj.shown     ||  layer.getShown(),
    opacity:    obj.opacity   ||  layer.getOpacity(),
  });
  mapp.layers().set(position, layerObject);
}
function getMosaic (year,biome){
  biome = biome || 'Cerrado';
  return ee.ImageCollection('projects/nexgenmap/MapBiomas2/LANDSAT/mosaics')
      .filterMetadata('biome', 'equals', biome)
      .filterMetadata('version', 'equals', '2')
      .filterMetadata('year', 'equals', year);
}
function aktualizer (year){
  var yearNumber = ee.Number.parse(year);
  var fire = getFire(year).clip(options.geometry);
    var obj = {
      eeObject:ee.Image(1).updateMask(fire),
      name: 'Area queimada no ano ' + year,
      visParams:visParams.standart,
      // shown:true
    };
  plotLayer(obj,0,options.mapp);
  if (options.firstRound === true){
    options.mapp.layers().get(0).setShown(true);
    options.firstRound = false;
  }
    obj = {
      eeObject:fire,
      name: 'Area queimada mensal no ano ' + year,
      visParams:visParams.monthly,
      // shown:true
    };
  plotLayer(obj,1,options.mapp);
  var landcover = ee.ImageCollection('projects/mapbiomas-workspace/COLECAO6/mapbiomas-collection60-integration-v0-8')
    .median()
    .select('classification_'+year);
    obj = {
      eeObject:landcover.updateMask(fire),
      name: 'Cobertura queimada no ano ' + year,
      visParams:visParams.landcover,
      // shown:true
    };
  plotLayer(obj,2,options.mapp);
  options.yearPanel.setValue(''+year);
}
function setLayout (){
  // reorganizando o root
  options.mapp = ui.root.widgets().get(0);
  options.panel = ui.Panel({
      // widgets:,
      layout:ui.Panel.Layout.Flow('horizontal',true),
      style:{
      // width:'',
      // height:'200px',
      }
    });
  var splitPanel = ui.SplitPanel({
    firstPanel:options.mapp,
    secondPanel:options.panel,
    orientation:'horizontal',
    // wipe:true, 
    style:{
      // width:'',
      // height:'30px',
    }
    });
  // var splitPanel = ui.Panel({
  //   widgets:[options.mapp, options.panel],
  //   layout:ui.Panel.Layout.flow('vertical', false),
  //   style:{
  //   }
  // });
  // ui.root.widgets().reset([options.mapp, options.panel]);
  ui.root.widgets().reset([splitPanel]);
  // ui.root.setLayout(ui.Panel.Layout.Flow('vertical',true));
  options.yearPanel = ui.Label({
      value:options.year,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        backgroundColor:'ffffffdd',
        fontSize:'42px',
        position:'bottom-left'
      }
  });
  options.regionPanel = ui.Panel({
    widgets:
    ui.Label({
      value:options.region,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        backgroundColor:'ffffff00',
        // fontSize:'12px',
      }
    }),
    // layout:,
    style:{
      // height:'200px',
      // width:'70px',
      position:'bottom-right',
      backgroundColor:'ffffff00',
      // fontSize:'20px',
    }});
  options.visPanel = ui.Panel({
    widgets:
    ui.Label({
      value:options.vis,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        backgroundColor:'ffffff00',
        // fontSize:'12px',
      }
    }),
    // layout:,
    style:{
      // height:'200px',
      // width:'70px',
      position:'bottom-right',
      backgroundColor:'ffffff00',
      // fontSize:'20px',
    }});
  options.mapp.add(options.yearPanel);
  options.mapp.add(ui.Label({
    value:'Last Update 10-08-2021 \ncode-source',
    style:{
      margin:'0px 0px 0px 0px',
      position:'bottom-right',
      fontSize:'10px',
      backgroundColor:'ffffffdd',
      whiteSpace:'pre',
      textAlign:'center'
    },
    // targetUrl:'https://code.earthengine.google.com/167fe9b483919c6aec6779ee97279e0f'
    // targetUrl:'https://code.earthengine.google.com/46316a0f8b04fca3e6c120e7950d621b' // atualização 10 ago 2021 - painel de thumb direita
    targetUrl:'https://code.earthengine.google.com/1fa190cc11bfbdbebfab8bbb63f3972b' // atualização 11 ago 2021 - usuario pode escolher image da yhumbs
    }));
  options.mapp.add(options.regionPanel);
  options.mapp.add(options.visPanel);
  options.panel.add(ui.Label('thumbnails'));
}
function setSelectRegion (){
  var regions = ['Brasil','Amazônia','Caatinga','Cerrado','Mata Atlântica','Pampa','Pantanal','Canvas'];
  var color = '0000ff';
  var buttoms = regions.map(function(region){
    if (region !== options.region){
      color = '000000';
    }
    return ui.Button({
      label:region,
      onClick:function(){
        if (options.region === region && region !== 'Canvas'){
          return ;
        }
        options.region = region;
        setGeometry();
        setThumbs(region);
        aktualizer(options.year);
        options.regionPanel.widgets().get(0).widgets().forEach(function(buttom){
          var color_b = '0000ff';
          if (buttom.getLabel() !== options.region){
            color_b = '000000';
          }
          buttom.style().set('color',color_b);
        });
      },
      // disabled:,
      style:{
        color:color,
        margin:'0px 0px 0px 0px',
        fontSize:'10px',
        width:'90px'
      }
      });
  });
  var panelButtons = ui.Panel({
    widgets:buttoms,
    layout:ui.Panel.Layout.Flow('vertical',true),
    style:{
    }
    });
  options.regionPanel.clear();
  options.regionPanel.add(panelButtons);
}
function setSelectVis (){
  var viss_names = ['anual','mensal','cobertura'];
  var mapa = [2,1,0];  
  var color = '0000ff';
  var buttoms = mapa.map(function(int){
    var visName = viss_names[int];
      color = '000000';
    return ui.Button({
      label:visName,
      onClick:function(){
        options.visName = visName;
        setGeometry();
        switchLayer(int);
        setThumbs(options.region);
        options.visPanel.widgets().get(0).widgets().forEach(function(buttom){
          var color_b = '0000ff';
          if (visName !== options.visName){
            color_b = '000000';
          }
          buttom.style().set('color',color_b);
        });
      },
      // disabled:,
      style:{
        color:color,
        margin:'0px 0px 0px 0px',
        fontSize:'10px',
        width:'90px'
      }
      });
  });
  var panelButtons = ui.Panel({
    widgets:buttoms,
    layout:ui.Panel.Layout.Flow('vertical',true),
    style:{
    }
    });
  options.visPanel.clear();
  options.visPanel.add(panelButtons);
}
function setGeometry (){
  options.geometry = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas-2019')
    .filter(ee.Filter.eq('Bioma',options.region));
  if (options.region === 'Brasil'){
    options.geometry = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/brasil_2km');
  }
  if (options.region === 'Canvas'){
    options.geometry = ee.FeatureCollection(ee.Feature(ee.Geometry.Rectangle(options.mapp.getBounds())));
  }
    var line = ee.Image(1).paint(options.geometry,'000000',0.5);
    line = line.updateMask(line.neq(1));
    var obj = {
      eeObject:line,
      name: 'limite ' + options.region,
      visParams:{},
      shown:true,
      opacity:1
    };
  plotLayer(obj,3,options.mapp); 
}
function switchLayer (int){
  var layers = options.mapp.layers();
  var listLayers = [layers.get(0),layers.get(1),layers.get(2)];
  if (int !== null){
    listLayers.forEach(function(layer){
      layer.setOpacity(0);
    });
    listLayers[int].setOpacity(1);
    return ;
  }
  var layerOn;
  listLayers.forEach(function(layer){
    var opacity = layer.getOpacity();
    if (opacity === 1){
      layerOn = layers.indexOf(layer);
    }
  });
  if (layers.get(0).getOpacity() === 0 && layers.get(1).getOpacity() === 0 && layers.get(2).getOpacity() === 0){
    layers.get(0).setOpacity(1);
    position = 2;
  }
  var position = layerOn +1;
  if (position === 3){
    position = 0;
  }  
  [0,1,2].forEach(function(i){
    layers.get(i).setOpacity(0);
    if (i === position){
      layers.get(i).setOpacity(1);
      layers.get(i).setShown(true);
    }
  });
}
function init (){
  options.firstRound = true;
  setLayout();
  setSelectRegion();
  setSelectVis();
  // - ESTES TRÊS ADDS LAYERS SÃO NECESSARIOS PARA ATIVAR A LOGICA DO SETGEOMETRY ANTES DO AKTUALIZER
  options.mapp.addLayer(ee.Image().select(),{},'',true,1);
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  setGeometry();
  aktualizer(options.year);
  setThumbs();
  var centerObject = options.mapp.layers().get(0).getEeObject();
  options.mapp.centerObject(brasil_geometry);
  var line = ee.Image(1).paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas-2019'),'000000',0.5);
  line = line.updateMask(line.neq(1));
  var obj = {
      eeObject:line,
      name: 'limite dos biomas',
      visParams:{},
      shown:false,
      opacity:1
  };
  plotLayer(obj,4,options.mapp); 
  options.firstRound = false;
}
init();
// para redesenhar os limites da thumbnail, comente o init, utilize a layer de biomas como referencia
// Map.addLayer(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil'))
print({a:options.mapp})