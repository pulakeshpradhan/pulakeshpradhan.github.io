var cerrado_geometry = ui.import && ui.import("cerrado_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -61.30063671551424,
                -0.4380184975494845
              ],
              [
                -61.30063671551424,
                -25.640236868483356
              ],
              [
                -40.118996090514244,
                -25.640236868483356
              ],
              [
                -40.118996090514244,
                -0.4380184975494845
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-61.30063671551424, -0.4380184975494845],
          [-61.30063671551424, -25.640236868483356],
          [-40.118996090514244, -25.640236868483356],
          [-40.118996090514244, -0.4380184975494845]]], null, false),
    amazonia_geometry = ui.import && ui.import("amazonia_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -76.50571484051424,
                5.442446218098085
              ],
              [
                -76.50571484051424,
                -16.719015161350978
              ],
              [
                -42.579933590514244,
                -16.719015161350978
              ],
              [
                -42.579933590514244,
                5.442446218098085
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#0b4a8b",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-76.50571484051424, 5.442446218098085],
          [-76.50571484051424, -16.719015161350978],
          [-42.579933590514244, -16.719015161350978],
          [-42.579933590514244, 5.442446218098085]]], null, false),
    caatinga_geometry = ui.import && ui.import("caatinga_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -46.622902340514244,
                -1.756107122853905
              ],
              [
                -46.622902340514244,
                -17.642658948854034
              ],
              [
                -34.933449215514244,
                -17.642658948854034
              ],
              [
                -34.933449215514244,
                -1.756107122853905
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#ffc82d",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-46.622902340514244, -1.756107122853905],
          [-46.622902340514244, -17.642658948854034],
          [-34.933449215514244, -17.642658948854034],
          [-34.933449215514244, -1.756107122853905]]], null, false),
    mata_atlantica_geometry = ui.import && ui.import("mata_atlantica_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -58.136574215514244,
                -4.739249915822113
              ],
              [
                -58.136574215514244,
                -30.371641132062337
              ],
              [
                -34.230324215514244,
                -30.371641132062337
              ],
              [
                -34.230324215514244,
                -4.739249915822113
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#00ffff",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-58.136574215514244, -4.739249915822113],
          [-58.136574215514244, -30.371641132062337],
          [-34.230324215514244, -30.371641132062337],
          [-34.230324215514244, -4.739249915822113]]], null, false),
    pampa_geometry = ui.import && ui.import("pampa_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -58.31235546551424,
                -27.13609545229076
              ],
              [
                -58.31235546551424,
                -34.30596232986922
              ],
              [
                -48.117042965514244,
                -34.30596232986922
              ],
              [
                -48.117042965514244,
                -27.13609545229076
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#bf04c2",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #bf04c2 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-58.31235546551424, -27.13609545229076],
          [-58.31235546551424, -34.30596232986922],
          [-48.117042965514244, -34.30596232986922],
          [-48.117042965514244, -27.13609545229076]]], null, false),
    pantanal_geometry = ui.import && ui.import("pantanal_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -59.71860546551424,
                -15.367570682056055
              ],
              [
                -59.71860546551424,
                -22.835627675337726
              ],
              [
                -53.917824215514244,
                -22.835627675337726
              ],
              [
                -53.917824215514244,
                -15.367570682056055
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#ff0000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-59.71860546551424, -15.367570682056055],
          [-59.71860546551424, -22.835627675337726],
          [-53.917824215514244, -22.835627675337726],
          [-53.917824215514244, -15.367570682056055]]], null, false),
    brasil_geometry = ui.import && ui.import("brasil_geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -74.27281607176396,
                5.590083826285442
              ],
              [
                -74.27281607176396,
                -34.06634555817831
              ],
              [
                -33.88222470174418,
                -34.06634555817831
              ],
              [
                -33.88222470174418,
                5.590083826285442
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-74.27281607176396, 5.590083826285442],
          [-74.27281607176396, -34.06634555817831],
          [-33.88222470174418, -34.06634555817831],
          [-33.88222470174418, 5.590083826285442]]], null, false),
    geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPoint();
// --- --- DICIONARIO COM PARAMETROS DE START DO CODIGO E MEMORIA CACHE DO CODIGO
var options = {
  year:'2020', // string com o ano (1985 - 2020)
  region:'Brasil',//'Brasil','Amazônia','Caatinga','Cerrado','Mata Atlântica','Pampa','Pantanal',
  // -nota: parametro de estilo de ui, não é um parametro para este dicionario -> [ ] construir um dicionario para os parametros de visualização
  vis:{
        palette:['b01717'],
  },
  visName: 'acumulado', //'anual','mensal','cobertura','acumulado','frequencia'
  gifOrPng:'gif', // 'gif','png'
  clearPanel:'true', //'false','true'
  sizeThumbnail:'512px', //'64px','128px','256px','512px','1024px','2048px'
  backgroundColor:'fafafa', // valores RGB em hexadecimal
  limitThumb:'Biomas' // 'Biomas','Brasil','Esados','region'
};
// --- --- DICIONARIO COM PARAMETROS DE VISUALIZAÇÃO DE DOS DADOS
var visParams = {
  mosaic:{
    //falseColor
    bands:['swir1_median','nir_median','red_median'],
    min:138,
    max:4540,
  },
  standart:{
    palette:['b01717'],
    min:0,
    max:1,
    forceRgbOutput:true,
  },
  monthly:{
    palette:['a900ff', '6f02ff', '020aff', '0675ff', '06ffff', 'ffee00', 'ff7700', 'ff0800', 'c20202', '0aa602', '0cff00'],
    min:1,
    max:12,
    forceRgbOutput:true,
  },
  landcover:{
    min:0,
    max:49,
    palette:require('users/mapbiomas/modules:Palettes.js').get('classification6'),
    forceRgbOutput:true,
  },
  acumulado:{
    palette:['b01717'],    
  },
  frequencia:{
  min:0,
  max:35,
  palette:['ffffff','F8D71F','DAA118','BD6C12','9F360B','810004','4D0709']
},
};
// --- --- FABRICAS DE DADOS
function getAnual(year){
  return ee.Image('projects/mapbiomas-workspace/FOGO1/PROCESSADO/mapbiomas-fire-collection1-annual-burned-area-2')
    .select('burned_area_' + year);
}
function getMensal(year){
  return  ee.ImageCollection('projects/mapbiomas-workspace/FOGO1/monthly-coverage-collection-1-v9')
    .mosaic()
    .select('monthly_'+year);
}
function getCobertura(year){
  var landcover = ee.ImageCollection('projects/mapbiomas-workspace/COLECAO6/mapbiomas-collection60-integration-v0-12')
    .mosaic()
    .select('classification_'+year);
  var fire = ee.Image('projects/mapbiomas-workspace/FOGO1/PROCESSADO/mapbiomas-fire-collection1-annual-burned-area-2')
    .select('burned_area_' + year);
  return landcover.updateMask(fire);
}
function getAcumulado(year){
  return ee.Image('projects/mapbiomas-workspace/FOGO1/PROCESSADO/mapbiomas-fire-collection1-accumulated-burned-coverage-2')
    .select('fire_accumulated_1985_' + year);
}
function getFrequency(year){
  return ee.Image('projects/mapbiomas-workspace/FOGO1/PROCESSADO/mapbiomas-fire-collection1-fire-frequency-2')
    .select('fire_frequency_1985_' + year).divide(100).int();
}
// - função desatualizada - [ ] adequar ela a consulta do dicionario options
function getMosaic (year,biome){
  biome = biome || 'Cerrado';
  return ee.ImageCollection('projects/nexgenmap/MapBiomas2/LANDSAT/mosaics')
      .filterMetadata('biome', 'equals', biome)
      .filterMetadata('version', 'equals', '2')
      .filterMetadata('year', 'equals', year);
}
// --- --- FUNÇÕES DA INTERFACE DO USUARIO
function setLayout (){
  // reorganizando o root
  options.mapp = ui.root.widgets().get(0);
  options.panel = ui.Panel({
      // widgets:,
      layout:ui.Panel.Layout.Flow('horizontal',true),
      style:{
      // width:'',
      // height:'200px',
      }
    });
  options.thumbParams = ui.Panel({
      widgets:
      ui.Label({
        value:options.vis,
        style:{
          // height:'200px',
          // width:'70px',
          // position:'',
          backgroundColor:'ffffff00',
          // fontSize:'12px',
        }
      }),
      // layout:,
      style:{
        // height:'200px',
        // width:'70px',
        position:'bottom-left',
        backgroundColor:'ffffff00',
        // fontSize:'20px',
      }});
  options.panelPrincipal = ui.Panel({
      widgets:[options.thumbParams,options.panel],
      layout:ui.Panel.Layout.Flow('vertical'/*,true*/),
      style:{
      // width:'',
      // height:'200px',
      }
    });
  var splitPanel = ui.SplitPanel({
    firstPanel:options.mapp,
    secondPanel:options.panelPrincipal,
    orientation:'horizontal',
    // wipe:true, 
    style:{
      // width:'',
      // height:'30px',
    }
    });
  // var splitPanel = ui.Panel({
  //   widgets:[options.mapp, options.panel],
  //   layout:ui.Panel.Layout.flow('vertical', false),
  //   style:{
  //   }
  // });
  // ui.root.widgets().reset([options.mapp, options.panel]);
  ui.root.widgets().reset([splitPanel]);
  // ui.root.setLayout(ui.Panel.Layout.Flow('vertical',true));
  options.yearPanel = ui.Label({
      value:options.year,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        padding:'0px 15px 0px 15px',
        backgroundColor:'ffffffdd',
        fontSize:'42px',
        position:'bottom-right'
      }
  });
  options.regionPanel = ui.Panel({
    widgets:
    ui.Label({
      value:options.region,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        backgroundColor:'ffffff00',
        // fontSize:'12px',
      }
    }),
    // layout:,
    style:{
      // height:'200px',
      // width:'70px',
      position:'bottom-left',
      backgroundColor:'ffffff00',
      // fontSize:'20px',
    }});
  options.visPanel = ui.Panel({
    widgets:
    ui.Label({
      value:options.vis,
      style:{
        // height:'200px',
        // width:'70px',
        // position:'',
        backgroundColor:'ffffff00',
        // fontSize:'12px',
      }
    }),
    // layout:,
    style:{
      // height:'200px',
      // width:'70px',
      position:'bottom-left',
      backgroundColor:'ffffff00',
      // fontSize:'20px',
    }});
  options.mapp.add(ui.Label({
    value:'Last Update 14-08-2021 \ncode-source',
    style:{
      margin:'0px 0px 0px 0px',
      position:'bottom-right',
      fontSize:'10px',
      backgroundColor:'ffffffdd',
      whiteSpace:'pre',
      textAlign:'center'
    },
    // targetUrl:'https://code.earthengine.google.com/167fe9b483919c6aec6779ee97279e0f'
    // targetUrl:'https://code.earthengine.google.com/46316a0f8b04fca3e6c120e7950d621b' // atualização 10 ago 2021 - painel de thumb direita
    // targetUrl:'https://code.earthengine.google.com/a7166a6e4046329d713d9ff25b52db3c' // atualização 11 ago 2021 - usuario pode escolher image da yhumbs
    targetUrl:'https://code.earthengine.google.com/d588d826e86bfed84c1083d8f48a58b6' // atualização 14 ago 2021 - implementações para aderir possibilidade de gif e os dados de frequencia e acumulado
    }));
  options.mapp.add(options.yearPanel);
  options.mapp.add(options.regionPanel);
  options.mapp.add(options.visPanel);
  options.panel.add(ui.Label('thumbnails'));
}
function setThumbs (){
  // esta função é responsavel por construir as os mapas
  // e setar eles  no painel da direita (options.panel) 
  // como thumbnails 'png' de cada ano ou um 'gif' com todos os anos 
  // --- limpar painel - enquanto true limpa o painel a cada interação - enquanto false acumula as thumbnails no painel
  if (options.clearPanel === 'true'){
    options.panel.clear();
  }
  // --- preparando variaveis para consumir no loop 
  var blank = ee.Image(0).mask(0);
  var line = {
    'Brasil':blank.paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/brasil_2km'),'vazio',1.5),
    'Biomas':blank.paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas-2019'),'vazio',1.5),
    'Estados':blank.paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/estados-2017'),'vazio',1.5),
    'region':options.geometry.geometry().bounds()
  };
  line = line[options.limitThumb];
  var canvasScale = ee.Number(options.mapp.getScale()).int();
  var scalesAndBuffers = {
    'Brasil':[10000,75000],
    'Amazônia':[7500,50000],
    'Caatinga':[3000,25000],
    'Cerrado':[7500,40000],
    'Mata Atlântica':[7500,25000],
    'Pampa':[2000,8000],
    'Pantanal':[1500,8000],
    'Canvas':[canvasScale,100],
  };
  var scale = scalesAndBuffers[options.region][0];
  var buffer = scalesAndBuffers[options.region][1];
  var geom = options.geometry.geometry().bounds();
  var text = require('users/gena/packages:text');
  var textVis = { // ! parametros de visualização do texto 
    fontSize: 32,
    textColor: 'ffffff',
    outlineColor: '000000',
    outlineWidth: 2.5,
    outlineOpacity: 0.6
  };
  // --- fundo do gif
  var backgrondColor = options.backgroundColor;
  var yearsList = ee.List.sequence(1985,2020,1).getInfo();
  var colGif = yearsList.map(function(year){
      var anual = getAnual(year);
      var mensal = getMensal(year);
      var cobertura = getCobertura(year);
      var acumulado = getAcumulado(year);
      var frequencia = getFrequency(year);
      var mapa = {
        'anual':anual.visualize(visParams.standart),
        'mensal':mensal.visualize(visParams.monthly),
        'cobertura':cobertura.visualize(visParams.landcover),
        'acumulado':acumulado.visualize(visParams.acumulado),
        'frequencia':frequencia.visualize(visParams.frequencia),
      };
      var pt = text.getLocation(geom,'right', '90%', '25%');
      var label = text.draw(''+year, pt, scale, textVis);
      var image = ee.Image(1).visualize({palette:[backgrondColor]})
        .blend(mapa[options.visName].clip(options.geometry))
        .blend(line)
        .blend(label);
      image = image;
      if (options.gifOrPng !== 'gif'){
        var thumbFire = ui.Thumbnail({
          image:image,
          params:{
            crs: 'EPSG:3857', 
            dimensions: 850, 
            region:geom.buffer(buffer),
            format:'png'
          },
          onClick:function(){
            if(options.year === ''+year){
              switchLayer(null);
              return ;
            }
            options.year = ''+year;
            aktualizer(''+year);
            return ;
          }, 
          style:{
            width:options.sizeThumbnail,
            height:options.sizeThumbnail,
            backgroundColor:backgrondColor,
          }
        });
      options.panel.add(thumbFire);
      }
      return image;
  });
  if (options.gifOrPng === 'gif'){
    var thumbFire = ui.Thumbnail({
        image:ee.ImageCollection(colGif),
        params:{
          crs: 'EPSG:3857', 
          dimensions: 850, 
          region: geom.buffer(buffer),
          framesPerSecond: 2, // frames por segundo || [ ] - colocar como opção para o usuario
          format: 'gif' 
        },
        style:{
          width:options.sizeThumbnail,
          height:options.sizeThumbnail,
          backgroundColor:backgrondColor,
        }
        });
    options.panel.add(thumbFire);
  }
}
function setSelectRegion (){
  var regions = ['Brasil','Amazônia','Caatinga','Cerrado','Mata Atlântica','Pampa','Pantanal','Canvas'];
  var color = '0000ff';
  var buttoms = regions.map(function(region){
    if (region !== options.region){
      color = '000000';
    }
    return ui.Button({
      label:region,
      onClick:function(){
        if (options.region === region && region !== 'Canvas'){
          return ;
        }
        options.region = region;
        setGeometry();
        setThumbs(region);
        aktualizer(options.year);
        options.regionPanel.widgets().get(0).widgets().forEach(function(buttom){
          var color_b = '0000ff';
          if (buttom.getLabel() !== options.region){
            color_b = '000000';
          }
          buttom.style().set('color',color_b);
        });
      },
      // disabled:,
      style:{
        color:color,
        margin:'0px 0px 0px 0px',
        fontSize:'10px',
        width:'90px'
      }
      });
  });
  var panelButtons = ui.Panel({
    widgets:buttoms,
    layout:ui.Panel.Layout.Flow('vertical',true),
    style:{
    }
    });
  options.regionPanel.clear();
  options.regionPanel.add(panelButtons);
}
function setSelectVis (){
  var viss_names = ['anual','mensal','cobertura','acumulado','frequencia'];
  var mapa = [4,3,2,1,0];  
  var color = '0000ff';
  var buttoms = mapa.map(function(int){
    var visName = viss_names[int];
      color = '000000';
    return ui.Button({
      label:visName,
      onClick:function(){
        options.visName = visName;
        setGeometry();
        switchLayer(int);
        setThumbs(options.region);
        options.visPanel.widgets().get(0).widgets().forEach(function(buttom){
          var color_b = '0000ff';
          if (visName !== options.visName){
            color_b = '000000';
          }
          buttom.style().set('color',color_b);
        });
      },
      // disabled:,
      style:{
        color:color,
        margin:'0px 0px 0px 0px',
        fontSize:'10px',
        width:'90px'
      }
      });
  });
  var panelButtons = ui.Panel({
    widgets:buttoms,
    layout:ui.Panel.Layout.Flow('vertical',true),
    style:{
    }
    });
  options.visPanel.clear();
  options.visPanel.add(panelButtons);
}
function setThumbsParams (){
  //  gif
  // clearPanel
  // sizeThumbnail
  // backgroundColor
  // gif or png's -> select
  var styleLabel = {
    margin:'14px 0px 0px 4px',
    // fontSize:'1.px'
  };
    var gifOrPng = ui.Select({
    items:['gif','png'],
    placeholder:'thumbs gif or png',
    value:options.gifOrPng,
    onChange:function(value){
      options.gifOrPng = value;
      setThumbs(options.region);
    },
    // disabled:,
    style:{}
    });
    gifOrPng = ui.Panel({
    widgets:[ui.Label('formato',styleLabel),gifOrPng],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
  // clear panel -> checkBox
    var clearPanel = ui.Select({
    items:['true','false'],
    placeholder:'clear thumbnail',
    value:options.clearPanel,
    onChange:function(value){
        options.clearPanel = value;
        // setThumbs(options.region);
    },
    // disabled:,
    style:{}
    });
    clearPanel = ui.Panel({
    widgets:[ui.Label('clear thumb',styleLabel),clearPanel],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
    //----------------------------------
    var limitThumb = ui.Select({
    items:['Brasil','Biomas','Estados','region'],
    // placeholder:'clear thumbnail',
    value:options.limitThumb,
    onChange:function(value){
        options.limitThumb = value;
        setThumbs(options.region);
    },
    // disabled:,
    style:{}
    });
    limitThumb = ui.Panel({
    widgets:[ui.Label('Limites',styleLabel),limitThumb],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
  // size thumbnail -> select
    var sizeThumbnail = ui.Select({
    items:['64px','128px','256px','512px','1024px','2048px'],
    placeholder:'thumbs gif or png',
    value:options.sizeThumbnail,
    onChange:function(value){
      options.sizeThumbnail = value;
      setThumbs(options.region);
    },
    // disabled:,
    style:{}
    });
    sizeThumbnail = ui.Panel({
    widgets:[ui.Label('size thumb',styleLabel),sizeThumbnail],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
  // backgroundColor -> textbox
  var backgroundColor = ui.Textbox({
    placeholder:'Background color Thumbnail',
    value:options.backgroundColor,
    onChange:function(value){
      options.backgroundColor = value;
      setThumbs(options.region);
    },
    // disabled:,
    style:{
      width:'65px',
      height:'20px',
    }
    });
    backgroundColor = ui.Panel({
    widgets:[ui.Label('background color (RGB)',styleLabel),backgroundColor],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
  var thumbParams = ui.Panel({
    widgets:[clearPanel,gifOrPng,sizeThumbnail,limitThumb,backgroundColor,],
    layout:ui.Panel.Layout.Flow('horizontal',true),
    style:{
    }
    });
  options.thumbParams.clear();
  options.thumbParams.add(thumbParams);
}
function setGeometry (){
  options.geometry = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas-2019')
    .filter(ee.Filter.eq('Bioma',options.region));
  if (options.region === 'Brasil'){
    options.geometry = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/brasil_2km');
  }
  if (options.region === 'Canvas'){
    options.geometry = ee.FeatureCollection(ee.Feature(ee.Geometry.Rectangle(options.mapp.getBounds())));
  }
    var line = ee.Image(1).paint(options.geometry,'000000',0.5);
    line = line.updateMask(line.neq(1));
    var obj = {
      eeObject:line,
      name: 'limite ' + options.region,
      visParams:{},
      shown:true,
      opacity:1
    };
  plotLayer(obj,5,options.mapp); 
}
function switchLayer (int){
  var layers = options.mapp.layers();
  var listLayers = [layers.get(0),layers.get(1),layers.get(2),layers.get(3),layers.get(4)];
  if (int !== null){
    listLayers.forEach(function(layer){
      layer.setOpacity(0);
    });
    listLayers[int].setOpacity(1);
    return ;
  }
  var layerOn;
  listLayers.forEach(function(layer){
    var opacity = layer.getOpacity();
    if (opacity === 1){
      layerOn = layers.indexOf(layer);
    }
  });
  if (layers.get(0).getOpacity() === 0 && layers.get(1).getOpacity() === 0 && layers.get(2).getOpacity() === 0 && layers.get(3).getOpacity() === 0 && layers.get(4).getOpacity() === 0){
    layers.get(0).setOpacity(1);
    position = 2;
  }
  var position = layerOn +1;
  if (position === 3){
    position = 0;
  }  
  [0,1,2,3,4].forEach(function(i){
    layers.get(i).setOpacity(0);
    if (i === position){
      layers.get(i).setOpacity(1);
      layers.get(i).setShown(true);
    }
  });
}
// --- --- FUNÇÕES DA MAPP
function plotLayer(obj, position, mapp){
  mapp = mapp || Map;
  position = position || 0;
  var layer = mapp.layers().get(position);
  if (layer === undefined){
    mapp.addLayer(ee.Image().select(),{},''+position,false);
  }
  layer = mapp.layers().get(position);
  var layerObject = 
  ui.Map.Layer({  
    eeObject:   obj.eeObject  ||  layer.getEeObject(),
    visParams:  obj.visParams ||  layer.getVisParams(),
    name:       obj.name      ||  layer.getName(),
    shown:      obj.shown     ||  layer.getShown(),
    opacity:    obj.opacity   ||  layer.getOpacity(),
  });
  mapp.layers().set(position, layerObject);
}
function aktualizer (year){
  var yearNumber = ee.Number.parse(year);
  var anual = getAnual(year);
  var mensal = getMensal(year);
  var cobertura = getCobertura(year);
  var acumulado = getAcumulado(year);
  var frequencia = getFrequency(year);
  var mapa = {
    'anual':anual.clip(options.geometry),
    'mensal':mensal.clip(options.geometry),
    'cobertura':cobertura.clip(options.geometry),
    'acumulado':acumulado.clip(options.geometry),
    'frequencia':frequencia.clip(options.geometry),
  };
    var obj = {
      eeObject:mapa['anual'],
      name: 'Area queimada no ano ' + year,
      visParams:visParams.standart,
      // shown:true
    };
  var position = 0
  plotLayer(obj,position,options.mapp);
  if (options.firstRound === true){
    options.mapp.layers().get(0).setShown(true);
    options.firstRound = false;
  }
    obj = {
      eeObject:mapa['mensal'],
      name: 'Area queimada mensal no ano ' + year,
      visParams:visParams.monthly,
      // shown:true
    };
  position = position + 1;
  plotLayer(obj,position,options.mapp);
    obj = {
      eeObject:mapa['cobertura'],
      name: 'Cobertura queimada no ano ' + year,
      visParams:visParams.landcover,
      // shown:true
    };
  position = position + 1;
  plotLayer(obj,position,options.mapp);
    obj = {
      eeObject:mapa['acumulado'],
      name: 'acumulado de 1985 à ' + year,
      visParams:visParams.standart,
      // shown:true
    };
  position = position + 1;
  plotLayer(obj,position,options.mapp);
    obj = {
      eeObject:mapa['frequencia'],
      name: 'frequencia de 1985 à ' + year,
      visParams:visParams.frequencia,
      // shown:true
    };
  position = position + 1;
  plotLayer(obj,position,options.mapp);
  options.yearPanel.setValue(''+year);
}
// --- --- FUNÇÃO DE START
function init (){
  options.firstRound = true;
  setLayout();
  setSelectRegion();
  setSelectVis();
  setThumbsParams();
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  options.mapp.addLayer(ee.Image().select(),{},'',true,1);
  options.mapp.addLayer(ee.Image().select(),{},'',true,0);
  setGeometry();
  aktualizer(options.year);
  options.panel.clear();
  setThumbs();
  var centerObject = options.mapp.layers().get(0).getEeObject();
  options.mapp.centerObject(brasil_geometry);
  setGeometry();
  var line = ee.Image(1).paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil'),'000000',0.5);
  line = line.updateMask(line.neq(1));
  var obj = {
      eeObject:line,
      name: 'limite dos biomas',
      visParams:{},
      shown:false,
      opacity:1
  };
  plotLayer(obj,6,options.mapp); 
  line = ee.Image(1).paint(ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/estados-2017'),'000000',0.5);
  line = line.updateMask(line.neq(1));
  obj = {
      eeObject:line,
      name: 'limite dos estados',
      visParams:{},
      shown:false,
      opacity:1
  };
  plotLayer(obj,7,options.mapp); 
}
// --- --- INICIANDO CODIDO
init();
print(options);