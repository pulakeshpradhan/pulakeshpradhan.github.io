var image = ui.import && ui.import("image", "image", {
      "id": "users/gena/20200501_035840_0f2e_3B_AnalyticMS"
    }) || ee.Image("users/gena/20200501_035840_0f2e_3B_AnalyticMS"),
    muddy_water = ui.import && ui.import("muddy_water", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41183011199296,
                40.3465037331264
              ],
              [
                68.40693776274979,
                40.34826992224746
              ],
              [
                68.40573613311112,
                40.34696163845061
              ],
              [
                68.41105763579667,
                40.345391664396885
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41093699919423,
                40.361745785345654
              ],
              [
                68.4092203854247,
                40.3627921849644
              ],
              [
                68.40548675047597,
                40.36220358717746
              ],
              [
                68.40763251768789,
                40.359783742281735
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41359775053701,
                40.35343941224377
              ],
              [
                68.41316859709463,
                40.355990297108896
              ],
              [
                68.41076533781728,
                40.354224310172675
              ],
              [
                68.41248195158681,
                40.3509538418634
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41433578705447,
                40.341426983625134
              ],
              [
                68.414432346579,
                40.343119709848736
              ],
              [
                68.41389590477603,
                40.343160596430224
              ],
              [
                68.41368132805484,
                40.34140245104879
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.42816570444485,
                40.36502013525923
              ],
              [
                68.42589119120022,
                40.36436615901613
              ],
              [
                68.42262962503811,
                40.36237149228727
              ],
              [
                68.42659929438015,
                40.36225704240586
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.40711572809597,
                40.34191457796375
              ],
              [
                68.40539911432644,
                40.343026704017575
              ],
              [
                68.40273836298367,
                40.34184915821315
              ],
              [
                68.40488413019558,
                40.34054074987867
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41968775431936,
                40.4243460067021
              ],
              [
                68.41893673579519,
                40.42568545749739
              ],
              [
                68.4177136484844,
                40.42532609526801
              ],
              [
                68.41904402415578,
                40.42393763225147
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.39934842271042,
                40.421157114744766
              ],
              [
                68.39883343857956,
                40.421777868588066
              ],
              [
                68.39746014756393,
                40.42132047157467
              ],
              [
                68.39874760789108,
                40.42083039989491
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.39270766127059,
                40.38802474230073
              ],
              [
                68.39313681471297,
                40.388376131915585
              ],
              [
                68.39314754354903,
                40.388841924625744
              ],
              [
                68.39270766127059,
                40.38898901639126
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.38898475515792,
                40.39131792653352
              ],
              [
                68.3889632974858,
                40.3918899272311
              ],
              [
                68.38804061758468,
                40.39173467037929
              ],
              [
                68.38812644827316,
                40.39135878388733
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.48954613554427,
                40.386292282980286
              ],
              [
                68.49255020964095,
                40.387403677102455
              ],
              [
                68.49104817259261,
                40.38903804690837
              ],
              [
                68.48795826780746,
                40.38851505288556
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 0
      },
      "color": "#d63000",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41183011199296, 40.3465037331264],
                  [68.40693776274979, 40.34826992224746],
                  [68.40573613311112, 40.34696163845061],
                  [68.41105763579667, 40.345391664396885]]]),
            {
              "class": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41093699919423, 40.361745785345654],
                  [68.4092203854247, 40.3627921849644],
                  [68.40548675047597, 40.36220358717746],
                  [68.40763251768789, 40.359783742281735]]]),
            {
              "class": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41359775053701, 40.35343941224377],
                  [68.41316859709463, 40.355990297108896],
                  [68.41076533781728, 40.354224310172675],
                  [68.41248195158681, 40.3509538418634]]]),
            {
              "class": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41433578705447, 40.341426983625134],
                  [68.414432346579, 40.343119709848736],
                  [68.41389590477603, 40.343160596430224],
                  [68.41368132805484, 40.34140245104879]]]),
            {
              "class": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.42816570444485, 40.36502013525923],
                  [68.42589119120022, 40.36436615901613],
                  [68.42262962503811, 40.36237149228727],
                  [68.42659929438015, 40.36225704240586]]]),
            {
              "class": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.40711572809597, 40.34191457796375],
                  [68.40539911432644, 40.343026704017575],
                  [68.40273836298367, 40.34184915821315],
                  [68.40488413019558, 40.34054074987867]]]),
            {
              "class": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41968775431936, 40.4243460067021],
                  [68.41893673579519, 40.42568545749739],
                  [68.4177136484844, 40.42532609526801],
                  [68.41904402415578, 40.42393763225147]]]),
            {
              "class": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.39934842271042, 40.421157114744766],
                  [68.39883343857956, 40.421777868588066],
                  [68.39746014756393, 40.42132047157467],
                  [68.39874760789108, 40.42083039989491]]]),
            {
              "class": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.39270766127059, 40.38802474230073],
                  [68.39313681471297, 40.388376131915585],
                  [68.39314754354903, 40.388841924625744],
                  [68.39270766127059, 40.38898901639126]]]),
            {
              "class": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.38898475515792, 40.39131792653352],
                  [68.3889632974858, 40.3918899272311],
                  [68.38804061758468, 40.39173467037929],
                  [68.38812644827316, 40.39135878388733]]]),
            {
              "class": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.48954613554427, 40.386292282980286],
                  [68.49255020964095, 40.387403677102455],
                  [68.49104817259261, 40.38903804690837],
                  [68.48795826780746, 40.38851505288556]]]),
            {
              "class": 0,
              "system:index": "10"
            })]),
    water = ui.import && ui.import("water", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.43032612344355,
                40.33368135261817
              ],
              [
                68.43174219382146,
                40.33629815876354
              ],
              [
                68.42715069278938,
                40.339896101432686
              ],
              [
                68.42187261216898,
                40.33590564431247
              ],
              [
                68.42243045805849,
                40.33381219534063
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.38616949200704,
                40.441797665540925
              ],
              [
                68.38737112164571,
                40.443169429471155
              ],
              [
                68.38539701581075,
                40.44367566861179
              ],
              [
                68.38453870892599,
                40.44243455941841
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.49982421722414,
                40.369898282904956
              ],
              [
                68.50154083099368,
                40.366301595365115
              ],
              [
                68.50355785217288,
                40.365909217840404
              ],
              [
                68.50342910614016,
                40.37277549474168
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 1
      },
      "color": "#98ff00",
      "mode": "FeatureCollection",
      "shown": true,
      "locked": false
    }) || /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[68.43032612344355, 40.33368135261817],
                  [68.43174219382146, 40.33629815876354],
                  [68.42715069278938, 40.339896101432686],
                  [68.42187261216898, 40.33590564431247],
                  [68.42243045805849, 40.33381219534063]]]),
            {
              "class": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.38616949200704, 40.441797665540925],
                  [68.38737112164571, 40.443169429471155],
                  [68.38539701581075, 40.44367566861179],
                  [68.38453870892599, 40.44243455941841]]]),
            {
              "class": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.49982421722414, 40.369898282904956],
                  [68.50154083099368, 40.366301595365115],
                  [68.50355785217288, 40.365909217840404],
                  [68.50342910614016, 40.37277549474168]]]),
            {
              "class": 1,
              "system:index": "2"
            })]),
    wave = ui.import && ui.import("wave", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41738504790202,
                40.336666668919484
              ],
              [
                68.4166072072877,
                40.33685681016096
              ],
              [
                68.41654283427134,
                40.336439726897886
              ],
              [
                68.41726703070536,
                40.33633750021451
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.41557723902598,
                40.336470394210764
              ],
              [
                68.41556114577189,
                40.33665031271554
              ],
              [
                68.41546995066538,
                40.33666257986887
              ],
              [
                68.41546995066538,
                40.336417236378914
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.4149241511089,
                40.41634141555012
              ],
              [
                68.41554642360036,
                40.417060234085675
              ],
              [
                68.41464520137136,
                40.41751766006444
              ],
              [
                68.41436625163381,
                40.416504784073446
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 2
      },
      "color": "#0b4a8b",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41738504790202, 40.336666668919484],
                  [68.4166072072877, 40.33685681016096],
                  [68.41654283427134, 40.336439726897886],
                  [68.41726703070536, 40.33633750021451]]]),
            {
              "class": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.41557723902598, 40.336470394210764],
                  [68.41556114577189, 40.33665031271554],
                  [68.41546995066538, 40.33666257986887],
                  [68.41546995066538, 40.336417236378914]]]),
            {
              "class": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.4149241511089, 40.41634141555012],
                  [68.41554642360036, 40.417060234085675],
                  [68.41464520137136, 40.41751766006444],
                  [68.41436625163381, 40.416504784073446]]]),
            {
              "class": 2,
              "system:index": "2"
            })]),
    soil = ui.import && ui.import("soil", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.42749694601113,
                40.322664261885436
              ],
              [
                68.4256730318689,
                40.32495467201524
              ],
              [
                68.41758350149209,
                40.32233706917708
              ],
              [
                68.41668227926309,
                40.31837791172199
              ],
              [
                68.4226475121122,
                40.316872716572135
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.40621896932382,
                40.32649181710491
              ],
              [
                68.40355821798104,
                40.3273751794052
              ],
              [
                68.40274282644052,
                40.32557572547116
              ],
              [
                68.40445944021005,
                40.324037972278006
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.42107349609988,
                40.342710842670925
              ],
              [
                68.42097693657534,
                40.34365123347502
              ],
              [
                68.4204297659363,
                40.3437330059689
              ],
              [
                68.42046195244448,
                40.34261271417949
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.44546267140254,
                40.421456135210704
              ],
              [
                68.44516226399287,
                40.42292632586426
              ],
              [
                68.44044157612666,
                40.422403595090884
              ],
              [
                68.44091364491328,
                40.420966064519234
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.44366022694453,
                40.41916910810619
              ],
              [
                68.44057032215937,
                40.420116600196806
              ],
              [
                68.4402699147497,
                40.418809711063815
              ],
              [
                68.443746057633,
                40.41779685452407
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {
        "class": 3
      },
      "color": "#ffc82d",
      "mode": "FeatureCollection",
      "shown": false,
      "locked": false
    }) || 
    /* color: #ffc82d */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[68.42749694601113, 40.322664261885436],
                  [68.4256730318689, 40.32495467201524],
                  [68.41758350149209, 40.32233706917708],
                  [68.41668227926309, 40.31837791172199],
                  [68.4226475121122, 40.316872716572135]]]),
            {
              "class": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.40621896932382, 40.32649181710491],
                  [68.40355821798104, 40.3273751794052],
                  [68.40274282644052, 40.32557572547116],
                  [68.40445944021005, 40.324037972278006]]]),
            {
              "class": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.42107349609988, 40.342710842670925],
                  [68.42097693657534, 40.34365123347502],
                  [68.4204297659363, 40.3437330059689],
                  [68.42046195244448, 40.34261271417949]]]),
            {
              "class": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.44546267140254, 40.421456135210704],
                  [68.44516226399287, 40.42292632586426],
                  [68.44044157612666, 40.422403595090884],
                  [68.44091364491328, 40.420966064519234]]]),
            {
              "class": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[68.44366022694453, 40.41916910810619],
                  [68.44057032215937, 40.420116600196806],
                  [68.4402699147497, 40.418809711063815],
                  [68.443746057633, 40.41779685452407]]]),
            {
              "class": 3,
              "system:index": "4"
            })]),
    image2 = ui.import && ui.import("image2", "image", {
      "id": "users/gena/20200501_035839_0f2e_3B_AnalyticMS"
    }) || ee.Image("users/gena/20200501_035839_0f2e_3B_AnalyticMS"),
    image3 = ui.import && ui.import("image3", "image", {
      "id": "users/gena/20200501_035841_0f2e_3B_AnalyticMS"
    }) || ee.Image("users/gena/20200501_035841_0f2e_3B_AnalyticMS"),
    image4 = ui.import && ui.import("image4", "image", {
      "id": "users/gena/20200501_035842_0f2e_3B_AnalyticMS"
    }) || ee.Image("users/gena/20200501_035842_0f2e_3B_AnalyticMS"),
    geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                68.3527505800194,
                40.413519823358286
              ],
              [
                68.38759783954089,
                40.30193999493679
              ],
              [
                68.4929979249901,
                40.25964059131322
              ],
              [
                68.51067904681628,
                40.27968044992586
              ],
              [
                68.5362565919823,
                40.38180726008169
              ],
              [
                68.5256135866112,
                40.42821178716991
              ],
              [
                68.4765184328026,
                40.441277709396736
              ],
              [
                68.42038516253893,
                40.46465936993629
              ],
              [
                68.35944537372058,
                40.447417815741304
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#00ffff",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[68.3527505800194, 40.413519823358286],
          [68.38759783954089, 40.30193999493679],
          [68.4929979249901, 40.25964059131322],
          [68.51067904681628, 40.27968044992586],
          [68.5362565919823, 40.38180726008169],
          [68.5256135866112, 40.42821178716991],
          [68.4765184328026, 40.441277709396736],
          [68.42038516253893, 40.46465936993629],
          [68.35944537372058, 40.447417815741304]]]);
print(image.projection().nominalScale())
image = ee.ImageCollection.fromImages([image.resample('bicubic'), image2.resample('bicubic'), image3.resample('bicubic'), image4.resample('bicubic')]).mosaic()
var s2 = ee.ImageCollection('COPERNICUS/S2').filterDate('2018-01-01', '2019-01-01').select(['B12', 'B8', 'B3'])
  .reduce(ee.Reducer.percentile([30]))
Map.addLayer(s2, { min: 500, max: 3500 }, 's2', false)  
// var dark = image.reduceRegion({ reducer: ee.Reducer.percentile([0]), geometry: Map.getBounds(true), scale: Map.getScale()})
var nir = image.select('b4').unitScale(4694, 8679.96)
var red = image.select('b3').unitScale(5985, 10108)
var green = image.select('b2').unitScale(7508, 11198)
var blue = image.select('b1').unitScale(8383, 11704)
Map.addLayer(ee.Image([red, green, blue]), { min: 0.2, max: 0.95 }, 'RGB')
var features = muddy_water.merge(water).merge(wave).merge(soil)
var samples = image.addBands(ee.Image(0).paint(features, 'class').rename('class')).stratifiedSample({
  numPoints: 1000, classBand: 'class', region: features.geometry(), scale: 3})
print(samples.aggregate_array('class'))
var classifier = ee.Classifier.smileRandomForest({ numberOfTrees: 10, variablesPerSplit: 4 })
classifier = classifier.train({ features: samples, classProperty: 'class' })
print(classifier.confusionMatrix())
print(classifier.confusionMatrix().accuracy())
var trained = image.classify(classifier)
var water = trained.eq(0).or(trained.eq(1)).focal_mode(2)
var waves = trained.eq(2)
var classifiedRGB = water.mask(water).visualize({ palette: ['1f78b4'] }).blend(waves.mask(waves).visualize({ palette: ['ffffff'], forceRgbOutput: true }))
  .clip(geometry)
Map.addLayer(classifiedRGB, {}, 'classified', true, 0.75)
Map.setOptions('HYBRID')
Map.setCenter(68.4609, 40.36071, 13)
var publish = true
// var publish = false
if(publish) {
  Map.setControlVisibility({ drawingToolsControl: false })
  Map.drawingTools().layers().map(function(layer) {
    layer.setShown(false)
  })
}