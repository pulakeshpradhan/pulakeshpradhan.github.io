var Da = ee.FeatureCollection("ft:1Mh4Y9wWkjt3Ze0x01vPaC_VyXSPAsm1ydTczdmoO"),
    table = ee.FeatureCollection("users/plewis/gadm36_CHN_2"),
    table2 = ee.FeatureCollection("users/plewis/gadm36_CHN_2"),
    class_veg = /* color: #008000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([114.45001953484007, 22.60969540874921]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([114.43731659294554, 22.615558613556004]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([114.36951034904905, 22.65152469503198]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.07604615964556, 22.6929848581434],
                  [114.07827775754595, 22.691717874138337],
                  [114.08239763059282, 22.69187624777965],
                  [114.08668916501665, 22.69219299451313],
                  [114.08497255124712, 22.69520205196137],
                  [114.08497255124712, 22.697894310501187],
                  [114.08411424436235, 22.700744879517952],
                  [114.08119600095415, 22.699794696437177],
                  [114.08119600095415, 22.69646900374739],
                  [114.0787927416768, 22.697735943816422]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.14968889035845, 22.597849342039662],
                  [114.15483873166704, 22.5989587116617],
                  [114.15861528196001, 22.60086046735578],
                  [114.15655534543657, 22.605297795120133],
                  [114.15260713376665, 22.606882520361715],
                  [114.14848726071978, 22.60482237398883],
                  [114.14488237180376, 22.602603720325746],
                  [114.14213578977251, 22.601177424083534],
                  [114.13732927121782, 22.60165285780659]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.1776696948018, 22.606090160022273],
                  [114.18642442502642, 22.59990959279317],
                  [114.19861238279009, 22.60672404865884],
                  [114.19140260495806, 22.6125873801041],
                  [114.18333452024126, 22.613221238805824]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.03608543251198, 22.472322181774143],
                  [114.03672916267556, 22.471608362269123],
                  [114.03702957008522, 22.471013509871643],
                  [114.03690082405251, 22.46673049720513],
                  [114.03732997749489, 22.46673049720513],
                  [114.03728706215065, 22.469585853695545],
                  [114.03737289283913, 22.47037899783207],
                  [114.03763038490456, 22.470934196025645],
                  [114.0371154007737, 22.471529048763724],
                  [114.03685790870827, 22.47236183830545],
                  [114.03642875526589, 22.472877372179248],
                  [114.03557044838112, 22.473670497469076],
                  [114.03496963356179, 22.473432560359015]]]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.0341971573655, 22.473273935391877],
                  [114.03471214149636, 22.473749809748274],
                  [114.03385383461159, 22.473908434170408],
                  [114.03230888221901, 22.472480807831257]]]),
            {
              "landcover": 1,
              "system:index": "7"
            })]),
    class_water = /* color: #360ed6 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([114.39646118523069, 22.603515003444425]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([113.80756948802184, 22.47699354218765]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9648113093109, 22.485241578003713]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.85649125852251, 22.410634468021414],
                  [113.89357011594439, 22.429676766727734],
                  [113.87434404172564, 22.45886988441233],
                  [113.82627885617876, 22.49186339732784],
                  [113.81666581906939, 22.447447222294166]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.85820787229204, 22.514224720005405],
                  [113.88224046506548, 22.502172257666953],
                  [113.88945024289751, 22.508198620158634],
                  [113.8946000842061, 22.517713394586373],
                  [113.8997499255147, 22.529130259266367],
                  [113.86335771360064, 22.546253786936354],
                  [113.85511796750689, 22.532935671158054]]]),
            {
              "landcover": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.95433824338579, 22.481553768953972],
                  [113.95056169309282, 22.459028525870735],
                  [113.98420732297564, 22.494242433277247],
                  [114.01338975705767, 22.491070376255376],
                  [114.02025621213579, 22.480919305204903],
                  [114.02574937619829, 22.489167107140297],
                  [114.02677934446001, 22.494242433277247],
                  [114.02403276242876, 22.502172257666953],
                  [114.00515001096392, 22.51834768959469],
                  [113.93923204221392, 22.513273248019324]]]),
            {
              "landcover": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.83863847531939, 22.561155868974264],
                  [113.84378831662798, 22.57130104611541],
                  [113.83426215318707, 22.585328129157446],
                  [113.82490556516314, 22.60173209660077],
                  [113.81838243283892, 22.591589160191646]]]),
            {
              "landcover": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.60768144406939, 22.725130655467705],
                  [114.63652055539751, 22.723863968903306],
                  [114.65986650266314, 22.720063838844002],
                  [114.65025346555376, 22.7580603879336],
                  [114.59669511594439, 22.739063433480503]]]),
            {
              "landcover": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.57746904172564, 22.603475338530565],
                  [114.60630815305376, 22.61361739901115],
                  [114.62278764524126, 22.650376098127673],
                  [114.61592119016314, 22.661781970430486],
                  [114.59669511594439, 22.655445491712552]]]),
            {
              "landcover": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.53211191966307, 22.740038706420872],
                  [114.53503016307127, 22.740909451698702],
                  [114.53503016307127, 22.74470900254567],
                  [114.53228358104002, 22.74534225075118]]]),
            {
              "landcover": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.00341033093434, 22.60881635906122],
                  [114.00306700818044, 22.609410617969026],
                  [114.00289534680348, 22.61067836172679],
                  [114.00353907696706, 22.61202532666903],
                  [114.00216578595143, 22.61194609380222],
                  [114.00152205578786, 22.613332662382646],
                  [114.00117873303395, 22.614560754310496],
                  [114.00053500287038, 22.614362675708932],
                  [114.00130747906667, 22.612896885191976],
                  [114.00169371716481, 22.6111933792914],
                  [114.00250910870534, 22.609252149177923],
                  [114.00362490765554, 22.60746936270095],
                  [114.00409697644216, 22.60624120746789],
                  [114.00508402935964, 22.606320443620174],
                  [114.00572775952321, 22.606835477497896],
                  [114.00675772778493, 22.607627833545433],
                  [114.00607108227712, 22.608182480063782],
                  [114.00555609814626, 22.60901444564903],
                  [114.00581359021169, 22.60992564027954],
                  [114.0061569129656, 22.610599128084175],
                  [114.00547026745778, 22.610559511245757],
                  [114.00525569073659, 22.609410617969026],
                  [114.00465487591725, 22.60877674170945],
                  [114.00388239972096, 22.6090936802043]]]),
            {
              "landcover": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.77069135663942, 22.594725942445987],
                  [113.82176061628297, 22.611999789833007],
                  [113.80819936750368, 22.634262420928536],
                  [113.76871725080446, 22.633074115340474]]]),
            {
              "landcover": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.7713963584473, 22.424505986531848],
                  [113.79130907817387, 22.43021837967719],
                  [113.82220812602543, 22.42387126167308],
                  [113.84143420024418, 22.404193352169074],
                  [113.87233324809574, 22.40863699472577],
                  [113.90391894145512, 22.433391829848347],
                  [113.88537951274418, 22.455603948782535],
                  [113.86409350200199, 22.479081462340755],
                  [113.86615343852543, 22.50636113959355],
                  [113.85242052836918, 22.50065188476356],
                  [113.84761400981449, 22.489232668159854],
                  [113.8318211631348, 22.50255499589406],
                  [113.83044787211918, 22.52412175813672],
                  [113.86684008403324, 22.5228532182168],
                  [113.84692736430668, 22.54441681248126],
                  [113.82976122661137, 22.54188009382157],
                  [113.83456774516605, 22.56661111158539],
                  [113.7768895225098, 22.56661111158539]]]),
            {
              "landcover": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.89636584086918, 22.41833548005534],
                  [113.91559191508793, 22.425952290518712],
                  [113.93825121684574, 22.44418101759794],
                  [113.97189684672855, 22.465756875284004],
                  [113.97739001079105, 22.479081462340755],
                  [113.94649096293949, 22.49177035329427],
                  [113.93825121684574, 22.48035040377484],
                  [113.92108507915043, 22.482253794120606],
                  [113.91353197856449, 22.47590905788001],
                  [113.89293261333012, 22.451161809582256]]]),
            {
              "landcover": 0,
              "system:index": "13"
            })]),
    class_urban = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([114.11389921519469, 22.54787887225187]),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([114.11364172312926, 22.535670792246595]),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.10771768369341, 22.564991207945695],
                  [114.1084901598897, 22.565070467830708],
                  [114.10891931333208, 22.566655655962787],
                  [114.1073743609395, 22.566655655962787],
                  [114.10634439267778, 22.565546026183974]]]),
            {
              "landcover": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.11793153562212, 22.571886647481442],
                  [114.11964814939165, 22.570935572878916],
                  [114.11775987424517, 22.570856316365827],
                  [114.11818902768755, 22.56990523465419],
                  [114.12102144040728, 22.569508948670965],
                  [114.12187974729204, 22.571094085768387],
                  [114.11818902768755, 22.572679204637236]]]),
            {
              "landcover": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.11355417050981, 22.546961426151892],
                  [114.11595742978716, 22.5468028855246],
                  [114.11810319699907, 22.547991935789714],
                  [114.1172448901143, 22.551321222025468],
                  [114.11784570493364, 22.55338216848595],
                  [114.1154424456563, 22.55338216848595],
                  [114.11466996946001, 22.552668767425885],
                  [114.11389749326372, 22.550766346564586],
                  [114.11192338742876, 22.547833396346313]]]),
            {
              "landcover": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.0250678093214, 22.44454705133471],
                  [114.02300787279796, 22.44200850110586],
                  [114.02841520617199, 22.440977201805406],
                  [114.03124761889171, 22.44272247305334],
                  [114.03562498400402, 22.44224649216332],
                  [114.03476667711925, 22.444388393306486],
                  [114.03064680407238, 22.445895637247173],
                  [114.03099012682628, 22.446926899979612],
                  [114.0309042961378, 22.44819613589264],
                  [114.02987432787609, 22.448672096365218],
                  [114.02978849718761, 22.449703338451652],
                  [114.03064680407238, 22.450417270788222],
                  [114.03141928026866, 22.45073457286906],
                  [114.0305609733839, 22.45200377393139],
                  [114.02901602099132, 22.45192444920536],
                  [114.0279860527296, 22.45089322363719],
                  [114.02704191515636, 22.449148055204194],
                  [114.02558279345226, 22.449386034011088],
                  [114.02532530138683, 22.44819613589264],
                  [114.02635526964855, 22.447799500917657],
                  [114.02755689928722, 22.447799500917657],
                  [114.0276427299757, 22.446926899979612],
                  [114.0268702537794, 22.44645093351748],
                  [114.02601194689464, 22.446054293551278]]]),
            {
              "landcover": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.14836150204815, 22.736051290925687],
                  [114.14921980893291, 22.736605418360362],
                  [114.15042143857158, 22.739059384289305],
                  [114.14939147030987, 22.740088453666612],
                  [114.14776068722881, 22.73993013580508],
                  [114.14767485654033, 22.738584426579386]]]),
            {
              "landcover": 2,
              "system:index": "6"
            })]),
    class_soil = /* color: #ffff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([114.1048368777906, 22.566823039599626]),
            {
              "landcover": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([114.15873855015388, 22.564841553992427]),
            {
              "landcover": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.09518640317583, 22.56491194801512],
                  [114.09844796933794, 22.564357127225378],
                  [114.09844796933794, 22.566576396989042],
                  [114.09690301694536, 22.56713120884845],
                  [114.09810464658403, 22.567686018475147],
                  [114.09810464658403, 22.56863711549781],
                  [114.09552972592974, 22.567368984676136]]]),
            {
              "landcover": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.10059373654985, 22.568399341857305],
                  [114.1015378741231, 22.5685578576632],
                  [114.10256784238481, 22.569271176534198],
                  [114.10093705930376, 22.57030151949818],
                  [114.10016458310747, 22.569746720397603]]]),
            {
              "landcover": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.10634439267778, 22.58543874741055],
                  [114.10677354612017, 22.581872534557714],
                  [114.10788934507036, 22.582031034867107],
                  [114.10754602231646, 22.58599348333427]]]),
            {
              "landcover": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.08583085813189, 22.561265941958577],
                  [114.08668916501665, 22.560790368844234],
                  [114.0876333025899, 22.562375606180872],
                  [114.08720414914751, 22.563406000677627]]]),
            {
              "landcover": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.13655679502153, 22.58068377642472],
                  [114.13732927121782, 22.581000779596426],
                  [114.13612764157915, 22.582665034281174],
                  [114.13612764157915, 22.581872534557714]]]),
            {
              "landcover": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.36751932430013, 22.664771526971542],
                  [114.36799139308675, 22.664969532903434],
                  [114.36820596980795, 22.664613122020285],
                  [114.36867803859457, 22.66469232451877],
                  [114.36854929256185, 22.66512793744321],
                  [114.36743349361166, 22.665167538549586],
                  [114.36709017085775, 22.664929931739906]]]),
            {
              "landcover": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.3733128957723, 22.667385182263526],
                  [114.37369913387045, 22.667226780329894],
                  [114.37344164180502, 22.667979187885788],
                  [114.37399954128011, 22.668454390531743],
                  [114.37326998042806, 22.668810791435963],
                  [114.37326998042806, 22.668493990677934]]]),
            {
              "landcover": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.3802651815389, 22.66508833632542],
                  [114.38108057307943, 22.665880356509692],
                  [114.38052267360433, 22.665721952838602]]]),
            {
              "landcover": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.22951206616551, 22.423600037004537],
                  [114.22899708203465, 22.420267677383844],
                  [114.2343185847202, 22.424869486300192],
                  [114.23208698681981, 22.426932316650117],
                  [114.22934040478856, 22.427090994638238]]]),
            {
              "landcover": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.19243320874364, 22.451842539068686],
                  [114.19157490185887, 22.45438090929101],
                  [114.18797001294286, 22.45390496841433]]]),
            {
              "landcover": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.17699232471091, 22.450910974397942],
                  [114.17827978503806, 22.450633335470137],
                  [114.17965307605368, 22.450435021609916],
                  [114.17952433002097, 22.45186287507284],
                  [114.17840853107077, 22.453528685528827],
                  [114.17604818713767, 22.451188612769844]]]),
            {
              "landcover": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.17124166858298, 22.45737583794645],
                  [114.17209997546775, 22.457574141878528],
                  [114.17201414477927, 22.458763959513398],
                  [114.17188539874655, 22.45935886450081],
                  [114.17107000720603, 22.458446675809412]]]),
            {
              "landcover": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.18135203472218, 22.43441434146804],
                  [114.18246783367238, 22.434374674081017],
                  [114.18251074901661, 22.43580269287045],
                  [114.18165244213185, 22.43576302588028]]]),
            {
              "landcover": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([113.89506957649735, 22.484023126041354]),
            {
              "landcover": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([113.89661452888993, 22.47101627008298]),
            {
              "landcover": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([113.89850280403641, 22.472919788725022]),
            {
              "landcover": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([113.88906142830399, 22.470064500952706]),
            {
              "landcover": 3,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([113.88013503670243, 22.47958189795483]),
            {
              "landcover": 3,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([113.881679989095, 22.478947425169956]),
            {
              "landcover": 3,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91666407035109, 22.41865926289443]),
            {
              "landcover": 3,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91752237723585, 22.418817950337115]),
            {
              "landcover": 3,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9173507158589, 22.41850057527044]),
            {
              "landcover": 3,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91404754530731, 22.41892557650274]),
            {
              "landcover": 3,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91396171461884, 22.41979835351997]),
            {
              "landcover": 3,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91827470671478, 22.418548693822384]),
            {
              "landcover": 3,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91713745009247, 22.418350334106147]),
            {
              "landcover": 3,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9163864315683, 22.418469349969886]),
            {
              "landcover": 3,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9169443310434, 22.418231318140407]),
            {
              "landcover": 3,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([113.91793138396088, 22.418231318140407]),
            {
              "landcover": 3,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9182961643869, 22.418330498118937]),
            {
              "landcover": 3,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92172939192596, 22.418211482136204]),
            {
              "landcover": 3,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92254478346649, 22.418330498118937]),
            {
              "landcover": 3,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92275936018768, 22.418251154141775]),
            {
              "landcover": 3,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92248041045013, 22.417933777779865]),
            {
              "landcover": 3,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9228881062204, 22.417834597518038]),
            {
              "landcover": 3,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92293102156464, 22.417517220204225]),
            {
              "landcover": 3,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([113.9233387173349, 22.41898508420087]),
            {
              "landcover": 3,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([113.92355329405609, 22.41908426364111]),
            {
              "landcover": 3,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Point([114.40897732043982, 22.79968541526403]),
            {
              "landcover": 3,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Point([114.40743236804724, 22.79810291944584]),
            {
              "landcover": 3,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Point([114.41326885486365, 22.798735919977762]),
            {
              "landcover": 3,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Point([114.41189556384802, 22.808863528668134]),
            {
              "landcover": 3,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Point([114.42305355334997, 22.801426139443517]),
            {
              "landcover": 3,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Point([114.41807537341833, 22.8099711902028]),
            {
              "landcover": 3,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Point([114.41996364856482, 22.821047310174293]),
            {
              "landcover": 3,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Point([114.42957668567419, 22.82199664997057]),
            {
              "landcover": 3,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Point([114.38013820911169, 22.791772752465693]),
            {
              "landcover": 3,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Point([114.36228542590857, 22.79240578238953]),
            {
              "landcover": 3,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Point([114.40022259021521, 22.795254380676983]),
            {
              "landcover": 3,
              "system:index": "50"
            })]),
    class_veg8 = /* color: #00ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[114.01725313048667, 22.580212014806964],
                  [114.01879808287924, 22.578626982580612],
                  [114.02635118346518, 22.578468478355123],
                  [114.04077073912924, 22.579895009820408],
                  [114.05021211486167, 22.58338202455565],
                  [114.04780885558432, 22.58734443416107],
                  [114.04145738463706, 22.59035578922361],
                  [114.02858278136557, 22.587978409119813],
                  [114.02171632628745, 22.587185939965412],
                  [114.01725313048667, 22.582906527743415]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.99270555358237, 22.57609089309351],
                  [113.99871370177573, 22.569116406357423],
                  [114.01107332091635, 22.5722866713518],
                  [114.00849840026206, 22.58560098797769],
                  [113.99064561705893, 22.58100452408233]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.06343004088706, 22.588770873714402],
                  [114.06737825255698, 22.590197298493514],
                  [114.07596132140463, 22.5917821975861],
                  [114.06737825255698, 22.59859705580781],
                  [114.06308671813315, 22.59146521922688]]]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.18309310695815, 22.585941321411767],
                  [114.18060401699233, 22.586496055311404],
                  [114.1825781228273, 22.581899621282258],
                  [114.19347862026382, 22.57270629316897],
                  [114.19897178432632, 22.57460841137462],
                  [114.19339278957534, 22.576431250020683],
                  [114.19468024990249, 22.587050786976857],
                  [114.18523887417007, 22.586020569248507]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.22310783972807, 22.591173949775882],
                  [114.21289102900653, 22.59901803596143],
                  [114.20465128291278, 22.59727473757833],
                  [114.20326331875015, 22.585228088829414]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.23729136099882, 22.625710464434732],
                  [114.24827768912382, 22.617470821759877],
                  [114.25445749869414, 22.62634426264914],
                  [114.24553110709257, 22.637752130756304],
                  [114.23179819693632, 22.627611850311368]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.20124247183867, 22.503649962178006],
                  [114.20639231314726, 22.496989011394987],
                  [114.22287180533476, 22.500160932724313],
                  [114.22012522330351, 22.511896409154026],
                  [114.20124247183867, 22.509359093237386]]]),
            {
              "landcover": 1,
              "system:index": "6"
            })]),
    class_water8 = /* color: #360ed6 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[113.8572330724246, 22.41536578065245],
                  [113.88813212027617, 22.408383188136664],
                  [113.9561100255496, 22.45154268192761],
                  [113.94031717886992, 22.473117393801918],
                  [113.90804484000273, 22.457253961923847],
                  [113.88744547476836, 22.44011941620445],
                  [113.85997965445586, 22.492151113997945],
                  [113.8462467442996, 22.489613435845783],
                  [113.81740763297148, 22.454715644306216]]]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.97464945426054, 22.469944852725497],
                  [113.9945621739871, 22.49278552626474],
                  [114.01996805777617, 22.49278552626474],
                  [114.02477457633086, 22.5080105479313],
                  [114.00417521109648, 22.52133106686281],
                  [113.9609165441043, 22.512450863536444]]]),
            {
              "landcover": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.31385233511992, 22.559382615340894],
                  [114.32827189078398, 22.551773144831756],
                  [114.35299112906523, 22.53972395821611],
                  [114.3344517003543, 22.530844937165234],
                  [114.34749796500273, 22.516256734827326],
                  [114.37221720328398, 22.509279224084604],
                  [114.39968302359648, 22.475655374344107],
                  [114.42165567984648, 22.532747632595402],
                  [114.41478922476836, 22.556212053641612],
                  [114.42165567984648, 22.57650238886715],
                  [114.42165567984648, 22.59171818009722],
                  [114.40380289664336, 22.598057596988465],
                  [114.36878397574492, 22.598691522622495],
                  [114.3289585362918, 22.590450261693018],
                  [114.31179239859648, 22.575868361095758],
                  [114.29737284293242, 22.563821279271917]]]),
            {
              "landcover": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.6917515050418, 22.672523860858384],
                  [113.70411112418242, 22.547017012625375],
                  [113.6313267003543, 22.47216563910852],
                  [113.5873813878543, 22.455667518859464],
                  [113.6478061925418, 22.45059077905455],
                  [113.75492289176054, 22.442975320836876],
                  [113.82633402457304, 22.449321565058632],
                  [113.82633402457304, 22.55335848580256],
                  [113.78101542105742, 22.626898256901917],
                  [113.74530985465117, 22.714334002960666],
                  [113.66153910269804, 22.720667759631837]]]),
            {
              "landcover": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.69449808707304, 22.36933768531032],
                  [113.63819315543242, 22.260079146824246],
                  [113.92521097769804, 22.324882321300922],
                  [113.91834452261992, 22.338855534906408],
                  [113.82221415152617, 22.323611959748053],
                  [113.73981669058867, 22.382036612401926]]]),
            {
              "landcover": 0,
              "system:index": "4"
            })]),
    class_urban8 = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[114.10717203726836, 22.605110432115488],
                  [114.10648539176054, 22.596869555469947],
                  [114.11197855582304, 22.589896120663045],
                  [114.13241752514978, 22.600688845454158],
                  [114.14459421744414, 22.610181495548126],
                  [114.15008738150664, 22.61588621848777],
                  [114.13326456656523, 22.614935447761113],
                  [114.12777140250273, 22.60447653604568],
                  [114.11815836539336, 22.61620314060277],
                  [114.10236551871367, 22.620639973529368],
                  [114.09961893668242, 22.61176616454043]]]),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.02443125357695, 22.63814764353483],
                  [114.04503061881132, 22.61786639289952],
                  [114.06288340201445, 22.61659871538863],
                  [114.06460001578398, 22.6324438442704],
                  [114.07352640738554, 22.652089266999823],
                  [114.04812052359648, 22.666663087045418],
                  [114.02820780386992, 22.67521656486617],
                  [114.00829508414336, 22.660643653322726]]]),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.89911844840117, 22.54987071162133],
                  [113.91422464957304, 22.556846171811852],
                  [113.9451236974246, 22.54987071162133],
                  [113.9059849034793, 22.57650238886715],
                  [113.88126566519804, 22.56001671893484]]]),
            {
              "landcover": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.09476150476519, 22.613142006627832],
                  [114.10231460535113, 22.595392848918596],
                  [114.11089767419878, 22.586834401528076],
                  [114.12531722986284, 22.591906138265557],
                  [114.13184036218706, 22.59602678682351]]]),
            {
              "landcover": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.17544235193316, 22.642296365246477],
                  [114.18539871179644, 22.637226486247084],
                  [114.19535507165972, 22.64483123457761],
                  [114.20977462732378, 22.649900832882267],
                  [114.2001615902144, 22.65306923677707],
                  [114.1891752620894, 22.6549702440161],
                  [114.18024887048784, 22.65180188399328]]]),
            {
              "landcover": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.24616683923784, 22.5874683788345],
                  [114.25131668054644, 22.586200421303477],
                  [114.25577987634722, 22.57922644625224],
                  [114.26161636316363, 22.57922644625224],
                  [114.25646652185503, 22.590004258877325],
                  [114.24033035242144, 22.59602678682351]]]),
            {
              "landcover": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.10368789636675, 22.629621316966645],
                  [114.11089767419878, 22.62360025948777],
                  [114.11501754724566, 22.627403063315597],
                  [114.10952438318316, 22.63088887440798],
                  [114.1060911556441, 22.631205761941708]]]),
            {
              "landcover": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.05047286951128, 22.526444963579113],
                  [114.05167449914995, 22.52374934765599],
                  [114.05682434045855, 22.523590780375535],
                  [114.05871261560503, 22.517723663071905],
                  [114.06266082727495, 22.520736538208904],
                  [114.06266082727495, 22.526444963579113],
                  [114.0654074093062, 22.531518921446136],
                  [114.06163085901323, 22.536434140372986],
                  [114.06695236169878, 22.538178208259037],
                  [114.06592239343706, 22.54452008757058],
                  [114.0511595150191, 22.539763705401015]]]),
            {
              "landcover": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.03948654138628, 22.51201487742674],
                  [114.03725494348589, 22.50916039619236],
                  [114.04669631921831, 22.505671505762358],
                  [114.05304779016558, 22.505037152590223],
                  [114.05459274255816, 22.508684643590165],
                  [114.05459274255816, 22.51122197188462]]]),
            {
              "landcover": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.04240478479448, 22.543885912750813],
                  [114.04171813928667, 22.54959338122368],
                  [114.02266372644488, 22.545312801997635]]]),
            {
              "landcover": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.03828491174761, 22.5434102797238],
                  [114.02352203332964, 22.544044456728933],
                  [114.02523864709917, 22.540397899159412]]]),
            {
              "landcover": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.03519500696245, 22.556251796077767],
                  [114.04171813928667, 22.557044443106697],
                  [114.0379415889937, 22.561166134229065],
                  [114.0321051021773, 22.560056460274737]]]),
            {
              "landcover": 2,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.98215164148394, 22.561483182290292],
                  [113.98215164148394, 22.563543976921107],
                  [113.97408355676714, 22.56592177860962]]]),
            {
              "landcover": 2,
              "system:index": "12"
            })]),
    class_soil8 = /* color: #ffff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[114.09412577261992, 22.61628179418515],
                  [114.0982456456668, 22.618817143364286],
                  [114.09721567740507, 22.622620079489675],
                  [114.09206583609648, 22.62230317216316]]]),
            {
              "landcover": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[113.97428834897369, 22.771266672683243],
                  [113.97548997861236, 22.770158696720447],
                  [113.97651994687408, 22.77047526219898],
                  [113.97506082516998, 22.772374639652156],
                  [113.97591913205474, 22.773799155396144],
                  [113.97506082516998, 22.7731660391233],
                  [113.97411668759673, 22.772849479885526]]]),
            {
              "landcover": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.02708631274584, 22.70524728313137],
                  [114.02837377307299, 22.70540564113098],
                  [114.02871709582689, 22.706039071298072],
                  [114.02622800586107, 22.705563998947458]]]),
            {
              "landcover": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.02605634448412, 22.705168104062903],
                  [114.02605634448412, 22.700179730455073],
                  [114.0264854979265, 22.702634349698737],
                  [114.02639966723802, 22.704455490386366]]]),
            {
              "landcover": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([114.04279332873705, 22.699546273186595]),
            {
              "landcover": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([114.02725797412279, 22.72258639599082]),
            {
              "landcover": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([114.02545552966478, 22.727969783162237]),
            {
              "landcover": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([114.02442556140306, 22.727653119193086]),
            {
              "landcover": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.00635589563433, 22.532628824882906],
                  [114.00635589563433, 22.53120180454015],
                  [114.007557525273, 22.53120180454015],
                  [114.0079008480269, 22.532311710525445]]]),
            {
              "landcover": 3,
              "system:index": "8"
            })]),
    class_bare = /* color: #d6b86f */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[114.0771545789471, 22.46004995902103],
                  [114.07895702340511, 22.458780831622544],
                  [114.0811886213055, 22.459494717214113],
                  [114.08290523507503, 22.461477713453338],
                  [114.08453601815609, 22.46163635192677],
                  [114.0877975843182, 22.46123975540271],
                  [114.0877975843182, 22.463619317522532],
                  [114.0877975843182, 22.465364303774567],
                  [114.08539432504085, 22.46417454280452]]]),
            {
              "landcover": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.11208766915706, 22.436886555270274],
                  [114.11466258981136, 22.437441887604137],
                  [114.11346096017269, 22.43942519922386]]]),
            {
              "landcover": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.14178508736995, 22.426255479285132],
                  [114.14247173287777, 22.425224062913035],
                  [114.14538997628597, 22.426652175849416],
                  [114.14813655831722, 22.427524904300725],
                  [114.14847988107113, 22.428952993568107],
                  [114.14633411385921, 22.428397627265458],
                  [114.14384502389339, 22.426969532284694]]]),
            {
              "landcover": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.14556163766292, 22.41546489805406],
                  [114.14770740487484, 22.414750785894917],
                  [114.15053981759456, 22.413877977159313],
                  [114.15036815621761, 22.41625835170284],
                  [114.14616245248226, 22.416655076827517]]]),
            {
              "landcover": 4,
              "system:index": "3"
            })]),
    class_bare8 = /* color: #ffdc84 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[114.065610351347, 22.461319074798315],
                  [114.06578201272396, 22.460644858488642],
                  [114.06625408151058, 22.45961369778857],
                  [114.06732696511654, 22.46100179694351],
                  [114.0667261502972, 22.46246920093301],
                  [114.06771320321468, 22.462508860284657],
                  [114.06852859475521, 22.463302044934004],
                  [114.06754154183773, 22.464015907236682],
                  [114.0663828275433, 22.463976248316346],
                  [114.06496662118343, 22.46290545317683]]]),
            {
              "landcover": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.07191890695003, 22.46163635192677],
                  [114.07247680642513, 22.461596692325436],
                  [114.07462257363704, 22.46183464976319],
                  [114.07646793343929, 22.461200095687893],
                  [114.07754081704525, 22.461517373088718],
                  [114.0751375577679, 22.462350222809988],
                  [114.0722193143597, 22.462350222809988]]]),
            {
              "landcover": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.07724040963558, 22.460287919114496],
                  [114.07908576943782, 22.458384226927336],
                  [114.08470767953304, 22.462389882195687],
                  [114.08350604989437, 22.463381363149246],
                  [114.07801288583187, 22.461041456715076]]]),
            {
              "landcover": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[114.0843214414349, 22.455528639623065],
                  [114.0835489652386, 22.45509236416039],
                  [114.08384937264827, 22.45485439514752],
                  [114.08543724038509, 22.454894056678025],
                  [114.08590930917171, 22.456163219663235],
                  [114.08689636208919, 22.45687711873617],
                  [114.08552307107357, 22.457472031821773],
                  [114.08483642556575, 22.456559830713207]]]),
            {
              "landcover": 4,
              "system:index": "3"
            })]);
//
//print(class_veg)
var countries = ['CHN']
var countryNames = ['PRC']
var zoomLevel = 10
// ogrinfo  -al gadm36_CHN_2.shp | grep NAME_1 | grep -v NL | sed 's/  NAME_1 (String) =//g' | awk '{printf("\"%s\", ",$0)}' | sed 's/" /"/g'
var level1 = ["Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Anhui", "Beijing", "Chongqing", "Fujian", "Fujian", "Fujian", "Fujian", "Fujian", "Fujian", "Fujian", "Fujian", "Fujian", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Gansu", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangdong", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guangxi", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Guizhou", "Hainan", "Hainan", "Hainan", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Hebei", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Heilongjiang", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Henan", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hubei", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Hunan", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangsu", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jiangxi", "Jilin", "Jilin", "Jilin", "Jilin", "Jilin", "Jilin", "Jilin", "Jilin", "Jilin", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Liaoning", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Nei Mongol", "Ningxia Hui", "Ningxia Hui", "Ningxia Hui", "Ningxia Hui", "Ningxia Hui", "Qinghai", "Qinghai", "Qinghai", "Qinghai", "Qinghai", "Qinghai", "Qinghai", "Qinghai", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shaanxi", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shandong", "Shanghai", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Shanxi", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Sichuan", "Tianjin", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xinjiang Uygur", "Xizang", "Xizang", "Xizang", "Xizang", "Xizang", "Xizang", "Xizang", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Yunnan", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang", "Zhejiang"]
// ogrinfo  -al gadm36_CHN_2.shp | grep NAME_2 | grep -v VAR | grep -v NL | sed 's/ NAME_2 (String) = //g' | awk '{printf("\"%s\", ",$0)}'
var level2 = ["Anqing", "Bengbu", "Bozhou", "Chaohu", "Chizhou", "Chuzhou", "Fuyang", "Hefei", "Huaibei", "Huainan", "Huangshan", "Lu'an", "Ma'anshan", "Suzhou", "Tongling", "Wuhu", "Xuancheng", "Beijing", "Chongqing", "Fuzhou", "Longyan", "Nanping", "Ningde", "Putian", "Quanzhou", "Sanming", "Xiamen", "Zhangzhou", "Baiyin", "Dingxi", "Gannan Tibetan", "Jiayuguan", "Jinchang", "Jiuquan", "Lanzhou", "Linxia Hui", "Longnan", "Pingliang", "Qingyang", "Tianshui", "Wuwei", "Zhangye", "Chaozhou", "Dongguan", "Foshan", "Guangzhou", "Heyuan", "Huizhou", "Jiangmen", "Jieyang", "Maoming", "Meizhou", "Qingyuan", "Shantou", "Shanwei", "Shaoguan", "Shenzhen", "Yangjiang", "Yunfu", "Zhanjiang", "Zhaoqing", "Zhongshan", "Zhuhai", "Baise", "Beihai", "Chongzuo", "Fangchenggang", "Guigang", "Guilin", "Hechi", "Hezhou", "Laibin", "Liuzhou", "Nanning", "Qinzhou", "Wuzhou", "Yulin", "Anshun", "Bijie", "Guiyang", "Liupanshui", "Qiandongnan Miao and Dong", "Qiannan Buyei and Miao", "Qianxinan Buyei and Miao", "Tongren", "Zunyi", "Haikou", "Hainan", "Sanya", "Baoding", "Cangzhou", "Chengde", "Handan", "Hengshui", "Langfang", "Qinhuangdao", "Shijiazhuang", "Tangshan", "Xingtai", "Zhangjiakou", "Daqing", "Daxing'anling", "Harbin", "Hegang", "Heihe", "Jiamusi", "Jixi", "Mudanjiang", "Qiqihar", "Qitaihe", "Shuangyashan", "Suihua", "Yichun", "Anyang", "Hebi", "Jiaozuo", "Jiyuan shi", "Kaifeng", "Luohe", "Luoyang", "Nanyang", "Pingdingshan", "Puyang", "Sanmenxia", "Shangqiu", "Xinxiang", "Xinyang", "Xuchang", "Zhengzhou", "Zhoukou", "Zhumadian", "Enshi Tujia and Miao", "Ezhou", "Huanggang", "Huangshi", "Jingmen", "Jingzhou", "Qianjiang", "Shennongjia", "Shiyan", "Suizhou Shi", "Tianmen", "Wuhan", "Xiangfan", "Xianning", "Xiantao", "Xiaogan", "Yichang", "Changde", "Changsha", "Chenzhou", "Hengyang", "Huaihua", "Loudi", "Shaoyang", "Xiangtan", "Xiangxi Tujia and Miao", "Yiyang", "Yongzhou", "Yueyang", "Zhangjiajie", "Zhuzhou", "Changzhou", "Huai'an", "Lianyungang", "Nanjing", "Nantong", "Suqian", "Suzhou", "Taizhou", "Wuxi", "Xuzhou", "Yancheng", "Yangzhou", "Zhenjiang", "Fuzhou", "Ganzhou", "Ji'an", "Jingdezhen", "Jiujiang", "Nanchang", "Pingxiang", "Shangrao", "Xinyu", "Yichun", "Yingtan", "Baicheng", "Baishan", "Changchun", "Jilin", "Liaoyuan", "Siping", "Songyuan", "Tonghua", "Yanbian Korean", "Anshan", "Benxi", "Chaoyang", "Dalian", "Dandong", "Fushun", "Fuxin", "Huludao", "Jinzhou", "Liaoyang", "Panjin", "Shenyang", "Tieling", "Alxa", "Baotou", "Baynnur", "Chifeng", "Hohhot", "Hulunbuir", "Ordos", "Tongliao", "Ulaan Chab", "Wuhai", "Xilin Gol", "Xing'an", "Guyuan", "Shizuishan", "Wuzhong", "Yinchuan", "Zhongwei", "Golog Tibetan", "Gyêgu Tibetan", "Haibei Tibetan", "Haidong", "Hainan Tibetan", "Haixi Mongol and Tibetan", "Huangnan Tibetan", "Xining", "Ankang", "Baoji", "Hanzhong", "Shangluo", "Tongchuan", "Weinan", "Xi'an", "Xianyang", "Yan'an", "Yulin", "Binzhou", "Dezhou", "Dongying", "Heze", "Jinan", "Jining", "Laiwu", "Liaocheng", "Linyi", "Qingdao", "Rizhao", "Tai'an", "Weifang", "Weihai", "Yantai", "Zaozhuang", "Zibo", "Shanghai", "Changzhi", "Datong", "Jincheng", "Jinzhong", "Linfen", "Luliang", "Shuozhou", "Taiyuan", "Xinzhou", "Yangquan", "Yuncheng", "Bazhong", "Chengdu", "Dazhou", "Deyang", "Garzê Tibetan", "Guang'an", "Guangyuan", "Leshan", "Liangshan Yi", "Luzhou", "Meishan", "Mianyang", "Nanchong", "Neijiang", "Neijiang]]", "Ngawa Tibetan and Qiang", "Panzhihua", "Suining", "Ya'an", "Yibin", "Zigong", "Ziyang", "Tianjin", "Aksu", "Altay", "Bayin'gholin Mongol", "Börtala Mongol", "Changji Hui", "Hami", "Ili Kazakh", "Karamay", "Kashgar", "Khotan", "Kizilsu Kirghiz", "Shihezi", "Tacheng", "Turfan", "Ürümqi", "Chamdo", "Lhasa", "Nagchu", "Ngari", "Nyingtri", "Shannan", "Shigatse", "Baoshan", "Chuxiong Yi", "Dali Bai", "Dehong Dai and Jingpo", "Dêqên Tibetan", "Honghe Hani and Yi", "Kunming", "Lijiang", "Lincang", "Nujiang Lisu", "Pu'er", "Qujing", "Wenshan Zhuang and Miao", "Xishuangbanna Dai", "Yuxi", "Zhaotong", "Hangzhou", "Huzhou", "Jiaxing", "Jinhua", "Lishui", "Ningbo", "Quzhou", "Shaoxing", "Taizhou", "Wenzhou", "Zhoushan"]
var cindex = level2.indexOf("Shenzhen")
level1 = [level1[cindex]]
level2 = ["Shenzhen"]
print('level 1,2 check:',level1.length,level2.length)
function onlyUnique(value, index, self) { 
    return self.indexOf(value) === index;
}
// get unique values for the level 1 labels
var level1_values = level1.filter( onlyUnique )
var level1_index = 0
var level1_code = level1_values[level1_index]
function onlyLevel1(value, index, self) { 
    return level1[index] === level1_code;
}
var level2_values = level2.filter( onlyLevel1 )
var county = level2_values[0]
var countyLevel = '2'
var countryIndex = 0
var table = ee.FeatureCollection("users/plewis/gadm36_"
          +countries[countryIndex]+"_"+countyLevel)
var map = Map    
//ui.root.clear();
//var mapOptions = {
//    lat: 0,
//    lon: 0,/
//    zoom: 8,
//    streetViewControl: true,
//  };
//var map = ui.Map();
//map.setOptions('Satellite');
//ui.root.add(map);
// Adds charts next to the map to interactively display a
// Create a panel to hold our widgets.
var panel = ui.Panel();
panel.style().set('width', '300px');
// Create an intro panel with labels.
var intro = ui.Panel([
  ui.Label({
    value: 'Downloads',
    style: {fontWeight: 'bold'}
  }),
]);
panel.add(intro);
var panel3 = ui.Panel({
  layout: ui.Panel.Layout.flow('horizontal'),
  style: {width: '300px'}
});
panel.add(panel3);
// Create an intro panel with labels.
var intro = ui.Panel([
  ui.Label({
    value: 'Time plots for bands',
    style: {fontWeight: 'bold'}
  }),
  ui.Label('Click a point on the map to inspect.')
]);
panel.add(intro);
// Create panels to hold lon/lat values.
var long = ui.Label('lon:');
var lati = ui.Label('lat:');
var latlon = ui.Panel(
  [long,lati],ui.Panel.Layout.flow('horizontal'));
panel.add(latlon);
// Register a callback on the default map to be invoked when the map is clicked.
map.onClick(function(coords) {
  // string for lon/lat
  var latitude = coords.lat.toFixed(4)
  var longitude = coords.lon.toFixed(4)
  // Update the lon/lat panel with values from the click event.
  long.setValue('lon: ' + longitude),
  lati.setValue('lat: ' + latitude);
  // Add a white dot for the point clicked on.
  var point = ee.Geometry.Point(coords.lon, coords.lat);
  // get the time series of data for 1986-2019
  var pointset = getSeries(point).select(
    ['B1','B2','B3','B4','B5','B6','B7'],
    ['B1_blue','B2_green','B3_red','B4_nir','B5_swir','B6_NDVI','B7_NDWI'])
  // this is an ImageCollection
  // We want to insert the dot in the 'blank' layer
  // so we have to find that
  var dot = ui.Map.Layer(point, {color: 'FFFFFF'},'blank');
  var layers = map.layers()
  var lay_name, index, layer
  // list of layers names
  var names = []
  layers.forEach(function(lay) {
    lay_name = lay.getName()
    names.push(lay_name)
  })
  var index = names.indexOf('blank');
  if (index > -1) {
    // if name in names
    map.layers().set(index, dot);
  }
  // now generate the chart as image series
  // Chart options:
  // https://developers.google.com/chart/
  // interactive/docs/gallery/linechart#configuration-options
  var chart1 = ui.Chart.image.series(pointset, 
    point, ee.Reducer.mean(), 30)
    .setOptions({
      title: county+' time series at '+'lat: '+latitude+' lon: '+longitude,
      vAxis: {title: 'Reflectance or VI'},
      hAxis: {title: 'Date, annual average'},
      pointSize: 2,
      lineWidth: 2,
      colors: ['blue','green','red','black','purple','orange','cyan'],
      curveType: 'none',
    })
  // add chart to panel
  panel.widgets().set(2, chart1);
});
map.style().set('cursor', 'crosshair');
// Add the panel to the ui.root.
ui.root.insert(0, panel);
//var map = Map
var allowed = {},translator={}
// switch off classes
var classes = false
//
// EE functions
//
var scale = ee.Image(0.0001);
var cloudMaskL457 = function (image) {
  var qa = image.select('pixel_qa')
  var cloud = qa.bitwiseAnd(1 << 5)
        .and(qa.bitwiseAnd(1 << 7))
        .or(qa.bitwiseAnd(1 << 3))
  var mask2 = image.mask().reduce(ee.Reducer.min())
  return image.updateMask(cloud.not()).updateMask(mask2)
         .multiply(scale)
}
function maskL8sr(image) {
  // Bits 3 and 5 are cloud shadow and cloud, respectively.
  var cloudShadowBitMask = (1 << 3);
  var cloudsBitMask = (1 << 5);
  // Get the pixel QA band.
  var qa = image.select('pixel_qa');
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudShadowBitMask).eq(0)
                 .and(qa.bitwiseAnd(cloudsBitMask).eq(0));
  return image.updateMask(mask).multiply(scale)
}
var getLS = function (year){
  // derive ls from year
  var ls = 7
  if (year <= 1984 ){
    ls = 4;
  } else if (year <= 2012){
    ls = 5;
  } else if (year >= 2013){
    ls = 8
  }
  return ls;
}
var trainedLS457 = false, trainedLS8 = false
var classifierLS457, classifierLS8
var trainLS8 = function (composite){
  if ( trainedLS8 === true){
    return
  }
  print('training LS8 ...')
  var bands = ['blue', 'green', 'red', 'nir', 'swir', 'NDVI', 'NDWI']
  var newfc = class_urban8.merge(class_veg8)
              .merge(class_soil8).merge(class_water8)//.merge(class_bare8);
  var training = composite.sampleRegions({
    collection: newfc,
    properties: ['landcover'],
    scale: 30
  });
  classifierLS8 = ee.Classifier.randomForest(10).train({
    features: training,
    classProperty: 'landcover',
    inputProperties: bands
  });
  trainedLS8 = true
}
var trainLS457 = function (composite){
  if ( trainedLS457 === true){
    return
  }
  print('training ... LS457')
  var bands = ['blue', 'green', 'red', 'nir', 'swir', 'NDVI', 'NDWI']
  var newfc = class_urban.merge(class_veg).merge(class_soil)
              .merge(class_water)//.merge(class_bare);
  var training = composite.sampleRegions({
    collection: newfc,
    properties: ['landcover'],
    scale: 30
  });
  classifierLS457 = ee.Classifier.randomForest(10).train({
    features: training,
    classProperty: 'landcover',
    inputProperties: bands
  });
  trainedLS457 = true
}
var classified
var unmix = function(composite){
  var bands = ['blue', 'green', 'red', 'nir', 'swir', 'NDVI', 'NDWI']
  // train if needed
  var ls = getLS(year)
  if ( year == 8){
    trainLS8(composite)
    classified = composite.select(bands).classify(classifierLS8);
  }else{
    trainLS457(composite)
    classified = composite.select(bands).classify(classifierLS457);
  }
  /*var newfc = class_urban.merge(class_veg).merge(class_soil).merge(class_water);
  var training = composite.sampleRegions({
    collection: newfc,
    properties: ['landcover'],
    scale: 30
  });
  var classifier = ee.Classifier.randomForest().train({
    features: training,
    classProperty: 'landcover',
    inputProperties: bands
  });
  */
  // Define a palette for the Land Use classification.
  var palette = [
    '0000FF', // water (0)  // blue
    '008000', //  forest (1) // green
    'FF0000', // urban (2)  // red
    'FFFF00', // soil (3) // yellow
    'FFFFFF' // ? // white
  ];
  var layName = 'Land Use Classification '+ yearName
  layerInfo[layName] = Map.addLayer(classified,  {min: 0, max: 4, palette: palette}, layName);
}
var maxIterations = 5
var minImages = 10
var getDataset = function (year,timespan){
  // derive ls from year
  year = parseInt(year)
  timespan=parseInt(timespan)
  if (isNaN(year)){
    return
  }
  var ls = getLS(year)
  print('getting data for ',county)
  var shape = table.filter(ee.Filter.eq('NAME_2',county));
  shape = shape.geometry().bounds()
  var nImages = 0
  for ( var timespan = 0; timespan < maxIterations; timespan++ ){
    var t11 = year+timespan
    var t12 = year-timespan
    var t1 = 'YEAR-01-01'.replace('YEAR',t12.toString())
    var t2 = 'YEAR-12-31'.replace('YEAR',t11.toString())
    //print(ls,t1,t2)
    if (ls == 8) {
      // .filterMetadata('IMAGE_QUALITY', 'equals', 9)
      var image = ee.ImageCollection("LANDSAT/LC08/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(shape)
          .map(maskL8sr).map(maskBad)
      nImages = (image.size())
    } else if (ls == 7){
      var image =  ee.ImageCollection("LANDSAT/LE07/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(shape)
          .map(cloudMaskL457).map(maskBad)
      nImages = (image.size())
    } else if (ls == 5){
      var image =  ee.ImageCollection("LANDSAT/LT05/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(shape)
          .map(cloudMaskL457).map(maskBad)
      nImages = (image.size())
    } else if (ls == 4){
      var image =  ee.ImageCollection("LANDSAT/LT04/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(shape)
          .map(cloudMaskL457).map(maskBad)
      nImages = (image.size())
    }
    nImages = nImages.getInfo()
    if ( nImages >= minImages){
      print('Sp Images:',minImages,nImages,timespan)
      return image.median().clip(shape);
    }
  }
  // no doing, so send a blank
  print('fall: Images:',minImages,nImages,timespan)
  var fblank = ee.Image([0,0,0,0,0]).float().select(
  ['constant', 'constant_1', 'constant_2', 
   'constant_3', 'constant_4'], // old names
    getAllBandsIn(ls))               // new names
  fblank = fblank.updateMask(fblank)
  return fblank.clip(shape);
}
var getAllBandsIn = function (ls) {
  if (ls == 8) {
    // leave out B1 and 7 for compatibility
    return ['B2', 'B3', 'B4', 'B5', 'B6'];
  } else {
    return ['B1', 'B2', 'B3', 'B4', 'B5'];
  }
}
var getAllBandsOut = function (ls) {
  return ['blue', 'green', 'red', 'nir', 'swir'];
}
var getBands = function (ls,type) {
  if (type == 'False colour'){
    // FCC
    return ['nir','red','green'];
  } else if (type == 'Real colour'){
    // RGB
    return ['red','green','blue'];
  } else if (type == 'VIs'){
    return ['NDVI','NDWI','NDWI']
  }
}
var year = 0
var timespan = 0
var types = ['Real colour', 'False colour']
// load vector shape file
var table = ee.Collection.loadTable("users/plewis/gadm36_"
          +countries[countryIndex]+"_"+countyLevel)
var shenzhenShape = table.filter(ee.Filter.eq('NAME_2',county))
// centre shape
map.centerObject(shenzhenShape,zoomLevel)
var ls, bandsIn, bandsOut, data, ndvi, i
var params, ndwi, url
var type = types[0]
var fromYear = 1986, toYear = 2019
var yearName, labelName
var layerInfo = {}
var class_url
var hdr_url_base = 'http://www2.geog.ucl.ac.uk/~plewis/GEOG0027/YEAR/YEAR_hdr.zip'
var hdr_url
var setYear = function (yearset){
  year = parseInt(yearset)
  // Display the results.
  yearName = year.toString()
  labelName = (yearName+'_'+type).toString();
  timespan = parseInt(timespan);
  return year
}
// check if name in layer
var isInLayer = function(name) {
  var layers = map.layers()
  var lay_name, index, layer
  // list of layers names
  var names = []
  layers.forEach(function(lay) {
    lay_name = lay.getName()
    names.push(lay_name)
  })
  // get index
  index = names.indexOf(name)
  if (index > -1) {
    // if name in names
    layer = layers.get(index)
    return true
  } 
  return false
};
var checkExists = function(labelName){
  if (noLabel === true) {
    return false
  }
  return isInLayer(labelName);
}
// remove layer name
var removeLayer = function(name) {
  var layers = map.layers()
  var lay_name, index, layer
  // list of layers names
  var names = []
  layers.forEach(function(lay) {
    lay_name = lay.getName()
    names.push(lay_name)
  })
  // get index
  index = names.indexOf(name)
  if (index > -1) {
    // if name in names
    layer = layers.get(index)
    map.remove(layer)
  } else {
    print('Layer '+name+' not found')
  }
}
var addVIS = function(data){
  // add NDVI and NDWI to image
  ndvi = data.normalizedDifference(['B4', 'B3'])
                .select(['nd'],['B6']);
  ndwi = data.normalizedDifference(['B4', 'B5'])
                .select(['nd'],['B7']);
  // combine the datasets
  data = data.addBands([ndvi]).addBands([ndwi]).float();
  return data
}
var level2_values = level2.filter( onlyLevel1 )
var sound = []
var result = []
var b
var nBands 
var nImages
/*
** Dont trust anything blue > 0.5
*/
var maskBad = function(image) {
  var mask = image.select(['B1']).lt(0.5);
  //print(mask)
  return image.updateMask(mask);
};
var getSeriesData = function(point){
  for(timespan=0;timespan<5;timespan++){
    var t11 = year+timespan
    var t12 = year-timespan
    var t1 = 'YEAR-01-01'.replace('YEAR',t12.toString())
    var t2 = 'YEAR-12-31'.replace('YEAR',t11.toString())
    if (ls == 8) {
      // .filterMetadata('IMAGE_QUALITY', 'equals', 9)
      var image = ee.ImageCollection("LANDSAT/LC08/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(point)
          .map(maskL8sr).map(maskBad)
      nImages = image.size()
    } else if (ls == 7){
      var image = ee.ImageCollection("LANDSAT/LE07/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(point)
          .map(cloudMaskL457).map(maskBad)
      nImages = image.size()
     } else if (ls == 5){
      var image = ee.ImageCollection("LANDSAT/LT05/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(point)
          .map(cloudMaskL457).map(maskBad)
      nImages = image.size()
    } else if (ls == 4){
      var image = ee.ImageCollection("LANDSAT/LT04/C01/T1_SR")
          .filterDate(t1,t2)
          .filterBounds(point)
          .map(cloudMaskL457).map(maskBad)
      nImages = image.size()
    }
    print('Images pt:',year,t11,t12,minImages,nImages,timespan)
    nImages = nImages.getInfo()
    if ( nImages >= minImages){
      return image.median().clip(point);
    }
  }
  // no solution, so send back blank
  print(ls,'fall Images pt:',year,t11,t12,minImages,nImages,timespan)
  var fblank = ee.Image([0,0,0,0,0]).float().select(
  ['constant', 'constant_1', 'constant_2', 
   'constant_3', 'constant_4'], // old names
    getAllBandsIn(ls))               // new names
  fblank = fblank.updateMask(fblank)
  return fblank.clip(point);
}
var getSeries = function(point){
  // returns ImageCollection for point
  // containing pixel values for each band
  result = []
  var save_year = year
  for (var year=parseInt(fromYear); year<parseInt(toYear);year++){
    year = setYear(year)
    ls = getLS(year)
    var bandsIn = getAllBandsIn(ls)
    var bandsOut = ['B1','B2','B3','B4','B5']
    print('selektor',bandsIn,ls)
    var image = getSeriesData(point).select(bandsIn,bandsOut)
    image = addVIS(image)
    result.push(image.set('system:time_start',year.toString()+'-06-06')) 
  }
  year = setYear(save_year)
  /*
      // so if this fails we have zero bands
      image = image.set('nImages',ee.String(nImages))
      image = ee.ImageCollection([image,fblank])
              .filterMetadata('nImages',"greater_than", '0').first()
      image = image.select(bandsIn,bandsOut)
          .set('system:time_start',year.toString()+'-06-06')
      image = addVIS(image)
      result.push(image)  
  */
  // ).merge(
  // .filterMetadata('IMAGE_QUALITY', 'equals', 9)
  return ee.ImageCollection(result)
}
var doit = function (yearset){
  shenzhenShape = table.filter(ee.Filter.eq('NAME_2',county))
  // centre shape
  //map.centerObject(shenzhenShape,zoomLevel)
  if (yearset === 0){
    return
  }
  // sets yearName and labelName
  year = setYear(yearset)
  print('the year is',year)
  if (!((parseInt(year)>=parseInt(fromYear)) && (parseInt(year)<=parseInt(toYear)))){
    return
  }
  ls = getLS(year)
  print ('doit now',labelName,checkExists(labelName),labelName)
  // does labelName already appear in
  // layers? 
  if (checkExists(labelName)){
    print(labelName+' exists')
    return
  }
  // select visualisation parameters
  if ( type == 'VIs' ) {
    params = {bands: getBands(ls,type), min: -1, max: 1, gamma: 0.7}
  } else{
    params = {bands: getBands(ls,type), gain: [1000,1000,1000]};
  }
  print('landsat: '+ls)
  bandsIn = getAllBandsIn(ls)
  bandsOut = getAllBandsOut(ls)
  print('reading image data',year,timespan)
  // read Image data
  data = getDataset(year,timespan).select(bandsIn,bandsOut)
  // add an NDVI band
  ndvi = data.normalizedDifference([bandsOut[3], bandsOut[2]])
                .select(['nd'],['NDVI']);
  ndwi = data.normalizedDifference([bandsOut[3], bandsOut[4]])
                .select(['nd'],['NDWI']);
  // combine the datasets
  data = data.addBands([ndvi]).addBands([ndwi]).float();
  unmix(data)
  // Create an empty image into which to paint the features, cast to byte.
  var empty = ee.Image().byte();
  // Paint all the polygon edges with the same number and width, display.
  var outline = empty.paint({
    featureCollection: shenzhenShape,
    color: 1,
    width: 1
  });
  var outlineMask = empty.paint({
    featureCollection: shenzhenShape,
    color: 0
  });
  data = data.addBands([outlineMask])
  var properties = data.propertyNames();  
  data = data.float()
  class_url = classified.byte().clip(shenzhenShape.geometry().bounds()).getDownloadURL({
        name: 'class'+yearName,
        scale: 30,
        format: 'tiff'
      });
  url = data.clip(shenzhenShape.geometry().bounds()).getDownloadURL({
        name: yearName,
        scale: 30,
        format: 'tiff'
      });
  map.addLayer(data, params, labelName);
  layerInfo[labelName] = labelName;
  noLabel = false
  panel3.clear();
  label = ui.Label(yearName);
  var u2=label.setUrl(url);
  panel3.add(label);
  class_label = ui.Label('class');
  var class_u2=class_label.setUrl(class_url);
  panel3.add(class_label);
  hdr_url = hdr_url_base.replace('YEAR',yearName).replace('YEAR',yearName)
  hdr_label = ui.Label('header');
  var hdr_u2=hdr_label.setUrl(hdr_url);
  panel3.add(hdr_label);
  // add another layer for drawing
  var blank = ee.Image().byte();
  if (!('blank' in layerInfo)){
    map.addLayer(blank,{},'blank')
    layerInfo['blank']=blank
  }else{
    removeLayer('blank')
    map.addLayer(blank, {}, 'blank');
  }
  if (!(county in layerInfo)){
    map.addLayer(outline,{},county)
    layerInfo[county]=county
  }else{
    print('removing '+county)
    removeLayer(county)
    map.addLayer(outline, {}, county);
  }
};
var class_label,hdr_label,link_panel
var label,thisyear;
var years = {'Year ...':'Year ...'};
var typos = {};
// initialise
// years is a dictionary of years
for ( i = parseInt(fromYear); i <= parseInt(toYear); i++){
  years[i] = setYear(i)
}
// reset variable year
year = setYear(fromYear)
// typos is dictionary of
// display types 
for (i = 0 ; i < types.length ; i++){
  typos[types[i]] = types[i]
}
// select from dictionary years
// set year, yearName and labelName
//
var select = ui.Select({
  items: Object.keys(years),
  placeholder: year.toString(),
  onChange: function(key) {
    year = setYear(key)
    print ('setting year to',year,checkExists(labelName),labelName)
    if (year !== NaN){
      print('reloading ...',county,type,year,timespan)
      doit(year);
    }
  }
});
// select from dictionary typos
// set type, labelName
var displayType = ui.Select({
  items: Object.keys(typos),
  placeholder: type,
  onChange: function(key) {
    type = key;
    year = setYear(year);
    print ('setting type to',type,checkExists(labelName),labelName)
    if (year !== NaN){
      print('reloading ...',county,type,year,timespan)
      doit(year);
    }
  }
})
// location selektor
var level1_select = ui.Label(level1_code)
/* ui.Select({
  items: level1_values,
  placeholder: level1_code,
  onChange: function(key) {
    level1_code = key
    level1_index = level1_values.indexOf(level1_code)
    level2_values = level2.filter( onlyLevel1 )
    var save_year = year
    clearFunction()
    county = level2_values[0]
    level2_select[level1_index].setValue(county)
    clearFunction()
    year = setYear(save_year)
    if (year !== NaN){
      print('reloading ...',level1_code,county,type,year,timespan)
      doit(year);
    }
    //select.setValue(year)
  }
})*/
// location selektor
var level2_select = [];
var save_level1 = level1_index
for (level1_index=0; level1_index <= level1_values.length; level1_index++){
  level1_code = level1_values[level1_index]
  /*level2_select.push(ui.Select({
    items: level2.filter( onlyLevel1 ),
    placeholder: county,
    onChange: function(key) {
      print('loading ' + county);
      var save_year = year
      clearFunction()
      year = setYear(save_year)
      county = key
      if (year !== NaN){
        print('reloading ...',level1_code,county,type,year,timespan)
        doit(year);
      }
    }
  }))*/
  level2_select.push(ui.Label(county))
}
// reset values
level1_index = save_level1
level1_code = level1_values[level1_index]
var clearFunction = function () {
  map.centerObject(shenzhenShape,zoomLevel);
  panel2.clear();
  year = setYear(fromYear)
  addPanels(clear,displayType,select)
  for (var key in layerInfo){
      removeLayer(key);
  }
  //for (var key in layerInfo){
  //    removeLayer(key);
  //}
  //year = setYear(year);
  noLabel = true
  select.setValue('Year ...');
}
var panel2 = ui.Panel({
  layout: ui.Panel.Layout.flow('vertical'),
  style: {width: '150px',position: 'bottom-left'}
});
var addPanels = function(clear,displayType,
          select){
  var save_year = year
  year = setYear(save_year)
  print('reloading labels ...',county,type,year,timespan)
  panel3.remove(label);
  panel3.remove(class_label);
  panel3.remove(hdr_label);
  label = ui.Label(yearName);
  var u2=label.setUrl(url);
  class_label = ui.Label('class');
  var class_u2=class_label.setUrl(class_url);
  hdr_url = hdr_url_base.replace('YEAR',yearName).replace('YEAR',yearName)
  hdr_label = ui.Label('header');
  var hdr_u2=hdr_label.setUrl(hdr_url);
  var title = ui.Label('P. Lewis, UCL');
  title.setUrl('http://www2.geog.ucl.ac.uk/~plewis');
  panel2.add(title);
  var title = ui.Label('NCEO');
  title.setUrl('http://www.nceo.ac.uk');
  panel2.add(title);
  panel2.add(clear);
  panel2.add(displayType);
  panel2.add(select);
  panel3.add(label);
  panel3.add(class_label);
  panel3.add(hdr_label);
  panel2.add(level1_select)
  panel2.add(level2_select[level1_index])
  year = setYear(save_year);
  try {
    select.setValue(year);
    displayType.setValue(type);
    level1_select.setValue(level1_code)
    level2_select[level1_code].setValue(county)
  }
  catch (err){
    print('error',err);
  }
  if (! checkExists(labelName)){
    map.addLayer(data, params, labelName);
    layerInfo[labelName] = labelName;
    // actions if we have a new image
    // to display
    panel3.remove(label);
    label = ui.Label(yearName);
    var u2=label.setUrl(url);
    panel3.remove(class_label);
    class_label = ui.Label('class');
    var class_u2=class_label.setUrl(class_url);
    panel3.add(class_label);
    panel3.remove(hdr_label);
    hdr_url = hdr_url_base.replace('YEAR',yearName).replace('YEAR',yearName)
    hdr_label = ui.Label('header');
  }
};
// clear all terms
var noLabel = false
var clear = ui.Button('Clear ...');
clear.onClick(clearFunction);
// Set a place holder.
select.setValue(year.toString());
displayType.setValue(type);
map.centerObject(shenzhenShape,zoomLevel)
//panel.style().set('background-color', 'black');
//map.style().set('background-color', 'black');
// add buttons
addPanels(clear,displayType,select);
ui.root.add(panel2);
// sort training
trainLS8(getDataset(fromYear,timespan).select(bandsIn,bandsOut))
trainLS457(getDataset(toYear,timespan).select(bandsIn,bandsOut))