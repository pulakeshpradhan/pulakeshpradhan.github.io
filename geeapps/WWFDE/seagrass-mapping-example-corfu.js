var sunglint = /* color: #33d665 */ee.Geometry.MultiPolygon(
        [[[[19.570598602294922, 39.78492757520378],
           [19.578323364257812, 39.78057429170315],
           [19.581928253173828, 39.78387225903925],
           [19.573345184326172, 39.78730197739421]]],
         [[[19.89349365234375, 39.80273359423279],
           [19.8976993560791, 39.804513942610306],
           [19.89521026611328, 39.80622830859078],
           [19.891948699951172, 39.80464581843411]]],
         [[[19.875812530517578, 39.83925447389389],
           [19.88027572631836, 39.838068180000015],
           [19.88147735595703, 39.83978170904672],
           [19.87649917602539, 39.84096797334044]]],
         [[[19.718055725097656, 39.61150721981573],
           [19.71771240234375, 39.61759024027718],
           [19.71393585205078, 39.61785470730169],
           [19.71324920654297, 39.61335863045665]]]]),
    deepWater = /* color: #1915ff */ee.Geometry.MultiPolygon(
        [[[[19.555578231811523, 39.72525373249864],
           [19.556779861450195, 39.724725619100084],
           [19.557209014892578, 39.72531974638905],
           [19.55592155456543, 39.72584785523707]]],
         [[[19.639477729797363, 39.676331628536076],
           [19.64029312133789, 39.67534071038867],
           [19.640679359436035, 39.675604956617946],
           [19.63982105255127, 39.67652981045965]]]]),
    sand = /* color: #ebd119 */ee.Geometry.MultiPolygon(
        [[[[19.84727382659912, 39.82284225611351],
           [19.848132133483887, 39.822908176476936],
           [19.84727382659912, 39.825709733463185],
           [19.846415519714355, 39.82557789804866]]],
         [[[19.637460708618164, 39.78885189017607],
           [19.63853359222412, 39.78954439311165],
           [19.638147354125977, 39.79007200971703],
           [19.636945724487305, 39.789313559574325]]],
         [[[19.54094409942627, 39.76507172805369],
           [19.5412015914917, 39.76467587220983],
           [19.54218864440918, 39.76523666731693],
           [19.54188823699951, 39.765665507552264]]],
         [[[19.790797233581543, 39.592791968876035],
           [19.795947074890137, 39.59580129919034],
           [19.79538917541504, 39.59636346728417],
           [19.7904109954834, 39.593288021332896]]],
         [[[19.848175048828125, 39.54522058264058],
           [19.84057903289795, 39.54019026740426],
           [19.841179847717285, 39.539660739327275],
           [19.84851837158203, 39.54469109294381]]],
         [[[20.070905685424805, 39.46445987319321],
           [20.07051944732666, 39.46151111072382],
           [20.07129192352295, 39.46151111072382],
           [20.071721076965332, 39.46436047874017]]],
         [[[19.975719451904297, 39.41749675989206],
           [19.974346160888672, 39.405825642853095],
           [19.975547790527344, 39.405825642853095],
           [19.97666358947754, 39.41716522102947]]]]),
    seagrasses = /* color: #1ce735 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[19.514079093933105, 39.74893587209068],
                  [19.514636993408203, 39.74893587209068],
                  [19.514626264572144, 39.74934831612539],
                  [19.514057636260986, 39.74933181841142]]]),
            {
              "Id": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.501376152038574, 39.78662862019765],
                  [19.501885771751404, 39.78662862019765],
                  [19.501875042915344, 39.78701198328683],
                  [19.501376152038574, 39.787003738941806]]]),
            {
              "Id": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.646129608154297, 39.73614063188874],
                  [19.646644592285156, 39.73614207574041],
                  [19.646633863449097, 39.73653809558063],
                  [19.646118879318237, 39.73652984519049]]]),
            {
              "Id": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.675081372261047, 39.705307424067726],
                  [19.675580263137817, 39.705307424067726],
                  [19.675569534301758, 39.705695366937974],
                  [19.675059914588928, 39.705695366937974]]]),
            {
              "Id": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.725517630577087, 39.67175037018674],
                  [19.725512266159058, 39.671358107438856],
                  [19.726005792617798, 39.67137049471757],
                  [19.72599506378174, 39.67174624111679]]]),
            {
              "Id": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.911834597587585, 39.42512306505363],
                  [19.91232007741928, 39.42512513693985],
                  [19.91230934858322, 39.42550221920672],
                  [19.91182655096054, 39.42549807545662]]]),
            {
              "Id": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[20.003743171691895, 39.39179502553527],
                  [20.00422328710556, 39.391799171288625],
                  [20.004215240478516, 39.39217228808152],
                  [20.00372976064682, 39.39216606948467]]]),
            {
              "Id": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[20.129654109477997, 39.36144565864678],
                  [20.130136907100677, 39.36144980620283],
                  [20.130120813846588, 39.36182515900568],
                  [20.129648745059967, 39.36181893770495]]]),
            {
              "Id": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[20.051432847976685, 39.44553437022403],
                  [20.051921010017395, 39.44553851278249],
                  [20.051915645599365, 39.44591548457231],
                  [20.05143016576767, 39.44590927076815]]]),
            {
              "Id": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.92299258708954, 39.613084434679884],
                  [19.92347538471222, 39.613084434679884],
                  [19.92347538471222, 39.61346876300856],
                  [19.92297112941742, 39.61346876300856]]]),
            {
              "Id": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.867857098579407, 39.64400849856937],
                  [19.868334531784058, 39.64401056393309],
                  [19.868331849575043, 39.64438852445403],
                  [19.867854416370392, 39.64438645910161]]]),
            {
              "Id": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.84691172838211, 39.69731975286598],
                  [19.847402572631836, 39.69733007171805],
                  [19.84738916158676, 39.697699485605774],
                  [19.846919775009155, 39.697697421846534]]]),
            {
              "Id": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.761046171188354, 39.613902679146555],
                  [19.761534333229065, 39.613910944196654],
                  [19.761534333229065, 39.61428700293251],
                  [19.761046171188354, 39.614278737927286]]]),
            {
              "Id": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[20.12072503566742, 39.39002611354676],
                  [20.121304392814636, 39.390046842836554],
                  [20.121293663978577, 39.39041582316473],
                  [20.12069284915924, 39.390419969]]]),
            {
              "Id": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.773759841918945, 39.80450425794437],
                  [19.774258732795715, 39.804516621315344],
                  [19.774253368377686, 39.804891642511606],
                  [19.773754477500916, 39.80488752141068]]]),
            {
              "Id": 0,
              "system:index": "14"
            })]),
    nonSeagrass = /* color: #ff31a3 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[19.66528058052063, 39.7174481764394],
                  [19.66577410697937, 39.7174481764394],
                  [19.66577410697937, 39.71783192472701],
                  [19.66528594493866, 39.717827798412664]]]),
            {
              "Id": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.669582843780518, 39.71272614399365],
                  [19.6700656414032, 39.71273233392284],
                  [19.67005491256714, 39.713099602060744],
                  [19.669572114944458, 39.713095475463305]]]),
            {
              "Id": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.66478168964386, 39.706904579249205],
                  [19.66526985168457, 39.706908706216986],
                  [19.66525912284851, 39.707284259249626],
                  [19.66478168964386, 39.70728013230434]]]),
            {
              "Id": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.833986163139343, 39.557623757046535],
                  [19.834474325180054, 39.55762789292942],
                  [19.834458231925964, 39.55800425724006],
                  [19.833986163139343, 39.55799598551893]]]),
            {
              "Id": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.841410517692566, 39.55219726628743],
                  [19.841904044151306, 39.552205538700065],
                  [19.841898679733276, 39.55258606861434],
                  [19.841410517692566, 39.55258606861434]]]),
            {
              "Id": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.841356873512268, 39.54057768919928],
                  [19.841861128807068, 39.54057768919928],
                  [19.84185039997101, 39.54095414600806],
                  [19.841367602348328, 39.54095414600806]]]),
            {
              "Id": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.993464946746826, 39.48370514056126],
                  [19.993969202041626, 39.48370514056126],
                  [19.993958473205566, 39.48408190566523],
                  [19.993475675582886, 39.48407776540046]]]),
            {
              "Id": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[20.01211702823639, 39.481336856026935],
                  [20.0126051902771, 39.48134513688259],
                  [20.01258909702301, 39.481713633960894],
                  [20.01211166381836, 39.481713633960894]]]),
            {
              "Id": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.95863378047943, 39.51105877579947],
                  [19.95914340019226, 39.51106291445752],
                  [19.9591326713562, 39.51143953130655],
                  [19.95864450931549, 39.51143539267096]]]),
            {
              "Id": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.804707169532776, 39.54823053080369],
                  [19.805173873901367, 39.548234667246604],
                  [19.805163145065308, 39.54860280967885],
                  [19.804701805114746, 39.54860280967885]]]),
            {
              "Id": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.915562868118286, 39.67032169737755],
                  [19.916056394577026, 39.67032169737755],
                  [19.916056394577026, 39.6707057077462],
                  [19.915573596954346, 39.67070157861381]]]),
            {
              "Id": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.832639694213867, 39.810969997500806],
                  [19.833122491836548, 39.81098235970909],
                  [19.833127856254578, 39.811349104210045],
                  [19.832628965377808, 39.81134498349617]]]),
            {
              "Id": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.79690194129944, 39.797006185202235],
                  [19.79739010334015, 39.797008245988906],
                  [19.79737937450409, 39.79738124735929],
                  [19.79689657688141, 39.79737300425695]]]),
            {
              "Id": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.769087433815002, 39.79760927177377],
                  [19.769580960273743, 39.7976133933109],
                  [19.769564867019653, 39.79799257367099],
                  [19.769087433815002, 39.79798845215656]]]),
            {
              "Id": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.67729151248932, 39.79732354562211],
                  [19.677771627902985, 39.79733384950731],
                  [19.67776894569397, 39.797696545282484],
                  [19.67729151248932, 39.79769242375034]]]),
            {
              "Id": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.671720564365387, 39.79582122264077],
                  [19.672192633152008, 39.795827405107126],
                  [19.67218726873398, 39.796192169637806],
                  [19.671709835529327, 39.796188048015495]]]),
            {
              "Id": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.656480252742767, 39.71455008576345],
                  [19.65695232152939, 39.71456040203902],
                  [19.656949639320374, 39.71493178693165],
                  [19.656472206115723, 39.71492559719984]]]),
            {
              "Id": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.709260761737823, 39.67516162030485],
                  [19.708783328533173, 39.67516162030485],
                  [19.708783328533173, 39.674794150259125],
                  [19.709271490573883, 39.67479208581515]]]),
            {
              "Id": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.90622341632843, 39.60491870965677],
                  [19.906714260578156, 39.60492077618752],
                  [19.906708896160126, 39.60529068419881],
                  [19.906226098537445, 39.6052844846395]]]),
            {
              "Id": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[19.92142081260681, 39.61620104845017],
                  [19.921908974647522, 39.61621344561333],
                  [19.921908974647522, 39.61660188893419],
                  [19.921418130397797, 39.61659362420537]]]),
            {
              "Id": 1,
              "system:index": "19"
            })]),
    Corfu = /* color: #d63000 */ee.Geometry.Polygon(
        [[[20.0830078125, 39.92658893613412],
          [19.35791015625, 39.9097367488884],
          [19.31396484375, 39.63953808074103],
          [19.92919921875, 39.13006076229285],
          [20.3466796875, 39.334297948453205]]]),
    imageVisParam = {"opacity":1,"bands":["B3","B2","B1"],"gamma":1};
//--------------------------------------------------------------------------------
// This code demostrates the workflow followed for large scale habitat mapping paper 
// Input: Sentinel 2A - 1C image collection
// Processes: Cloud mask, land mask, seasonal composite, dark pixel subtraction,
// sunglint correction, depth invariant index, classification, visualization
//--------------------------------------------------------------------------------
// NOTE: Please apply appropriate stretch in the map for better visualization
// Global Variables
// Filter dates
var start = '2017-08-01'
var end   = '2017-10-01'
//--------------------------------------------------------------------------------
// Helper functions
//--------------------------------------------------------------------------------
// Function to divide by 10000 to rescale S2 pixel values
function divide10000(image){
  return image.divide(10000)
}
// Function to mask clouds using the Sentinel-2 QA band.
// Input: original image, Output: the image after applying cloud mask
function maskS2clouds(image) {
  var qa = image.select('QA60');
  // Bits 10 and 11 are clouds and cirrus, respectively.
  var cloudBitMask = ee.Number(2).pow(10).int();
  var cirrusBitMask = ee.Number(2).pow(11).int();
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0).and(
             qa.bitwiseAnd(cirrusBitMask).eq(0));
  // Return the masked and scaled data.
  return image.updateMask(mask).divide(10000);
}
// Function for Atmospheric correction using dark pixel subtraction (Haze)
// Input: an image after applying cloud mask
// Output: the image after removing haze
function hazeRemovalDeepwater(image) {
  // Select the relevant bands
  image = image.select(['B1', 'B2', 'B3', 'B4', 'B8'])
  // Combine reducers of Mean and Standard deviation, for cheaper computation
  var reducers = ee.Reducer.mean().combine({
    reducer2: ee.Reducer.stdDev(),
    sharedInputs: true
  });
  // Calculate Mean and Standard deviation by intersecting the image with deep water polygon
  var stats = image.reduceRegion({
    reducer: reducers,
    bestEffort: true,
    geometry: deepWater,
    scale: 10,
    maxPixels: 1e12
  });
  // Convert the statistics into an image and concaternate it to the original image
  image = ee.Image.cat([image, stats.toImage()])
  // Apply the expression
  return image.expression(
    'image - ( mean + (2 * std) )', {
      'image': image.select(['B1', 'B2', 'B3', 'B4', 'B8']),
      'mean': image.select(['B1_mean', 'B2_mean', 'B3_mean', 'B4_mean', 'B8_mean']),
      'std': image.select(['B1_stdDev', 'B2_stdDev', 'B3_stdDev', 'B4_stdDev', 'B8_stdDev'])
  });
}
// Function to correct for Sunglint
// Input: an water surface reflectance image
// Output: the image after Sunglint correction
function sunglintRemoval(image){
  // Fit a linear model between NIR and other bands, in the sunglint polygons
  // Output: a dictionary such that: linear_fit.keys() =  ["coefficients","residuals"]
  var linearFit1 = image.select(['B8', 'B1']).reduceRegion({
    reducer: ee.Reducer.linearFit(),
    geometry: sunglint,
    scale: 10,
    maxPixels: 1e12
  });
  var linearFit2 = image.select(['B8', 'B2']).reduceRegion({
    reducer: ee.Reducer.linearFit(),
    geometry: sunglint,
    scale: 10,
    maxPixels: 1e12
  });
  var linearFit3 = image.select(['B8', 'B3']).reduceRegion({
    reducer: ee.Reducer.linearFit(),
    geometry: sunglint,
    scale: 10,
    maxPixels: 1e12
  });
  var linearFit4 = image.select(['B8', 'B4']).reduceRegion({
    reducer: ee.Reducer.linearFit(),
    geometry: sunglint,
    scale: 10,
    maxPixels: 1e12
  });
  // Extract the slope of the fit, convert it into a constant image
  var slopeImage = ee.Dictionary({'B1': linearFit1.get('scale'), 
                                  'B2': linearFit2.get('scale'), 
                                  'B3': linearFit3.get('scale'), 
                                  'B4': linearFit4.get('scale')}).toImage()
  // Calculate the minimum of NIR in the image, in the sunglint polygons
  var minNIR = image.select('B8').reduceRegion({
    reducer: ee.Reducer.min(),
    geometry: sunglint,
    scale: 10,
    maxPixels: 1e12
  }).toImage(['B8']);
  // Apply the expression  
  return image.select(['B1','B2', 'B3', 'B4']).subtract(slopeImage.multiply((image.select('B8')).subtract(minNIR)))
}
// Function to calculate Depth Invariant Index (DIV)
// DIV is a depth agnostic index
// Input: water surface reflectance image (after sunglint correction)
// Output: input image + Depth Invariant index for the three band pairs
function depthInvariant(image){
  // Define band pairs, to iterate over
  var band1 = ee.List(['B1', 'B2', 'B1']);
  var band2 = ee.List(['B2', 'B3', 'B3']);
  var nband = ee.List(['B1B2', 'B2B3', 'B1B3']);
  // Iterage over band pairs
  for (var i = 0; i < 3; i += 1) {
    var x = band1.get(i)
    var y = band2.get(i)
    var z = nband.get(i)
    // Take log
    var imageLog = (image.select([x, y])).log()
    // Calculate Variance and Covariance of log of band pairs
    var covariance = imageLog.toArray().reduceRegion({
      reducer: ee.Reducer.covariance(),
      geometry: sand,
      scale: 10,
      maxPixels: 1e12
    });
    var covarMatrix = ee.Array(covariance.get('array'))
    var var1 = covarMatrix.get([0,0])
    var var2 = covarMatrix.get([1,1])
    var covar = covarMatrix.get([0,1])
    // Calculate attenuation coefficient
    var a = (var1.subtract(var2)).divide(covar.multiply(2))
    var attenCoeffRatio = a.add(((a.pow(2)).add(1)).sqrt())
    // Apply expression
    var depthInvariantIndex = image.expression(
      'image1 - ( image2 * coeff)',{
        'image1': imageLog.select([x]),
        'image2': imageLog.select([y]),
        'coeff': attenCoeffRatio
    })
    // Concatenate DIV to original image
    image = ee.Image.cat([image, depthInvariantIndex.select([x], [z])])
  }
  return image
}
// Function to shift an image to have non negative values
function makePositive(image){
  // Calculate minimum of image
  var min = image.reduceRegion({
    reducer: ee.Reducer.min(),
    geometry: Corfu,
    scale: 30,
    maxPixels: 1e12
  });
  // Subtract min from image, to relocate the min to 0
  return image.subtract(min.toImage(image.bandNames()))
}
// Fucntion to clip an image collection
function clipCollection(image){
  return image.clip(Corfu)
}
// Define a boxcar or low-pass kernel.
var boxcar = ee.Kernel.square({
  radius: 2, units: 'pixels', normalize: true
});
//--------------------------------------------------------------------------------
// Apply Image Corrections Successively
//--------------------------------------------------------------------------------
// Import S2A - 1C image collection
var S2Collection = ee.ImageCollection('COPERNICUS/S2')
    // Select relevant bands
    .select(['B1', 'B2', 'B3', 'B4', 'B8', 'QA60'])
    // Filter by dates (defines as global variables)
    .filterDate(start, end)
    // Clip each image in the collection using Coastline geometry
    .map(clipCollection)
// Define S2 to display original image (No corrections applied)    
var S2 = S2Collection
    .map(divide10000)
    .median()
Map.setCenter(19.8221, 39.7374, 10);
Map.addLayer(S2, {bands: ['B3','B2','B1']}, 'S2');
// To calculate the first quartile of a set of values
var quartReducer = ee.Reducer.percentile([25])
// Apply cloud mask and take first quartile
var S2_Cloud = S2Collection
    // Pre-filter to get less cloudy granules.
    .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 20))
    // Apply cloud mask
    .map(maskS2clouds)
    // Take first quartile composite, and rename the bands
    .reduce(quartReducer)
    .select(['B1_p25', 'B2_p25', 'B3_p25', 'B4_p25', 'B8_p25'], 
    ['B1', 'B2', 'B3', 'B4', 'B8']);
// Display Cloud-free composite    
Map.addLayer(S2_Cloud, {bands: ['B3','B2','B1'], min: 0, max: 0.3}, 'S2_Cloud');
// Apply atmospheric correction and display
var S2_Cloud_Atm = hazeRemovalDeepwater(S2_Cloud)
Map.addLayer(S2_Cloud_Atm, {bands: ['B3','B2','B1']}, 'S2_Cloud_Atm');
// Apply Sunglint correction and display
var S2_Cloud_Atm_Sg = sunglintRemoval(S2_Cloud_Atm)
Map.addLayer(S2_Cloud_Atm_Sg, {bands: ['B3','B2','B1']}, 'S2_Cloud_Atm_Sg');
// Shift image to have positive values, compute DIV and display
var S2_Cloud_Atm_Sg_DIV = depthInvariant(makePositive(S2_Cloud_Atm_Sg))
Map.addLayer(S2_Cloud_Atm_Sg_DIV, {bands: ['B2B3']}, 'DIV');
//--------------------------------------------------------------------------------
// Classification 
//--------------------------------------------------------------------------------
// Use these bands to classify
var bands = ['B1','B2', 'B3', 'B4','B2B3']
// Define image-composite to be used for classification 
var classificationComp = S2_Cloud_Atm_Sg_DIV.select(bands).convolve(boxcar)
// Merge Feature collections to define training points
// // var newFC = rocks.merge(softBottoms).merge(posidonia).merge(deepWater)
var newFC = seagrasses.merge(nonSeagrass)
// Sample the image to generate sampled data
// Concatenate additional column of randomply generated numbers
var sampledData = classificationComp.sampleRegions({
  collection: newFC,
  scale: 40
}).randomColumn('random', 0);
// Split the sampled data into training and validation sets
var trainingData = sampledData.filter(ee.Filter.lt('random', 0.8))
var validationData = sampledData.filter(ee.Filter.gte('random', 0.8))
// Define different classifiers and their parameters
var cartClassifier = ee.Classifier.cart()
var svmClassifier = ee.Classifier.svm({
  kernelType: 'RBF',
  gamma: 1000,
  cost: 100
})
var rfClassifier = ee.Classifier.randomForest(500)
// Train the classifier, with 80% of the sampled data
// Class label is stored in the 'Id' property.
var trainedClassifier = svmClassifier.train({
  features: trainingData,
  classProperty: 'Id',
  inputProperties: bands,
});
// Classify the image using the trained classifier
var S2_Classified = classificationComp.classify(trainedClassifier)
// Display Classified map
// Map.addLayer(S2_Classified, {min: 0, max: 3, palette: ['008000', 'FCE883', '232323', '1F75FE']}, 'classification');
Map.addLayer(S2_Classified.updateMask(S2_Classified.eq(0)), {palette: ['00ff00']}, 'classification');
// Accuracy Assessment
// Get a confusion matrix representing resubstitution accuracy.
var trainAccuracy = trainedClassifier.confusionMatrix();
// print('Resubstitution error matrix: ', trainAccuracy);
// print('User accuracy: ', trainAccuracy.consumersAccuracy());
// print('Producers accuracy: ', trainAccuracy.producersAccuracy());
// print('Training overall accuracy: ', trainAccuracy.accuracy());
// Classify the validation data.
var validated = validationData.classify(trainedClassifier);
// Get a confusion matrix representing expected accuracy.
var testAccuracy = validated.errorMatrix('Id', 'classification');
// print('Validation error matrix: ', testAccuracy);
// print('Validation overall accuracy: ', testAccuracy.accuracy());