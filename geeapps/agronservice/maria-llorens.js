//First variables to choose dates of calculated imags and NDVI chart
var newDate = new Date();
var fechaFinNDVI = ee.Date(newDate);
var fechaInicioNDVI = fechaFinNDVI.advance(-15, 'day');
var fechaInicioChart = '2016-01-01';
var fechaFinChart =  new Date()-3;
//GEOMETRY CALCULATIONS AND functions
//The first step is on imports
var geometry = /* color: #ffc82d */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.957211867395927,
                36.93228902573744
              ],
              [
                -4.957325224905617,
                36.93248190051763
              ],
              [
                -4.957419102221138,
                36.93258052482477
              ],
              [
                -4.957673912077553,
                36.932606252883886
              ],
              [
                -4.957952861815102,
                36.932917132911975
              ],
              [
                -4.9580607288670535,
                36.933060701115174
              ],
              [
                -4.958280670006275,
                36.93314431674882
              ],
              [
                -4.958481835682392,
                36.93335871539035
              ],
              [
                -4.958492564518451,
                36.93353880978318
              ],
              [
                -4.958621310551166,
                36.93362885681999
              ],
              [
                -4.958752738792896,
                36.93371890375045
              ],
              [
                -4.958844525337099,
                36.93375488943013
              ],
              [
                -4.959034962177157,
                36.93383850430224
              ],
              [
                -4.959142250537752,
                36.93384064827212
              ],
              [
                -4.9593112297056905,
                36.93384064827212
              ],
              [
                -4.959418518066286,
                36.9339028233722
              ],
              [
                -4.959490937709688,
                36.9339178311474
              ],
              [
                -4.9596867389677755,
                36.93389853543589
              ],
              [
                -4.9599603242872945,
                36.933862087967526
              ],
              [
                -4.96007297706592,
                36.933819208570654
              ],
              [
                -4.960363834642749,
                36.9335695651772
              ],
              [
                -4.9605194027656125,
                36.93343020651432
              ],
              [
                -4.960688381933551,
                36.93321366408646
              ],
              [
                -4.960116557033189,
                36.9326911216538
              ],
              [
                -4.959973802977629,
                36.93263585476647
              ],
              [
                -4.96007840912921,
                36.932455758240096
              ],
              [
                -4.960172286444731,
                36.93226494121812
              ],
              [
                -4.9603600410757736,
                36.93216631650263
              ],
              [
                -4.960448553973265,
                36.93205268352007
              ],
              [
                -4.960683024376635,
                36.93181684094008
              ],
              [
                -4.960876143425708,
                36.93135801783011
              ],
              [
                -4.961086502866806,
                36.93052306707105
              ],
              [
                -4.961363499299182,
                36.9296385695368
              ],
              [
                -4.96129107965578,
                36.92876694054892
              ],
              [
                -4.96115421772663,
                36.92837196440702
              ],
              [
                -4.961221272952002,
                36.92824546100572
              ],
              [
                -4.96141170979206,
                36.92812324565597
              ],
              [
                -4.961639697558326,
                36.92807393063478
              ],
              [
                -4.961722846037787,
                36.928097516083675
              ],
              [
                -4.961865003115577,
                36.928043912780176
              ],
              [
                -4.9622190547055425,
                36.92787238195574
              ],
              [
                -4.962696239818342,
                36.92760000039113
              ],
              [
                -4.9627901171338635,
                36.92752066697085
              ],
              [
                -4.9627758971060985,
                36.92735368886039
              ],
              [
                -4.9627007952536815,
                36.92721646298928
              ],
              [
                -4.962735663970875,
                36.92713927332822
              ],
              [
                -4.962880503257679,
                36.92695273132469
              ],
              [
                -4.962915371974873,
                36.92675332385065
              ],
              [
                -4.963004313208785,
                36.926240079766465
              ],
              [
                -4.9630150420448444,
                36.92585198154217
              ],
              [
                -4.962982976515036,
                36.925405947685164
              ],
              [
                -4.963068807203513,
                36.92480985578485
              ],
              [
                -4.962980294306021,
                36.9247884135433
              ],
              [
                -4.962813997347098,
                36.924912778460225
              ],
              [
                -4.962679886896353,
                36.92493850910735
              ],
              [
                -4.9622507334539705,
                36.924919211122834
              ],
              [
                -4.961674058515769,
                36.924880615139095
              ],
              [
                -4.961411202032309,
                36.92484416335874
              ],
              [
                -4.961116268431056,
                36.92469402763394
              ],
              [
                -4.9610465309966685,
                36.9245460758199
              ],
              [
                -4.96101434448849,
                36.92443243147793
              ],
              [
                -4.961143090521205,
                36.92406576650262
              ],
              [
                -4.961495347568302,
                36.923289745530944
              ],
              [
                -4.961363919326573,
                36.92319110920347
              ],
              [
                -4.961125202724247,
                36.92311177119531
              ],
              [
                -4.960921354839115,
                36.923081751386896
              ],
              [
                -4.960763104507237,
                36.92306030865938
              ],
              [
                -4.960626311847477,
                36.923058164386276
              ],
              [
                -4.95862172050488,
                36.92279560892396
              ],
              [
                -4.95849029226315,
                36.92278274323991
              ],
              [
                -4.958323189847306,
                36.92302657220344
              ],
              [
                -4.958070249639832,
                36.923324755018044
              ],
              [
                -4.9579924655784,
                36.923288302493816
              ],
              [
                -4.958121211611115,
                36.92316607919726
              ],
              [
                -4.958161444746338,
                36.92304385570477
              ],
              [
                -4.958271415315949,
                36.9229816717474
              ],
              [
                -4.95823386438974,
                36.92287874646519
              ],
              [
                -4.958177538000427,
                36.92281227381326
              ],
              [
                -4.958019287668549,
                36.92281012953319
              ],
              [
                -4.9578664017547,
                36.92273507969312
              ],
              [
                -4.957597036251627,
                36.92266620932663
              ],
              [
                -4.957438785919749,
                36.922589015058605
              ],
              [
                -4.957462925800883,
                36.922546129320395
              ],
              [
                -4.957623858341776,
                36.92259330363111
              ],
              [
                -4.957704324612223,
                36.92254184074525
              ],
              [
                -4.95789476145228,
                36.92243462628811
              ],
              [
                -4.9582166265340675,
                36.92184065546463
              ],
              [
                -4.95817632442504,
                36.92167384963121
              ],
              [
                -4.958232650814352,
                36.921328614610495
              ],
              [
                -4.957371661720572,
                36.92104556361373
              ],
              [
                -4.957476267872153,
                36.92086972837453
              ],
              [
                -4.957663536086329,
                36.920486084099316
              ],
              [
                -4.9576581716682995,
                36.9203702893573
              ],
              [
                -4.957794898642646,
                36.92017103971323
              ],
              [
                -4.95819722999488,
                36.91995017089988
              ],
              [
                -4.958519095076667,
                36.91988584005723
              ],
              [
                -4.958658569945442,
                36.91983651970781
              ],
              [
                -4.958859735621559,
                36.91957061814385
              ],
              [
                -4.95938051155531,
                36.9195152692776
              ],
              [
                -4.959699694428082,
                36.91955601234889
              ],
              [
                -4.959908906731243,
                36.91975329428096
              ],
              [
                -4.960002784046765,
                36.91989696667117
              ],
              [
                -4.960072848800678,
                36.92000925846552
              ],
              [
                -4.96015063286211,
                36.92003499076741
              ],
              [
                -4.960196230415363,
                36.91997923743562
              ],
              [
                -4.960288541106252,
                36.91954636040454
              ],
              [
                -4.960253672389058,
                36.919205404514656
              ],
              [
                -4.960215878397548,
                36.91894912903041
              ],
              [
                -4.960191738516414,
                36.918760422594296
              ],
              [
                -4.96004153481158,
                36.9187411230461
              ],
              [
                -4.959977161795223,
                36.918597448478224
              ],
              [
                -4.9595372795167805,
                36.91846449565187
              ],
              [
                -4.959250283152187,
                36.918316531750015
              ],
              [
                -4.959065210730159,
                36.91829723208948
              ],
              [
                -4.958485907893191,
                36.91824071951567
              ],
              [
                -4.958389348368655,
                36.91848518170273
              ],
              [
                -4.958274013381015,
                36.91868461080121
              ],
              [
                -4.95800711374477,
                36.918929914804096
              ],
              [
                -4.957717435171162,
                36.91928159382307
              ],
              [
                -4.957068572410549,
                36.919894550238155
              ],
              [
                -4.9567493895377766,
                36.92000176826682
              ],
              [
                -4.956298778423275,
                36.92002964492958
              ],
              [
                -4.955920586952175,
                36.91994387055008
              ],
              [
                -4.955696206223024,
                36.91993568903711
              ],
              [
                -4.95529387487079,
                36.91963118917795
              ],
              [
                -4.954727928768648,
                36.91956685806623
              ],
              [
                -4.954376559387697,
                36.91951324876497
              ],
              [
                -4.954003177191794,
                36.91940513155441
              ],
              [
                -4.953643761183798,
                36.91938368779296
              ],
              [
                -4.953278980757773,
                36.91938797654574
              ],
              [
                -4.952916882540762,
                36.91944587468456
              ],
              [
                -4.952474318053305,
                36.91962385757675
              ],
              [
                -4.95234557202059,
                36.919773963307506
              ],
              [
                -4.952260232051231,
                36.919816971782176
              ],
              [
                -4.951994693358756,
                36.91982554923875
              ],
              [
                -4.9517613411744605,
                36.91976336265679
              ],
              [
                -4.951503849109031,
                36.9197526408272
              ],
              [
                -4.951321458896018,
                36.919799816866174
              ],
              [
                -4.951227581580497,
                36.91993062300341
              ],
              [
                -4.951243674834586,
                36.92006571763091
              ],
              [
                -4.951316094477988,
                36.92023726601934
              ],
              [
                -4.951444840510703,
                36.920415247064426
              ],
              [
                -4.951533353408195,
                36.92060330751937
              ],
              [
                -4.951423382838584,
                36.921040752063206
              ],
              [
                -4.951452887137748,
                36.92111794789866
              ],
              [
                -4.951501166900016,
                36.921218731232905
              ],
              [
                -4.9515859875829165,
                36.92152906589332
              ],
              [
                -4.951628902927155,
                36.92174349720343
              ],
              [
                -4.951588669791931,
                36.92202011270277
              ],
              [
                -4.9514840636403505,
                36.922240975520516
              ],
              [
                -4.951378299303656,
                36.92240554363095
              ],
              [
                -4.951206637926703,
                36.92246987234784
              ],
              [
                -4.950994743414526,
                36.92263498247281
              ],
              [
                -4.950823082037573,
                36.922695022429615
              ],
              [
                -4.950587047644262,
                36.92273147523744
              ],
              [
                -4.950387820752553,
                36.922731777406575
              ],
              [
                -4.9498782010397235,
                36.922877588463095
              ],
              [
                -4.949647531064443,
                36.922954782438964
              ],
              [
                -4.949381992371968,
                36.92303412061048
              ],
              [
                -4.949250564130239,
                36.92315419984821
              ],
              [
                -4.9490547628721515,
                36.92321423939616
              ],
              [
                -4.948602635844281,
                36.92334818276864
              ],
              [
                -4.948460478766492,
                36.923468261511736
              ],
              [
                -4.948127884848645,
                36.9236226481893
              ],
              [
                -4.947792608721784,
                36.92384136211403
              ],
              [
                -4.947323008857438,
                36.92407786587152
              ],
              [
                -4.947009190402696,
                36.92424511675418
              ],
              [
                -4.946571990333268,
                36.924571040497064
              ],
              [
                -4.946225150872124,
                36.92489288914195
              ],
              [
                -4.9461071336754685,
                36.92506657088692
              ],
              [
                -4.946024214408681,
                36.92518490776589
              ],
              [
                -4.945978616855427,
                36.92538431934228
              ],
              [
                -4.945962523601338,
                36.92552369271507
              ],
              [
                -4.9460268966176955,
                36.92565448903314
              ],
              [
                -4.946099316261098,
                36.92578957351954
              ],
              [
                -4.946262931011006,
                36.92594395549662
              ],
              [
                -4.946540612564263,
                36.926187531252154
              ],
              [
                -4.946948308334527,
                36.92650058163475
              ],
              [
                -4.947144109592614,
                36.92670642228168
              ],
              [
                -4.947591560274304,
                36.9270004356926
              ],
              [
                -4.947827594667615,
                36.927077625494206
              ],
              [
                -4.947883921056928,
                36.927150526901755
              ],
              [
                -4.9479617051183595,
                36.92714195026922
              ],
              [
                -4.948055582433881,
                36.92717840095093
              ],
              [
                -4.9484123162328615,
                36.927403537128335
              ],
              [
                -4.948538380056561,
                36.9274571408821
              ],
              [
                -4.948664443880261,
                36.927461429180774
              ],
              [
                -4.949066628023047,
                36.927701338164624
              ],
              [
                -4.949267793699164,
                36.92781068935516
              ],
              [
                -4.949809599920172,
                36.928070129787514
              ],
              [
                -4.9501556048830935,
                36.9279993733935
              ],
              [
                -4.950729700397687,
                36.9277792916564
              ],
              [
                -4.950735064815717,
                36.92772139984533
              ],
              [
                -4.951073023151594,
                36.92758203049025
              ],
              [
                -4.951228591274457,
                36.92751127364324
              ],
              [
                -4.951414611682935,
                36.927325739975004
              ],
              [
                -4.9515299466705756,
                36.927272136128856
              ],
              [
                -4.951698925838514,
                36.92723354133628
              ],
              [
                -4.951873269424482,
                36.92724426211395
              ],
              [
                -4.9520556596374945,
                36.92728928936372
              ],
              [
                -4.952486362402624,
                36.92743035059118
              ],
              [
                -4.952778723185247,
                36.92758687339145
              ],
              [
                -4.953046944086736,
                36.927689792317864
              ],
              [
                -4.953248672995414,
                36.92778112155317
              ],
              [
                -4.953414969954338,
                36.92782186020768
              ],
              [
                -4.95347666076168,
                36.92787760780491
              ],
              [
                -4.953557127032127,
                36.92795050844747
              ],
              [
                -4.953801208052482,
                36.92811989496538
              ],
              [
                -4.953892403158989,
                36.92825283095635
              ],
              [
                -4.9540935688351055,
                36.92852084636239
              ],
              [
                -4.954187446150627,
                36.92866664634752
              ],
              [
                -4.954255566316647,
                36.92886928373428
              ],
              [
                -4.954370901304287,
                36.92903438000075
              ],
              [
                -4.9544862362919275,
                36.92920376411035
              ],
              [
                -4.954480871873898,
                36.929272375288114
              ],
              [
                -4.954652533250851,
                36.92939244470066
              ],
              [
                -4.954832241254849,
                36.929546819381756
              ],
              [
                -4.9549314829884,
                36.92964544748656
              ],
              [
                -4.954934597368947,
                36.92972558478368
              ],
              [
                -4.955063343401662,
                36.92983922123543
              ],
              [
                -4.9551706317622575,
                36.93000002724562
              ],
              [
                -4.955192089434377,
                36.93010079883911
              ],
              [
                -4.9552457336146745,
                36.93025302801494
              ],
              [
                -4.955401301737538,
                36.93036451961282
              ],
              [
                -4.955594424986771,
                36.9305615399506
              ],
              [
                -4.955712442183426,
                36.93071591226409
              ],
              [
                -4.955916290068558,
                36.930848843727944
              ],
              [
                -4.9561255023717194,
                36.93102036785489
              ],
              [
                -4.956213422277642,
                36.93113996050145
              ],
              [
                -4.95639313028164,
                36.93117212118183
              ],
              [
                -4.956666715601159,
                36.931255738887295
              ],
              [
                -4.956851788023187,
                36.931442270361266
              ],
              [
                -4.956924207666589,
                36.93161164912035
              ],
              [
                -4.956976694461105,
                36.93177754820768
              ],
              [
                -4.957092029448745,
                36.93195121426783
              ],
              [
                -4.957153720256088,
                36.93213131198633
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.961049971450507,
                36.932913208551795
              ],
              [
                -4.9613074635594785,
                36.93269023261115
              ],
              [
                -4.961436209613794,
                36.932398647704495
              ],
              [
                -4.961607871019851,
                36.931892659483836
              ],
              [
                -4.9618009901014375,
                36.93135236326886
              ],
              [
                -4.961951193831737,
                36.93127517778263
              ],
              [
                -4.962468824282382,
                36.93073064659187
              ],
              [
                -4.962747774066997,
                36.930576274282195
              ],
              [
                -4.963112554554641,
                36.93053339302955
              ],
              [
                -4.963595352258835,
                36.930481935494555
              ],
              [
                -4.9638635732056855,
                36.93043047792485
              ],
              [
                -4.964045963449394,
                36.930301833848596
              ],
              [
                -4.964078149963029,
                36.93007027396417
              ],
              [
                -4.963906488557086,
                36.930001663492995
              ],
              [
                -4.963906488557086,
                36.92985586603659
              ],
              [
                -4.963906488557086,
                36.92971006830138
              ],
              [
                -4.963885030881443,
                36.92957284664879
              ],
              [
                -4.9639494039086,
                36.92920406223348
              ],
              [
                -4.964076999657323,
                36.92911248034003
              ],
              [
                -4.964205745711752,
                36.92906102184583
              ],
              [
                -4.964624170388674,
                36.92891522259036
              ],
              [
                -4.9646778145779535,
                36.92880372885394
              ],
              [
                -4.96465635690231,
                36.92854643499363
              ],
              [
                -4.964774374118974,
                36.928392058260556
              ],
              [
                -4.965128425768512,
                36.9282548342354
              ],
              [
                -4.965192798795897,
                36.92817764561273
              ],
              [
                -4.965310816012334,
                36.928117609963245
              ],
              [
                -4.965428833228884,
                36.928083303856624
              ],
              [
                -4.965557579283427,
                36.9281433395331
              ],
              [
                -4.9656434099864555,
                36.9282291047032
              ],
              [
                -4.966040376987621,
                36.92846924666613
              ],
              [
                -4.966201309555686,
                36.928434940717736
              ],
              [
                -4.9665017170159445,
                36.92825483423542
              ],
              [
                -4.966523174691815,
                36.92818622213019
              ],
              [
                -4.966587547718859,
                36.92809188038473
              ],
              [
                -4.966737751449273,
                36.927988961983765
              ],
              [
                -4.966898684017224,
                36.927980385444066
              ],
              [
                -4.967177633801839,
                36.92765447622106
              ],
              [
                -4.967274193342519,
                36.92736287205096
              ],
              [
                -4.967402939397061,
                36.92725137604413
              ],
              [
                -4.968060431342906,
                36.9268580540975
              ],
              [
                -4.968350109965513,
                36.92665221382524
              ],
              [
                -4.96881144999395,
                36.92627483854922
              ],
              [
                -4.969240603508638,
                36.925691618539425
              ],
              [
                -4.969691214699196,
                36.924911125957685
              ],
              [
                -4.969841418429269,
                36.9244393957981
              ],
              [
                -4.970045266348848,
                36.92421639507027
              ],
              [
                -4.970163283565512,
                36.92404485560502
              ],
              [
                -4.971085963622272,
                36.92376181464363
              ],
              [
                -4.971429286433931,
                36.923701775516726
              ],
              [
                -4.971600947839875,
                36.92364173634258
              ],
              [
                -4.971334653276131,
                36.92347986133986
              ],
              [
                -4.968212561456085,
                36.92285373437697
              ],
              [
                -4.967193321858417,
                36.92272507751493
              ],
              [
                -4.963813737929399,
                36.92183305063419
              ],
              [
                -4.962601379250145,
                36.92192740012473
              ],
              [
                -4.9623868024928015,
                36.92208178994831
              ],
              [
                -4.962343887141287,
                36.92218471632364
              ],
              [
                -4.962300971789773,
                36.922347682800556
              ],
              [
                -4.962150768059587,
                36.922442031654256
              ],
              [
                -4.962043479680915,
                36.9225106489291
              ],
              [
                -4.961871818274972,
                36.92255353469449
              ],
              [
                -4.9617645298963,
                36.9225535346945
              ],
              [
                -4.9615606819768345,
                36.92246776313956
              ],
              [
                -4.961474851273806,
                36.92236483714624
              ],
              [
                -4.961185172651312,
                36.92220187070607
              ],
              [
                -4.960562900054811,
                36.92204748112561
              ],
              [
                -4.96008010235073,
                36.92194455456498
              ],
              [
                -4.959983542809937,
                36.92220187070604
              ],
              [
                -4.9596831353495645,
                36.92225333383005
              ],
              [
                -4.959103778104577,
                36.92230479691929
              ],
              [
                -4.958985760888027,
                36.92236483714623
              ],
              [
                -4.958706811103411,
                36.92277654028577
              ],
              [
                -4.96040196748686,
                36.92299096812392
              ],
              [
                -4.961110070786162,
                36.92309389327201
              ],
              [
                -4.961421207084527,
                36.92316250996027
              ],
              [
                -4.961582139652478,
                36.92329974315143
              ],
              [
                -4.961185172651312,
                36.924251791614395
              ],
              [
                -4.961142257299798,
                36.92451767689933
              ],
              [
                -4.961206630327069,
                36.92468063838987
              ],
              [
                -4.961507037787442,
                36.92480071505475
              ],
              [
                -4.962043479680915,
                36.92489506087305
              ],
              [
                -4.962676481115295,
                36.92488648398531
              ],
              [
                -4.962805227169724,
                36.92487790709657
              ],
              [
                -4.963030532764833,
                36.92477498435678
              ],
              [
                -4.96312709230574,
                36.92479213815637
              ],
              [
                -4.963030532764833,
                36.92537536504706
              ],
              [
                -4.963059998080098,
                36.92568957374865
              ],
              [
                -4.96307072691809,
                36.92616987291736
              ],
              [
                -4.962952709701426,
                36.926924622640435
              ],
              [
                -4.962759590619726,
                36.92720765186019
              ],
              [
                -4.962856150160633,
                36.927559292760364
              ],
              [
                -4.96192274126588,
                36.92807388627608
              ],
              [
                -4.961654520319144,
                36.928142498482394
              ],
              [
                -4.9614399435618,
                36.9281596515243
              ],
              [
                -4.961241229111238,
                36.928349844784755
              ],
              [
                -4.961262686786995,
                36.92854710399737
              ],
              [
                -4.961391432841538,
                36.9288987387191
              ],
              [
                -4.96142361935506,
                36.929739224896785
              ],
              [
                -4.961133940732566,
                36.93063973551786
              ],
              [
                -4.960801346758558,
                36.93171175810078
              ],
              [
                -4.9604472951089065,
                36.932131986839785
              ],
              [
                -4.960211260675692,
                36.93227777994263
              ],
              [
                -4.959975226242477,
                36.932672277528525
              ],
              [
                -4.9601147011348985,
                36.93270658156994
              ],
              [
                -4.9607047872177645,
                36.933221140338446
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.958978467082943,
                36.92224522324317
              ],
              [
                -4.9588926363944665,
                36.92194502121552
              ],
              [
                -4.958688788509335,
                36.921884980668146
              ],
              [
                -4.958699517345394,
                36.921773476669046
              ],
              [
                -4.95879607686993,
                36.92160193173666
              ],
              [
                -4.958699517345394,
                36.92146469551287
              ],
              [
                -4.958259635066952,
                36.92134461361445
              ],
              [
                -4.95830255041119,
                36.92171343598662
              ],
              [
                -4.957916312313046,
                36.92245107537904
              ],
              [
                -4.9576695490836755,
                36.922656926959135
              ],
              [
                -4.958592228984799,
                36.92273412115841
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.958485055202118,
                36.9206064662528
              ],
              [
                -4.958560157054535,
                36.920134709540115
              ],
              [
                -4.958527970546356,
                36.92000604811191
              ],
              [
                -4.958281207316986,
                36.920040357847334
              ],
              [
                -4.958088088267914,
                36.92020332887969
              ],
              [
                -4.9577233078418885,
                36.92050353776442
              ],
              [
                -4.957487273448578,
                36.92100960149463
              ],
              [
                -4.958141732448212,
                36.921189725062746
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.958914208644501,
                36.92020332887969
              ],
              [
                -4.959128785365692,
                36.92002320298156
              ],
              [
                -4.9592468025623475,
                36.91993742859481
              ],
              [
                -4.95942919277536,
                36.91995458347987
              ],
              [
                -4.959557938808075,
                36.919988893238425
              ],
              [
                -4.9596974136768495,
                36.92009182242149
              ],
              [
                -4.959869075053803,
                36.920040357847334
              ],
              [
                -4.960062194102875,
                36.91999747067566
              ],
              [
                -4.959729600185028,
                36.91955144266044
              ],
              [
                -4.959386277431122,
                36.91951713270505
              ],
              [
                -4.959278989070526,
                36.91952571019534
              ],
              [
                -4.959010768169037,
                36.91955144266044
              ],
              [
                -4.95893566631662,
                36.9196114850452
              ],
              [
                -4.958828377956024,
                36.91981734429124
              ],
              [
                -4.95867817425119,
                36.92002320298156
              ],
              [
                -4.958656716579071,
                36.920169019217624
              ],
              [
                -4.958613801234833,
                36.920443496082015
              ],
              [
                -4.958753276103607,
                36.920460650853244
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.9607702972828065,
                36.92037487695854
              ],
              [
                -4.960791754954926,
                36.92009182242149
              ],
              [
                -4.960748839610687,
                36.91956002014686
              ],
              [
                -4.960587907069794,
                36.91893386110164
              ],
              [
                -4.9604269745289,
                36.91893386110164
              ],
              [
                -4.960491347545258,
                36.91973156967294
              ],
              [
                -4.9604269745289,
                36.91996316092096
              ],
              [
                -4.9602445843158876,
                36.92023763852634
              ],
              [
                -4.960523534053436,
                36.92039203174521
              ],
              [
                -4.960598635905853,
                36.92059788888408
              ],
              [
                -4.960834670299164,
                36.920512115143744
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.96266930126535,
                36.92067508516789
              ],
              [
                -4.9624439957080995,
                36.9205893115144
              ],
              [
                -4.962207961314789,
                36.920555002025964
              ],
              [
                -4.961853909724823,
                36.92054642465147
              ],
              [
                -4.9616929771839295,
                36.92058073414374
              ],
              [
                -4.961585688823334,
                36.920657930444904
              ],
              [
                -4.961446213954559,
                36.920812322812786
              ],
              [
                -4.961349654430023,
                36.92092382821741
              ],
              [
                -4.961446213954559,
                36.92097529219533
              ],
              [
                -4.9616929771839295,
                36.920812322812786
              ],
              [
                -4.9619182827411805,
                36.92071797195846
              ],
              [
                -4.962250876659027,
                36.920709394602255
              ],
              [
                -4.962604928248993,
                36.9207694360753
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.962390351527802,
                36.92136127092248
              ],
              [
                -4.962390351527802,
                36.92113826122956
              ],
              [
                -4.962465453380219,
                36.92095813753987
              ],
              [
                -4.962304520839325,
                36.92094098288057
              ],
              [
                -4.962089944118134,
                36.92096671486809
              ],
              [
                -4.961810994380585,
                36.92108679736164
              ],
              [
                -4.961532044643036,
                36.92114683853749
              ],
              [
                -4.961274552577606,
                36.9211983023649
              ],
              [
                -4.961027789348236,
                36.92116399315048
              ],
              [
                -4.9607702972828065,
                36.92113826122956
              ],
              [
                -4.9610707046924745,
                36.921412734605134
              ],
              [
                -4.9614354851185,
                36.921567125444774
              ],
              [
                -4.961875367396942,
                36.92161001173363
              ],
              [
                -4.962207961314789,
                36.921584279963206
              ],
              [
                -4.9623688938556825,
                36.921507084599824
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.959130153142496,
                36.91807158107879
              ],
              [
                -4.960085019551798,
                36.91845757450364
              ],
              [
                -4.9599670023551425,
                36.91821740104669
              ],
              [
                -4.959688052617594,
                36.91811446933358
              ],
              [
                -4.959366187535807,
                36.91797722683332
              ],
              [
                -4.959205254994913,
                36.91790860549058
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.959183797322794,
                36.91760838639007
              ],
              [
                -4.959173068486734,
                36.91698221132004
              ],
              [
                -4.958883389913126,
                36.916793500016794
              ],
              [
                -4.95829330392985,
                36.91651043218632
              ],
              [
                -4.957907065831705,
                36.916467543029455
              ],
              [
                -4.9577461332908115,
                36.91615016251895
              ],
              [
                -4.956984385930582,
                36.91588424810136
              ],
              [
                -4.956801995717569,
                36.91634745326189
              ],
              [
                -4.956898555242105,
                36.916750611019104
              ],
              [
                -4.956909284078165,
                36.91698221132004
              ],
              [
                -4.956920012914225,
                36.91719665541606
              ],
              [
                -4.957123860799356,
                36.917419676636236
              ],
              [
                -4.957810506307169,
                36.917737051863575
              ],
              [
                -4.958261117421671,
                36.91790860549058
              ],
              [
                -4.958432778798624,
                36.917882872471125
              ],
              [
                -4.958625897847696,
                36.91777136261985
              ],
              [
                -4.959055051290079,
                36.917960071503444
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.95828257509379,
                36.91806300342491
              ],
              [
                -4.958089456044718,
                36.91805442577012
              ],
              [
                -4.957692489110514,
                36.91792576083204
              ],
              [
                -4.95727406450419,
                36.91776278493224
              ],
              [
                -4.956866368733927,
                36.917402521180904
              ],
              [
                -4.956630334340616,
                36.91747972069947
              ],
              [
                -4.955879315816446,
                36.918123046981655
              ],
              [
                -4.955600366078897,
                36.91818309049109
              ],
              [
                -4.955214127980753,
                36.91823455631869
              ],
              [
                -4.954956635915323,
                36.918123046981655
              ],
              [
                -4.954827889882608,
                36.91787429479606
              ],
              [
                -4.954752788030191,
                36.9174539875353
              ],
              [
                -4.9546991438498935,
                36.91733389932105
              ],
              [
                -4.954259261571451,
                36.917282432885614
              ],
              [
                -4.95404468485026,
                36.91716234440121
              ],
              [
                -4.953948125325724,
                36.91698221132004
              ],
              [
                -4.953819379293009,
                36.91691358908198
              ],
              [
                -4.953636989079996,
                36.916887855726785
              ],
              [
                -4.95354042955546,
                36.917042255727715
              ],
              [
                -4.953561887227579,
                36.91727385514299
              ],
              [
                -4.953454598866983,
                36.917445409812
              ],
              [
                -4.953379497014566,
                36.91765127490536
              ],
              [
                -4.953465327703043,
                36.91778851799221
              ],
              [
                -4.953465327703043,
                36.91799438215937
              ],
              [
                -4.953465327703043,
                36.91820024577083
              ],
              [
                -4.953669175588175,
                36.9192381330148
              ],
              [
                -4.953969582997843,
                36.91928102061353
              ],
              [
                -4.954613313161417,
                36.91940110576165
              ],
              [
                -4.955128297292276,
                36.919478303257
              ],
              [
                -4.955396518193766,
                36.91952119072067
              ],
              [
                -4.955739840947672,
                36.91976993753421
              ],
              [
                -4.95604024835734,
                36.91987286701284
              ],
              [
                -4.956426486455484,
                36.91987286701284
              ],
              [
                -4.956844911061808,
                36.919795669916894
              ],
              [
                -4.957177504979654,
                36.91959838809447
              ],
              [
                -4.957585200749918,
                36.91919524539195
              ],
              [
                -4.957917794667765,
                36.918766367836824
              ],
              [
                -4.958196744405313,
                36.918337487869714
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.952648155234556,
                36.91934811602275
              ],
              [
                -4.9530558510048195,
                36.919228030791174
              ],
              [
                -4.953399173758726,
                36.91916798810448
              ],
              [
                -4.953270427726011,
                36.917692638664846
              ],
              [
                -4.952841274283628,
                36.917615439361825
              ],
              [
                -4.9524550361854836,
                36.917366685520506
              ],
              [
                -4.952025882743101,
                36.917238019422136
              ],
              [
                -4.951575271628599,
                36.91722944167452
              ],
              [
                -4.951403610251646,
                36.91734953005327
              ],
              [
                -4.951274864218931,
                36.91744388507536
              ],
              [
                -4.9511568470222755,
                36.9173838409839
              ],
              [
                -4.950952999137144,
                36.91735810778737
              ],
              [
                -4.950598947547178,
                36.91740957417173
              ],
              [
                -4.9501590652687355,
                36.91747819596351
              ],
              [
                -4.949987403891782,
                36.917538239980665
              ],
              [
                -4.949944488547544,
                36.91760686165666
              ],
              [
                -4.949998132727842,
                36.917752682513175
              ],
              [
                -4.950148336432676,
                36.91777841557656
              ],
              [
                -4.9502341671211525,
                36.91783845935733
              ],
              [
                -4.9502341671211525,
                36.91801001275623
              ],
              [
                -4.950191251776914,
                36.91815583284183
              ],
              [
                -4.950094692252378,
                36.91835311839624
              ],
              [
                -4.950094692252378,
                36.91852467063737
              ],
              [
                -4.949976675055723,
                36.91862760179681
              ],
              [
                -4.949880115531187,
                36.91877342070151
              ],
              [
                -4.949880115531187,
                36.91889350664897
              ],
              [
                -4.95005177690814,
                36.91903932504522
              ],
              [
                -4.950212709449033,
                36.91903932504522
              ],
              [
                -4.950319997809629,
                36.91915083304245
              ],
              [
                -4.950641862891416,
                36.91915941057394
              ],
              [
                -4.95103882982562,
                36.919262340876635
              ],
              [
                -4.951478712104063,
                36.91942531357176
              ],
              [
                -4.951843492530088,
                36.91945962356845
              ],
              [
                -4.952229730628233,
                36.91956255346592
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -4.9516838617564645,
                36.91967744661747
              ],
              [
                -4.950578791642329,
                36.919411544498836
              ],
              [
                -4.95029984190478,
                36.9192743043329
              ],
              [
                -4.949967247986933,
                36.91930861439752
              ],
              [
                -4.949741942429682,
                36.91942012200101
              ],
              [
                -4.949741942429682,
                36.91957451687509
              ],
              [
                -4.949838501954218,
                36.91968602408972
              ],
              [
                -4.949881417298457,
                36.919951925251276
              ],
              [
                -4.950063807511469,
                36.92022640289709
              ],
              [
                -4.950095994019648,
                36.92052661169098
              ],
              [
                -4.950031621003291,
                36.92073246846653
              ],
              [
                -4.9499350614787545,
                36.92084397398792
              ],
              [
                -4.950353486085078,
                36.92122137608121
              ],
              [
                -4.950353486085078,
                36.921581621791404
              ],
              [
                -4.9500101633311715,
                36.92175316676949
              ],
              [
                -4.949752671265742,
                36.921727435047366
              ],
              [
                -4.949516636872431,
                36.92169312607105
              ],
              [
                -4.949409348511836,
                36.92157304453237
              ],
              [
                -4.94930206015124,
                36.921555890011426
              ],
              [
                -4.949248415970942,
                36.92169312607105
              ],
              [
                -4.949334246659419,
                36.92186467079828
              ],
              [
                -4.94930206015124,
                36.92209625556786
              ],
              [
                -4.949194771790644,
                36.92236214832481
              ],
              [
                -4.949151856446406,
                36.92255084584788
              ],
              [
                -4.948980195069453,
                36.922636617294884
              ],
              [
                -4.948765618348261,
                36.922688080116785
              ],
              [
                -4.948669058823725,
                36.922628040154535
              ],
              [
                -4.948422295594355,
                36.92255942299691
              ],
              [
                -4.94829354956164,
                36.92255942299691
              ],
              [
                -4.947821480775019,
                36.922773851409445
              ],
              [
                -4.94778929426684,
                36.92303974180349
              ],
              [
                -4.947344477253864,
                36.923295715812706
              ],
              [
                -4.946582729893635,
                36.92360448955395
              ],
              [
                -4.946142847615192,
                36.9237674529688
              ],
              [
                -4.9458638978776435,
                36.923853223047246
              ],
              [
                -4.94569223650069,
                36.923990454972056
              ],
              [
                -4.945531303959797,
                36.92418772543125
              ],
              [
                -4.945509846287678,
                36.92457368789692
              ],
              [
                -4.945595676976154,
                36.92494249464968
              ],
              [
                -4.945584948140095,
                36.92527699225473
              ],
              [
                -4.945520575123737,
                36.925465682564
              ],
              [
                -4.945091421681354,
                36.92594598306214
              ],
              [
                -4.944748098927448,
                36.92605748095931
              ],
              [
                -4.9443404031571845,
                36.92620328565574
              ],
              [
                -4.944329674321125,
                36.926297629722484
              ],
              [
                -4.94445842035384,
                36.92638339695456
              ],
              [
                -4.944715912419269,
                36.92642628053442
              ],
              [
                -4.945005590992878,
                36.92642628053442
              ],
              [
                -4.945273811894367,
                36.92668358150703
              ],
              [
                -4.945370371418903,
                36.92683796167376
              ],
              [
                -4.945345072765917,
                36.92700934304121
              ],
              [
                -4.945312886257739,
                36.92714656928515
              ],
              [
                -4.945151953716845,
                36.92730094851433
              ],
              [
                -4.945141224880786,
                36.92748963381434
              ],
              [
                -4.945259242077441,
                36.92773835463259
              ],
              [
                -4.9452163267332025,
                36.92804711038154
              ],
              [
                -4.945119767208666,
                36.92826152336034
              ],
              [
                -4.944894461651415,
                36.928390170858165
              ],
              [
                -4.9445940542417475,
                36.92846735925262
              ],
              [
                -4.9442185449796625,
                36.92854454756896
              ],
              [
                -4.9441434431272455,
                36.92863031227322
              ],
              [
                -4.94428291799602,
                36.92882757072681
              ],
              [
                -4.944497494717211,
                36.92899052297738
              ],
              [
                -4.944647698422045,
                36.92908486359483
              ],
              [
                -4.944830088635058,
                36.92899052297738
              ],
              [
                -4.94502320768413,
                36.928999099401985
              ],
              [
                -4.9452163267332025,
                36.92893906440956
              ],
              [
                -4.945302157421679,
                36.92885330005267
              ],
              [
                -4.945506005306811,
                36.92878468849769
              ],
              [
                -4.945731310864062,
                36.928758959148645
              ],
              [
                -4.946010260601611,
                36.92868177104945
              ],
              [
                -4.9461926508146234,
                36.928647465202474
              ],
              [
                -4.946342854519457,
                36.928690347508756
              ],
              [
                -4.946997313519091,
                36.928664618127875
              ],
              [
                -4.947898535748095,
                36.92846735925262
              ],
              [
                -4.948241858502001,
                36.92841590033166
              ],
              [
                -4.948542265911669,
                36.92835586487997
              ],
              [
                -4.948756842632861,
                36.92836444137597
              ],
              [
                -4.949293284435839,
                36.92821864081281
              ],
              [
                -4.949679522533984,
                36.92809856955145
              ],
              [
                -4.94977608205852,
                36.92806426344203
              ],
              [
                -4.949228911419482,
                36.92781554368705
              ],
              [
                -4.948928504009814,
                36.92766974207413
              ],
              [
                -4.948671011944384,
                36.92748963381434
              ],
              [
                -4.948456435223193,
                36.927455327430856
              ],
              [
                -4.9481131124692865,
                36.92722375893882
              ],
              [
                -4.947941451092333,
                36.9271551459172
              ],
              [
                -4.947834162731738,
                36.9271551459172
              ],
              [
                -4.947726874371142,
                36.92711226274733
              ],
              [
                -4.947512297649951,
                36.92696645978934
              ],
              [
                -4.947168974896044,
                36.926734889812316
              ],
              [
                -4.946954398174853,
                36.92658050943685
              ],
              [
                -4.946696906109423,
                36.92639182188675
              ],
              [
                -4.94628921033916,
                36.92608305943378
              ],
              [
                -4.945945887585253,
                36.9257056814042
              ],
              [
                -4.945841062658474,
                36.92541646239063
              ],
              [
                -4.945980537527248,
                36.92506481166597
              ],
              [
                -4.946152198904201,
                36.924781774538744
              ],
              [
                -4.946998175758267,
                36.924214928773054
              ],
              [
                -4.9480925170363435,
                36.923605962015685
              ],
              [
                -4.94868260301962,
                36.92318568634644
              ],
              [
                -4.949171081587906,
                36.923042775982225
              ],
              [
                -4.949417844817276,
                36.92281119408744
              ],
              [
                -4.9500830326529695,
                36.92271684570643
              ],
              [
                -4.9504799995871736,
                36.92257103434252
              ],
              [
                -4.9509306107016755,
                36.92255388004608
              ],
              [
                -4.951145187422867,
                36.92234802818777
              ],
              [
                -4.9513812218161775,
                36.922202216118535
              ],
              [
                -4.951467052504654,
                36.921987786098455
              ],
              [
                -4.951467052504654,
                36.92170473754859
              ],
              [
                -4.951359764144058,
                36.9214988833978
              ],
              [
                -4.951295391127701,
                36.9210614414822
              ],
              [
                -4.951252475783463,
                36.92082985356975
              ],
              [
                -4.951351000803697,
                36.92058859161791
              ],
              [
                -4.951329543131578,
                36.92040846662979
              ],
              [
                -4.951190068262804,
                36.92018545415027
              ],
              [
                -4.9511471529185656,
                36.91998817333626
              ],
              [
                -4.951190068262804,
                36.919790892011854
              ],
              [
                -4.9513724584758165,
                36.91973084976833
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    });
// Create a planar polygon.
var planarPolygon = ee.Geometry(geometry, null, false);
// Display the polygons by adding them to the map.
Map.centerObject(geometry);
//Map.addLayer(geometry, {color: 'FF0000'}, 'geodesic polygon');
Map.addLayer(planarPolygon, {color: '000000'}, 'Área de estudio');
print('Polygon printout: ', geometry);
// Print polygon area in square kilometers.
print('Polygon area: ', geometry.area().divide(10000));
// Print polygon perimeter length in kilometers.
print('Polygon perimeter: ', geometry.perimeter().divide(1000));
// Print the geometry as a GegeometrygeometryoJSON string.
print('Polygon GeoJSON: ', geometry.toGeoJSONString());
// Print the GeoJSON 'type'.
print('Geometry type: ', geometry.type());
// Print the coordinates as lists.
print('Polygon coordinates: ', geometry.coordinates());
// Print whether the geometry is geodesic.
print('Geodesic? ', geometry.geodesic());
/*
// Compute a buffer of the polygon.
var buffer = polygon.buffer(1000000);
// Compute the centroid of the polygon.
var centroid = polygon.centroid();
Map.addLayer(buffer, {}, 'buffer');
Map.addLayer(centroid, {}, 'centroid');
// Display polygon 1 in red and polygon 2 in blue.
Map.setCenter(-45, 30);
Map.addLayer(poly1, {color: 'FF0000'}, 'poly1');
Map.addLayer(poly2, {color: '0000FF'}, 'poly2');
// Compute the intersection, display it in blue.
var intersection = poly1.intersection(poly2, ee.ErrorMargin(1));
Map.addLayer(intersection, {color: '00FF00'}, 'intersection');
// Compute the union, display it in magenta.
var union = poly1.union(poly2, ee.ErrorMargin(1));
Map.addLayer(union, {color: 'FF00FF'}, 'union');
// Compute the difference, display in yellow.
var diff1 = poly1.difference(poly2, ee.ErrorMargin(1));
Map.addLayer(diff1, {color: 'FFFF00'}, 'diff1');
// Compute symmetric difference, display in black.
var symDiff = poly1.symmetricDifference(poly2, ee.ErrorMargin(1));
Map.addLayer(symDiff, {color: '000000'}, 'symmetric difference');
*/
// Load the FeatureCollection Sentinel 2.
var s2 = ee.ImageCollection('COPERNICUS/S2')
          .filterBounds(geometry)
          .filterDate(fechaInicioNDVI,fechaFinNDVI );
print(s2);
// Function to mask clouds using the Sentinel-2 QA band..
function maskS2clouds(image) {
  // get date of the image to pass it through
  var date = image.date().millis();
  var qa = image.select('QA60');
  // Bits 10 and 11 are clouds and cirrus, respectively.
  var cloudBitMask = ee.Number(2).pow(10).int();
  var cirrusBitMask = ee.Number(2).pow(11).int();
  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0).and(
             qa.bitwiseAnd(cirrusBitMask).eq(0));
  // Return the masked and scaled data.
  return image.updateMask(mask).divide(10000).set('system:time_start', date);
}
var imagenes=s2.map(maskS2clouds);
// Display the results on the geometry we are working on.
Map.centerObject(geometry);
//Create the palettes to paint layers in the map.addlayer
var ndviPalette = ['b5b1ae', 'CE7E45', 'DF923D', 'F1B555', 'FCD163', '99B718',
  '74A901', '66A000', '529400', '3E8601', '207401', '056201',
  '004C00', '023B01', '012E01', '011D01', '011301'];
var ndwiPalette = ['#eff3ff', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#084594', '#002556'];
//New variables to know how many images we have for the choosen dates and list them for the loop, try to change GETINFO
print (imagenes);
var list=imagenes.toList(imagenes.size());
var max=ee.Number(imagenes.size());
var maximo = max.getInfo();
//maximum of 149 images to not saturate the server and machine.
if(maximo>149) maximo=149;
var cuenta =0;
//Here starts the loop to calculate each image from the collection with mask clouds of S2 collection
for (var i=0;i<maximo;i++){
    var AuxImg = list.get(i);
    var image = ee.Image(AuxImg);
    var clip=image.clip(geometry);
    if(i===0){
      var dateAnt = 0;
    }else{
      var dateAnt = date;  
    }
    //Try to optimize the code taking GETINFO out or changing it.
    var date = clip.date().format('yyyy-MM-dd').getInfo();
    if(date==dateAnt){
    }else{
      //Now we already have the images in order to be calculated with all the indexes we want to use.
      //At the beginning using the clip image from the general image we collect with all the data about date and bands
      //NDVI: calculate, give name, visualize and export to task menu
        image=clip.addBands(clip.normalizedDifference(['B8','B4']).rename('Vigorosidad_Cultivo'));
        var nameVigorosidad_Cultivo= 'Vigorosidad_Cultivo_'+cuenta.toString()+'_'+(date);
        var NDVI=image.addBands('Vigorosidad_Cultivo');
        Map.addLayer(image.select(['Vigorosidad_Cultivo']), {min:0, max: 1,palette: ndviPalette},nameVigorosidad_Cultivo, false);
        /*Export.image.toDrive({ 
                   image: image.select(['Vigorosidad_Cultivo']),
                   description: nameVigorosidad_Cultivo,
                   fileNamePrefix: nameVigorosidad_Cultivo,
                   scale: 10,
                   region:geometry,
                   });*/
        //NDWI: calculate reusing the image already we use in NDVI calculation (as a clip, because it contains all bands) , give name, visualize and export to task menu.        
        image=image.addBands(image.normalizedDifference(['B8A','B11']).rename('Estrés_hídrico'));
        var nameEstrés_hídrico= 'Estrés_hídrico_'+cuenta.toString()+'_'+date;
        Map.addLayer(image.select(['Estrés_hídrico']), {min:0, max: 1,palette: ndwiPalette},nameEstrés_hídrico, false);
        /*Export.image.toDrive({ 
                     image: image.select(['Estrés_hídrico']),
                     description: nameEstrés_hídrico,
                     fileNamePrefix: nameEstrés_hídrico,
                     scale: 30,
                     region:geometry,
                     });*/
        /*//NDRE: calculate reusing the image already we use in NDWI calculation (as a clip, because it contains all bands) , give name, visualize and export to task menu.            
        image=image.addBands(image.normalizedDifference(['B8','B5']).rename('NDRE'));
        var nameNDRE= 'NDRE_'+cuenta.toString()+'_'+date;
        Map.addLayer(image.select(['NDRE']), {min:0, max: 1,palette: ndviPalette},nameNDRE);
        Export.image.toDrive({ 
                   image: image.select(['NDRE']),
                   description: nameNDRE,
                   fileNamePrefix: nameNDRE,
                   scale: 10,
                   region:geometry,
                   });
        //MSAVI2: calculate reusing the image already we use in NDRE calculation (as a clip, because it contains all bands) , give name, visualize and export to task menu.
        image=image.addBands((image.select('B8').multiply(2).add(1).subtract(image.select('B8').multiply(2).add(1).pow(2).subtract(image.select('B8').subtract(image.select('B4')).multiply(8)).sqrt()).divide(2)).rename('MSAVI2'));
        var nameMSAVI2= 'MSAVI2_'+cuenta.toString()+'_'+date;
        Map.addLayer(image.select(['MSAVI2']), {min:0, max: 1,palette: ndviPalette},nameMSAVI2);
        Export.image.toDrive({ 
             image: image.select(['MSAVI2']),
             description: nameMSAVI2,
             fileNamePrefix: nameMSAVI2,
             scale: 10,
             region:geometry,
             });
        */
        //Calculate statistics of indexes
        var maxIndex = image.reduceRegion({
          reducer: ee.Reducer.max(),
          geometry: geometry,
          scale: 10,
          maxPixels: 1e9
        });
        var minIndex = image.reduceRegion({
          reducer: ee.Reducer.min(),
          geometry: geometry,
          scale: 10,
          maxPixels: 1e9
        });
        var meanIndex = image.reduceRegion({
          reducer: ee.Reducer.mean(),
          geometry: geometry,
          scale: 10,
          maxPixels: 1e9
        });
        print('maxIndex',maxIndex);
        print('minIndex',minIndex);
        print('meanIndex',meanIndex);
        /*
        var has = geometry.reduceRegion({
          reducer: ee.Reducer.max(area),
          geometry: geometry,
          scale: 10,
          maxPixels: 1e9
        });
        print('area',has);
        */
        /*var pairwisediff= function(image){
          var index = NDVIlist.indexOf(image);
          if (index !== 0) {
          var previousimage=NDVIlist.get(index.add(-1));
          var diff = image.subtract(previousimage);
          return diff;}
          };
        var S2_collection_dNDVI = S2collection_NDVI.map(pairwisediff);
*/
        //Calculate Kc from NDVI proposed formulation Calera et al,2014.
        var Kc = (ee.Number(meanIndex.get('Vigorosidad_Cultivo'))).multiply(1.25).add(0.1);
        //var Kc = ((ee.Number(meanIndex.get('Vigorosidad_Cultivo')).subtract(ee.Number(minIndex.get('Vigorosidad_Cultivo')))).divide((ee.Number(maxIndex.get('Vigorosidad_Cultivo'))).subtract(ee.Number(minIndex.get('Vigorosidad_Cultivo'))))).multiply(1.20);
        print('Kc value',Kc);
        //Every time we calculate we visualize and export tehn we are using less cache and computer resources for the executed of the code.
        //with that "cuenta" we get the number of calculated images for each index.
        cuenta++;
    }
}
//Here it give us the info of cuenta
print("Al final tengo " + cuenta + " imágenes");
/////////////////////////////////////////////////////////////////////////////////////////
//APP DEVELOPMENT
//center Button for the geometry
var button = ui.Button({
  style: {
    position:('top-left'),
    fontFamily:('monospace'),
    color:('#009639'),
    backgroundColor:('#8f8f8f'),
    padding:('3px 3px 3px 3px' ),
    //height:('500'),
    //fontWeight: ('100'),
    //fontSize :('6px'),
    //whiteSpace:('pre'),
    //border:('1px solid black'),
    //shown: (false)
    },
  label: 'Centrar Mapa',
  onClick: function() {
    print(Map.centerObject(geometry));
  }
});
//print(button);
Map.add(button);
// Create a panel, initially hidden.
var panel = ui.Panel({
  style: {
    width: '400px',
    shown: false
  },
  widgets: [
    ui.Label('Haz click en el mapa para cerrar el panel.')
  ]
});
//Let´s create and obtain the data for NDVI over time chart
var getdata= ee.ImageCollection ('COPERNICUS/S2') 
                .filterDate (fechaInicioChart, fechaFinChart)
                .filterBounds (geometry) 
                .filterMetadata ('CLOUDY_PIXEL_PERCENTAGE', 'Less_Than', 20);
//Calculations for NDVI
var withNDVI = getdata.map(function(image) {
  var ndvi = image.normalizedDifference(['B8', 'B4']).rename('NDVI');
  return image.addBands(ndvi);
});
var chart1 = ui.Chart.image.doySeriesByYear({
      imageCollection: withNDVI.select ('NDVI'),
      bandName: ('NDVI'),
      region: geometry,
      regionReducer: ee.Reducer.mean(),
      scale: 30,
      //startDay:fechaInicioChart,
      //endDay:fechaFinChart,
    }).setOptions({
      title: 'Histórico NDVI',
      hAxis: {title: 'Línea Temporal (día)', gridlines: {count: 7}},
      vAxis: {title: 'Valor NDVI'},
      interpolateNulls: true,
    });
    chart1.style().set({
            width: '450px',
            height: '340px'
        });
  //we finally add the chart to the panel   
  panel.add(chart1);
//ADD CHART POINT ANALYSIS TO THE PANEL!!!
// Create an intro panel with labels.
var intro = ui.Panel([
  ui.Label({
    value: 'Image Inspector',
    style: {fontSize: '20px', fontWeight: 'bold', backgroundColor: '#d4fcac'}
  }),
  ui.Label('Hacer Click en un punto del mapa para inspeccionar.')
]);
panel.add(intro);
// Create panels to hold lon/lat values.
var lon = ui.Label();
var lat = ui.Label();
panel.add(ui.Panel([lon, lat], ui.Panel.Layout.flow('horizontal')));
// Register a callback on the default map to be invoked when the map is clicked.
Map.onClick(function(coords) {
  // Update the lon/lat panel with values from the click event.
  //lon.setValue('lon: ' + coords.lon.toFixed(2));
  lat.setValue('lat: ' + coords.lat.toFixed(2));
  // Add a red dot for the point clicked on.
  var point = ee.Geometry.Point(coords.lon, coords.lat);
  var dot = ui.Map.Layer(point, {color: 'FF0000'});
  Map.layers().set(2, dot);
  // Create an NDVI chart.
  var ndviChart = ui.Chart.image.seriesByRegion({
      imageCollection: withNDVI.select ('NDVI'),
      band: ('NDVI'),
      regions: point,
      reducer: ee.Reducer.mean(),
      scale: 10,
  });
  ndviChart.setOptions({
    title: 'Histórico NDVI de un punto',
    vAxis: {title: 'NDVI'},
    hAxis: {title: 'Fecha', format: 'MM-yy', gridlines: {count: 7}},
    interpolateNulls: true,
  });
  panel.widgets().set(2, ndviChart);
});
  //CHIRPS Precipitation chart
  var prec = ee.ImageCollection('UCSB-CHG/CHIRPS/DAILY')
  .filterDate(fechaInicioChart, fechaFinChart)
  .select(['precipitation'])
  .filterBounds(geometry);
  // .map(function (img) {
  //   return img.clip(g).multiply(30)
  //   .set('system:time_start', img.get('system:time_start')). select(['precipitation']);
  //   })
  //   .sort('system:time_start', true);
  Map.style().set('cursor', 'crosshair');
  // Create prec chart.
  var precChart = ui.Chart.image.series(prec, geometry)
      .setOptions({
        title: 'Precipitación',
        vAxis: {title: 'Prec. (mm)'},
        hAxis: {title: 'Fecha', format: 'MM-yy', gridlines: {count: 7}},
        colors: ['#000099'],
      });
  //panel.widgets().set(3, GSMapChart);
  panel.add(precChart);
  //MODIS Temp chart
  var temp = ee.ImageCollection('MODIS/006/MOD11A2')
    .select(['LST_Day_1km'])
    .filterDate(fechaInicioChart, fechaFinChart)
    .map(function (img) {
    return img.clip(geometry).multiply(0.02).subtract(273.15)
    .set('system:time_start', img.get('system:time_start')). select(['LST_Day_1km']);
    })
    .sort('system:time_start', true);
    // Create temp chart.
  var TempChart = ui.Chart.image.series(temp, geometry)
      .setOptions({
        title: 'Temperatura',
        vAxis: {title: 'Temp. °C'},
        hAxis: {title: 'Fecha', format: 'MM-yy', gridlines: {count: 7}},
        colors: ['#000099'],
      });
  //panel.widgets().set(4, TempChart);
  panel.add(TempChart);
Map.style().set('cursor', 'crosshair');
// Create a button to unhide the panel.
var button = ui.Button({
  label: 'Gráficas',
  style: {
    position:('top-left'),
    fontFamily:('monospace'),
    color:('#009639'),
    backgroundColor:('#8f8f8f'),
    padding:('3px 3px 3px 3px' ),
    //height:('500'),
    //fontWeight: ('100'),
    //fontSize :('6px'),
    //whiteSpace:('pre'),
    //border:('1px solid black'),
    //shown: (false)
    },
  onClick: function() {
    // Hide the button.
    button.style().set('shown', false);
    // Display the panel.
    panel.style().set('shown', true);
    // Temporarily make a map click hide the panel
    // and show the button.
    var listenerId = Map.onClick(function() {
      panel.style().set('shown', false);
      button.style().set('shown', true);
      // Once the panel is hidden, the map should not
      // try to close it by listening for clicks.
      Map.unlisten(listenerId);
    });
  }
});
// Add the button to the map and the panel to root.
Map.add(button);
ui.root.insert(0, panel);
/////////////////////////////////////////////////////////////////////////////////////////////////////////
//MEJORAS PARA LA APP and visualization
Map.setOptions('SATELLITE');
// Set position of new panel2 for legend and title of map
var legend = ui.Panel({
style: {
position: 'bottom-left',
padding: '8px 15px'
}
});
// Create legend title for panel2
var legendTitle = ui.Label({
value: 'NDVI',
style: {
fontWeight: 'bold',
fontSize: '15px',
margin: '0 0 4px 0',
padding: '0'
}
});
//Add AGRON logo
/*
var logo = ee.Image("users/agronservice/tif_2");
//Add logo to panel2 we create
var branding = ui.Thumbnail({
  image:logo,
  params:{bands:['b1','b2','b3'],min:0,max:255},
  style:{width:'75px',height:'75px'}});
legend.add(branding);
*/
// Add the title to the panel2
legend.add(legendTitle);
// create vizualization parameters of the panel2
var viz = {min:0, max:1, palette:['b5b1ae', 'CE7E45', 'DF923D', 'F1B555', 'FCD163', '99B718',
  '74A901', '66A000', '529400', '3E8601', '207401', '056201',
  '004C00', '023B01', '012E01', '011D01', '011301']};
// create the legend image of panel2
var lon = ee.Image.pixelLonLat().select('latitude');
var gradient = lon.multiply((viz.max-viz.min)/100.0).add(viz.min);
var legendImage = gradient.visualize(viz);
// create text on top of legend
var panel1 = ui.Panel({
widgets: [
ui.Label(viz['max'])
],
});
legend.add(panel1);
// create thumbnail from the image
var thumbnail = ui.Thumbnail({
image: legendImage,
params: {bbox:'0,0,10,100', dimensions:'10x200'},
style: {padding: '1px', position: 'bottom-center'}
});
// add the thumbnail to the legend
legend.add(thumbnail);
// create text on top of legend
var panel1 = ui.Panel({
widgets: [
ui.Label(viz['min'])
],
});
legend.add(panel1);
Map.add(legend);
//Add text to the map
var label = ui.Label('AGRON - make sense of the data');
  label.style().set({
    position:('bottom-right'),
    fontFamily:('monospace'),
    color:('#009639'),
    backgroundColor:('#DBDBDB'),
    padding:('3px 3px 3px 3px' ),
    //height:('500'),
    //fontWeight: ('100'),
    //fontSize :('6px'),
    //whiteSpace:('pre'),
    //border:('1px solid black'),
    //shown: (false)
    });
//print(label);
Map.add(label);
//Do a Check Box
/*var checkbox = ui.Checkbox('Mostrar Layers', false);
checkbox.onChange(function(checked) {
  // Shows or hides the first map layer based on the checkbox's value.
  Map.layers().get().setShown(checked);
});
Map.add(checkbox);*/
/*
// CREATE 2 MAPS
var leftMap = ui.Map();
//leftMap.setControlVisibility(false);
var leftSelector = addLayerSelector(leftMap, 0, 'top-left');
var rightMap = ui.Map();
//rightMap.setControlVisibility(false);
var rightSelector = addLayerSelector(rightMap, 1, 'top-right');
function addLayerSelector(mapToChange, defaultValue, position) {
  var label = ui.Label('Selecciona capa para visualizar');
  // This function changes the given map to show the selected image.
  function updateMap(selection) {
    mapToChange.layers().set(0, ui.Map.Layer(images[selection]));
  }
  // Configure a selection dropdown to allow the user to choose between images,
  // and set the map to update when a user makes a selection.
  var select = ui.Select({items: Object.keys(images), onChange: updateMap});
  select.setValue(Object.keys(images)['NDVI'], true);
  var controlPanel =
      ui.Panel({widgets: [label, select], style: {position: position}});
  mapToChange.add(controlPanel);
}
leftMap.setControlVisibility({zoomControl: true});
// Link them together.
var linker = new ui.Map.Linker([leftMap, rightMap]);
// Create a split panel with the two maps.
var splitPanel = ui.SplitPanel({
  firstPanel: leftMap,
  secondPanel: rightMap,
  orientation: 'horizontal',
  wipe: true
});
// Remove the default map from the root panel.
ui.root.clear();
// Add our split panel to the root panel.
ui.root.add(splitPanel);
/*
//===============================Create a slider==========================//
// A helper function to show the image for a given year on the default map.
var showLayer = function(imageNumber) {
  Map.layers().reset();
  var image2 = image.toList(1, imageNumber).get(0);
  Map.addLayer({
    eeObject: ee.Image(image),
    visParams: {
      bands: ['nd'],
      min: 0,
      max: 1,
      palette: ndviPalette
    },
    name: nameVigorosidad_Cultivo + imageNumber
  });
};
print ('hola')
// Create a label and slider.
var label = ui.Label('NDVI');
// Make a slider to step through all the images.
var slider;
s2.size().evaluate(function(size) {
  slider = ui.Slider({
    min: 0,
    max: size-1,
    step: 1,
    onChange: showLayer,
    style: {stretch: 'horizontal'}
  });
  // Create a panel that contains both the slider and the label.
  var panel2 = ui.Panel({
    widgets: [label, slider],
    layout: ui.Panel.Layout.flow('vertical'),
    style: {
      position: 'top-center',
      padding: '7px'
    }
  });
  // Add the panel to the map.
  Map.add(panel2);
  // Set default values on the slider and map.
  slider.setValue(0);
})
*/
/*
//OTRO SLIDER
var dateSliderOne = ui.Panel([ui.DateSlider({
  start: fechaInicioNDVI,
  end: fechaFinNDVI
})]);
Map.add(dateSliderOne)
*/
/*
// Define a function to generate a download URL of the image for the
// viewport region. 
function downloadImg() {
  var viewBounds = ee.Geometry.Rectangle(Map.getBounds());
  var downloadArgs = {
    name: 'ee_image',
    band: (nameVigorosidad_Cultivo),
    scale: 10,
    region: viewBounds.toGeoJSONString()
 };
 var url = image.getDownloadURL(downloadArgs);
 urlLabel.setUrl(url);
 urlLabel.style().set({shown: true});
}
// Add UI elements to the Map.
var downloadButton = ui.Button('Download viewport', downloadImg);
var urlLabel = ui.Label('Download', {shown: false});
var panel = ui.Panel([downloadButton, urlLabel]);
Map.add(panel);
*/
/////////////////////////////STATISTICS///////////////////////////////////////////////////////
// Create a panel, initially hidden.
/*
var panel3 = ui.Panel({
  style: {
    width: '400px',
    shown: false
  },
  widgets: [
    ui.Label('Haz click en el mapa para cerrar el panel.')
  ]
});
var intro3 = ui.Panel([
  ui.Label({
    value: 'Valores Estadísticos de los Índices',
    style: {fontSize: '20px', fontWeight: 'bold'}
  }),
]);
panel3.add(intro3);
var maxIndexl = ui.Label(maxIndex.get('Vigorosidad_Cultivo'));
var minIndexl = ui.Label(minIndex.get('Vigorosidad_Cultivo'));
var meanIndexl = ui.Label(meanIndex.get('Vigorosidad_Cultivo'));
var Kcl = ui.Label(Kc);
var area=ui.Label('Polygon area: ', geometry.area().divide(10000));
panel3.add(ui.Panel([area,maxIndexl,minIndexl,meanIndexl,Kcl], ui.Panel.Layout.flow('horizontal')));
// Create a button to unhide the panel.
var button3 = ui.Button({
  label: 'Valores Estadísticos',
  style: {
    position:('top-left'),
    fontFamily:('monospace'),
    color:('#009639'),
    backgroundColor:('#8f8f8f'),
    padding:('3px 3px 3px 3px' ),
    //height:('500'),
    //fontWeight: ('100'),
    //fontSize :('6px'),
    //whiteSpace:('pre'),
    //border:('1px solid black'),
    //shown: (false)
    },
  onClick: function() {
    // Hide the button.
    button3.style().set('shown', false);
    // Display the panel.
    panel3.style().set('shown', true);
    // Temporarily make a map click hide the panel
    // and show the button.
    var listenerId3 = Map.onClick(function() {
      panel3.style().set('shown', false);
      button3.style().set('shown', true);
      // Once the panel is hidden, the map should not
      // try to close it by listening for clicks.
      Map.unlisten(listenerId3);
    });
  }
});
// Add the button to the map and the panel to root.
Map.add(button3);
ui.root.insert(0, panel3);
*/
/*
// Extracting the series of VI
var ndvis = image.select(['Vigorosidad_Cultivo']);
// Individual differences of composites from the start and the end of time period
var ndvipre = ndvis.filterDate('2019-12-05', '2019-12-10').median();
var ndviactual = ndvis.filterDate('2019-12-10', '2019-12-16');
var difference = ndviactual.subtract(ndvipre);
var differenceLoss= difference.mask(difference.lt(0)).clip(geometry);
var num_differenceLoss=differenceLoss.reduceRegion(ee.Reducer.count(), geometry,250);
print(num_differenceLoss,'NDVI difference');
*/
//////////////////////////////DSM///////////////////////////////////////////////
//Selección de la colección DEM
var DEM = ee.Image("JAXA/ALOS/AW3D30_V1_1");
//Generación de los mapas de pendientes y orientación de laderas
var slope =  ee.Terrain.slope (DEM);
var slope = slope.clip(geometry.buffer(10));
var aspect =  ee.Terrain.aspect (DEM);
var aspect = aspect.clip(geometry.buffer(10));
var DSM = DEM.select('AVE');
var DSM = DSM.clip(geometry.buffer(10));
//Visualización de pendientes
Map.addLayer (slope,{
  min: 0.0,
  max: 90.0,
  palette: [
    '3ae237', 'b5e22e', 'd6e21f', 'fff705', 'ffd611', 'ffb613', 'ff8b13',
    'ff6e08', 'ff500d', 'ff0000', 'de0101', 'c21301', '0602ff', '235cb1',
    '307ef3', '269db1', '30c8e2', '32d3ef', '3be285', '3ff38f', '86e26f'
  ]},
'Pendientes',false);
// Convert to radians, compute the sin of the aspect.
var sinImage = aspect.divide(180).multiply(Math.PI).sin();
// Display the result.
Map.addLayer(sinImage, {min: -1, max: 1}, 'Orientaciones', false);
/*
//Visualización de orientación de laderas
Map.addLayer (aspect,{
  min: 0.0,
  max: 360.0,
  shown:false,
  palette: [
    '3ae237', 'b5e22e', 'd6e21f', 'fff705', 'ffd611', 'ffb613', 'ff8b13',
    'ff6e08', 'ff500d', 'ff0000', 'de0101', 'c21301', '0602ff', '235cb1',
    '307ef3', '269db1', '30c8e2', '32d3ef', '3be285', '3ff38f', '86e26f'
  ]},
'Laderas');
*/
//Visualización de DEM
Map.addLayer (DSM,{
  min: 418.0,
  max: 484.0,
  palette: [
    '709959', '8ead6a', 'acc27a', 'cbd68b', 'ebe89d', 'f2ea9d', 'f2e399',
    'f2dc91', 'f2d38a', 'ebc486', 'e0b484', 'd4a281', 'c9957f', 'c79183',
    'd9a5a5', 'e6bcc7', 'f2d8e6', 'fff2ff'
  ]},
'Modelo Digital del Terreno');
// Load the SRTM image as new DEM.
var srtm = ee.Image('CGIAR/SRTM90_V4');
//var scale = srtm.projection().nominalScale();
//print('SRTM scale in meters', scale);
// Compute the mean elevation in the polygon.
var meanDict = srtm.reduceRegion({
  bestEffort: true,
  reducer: ee.Reducer.mean(),
  geometry: geometry,
  scale: 90
});
print('Mean elevation', meanDict);
// Get the mean from the dictionary and print it.
var mean = meanDict.get('elevation');
print('Mean elevation', mean);
var maxALT= srtm.reduceRegion({
  reducer: ee.Reducer.max(),
  geometry: geometry,
  maxPixels: 90
});
var maxal = maxALT.get('elevation');
print('Max elevation', max);
var minALT = srtm.reduceRegion({
  reducer: ee.Reducer.min(),
  geometry: geometry,
  maxPixels: 90
});
var minal = minALT.get('elevation');
print('Min elevation', minal);
/*
app.boot = function() {
  app.createPanels();
  var main = ui.Panel({
    widgets: [
      app.intro.panel,
      app.filters.panel,
      app.export.panel,
    ],
    style: {width: '350px',backgroundColor: '225129'}
  });
  ui.root.clear();
  ui.root.insert(0, main);
  maps[0].style().set('cursor', 'crosshair');
  maps[1].style().set('cursor', 'crosshair');
  maps[2].style().set('cursor', 'crosshair');
  maps[3].style().set('cursor', 'crosshair');
  maps[4].style().set('cursor', 'crosshair');
  ui.root.add(mapGrid);
  ui.root.add(panel);
};
app.boot();
*/