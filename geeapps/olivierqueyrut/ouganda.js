var geometry = ui.import && ui.import("geometry", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.67326950311201,
                1.4199400050586266
              ],
              [
                30.67326950311201,
                1.0416863101986447
              ],
              [
                31.166280977721385,
                1.0416863101986447
              ],
              [
                31.166280977721385,
                1.4199400050586266
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [
        {
          "type": "rectangle"
        }
      ],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[30.67326950311201, 1.4199400050586266],
          [30.67326950311201, 1.0416863101986447],
          [31.166280977721385, 1.0416863101986447],
          [31.166280977721385, 1.4199400050586266]]], null, false),
    geometry3 = ui.import && ui.import("geometry3", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.888016413766195,
                1.3227950131067379
              ],
              [
                30.888016413766195,
                1.310138328224738
              ],
              [
                30.89887399585848,
                1.310138328224738
              ],
              [
                30.89887399585848,
                1.3227950131067379
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.96702356250887,
                1.34840851281477
              ],
              [
                30.96702356250887,
                1.3316761060245967
              ],
              [
                30.989682864266683,
                1.3316761060245967
              ],
              [
                30.989682864266683,
                1.34840851281477
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.927045220421405,
                1.3167341280733227
              ],
              [
                30.927045220421405,
                1.3048925927099657
              ],
              [
                30.943224305199237,
                1.3048925927099657
              ],
              [
                30.943224305199237,
                1.3167341280733227
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.92955854741149,
                1.3409388380504466
              ],
              [
                30.92955854741149,
                1.3303630799343786
              ],
              [
                30.937884124193715,
                1.3303630799343786
              ],
              [
                30.937884124193715,
                1.3409388380504466
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.913851531420278,
                1.3366484751345866
              ],
              [
                30.913851531420278,
                1.3312426071905026
              ],
              [
                30.917113097582387,
                1.3312426071905026
              ],
              [
                30.917113097582387,
                1.3366484751345866
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.9143236002069,
                1.3585721504027637
              ],
              [
                30.9143236002069,
                1.3511498714979042
              ],
              [
                30.929472716723012,
                1.3511498714979042
              ],
              [
                30.929472716723012,
                1.3585721504027637
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                31.00776545766894,
                1.447622449382859
              ],
              [
                31.00776545766894,
                1.436832659487178
              ],
              [
                31.073747799435296,
                1.436832659487178
              ],
              [
                31.073747799435296,
                1.447622449382859
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.86802510717621,
                1.33380031779514
              ],
              [
                30.86802510717621,
                1.32766507871496
              ],
              [
                30.872917456419373,
                1.32766507871496
              ],
              [
                30.872917456419373,
                1.33380031779514
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.862047721716635,
                1.4005817634652784
              ],
              [
                30.862047721716635,
                1.3943608893969563
              ],
              [
                30.876295616003745,
                1.3943608893969563
              ],
              [
                30.876295616003745,
                1.4005817634652784
              ]
            ]
          ],
          "geodesic": false,
          "evenOdd": true
        }
      ],
      "displayProperties": [
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        },
        {
          "type": "rectangle"
        }
      ],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.MultiPolygon(
        [[[[30.888016413766195, 1.3227950131067379],
           [30.888016413766195, 1.310138328224738],
           [30.89887399585848, 1.310138328224738],
           [30.89887399585848, 1.3227950131067379]]],
         [[[30.96702356250887, 1.34840851281477],
           [30.96702356250887, 1.3316761060245967],
           [30.989682864266683, 1.3316761060245967],
           [30.989682864266683, 1.34840851281477]]],
         [[[30.927045220421405, 1.3167341280733227],
           [30.927045220421405, 1.3048925927099657],
           [30.943224305199237, 1.3048925927099657],
           [30.943224305199237, 1.3167341280733227]]],
         [[[30.92955854741149, 1.3409388380504466],
           [30.92955854741149, 1.3303630799343786],
           [30.937884124193715, 1.3303630799343786],
           [30.937884124193715, 1.3409388380504466]]],
         [[[30.913851531420278, 1.3366484751345866],
           [30.913851531420278, 1.3312426071905026],
           [30.917113097582387, 1.3312426071905026],
           [30.917113097582387, 1.3366484751345866]]],
         [[[30.9143236002069, 1.3585721504027637],
           [30.9143236002069, 1.3511498714979042],
           [30.929472716723012, 1.3511498714979042],
           [30.929472716723012, 1.3585721504027637]]],
         [[[31.00776545766894, 1.447622449382859],
           [31.00776545766894, 1.436832659487178],
           [31.073747799435296, 1.436832659487178],
           [31.073747799435296, 1.447622449382859]]],
         [[[30.86802510717621, 1.33380031779514],
           [30.86802510717621, 1.32766507871496],
           [30.872917456419373, 1.32766507871496],
           [30.872917456419373, 1.33380031779514]]],
         [[[30.862047721716635, 1.4005817634652784],
           [30.862047721716635, 1.3943608893969563],
           [30.876295616003745, 1.3943608893969563],
           [30.876295616003745, 1.4005817634652784]]]], null, false),
    geometry4 = ui.import && ui.import("geometry4", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            30.891045388402404,
            1.3197055827328048
          ]
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Point([30.891045388402404, 1.3197055827328048]),
    imageJul = ui.import && ui.import("imageJul", "image", {
      "id": "COPERNICUS/S2/20190717T080611_20190717T082239_T36NTG"
    }) || ee.Image("COPERNICUS/S2/20190717T080611_20190717T082239_T36NTG"),
    imageJan = ui.import && ui.import("imageJan", "image", {
      "id": "COPERNICUS/S2/20190128T081211_20190128T082008_T36NTG"
    }) || ee.Image("COPERNICUS/S2/20190128T081211_20190128T082008_T36NTG"),
    building = ui.import && ui.import("building", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.930786245361674,
                1.3311519989012397
              ],
              [
                30.93098204661976,
                1.3313584732497121
              ],
              [
                30.931301229492533,
                1.3315917624278228
              ],
              [
                30.931526535049784,
                1.3317311996271772
              ],
              [
                30.93212198545109,
                1.3320315258759354
              ],
              [
                30.932304375664103,
                1.332114651884751
              ],
              [
                30.93228023578297,
                1.3321897334386936
              ],
              [
                30.9326101474918,
                1.332315763184795
              ],
              [
                30.93259405423771,
                1.3323854817649754
              ],
              [
                30.932293646828043,
                1.3324203410543214
              ],
              [
                30.932191722885477,
                1.3322433631186688
              ],
              [
                30.931872540012705,
                1.3322406816347074
              ],
              [
                30.93150775958668,
                1.331886725724854
              ],
              [
                30.931303911701548,
                1.3318894072092096
              ],
              [
                30.931148343578684,
                1.3316185772744578
              ],
              [
                30.93088280488621,
                1.3316105328204877
              ],
              [
                30.930617266193735,
                1.3312592583051963
              ],
              [
                30.930606537357676,
                1.330977702359844
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.930896215931284,
                1.33062642775439
              ],
              [
                30.930990093246805,
                1.3306773759827186
              ],
              [
                30.930885487095225,
                1.3308704429436358
              ],
              [
                30.93096058894764,
                1.330889213341822
              ],
              [
                30.93114029695164,
                1.330972339389148
              ],
              [
                30.93122880984913,
                1.3310581469189466
              ],
              [
                30.93139242459904,
                1.331184176722909
              ],
              [
                30.931682103172648,
                1.3311439544457555
              ],
              [
                30.93177598048817,
                1.3313477473099489
              ],
              [
                30.931955688492167,
                1.3314308733418172
              ],
              [
                30.93223732043873,
                1.3317848293171395
              ],
              [
                30.932561867729532,
                1.331830414552699
              ],
              [
                30.932950788036692,
                1.3320395703285188
              ],
              [
                30.933055394188273,
                1.3323077187331023
              ],
              [
                30.932964199081766,
                1.332401570667814
              ],
              [
                30.93199592162739,
                1.3317767848637163
              ],
              [
                30.931242220894205,
                1.3313155694904042
              ],
              [
                30.930697732464182,
                1.3308087687772105
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.931078606144297,
                1.330331464306588
              ],
              [
                30.931320004955637,
                1.3304226348305805
              ],
              [
                30.93127172519337,
                1.3305352572379163
              ],
              [
                30.931024961964,
                1.3304145903727174
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.932167583004343,
                1.3307873168928621
              ],
              [
                30.932124667660105,
                1.3306559240972378
              ],
              [
                30.93234192659031,
                1.3306049758684642
              ],
              [
                30.93239557077061,
                1.3307175982674924
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.93314122487675,
                1.3312217175143324
              ],
              [
                30.933100991741526,
                1.3311171395939427
              ],
              [
                30.933160000339853,
                1.3310608284042056
              ],
              [
                30.93327265311848,
                1.331119821079138
              ],
              [
                30.93325655986439,
                1.3311814952377772
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.932897143856394,
                1.3317017032972045
              ],
              [
                30.93325119544636,
                1.3316829329052138
              ],
              [
                30.933253877655375,
                1.3318840442404856
              ],
              [
                30.932891779438364,
                1.33188136275613
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.938516371742594,
                1.3301759381108358
              ],
              [
                30.93838226129185,
                1.3299453302852657
              ],
              [
                30.938806050316202,
                1.3297361743318183
              ],
              [
                30.93882750798832,
                1.329864885689892
              ],
              [
                30.938763134971964,
                1.330074041632424
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.935008042351114,
                1.3320637036861291
              ],
              [
                30.93537282277714,
                1.331977896191342
              ],
              [
                30.93533527185093,
                1.3322514075705651
              ],
              [
                30.935002677933085,
                1.3322514075705651
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.915159890705695,
                1.3334848664853984
              ],
              [
                30.915248403603186,
                1.332766229038869
              ],
              [
                30.91516793733274,
                1.3327528216218236
              ],
              [
                30.915165255123725,
                1.3325892511280628
              ],
              [
                30.915417382771125,
                1.332597295578827
              ],
              [
                30.91544152265226,
                1.3328118142562613
              ],
              [
                30.9154307938162,
                1.333321296040262
              ],
              [
                30.91528863673841,
                1.3334955924158491
              ],
              [
                30.91505796676313,
                1.3340318888786917
              ],
              [
                30.914907763058295,
                1.333954125898827
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.915589044148078,
                1.3333132515918642
              ],
              [
                30.915605137402167,
                1.3324256806234247
              ],
              [
                30.9156829214636,
                1.33223261378431
              ],
              [
                30.91587604051267,
                1.3322352952682968
              ],
              [
                30.915862629467597,
                1.3326857845355278
              ],
              [
                30.91577143436109,
                1.3334044220055552
              ],
              [
                30.915610501820197,
                1.3335787183752519
              ],
              [
                30.915516624504676,
                1.3338522295766566
              ],
              [
                30.915444204861274,
                1.334123059265755
              ],
              [
                30.915232310349097,
                1.3341069703741628
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.915175983959784,
                1.3320583173193365
              ],
              [
                30.91553003554975,
                1.3320288209932822
              ],
              [
                30.915511260086646,
                1.3324069102369556
              ],
              [
                30.915066013390174,
                1.3324176361721007
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.823697575375718,
                1.3342288018611486
              ],
              [
                30.823625155732316,
                1.334218075933891
              ],
              [
                30.823614426896256,
                1.3340491425734895
              ],
              [
                30.823335477158707,
                1.334025009235344
              ],
              [
                30.823322066113633,
                1.333866801790521
              ],
              [
                30.82350713853566,
                1.333866801790521
              ],
              [
                30.82379681710927,
                1.3336898239588215
              ],
              [
                30.82398993615834,
                1.334126905550352
              ],
              [
                30.82391751651494,
                1.3341322685141777
              ],
              [
                30.82391215209691,
                1.3342904759419405
              ],
              [
                30.82391215209691,
                1.3346712463195614
              ],
              [
                30.823721715256852,
                1.3346873352074642
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.824690582630865,
                1.33486660480219
              ],
              [
                30.82502854096674,
                1.335022130701769
              ],
              [
                30.82569104659342,
                1.33542703429072
              ],
              [
                30.825677635548345,
                1.335676411964622
              ],
              [
                30.825315537331335,
                1.3356710490041674
              ],
              [
                30.824618162987463,
                1.335585241635165
              ],
              [
                30.824438454983465,
                1.3353975380050334
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.985833911981445,
                1.3487303460234428
              ],
              [
                30.985817818727355,
                1.3471268288785565
              ],
              [
                30.986043124284606,
                1.347169732361067
              ],
              [
                30.986048488702636,
                1.3487893382728424
              ],
              [
                30.985823183145385,
                1.348767886545957
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.98616114148126,
                1.3468694079676538
              ],
              [
                30.986370353784423,
                1.3467889639274266
              ],
              [
                30.98641326912866,
                1.347384249762259
              ],
              [
                30.98619869240747,
                1.3473949756318213
              ]
            ]
          ],
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#98ff00",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[30.930786245361674, 1.3311519989012397],
           [30.93098204661976, 1.3313584732497121],
           [30.931301229492533, 1.3315917624278228],
           [30.931526535049784, 1.3317311996271772],
           [30.93212198545109, 1.3320315258759354],
           [30.932304375664103, 1.332114651884751],
           [30.93228023578297, 1.3321897334386936],
           [30.9326101474918, 1.332315763184795],
           [30.93259405423771, 1.3323854817649754],
           [30.932293646828043, 1.3324203410543214],
           [30.932191722885477, 1.3322433631186688],
           [30.931872540012705, 1.3322406816347074],
           [30.93150775958668, 1.331886725724854],
           [30.931303911701548, 1.3318894072092096],
           [30.931148343578684, 1.3316185772744578],
           [30.93088280488621, 1.3316105328204877],
           [30.930617266193735, 1.3312592583051963],
           [30.930606537357676, 1.330977702359844]]],
         [[[30.930896215931284, 1.33062642775439],
           [30.930990093246805, 1.3306773759827186],
           [30.930885487095225, 1.3308704429436358],
           [30.93096058894764, 1.330889213341822],
           [30.93114029695164, 1.330972339389148],
           [30.93122880984913, 1.3310581469189466],
           [30.93139242459904, 1.331184176722909],
           [30.931682103172648, 1.3311439544457555],
           [30.93177598048817, 1.3313477473099489],
           [30.931955688492167, 1.3314308733418172],
           [30.93223732043873, 1.3317848293171395],
           [30.932561867729532, 1.331830414552699],
           [30.932950788036692, 1.3320395703285188],
           [30.933055394188273, 1.3323077187331023],
           [30.932964199081766, 1.332401570667814],
           [30.93199592162739, 1.3317767848637163],
           [30.931242220894205, 1.3313155694904042],
           [30.930697732464182, 1.3308087687772105]]],
         [[[30.931078606144297, 1.330331464306588],
           [30.931320004955637, 1.3304226348305805],
           [30.93127172519337, 1.3305352572379163],
           [30.931024961964, 1.3304145903727174]]],
         [[[30.932167583004343, 1.3307873168928621],
           [30.932124667660105, 1.3306559240972378],
           [30.93234192659031, 1.3306049758684642],
           [30.93239557077061, 1.3307175982674924]]],
         [[[30.93314122487675, 1.3312217175143324],
           [30.933100991741526, 1.3311171395939427],
           [30.933160000339853, 1.3310608284042056],
           [30.93327265311848, 1.331119821079138],
           [30.93325655986439, 1.3311814952377772]]],
         [[[30.932897143856394, 1.3317017032972045],
           [30.93325119544636, 1.3316829329052138],
           [30.933253877655375, 1.3318840442404856],
           [30.932891779438364, 1.33188136275613]]],
         [[[30.938516371742594, 1.3301759381108358],
           [30.93838226129185, 1.3299453302852657],
           [30.938806050316202, 1.3297361743318183],
           [30.93882750798832, 1.329864885689892],
           [30.938763134971964, 1.330074041632424]]],
         [[[30.935008042351114, 1.3320637036861291],
           [30.93537282277714, 1.331977896191342],
           [30.93533527185093, 1.3322514075705651],
           [30.935002677933085, 1.3322514075705651]]],
         [[[30.915159890705695, 1.3334848664853984],
           [30.915248403603186, 1.332766229038869],
           [30.91516793733274, 1.3327528216218236],
           [30.915165255123725, 1.3325892511280628],
           [30.915417382771125, 1.332597295578827],
           [30.91544152265226, 1.3328118142562613],
           [30.9154307938162, 1.333321296040262],
           [30.91528863673841, 1.3334955924158491],
           [30.91505796676313, 1.3340318888786917],
           [30.914907763058295, 1.333954125898827]]],
         [[[30.915589044148078, 1.3333132515918642],
           [30.915605137402167, 1.3324256806234247],
           [30.9156829214636, 1.33223261378431],
           [30.91587604051267, 1.3322352952682968],
           [30.915862629467597, 1.3326857845355278],
           [30.91577143436109, 1.3334044220055552],
           [30.915610501820197, 1.3335787183752519],
           [30.915516624504676, 1.3338522295766566],
           [30.915444204861274, 1.334123059265755],
           [30.915232310349097, 1.3341069703741628]]],
         [[[30.915175983959784, 1.3320583173193365],
           [30.91553003554975, 1.3320288209932822],
           [30.915511260086646, 1.3324069102369556],
           [30.915066013390174, 1.3324176361721007]]],
         [[[30.823697575375718, 1.3342288018611486],
           [30.823625155732316, 1.334218075933891],
           [30.823614426896256, 1.3340491425734895],
           [30.823335477158707, 1.334025009235344],
           [30.823322066113633, 1.333866801790521],
           [30.82350713853566, 1.333866801790521],
           [30.82379681710927, 1.3336898239588215],
           [30.82398993615834, 1.334126905550352],
           [30.82391751651494, 1.3341322685141777],
           [30.82391215209691, 1.3342904759419405],
           [30.82391215209691, 1.3346712463195614],
           [30.823721715256852, 1.3346873352074642]]],
         [[[30.824690582630865, 1.33486660480219],
           [30.82502854096674, 1.335022130701769],
           [30.82569104659342, 1.33542703429072],
           [30.825677635548345, 1.335676411964622],
           [30.825315537331335, 1.3356710490041674],
           [30.824618162987463, 1.335585241635165],
           [30.824438454983465, 1.3353975380050334]]],
         [[[30.985833911981445, 1.3487303460234428],
           [30.985817818727355, 1.3471268288785565],
           [30.986043124284606, 1.347169732361067],
           [30.986048488702636, 1.3487893382728424],
           [30.985823183145385, 1.348767886545957]]],
         [[[30.98616114148126, 1.3468694079676538],
           [30.986370353784423, 1.3467889639274266],
           [30.98641326912866, 1.347384249762259],
           [30.98619869240747, 1.3473949756318213]]]]),
    nobuilding = ui.import && ui.import("nobuilding", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                31.006857066240173,
                1.3604697753988773
              ],
              [
                31.00295176991449,
                1.355021056915185
              ],
              [
                31.006985812272887,
                1.3548923468813672
              ],
              [
                31.00917449482904,
                1.3587965481951143
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.993340138533767,
                1.3342302369994412
              ],
              [
                30.99398386869734,
                1.3345949184979886
              ],
              [
                30.993576172927078,
                1.3352813776426868
              ],
              [
                30.99301827345198,
                1.3348952443973692
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.86819121137887,
                1.386693099574941
              ],
              [
                30.875400989210902,
                1.3865858426326827
              ],
              [
                30.875400989210902,
                1.393042701882538
              ],
              [
                30.86847016111642,
                1.393021250552153
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.899108390258903,
                1.3385536378548437
              ],
              [
                30.901372174667472,
                1.3385590008090007
              ],
              [
                30.90139899675762,
                1.3394170733243327
              ],
              [
                30.899081568168754,
                1.3394438880856017
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.899580459045524,
                1.3415515274025096
              ],
              [
                30.901747683929557,
                1.342023466746389
              ],
              [
                30.899473170684928,
                1.3426026649076037
              ]
            ]
          ],
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#0b4a8b",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[31.006857066240173, 1.3604697753988773],
           [31.00295176991449, 1.355021056915185],
           [31.006985812272887, 1.3548923468813672],
           [31.00917449482904, 1.3587965481951143]]],
         [[[30.993340138533767, 1.3342302369994412],
           [30.99398386869734, 1.3345949184979886],
           [30.993576172927078, 1.3352813776426868],
           [30.99301827345198, 1.3348952443973692]]],
         [[[30.86819121137887, 1.386693099574941],
           [30.875400989210902, 1.3865858426326827],
           [30.875400989210902, 1.393042701882538],
           [30.86847016111642, 1.393021250552153]]],
         [[[30.899108390258903, 1.3385536378548437],
           [30.901372174667472, 1.3385590008090007],
           [30.90139899675762, 1.3394170733243327],
           [30.899081568168754, 1.3394438880856017]]],
         [[[30.899580459045524, 1.3415515274025096],
           [30.901747683929557, 1.342023466746389],
           [30.899473170684928, 1.3426026649076037]]]]),
    geometry2 = ui.import && ui.import("geometry2", "geometry", {
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                30.857634925785987,
                1.3985304732883717
              ],
              [
                30.85735597604844,
                1.3970503344863447
              ],
              [
                30.859909439030616,
                1.3961708312781658
              ],
              [
                30.861626052800148,
                1.3986591809661872
              ],
              [
                30.866732978764503,
                1.3994314268847916
              ],
              [
                30.866668605748146,
                1.4021557368437583
              ],
              [
                30.865145111027687,
                1.4029494328498249
              ],
              [
                30.862677478733985,
                1.402413151794149
              ],
              [
                30.86010255807969,
                1.40058979528592
              ],
              [
                30.858471774998634,
                1.3991525603324093
              ]
            ]
          ],
          "evenOdd": true
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": false,
      "locked": false
    }) || 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[30.857634925785987, 1.3985304732883717],
          [30.85735597604844, 1.3970503344863447],
          [30.859909439030616, 1.3961708312781658],
          [30.861626052800148, 1.3986591809661872],
          [30.866732978764503, 1.3994314268847916],
          [30.866668605748146, 1.4021557368437583],
          [30.865145111027687, 1.4029494328498249],
          [30.862677478733985, 1.402413151794149],
          [30.86010255807969, 1.40058979528592],
          [30.858471774998634, 1.3991525603324093]]]),
    Kagadi = ui.import && ui.import("Kagadi", "geometry", {
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            30.809091670339996,
            0.9379894036193277
          ]
        }
      ],
      "displayProperties": [],
      "properties": {},
      "color": "#d63000",
      "mode": "Geometry",
      "shown": true,
      "locked": false
    }) || /* color: #d63000 */ee.Geometry.Point([30.809091670339996, 0.9379894036193277]);
// imports of external modules
var s2 = require('users/olivierqueyrut/eolab:Sentinel2Module')
var s2proc = require('users/olivierqueyrut/eolab:ProcessingModule')
var debug_s1 = false
var debug_s2 = true
// S1
print("SENTINEL 1 ---------------------------------------")
var masks1 = function(polarization, desc_thres, asc_thres) {
  var mosaicS1 = ee.ImageCollection('COPERNICUS/S1_GRD')
          .filter(ee.Filter.listContains('transmitterReceiverPolarisation', polarization))
          .filter(ee.Filter.eq('instrumentMode', 'IW'))
          .select(polarization)
  var start = '2019-06-01'
  var end = '2019-09-01'
  var desc = mosaicS1.filter(ee.Filter.eq('orbitProperties_pass', 'DESCENDING'))
                .filterDate(start, end).mean()
  var asc  = mosaicS1.filter(ee.Filter.eq('orbitProperties_pass', 'ASCENDING'))
                .filterDate(start, end).mean()
  var mask = desc.select(polarization).gt(desc_thres).or(asc.select(polarization).gt(asc_thres))
  return [desc, asc, mask]
}
var s1_vv = masks1('VV', -10, -10)
var s1_vh = masks1('VH', -20, -20)
var masks1 = s1_vv[2].and(s1_vh[2])
if(debug_s1) {
  Map.addLayer(s1_vv[0], {min: -25, max: 5}, 'S1 VV desc', false)
  Map.addLayer(s1_vv[1], {min: -25, max: 5}, 'S1 VV asc', false)
  Map.addLayer(s1_vh[0], {min: -25, max: 5}, 'S1 VH desc', false)
  Map.addLayer(s1_vh[1], {min: -25, max: 5}, 'S1 VH asc', false)
  Map.addLayer(s1_vv[2], {}, 'Mask S1 vv', false)
  Map.addLayer(s1_vh[2], {}, 'Mask S1 vh', false)
}
Map.addLayer(masks1, {}, 'Mask S1', false)
/*
var texture = s1_vv[0].reduceNeighborhood({
  reducer: ee.Reducer.max(),
  kernel: ee.Kernel.circle(7),
});
Map.addLayer(texture, {min: -8, max: 5}, 'SD of S1 VV desc');
*/
print("SENTINEL 2 ---------------------------------------")
// display configurations
var buVis = { min: -2.0, max: 2.0 }
var biVis = { min: 0.0, max: 4000 }
var ndVis = { min: -1.0, max: 1.0 }
var masks2 = function(image, geometry) {
  // compute various indices
  var ndbi = image.normalizedDifference(['B11', 'B8'])
  var ndvi = image.normalizedDifference(['B8', 'B4'])
  var ndwi = image.normalizedDifference(['B3', 'B8'])
  var bi = s2proc.bi(image, ['B4', 'B3'])
  var bi2 = s2proc.bi2(image, ['B4', 'B3', 'B8'])
  var bu = ndbi.select('nd').subtract(ndvi.select('nd'))
  // filter input images where ndvi < 0.4
  var ndvi_threshold = 0.4
  var ndwi_threshold = 0.3
  var bi_threshold = 900
  //bi_threshold = s2proc.otsuThreshold(bi, 'B4', geometry, true)
  var bu_threshold = s2proc.otsuThreshold(bu, 'nd', geometry, false)
  print(bi_threshold)
  print(bu_threshold)
  var classNotVeg = ndvi.select('nd').lt(ndvi_threshold)
  var classNotWat = ndwi.select('nd').lt(ndwi_threshold)
  var classBrilliant = bi.select('B4').gt(bi_threshold)
  var classBuilding = bu.select('nd').gt(bu_threshold)
  var mask = classNotVeg.and(classNotWat)
  mask = mask.and(classBrilliant)
  return [ndvi, ndwi, bi, bu, mask] 
}
var s2_jul = masks2(imageJul, geometry)
var s2_jan = masks2(imageJan, geometry)
var masks2 = s2_jan[4].and(s2_jul[4])
if(debug_s2) {
  Map.addLayer(s2_jul[0], ndVis, "NDVI Jul", false)
  Map.addLayer(s2_jul[1], ndVis, "NDWI Jul", false)
  Map.addLayer(s2_jul[2], biVis, "BI Jul", false)
  Map.addLayer(s2_jul[3], buVis, "BU Jul", false)
  Map.addLayer(s2_jan[0], ndVis, "NDVI Jan", false)
  Map.addLayer(s2_jan[1], ndVis, "NDWI Jan", false)
  Map.addLayer(s2_jan[2], biVis, "BI Jan", false)
  Map.addLayer(s2_jan[3], buVis, "BU Jan", false)
}
Map.addLayer(masks2, {}, "Mask S2", false)
print("Mixing S1 and S2 masks ---------------------------------------")
var mask = masks2.and(masks1)
Map.addLayer(mask, {opacity: 0.4}, "Mask S1+S2", true)
// display images
var displayImage = function(image, filteredImage, label) {
  Map.addLayer(image, {
      bands: ['B4', 'B3', 'B2'],
      max: 4000,
    }, label + ' composite', false);
  Map.addLayer(filteredImage, {
      bands: ['B4', 'B3', 'B2'],
      max: 4000,
    }, label + ' composite(filtered)', false);
  Map.addLayer(filteredImage, {
      bands: ['B8', 'B4', 'B3'],
      max: 4000,
    }, label + ' nir (filtered)', false);
  Map.addLayer(filteredImage, {
      bands: ['B12', 'B11', 'B4'],
      max: 4000,
    }, label + ' swir (filtered)', false);
}
var filteredJul = s2.cloudMaskS2(imageJul.mask(mask))
var filteredJan = s2.cloudMaskS2(imageJan.mask(mask))
displayImage(imageJul, filteredJul, 'Jul');
displayImage(imageJan, filteredJan, 'Jan');
// Unsupervised classification
var classifimage = ee.Image.cat([//s2_jan[2].mask(mask), s2_jul[2].mask(mask),  // bi
                                 //s2_jan[0].mask(mask), s2_jul[0].mask(mask),  // ndvi
                                 s1_vv, s1_vh,
                                 filteredJan.select(['B2', 'B3', 'B4', 'B8', 'B11', 'B12']), 
                                 filteredJul.select(['B2', 'B3', 'B4', 'B8', 'B11', 'B12'])]);
// ee.Image.cat([imageJul.select(['B2', 'B3', 'B4', 'B8', 'B11', 'B12']), imageJan.select(['B2', 'B3', 'B4', 'B8', 'B11', 'B12'])]);
print(classifimage);
var training = classifimage.sample({
  region: geometry,
  scale: 20,
  factor: 0.1
});
var clusterer = ee.Clusterer.wekaKMeans(3).train(training);
var result = classifimage.cluster(clusterer);
var data = result.select("cluster").reduceRegion(ee.Reducer.first(), geometry4, 10).get("cluster");
var dataN = ee.Number(data)
print(dataN)
Map.addLayer(result.randomVisualizer(), {}, 'clusters', false);
var classCluster = result.select('cluster').eq(dataN);
Map.addLayer(result.mask(classCluster), 
  {palette: 'blue', opacity: 0.9}, ' class cluster', false);
/*
// Supervised classification
// Use these bands for prediction.
var bands = ['B2', 'B3', 'B4', 'B8', 'B11', 'B12'];
// Make a FeatureCollection from the hand-made geometries.
var polygons = ee.FeatureCollection([
  ee.Feature(building, {'class': 1}),
  ee.Feature(nobuilding, {'class': 0})
]);
// Get the values for all pixels in each polygon in the training.
var training = imageJan.sampleRegions({
  // Get the sample from the polygons FeatureCollection.
  collection: polygons,
  // Keep this list of properties from the polygons.
  properties: ['class'],
  // Set the scale to get S2 pixels in the polygons.
  scale: 20
});
// Create an SVM classifier with custom parameters.
var classifier = ee.Classifier.svm({
  kernelType: 'RBF',
  gamma: 0.5,
  cost: 10
});
// Train the classifier.
var trained = classifier.train(training, 'class', bands);
// Classify the image.
var classified = imageJan.classify(trained);
// Display the classification result and the input image.
Map.addLayer(classified,
             {min: 0, max: 1, palette: ['red', 'green']},
             'buildings');
*/
Map.centerObject(Kagadi, 13);